===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Args: ['/home/klipper/klipper/klippy/klippy.py', '/home/klipper/printer_data/config/printer.cfg', '-I', '/home/klipper/printer_data/comms/klippy.serial', '-l', '/home/klipper/printer_data/logs/klippy.log', '-a', '/home/klipper/printer_data/comms/klippy.sock']
Git version: 'v0.12.0-404-g80d185c94-dirty'
Untracked files: klippy/extras/gcode_shell_command.py, klippy/extras/led_effect.py
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.10.12 (main, Nov  6 2024, 20:22:13) [GCC 11.4.0]'
webhooks client 281473444406240: {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
=============== Log rollover at Mon Dec 30 12:17:46 2024 ===============
Stats 53041.9: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000020 mcu_task_stddev=0.000019 bytes_write=1005186 bytes_read=9063380 bytes_retransmit=9 bytes_invalid=0 send_seq=82045 receive_seq=82045 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998278  orange_pi: temp=45.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.68 cputime=1191.185 memavail=1721268 print_time=52568.406 buffer_time=0.501 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
webhooks client 281473444406240: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:17:47 2024 (1735550268.0 53043.5)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473464771264: New connection
webhooks client 281473464771264: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 1393412224, 'value': 31201, '#name': 'analog_in_state', '#sent_time': 53046.686487044004, '#receive_time': 53046.718115335}
mcu 'mcu': got {'oid': 19, 'next_clock': 1396292224, 'value': 31252, '#name': 'analog_in_state', '#sent_time': 53046.738514085, '#receive_time': 53046.758109669}
mcu 'mcu': got {'oid': 27, 'next_clock': 1402052224, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53046.790740002, '#receive_time': 53046.838115085004}
mcu 'mcu': got {'oid': 15, 'next_clock': 1415012224, 'value': 31208, '#name': 'analog_in_state', '#sent_time': 53046.997977294, '#receive_time': 53047.018118252}
mcu 'mcu': got {'oid': 19, 'next_clock': 1417892224, 'value': 31252, '#name': 'analog_in_state', '#sent_time': 53047.049845127, '#receive_time': 53047.058116627}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53047.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3089 bytes_read=6282 bytes_retransmit=9 bytes_invalid=0 send_seq=224 receive_seq=221 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71995440  orange_pi: temp=47.4 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.65 cputime=1194.232 memavail=1721660 print_time=52573.880 buffer_time=0.240 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473464771264
webhooks: registering remote method 'reboot_machine' for connection id: 281473464771264
webhooks: registering remote method 'pause_job_queue' for connection id: 281473464771264
webhooks: registering remote method 'start_job_queue' for connection id: 281473464771264
Stats 53048.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7134 bytes_read=7263 bytes_retransmit=9 bytes_invalid=0 send_seq=332 receive_seq=331 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71996623  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.65 cputime=1194.336 memavail=1721440 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53049.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=9096 bytes_read=8233 bytes_retransmit=9 bytes_invalid=0 send_seq=411 receive_seq=411 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997362  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.65 cputime=1194.435 memavail=1721200 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 53050.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=10878 bytes_read=9031 bytes_retransmit=9 bytes_invalid=0 send_seq=473 receive_seq=473 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997913  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.65 cputime=1194.510 memavail=1721200 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53051.6: gcodein=0  mcu: mcu_awake=0.165 mcu_task_avg=0.000203 mcu_task_stddev=0.000289 bytes_write=12909 bytes_read=10218 bytes_retransmit=9 bytes_invalid=0 send_seq=566 receive_seq=566 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998061  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.65 cputime=1194.598 memavail=1721200 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53052.6: gcodein=0  mcu: mcu_awake=0.165 mcu_task_avg=0.000203 mcu_task_stddev=0.000289 bytes_write=14600 bytes_read=10991 bytes_retransmit=9 bytes_invalid=0 send_seq=629 receive_seq=629 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998012  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.65 cputime=1194.672 memavail=1720948 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53053.6: gcodein=0  mcu: mcu_awake=0.165 mcu_task_avg=0.000203 mcu_task_stddev=0.000289 bytes_write=16147 bytes_read=11737 bytes_retransmit=9 bytes_invalid=0 send_seq=687 receive_seq=687 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998012  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.60 cputime=1194.743 memavail=1720700 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53054.6: gcodein=0  mcu: mcu_awake=0.165 mcu_task_avg=0.000203 mcu_task_stddev=0.000289 bytes_write=18016 bytes_read=12660 bytes_retransmit=9 bytes_invalid=0 send_seq=761 receive_seq=761 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998022  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.60 cputime=1194.822 memavail=1720700 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53055.6: gcodein=0  mcu: mcu_awake=0.165 mcu_task_avg=0.000203 mcu_task_stddev=0.000289 bytes_write=19888 bytes_read=13558 bytes_retransmit=9 bytes_invalid=0 send_seq=833 receive_seq=833 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998096  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.60 cputime=1194.898 memavail=1720700 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53056.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000247 mcu_task_stddev=0.000268 bytes_write=21832 bytes_read=14578 bytes_retransmit=9 bytes_invalid=0 send_seq=912 receive_seq=912 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998087  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.60 cputime=1194.980 memavail=1720700 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53057.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000247 mcu_task_stddev=0.000268 bytes_write=23751 bytes_read=15678 bytes_retransmit=9 bytes_invalid=0 send_seq=999 receive_seq=999 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998090  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.60 cputime=1195.066 memavail=1720700 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53058.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000247 mcu_task_stddev=0.000268 bytes_write=25179 bytes_read=16405 bytes_retransmit=9 bytes_invalid=0 send_seq=1056 receive_seq=1056 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998716  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.55 cputime=1195.137 memavail=1720700 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53059.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000247 mcu_task_stddev=0.000268 bytes_write=27007 bytes_read=17234 bytes_retransmit=9 bytes_invalid=0 send_seq=1121 receive_seq=1121 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998583  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.55 cputime=1195.212 memavail=1720700 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53060.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000247 mcu_task_stddev=0.000268 bytes_write=28837 bytes_read=18040 bytes_retransmit=9 bytes_invalid=0 send_seq=1186 receive_seq=1186 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998479  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.55 cputime=1195.288 memavail=1720700 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53061.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000246 mcu_task_stddev=0.000267 bytes_write=30739 bytes_read=18931 bytes_retransmit=9 bytes_invalid=0 send_seq=1258 receive_seq=1258 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998413  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.55 cputime=1195.369 memavail=1720704 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53062.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000246 mcu_task_stddev=0.000267 bytes_write=32644 bytes_read=19970 bytes_retransmit=9 bytes_invalid=0 send_seq=1341 receive_seq=1341 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998354  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.55 cputime=1195.452 memavail=1720452 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53063.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000246 mcu_task_stddev=0.000267 bytes_write=33938 bytes_read=20546 bytes_retransmit=9 bytes_invalid=0 send_seq=1384 receive_seq=1384 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998324  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.51 cputime=1195.515 memavail=1719960 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53064.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000246 mcu_task_stddev=0.000267 bytes_write=35826 bytes_read=21394 bytes_retransmit=9 bytes_invalid=0 send_seq=1454 receive_seq=1454 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998298  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.51 cputime=1195.611 memavail=1719204 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53065.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000246 mcu_task_stddev=0.000267 bytes_write=37658 bytes_read=22272 bytes_retransmit=9 bytes_invalid=0 send_seq=1524 receive_seq=1524 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998282  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.51 cputime=1195.690 memavail=1718448 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53066.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000246 mcu_task_stddev=0.000267 bytes_write=39562 bytes_read=23177 bytes_retransmit=9 bytes_invalid=0 send_seq=1596 receive_seq=1596 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998264  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.51 cputime=1195.771 memavail=1718332 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53067.6: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000241 mcu_task_stddev=0.000268 bytes_write=41388 bytes_read=23946 bytes_retransmit=9 bytes_invalid=0 send_seq=1659 receive_seq=1658 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998253  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.51 cputime=1195.844 memavail=1718472 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53068.6: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000241 mcu_task_stddev=0.000268 bytes_write=42755 bytes_read=24638 bytes_retransmit=9 bytes_invalid=0 send_seq=1710 receive_seq=1710 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998248  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.47 cputime=1195.912 memavail=1718228 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53069.6: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000241 mcu_task_stddev=0.000268 bytes_write=44722 bytes_read=25743 bytes_retransmit=9 bytes_invalid=0 send_seq=1798 receive_seq=1798 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998236  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.47 cputime=1195.998 memavail=1717992 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53070.6: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000241 mcu_task_stddev=0.000268 bytes_write=46662 bytes_read=26784 bytes_retransmit=9 bytes_invalid=0 send_seq=1881 receive_seq=1881 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998440  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.47 cputime=1196.080 memavail=1718508 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53071.6: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000241 mcu_task_stddev=0.000268 bytes_write=48636 bytes_read=27805 bytes_retransmit=9 bytes_invalid=0 send_seq=1962 receive_seq=1962 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998401  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.47 cputime=1196.162 memavail=1718524 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53072.6: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000255 mcu_task_stddev=0.000266 bytes_write=50469 bytes_read=28578 bytes_retransmit=9 bytes_invalid=0 send_seq=2026 receive_seq=2025 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998371  orange_pi: temp=45.9 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.47 cputime=1196.235 memavail=1718452 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53073.6: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000255 mcu_task_stddev=0.000266 bytes_write=51737 bytes_read=29183 bytes_retransmit=9 bytes_invalid=0 send_seq=2072 receive_seq=2072 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998501  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.59 cputime=1196.300 memavail=1718596 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53074.6: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000255 mcu_task_stddev=0.000266 bytes_write=53725 bytes_read=30251 bytes_retransmit=9 bytes_invalid=0 send_seq=2156 receive_seq=2156 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998457  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.59 cputime=1196.384 memavail=1718360 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53075.6: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000255 mcu_task_stddev=0.000266 bytes_write=55653 bytes_read=31197 bytes_retransmit=9 bytes_invalid=0 send_seq=2233 receive_seq=2233 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998428  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.59 cputime=1196.463 memavail=1719120 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53076.6: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000255 mcu_task_stddev=0.000266 bytes_write=57550 bytes_read=32172 bytes_retransmit=9 bytes_invalid=0 send_seq=2311 receive_seq=2311 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998397  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.59 cputime=1196.547 memavail=1719644 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53077.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000244 mcu_task_stddev=0.000267 bytes_write=59303 bytes_read=32886 bytes_retransmit=9 bytes_invalid=0 send_seq=2367 receive_seq=2367 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998379  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.59 cputime=1196.617 memavail=1720168 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53078.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000244 mcu_task_stddev=0.000267 bytes_write=60657 bytes_read=33574 bytes_retransmit=9 bytes_invalid=0 send_seq=2419 receive_seq=2419 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998344  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.54 cputime=1196.688 memavail=1720168 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53079.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000244 mcu_task_stddev=0.000267 bytes_write=62568 bytes_read=34505 bytes_retransmit=9 bytes_invalid=0 send_seq=2493 receive_seq=2493 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998326  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.54 cputime=1196.767 memavail=1719704 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53080.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000244 mcu_task_stddev=0.000267 bytes_write=64448 bytes_read=35436 bytes_retransmit=9 bytes_invalid=0 send_seq=2568 receive_seq=2567 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998312  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.54 cputime=1196.849 memavail=1719976 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53081.6: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000244 mcu_task_stddev=0.000267 bytes_write=66405 bytes_read=36536 bytes_retransmit=9 bytes_invalid=0 send_seq=2654 receive_seq=2654 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998298  orange_pi: temp=46.6 chamber_heater: target=0 temp=27.4 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.54 cputime=1196.933 memavail=1719976 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53082.6: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=68373 bytes_read=37559 bytes_retransmit=9 bytes_invalid=0 send_seq=2735 receive_seq=2735 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998295  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.54 cputime=1197.015 memavail=1719724 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53083.6: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=69712 bytes_read=38179 bytes_retransmit=9 bytes_invalid=0 send_seq=2783 receive_seq=2782 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998287  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.50 cputime=1197.082 memavail=1719980 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53084.6: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=71519 bytes_read=39016 bytes_retransmit=9 bytes_invalid=0 send_seq=2850 receive_seq=2850 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998278  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.50 cputime=1197.157 memavail=1720000 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53085.6: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=73347 bytes_read=39793 bytes_retransmit=9 bytes_invalid=0 send_seq=2914 receive_seq=2914 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998270  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.50 cputime=1197.232 memavail=1720788 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53086.6: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=75307 bytes_read=40809 bytes_retransmit=9 bytes_invalid=0 send_seq=2995 receive_seq=2995 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998267  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.50 cputime=1197.315 memavail=1721292 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53087.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000239 mcu_task_stddev=0.000265 bytes_write=77282 bytes_read=41863 bytes_retransmit=9 bytes_invalid=0 send_seq=3079 receive_seq=3078 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998260  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.50 cputime=1197.398 memavail=1721816 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53088.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000239 mcu_task_stddev=0.000265 bytes_write=78557 bytes_read=42503 bytes_retransmit=9 bytes_invalid=0 send_seq=3128 receive_seq=3128 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998255  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.46 cputime=1197.462 memavail=1722088 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53089.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000239 mcu_task_stddev=0.000265 bytes_write=80384 bytes_read=43267 bytes_retransmit=9 bytes_invalid=0 send_seq=3190 receive_seq=3190 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998251  orange_pi: temp=46.3 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.46 cputime=1197.535 memavail=1721836 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 53090.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000239 mcu_task_stddev=0.000265 bytes_write=82371 bytes_read=44361 bytes_retransmit=9 bytes_invalid=0 send_seq=3276 receive_seq=3276 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998248  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.46 cputime=1197.626 memavail=1721608 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Stats 53091.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000239 mcu_task_stddev=0.000265 bytes_write=84318 bytes_read=45419 bytes_retransmit=9 bytes_invalid=0 send_seq=3361 receive_seq=3361 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998318  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.46 cputime=1197.711 memavail=1721384 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53092.6: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000260 mcu_task_stddev=0.000269 bytes_write=86267 bytes_read=46479 bytes_retransmit=9 bytes_invalid=0 send_seq=3443 receive_seq=3443 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998310  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.46 cputime=1197.793 memavail=1720632 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53093.6: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000260 mcu_task_stddev=0.000269 bytes_write=87561 bytes_read=47052 bytes_retransmit=9 bytes_invalid=0 send_seq=3487 receive_seq=3487 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998300  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.42 cputime=1197.857 memavail=1721408 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53094.6: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000260 mcu_task_stddev=0.000269 bytes_write=89463 bytes_read=47941 bytes_retransmit=9 bytes_invalid=0 send_seq=3559 receive_seq=3559 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998292  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.42 cputime=1197.933 memavail=1721680 print_time=52573.880 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53095.6: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000260 mcu_task_stddev=0.000269 bytes_write=91317 bytes_read=48893 bytes_retransmit=9 bytes_invalid=0 send_seq=3634 receive_seq=3634 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998286  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.42 cputime=1198.019 memavail=1721448 print_time=52622.292 buffer_time=0.622 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473464771264: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:18:41 2024 (1735550321.9 53097.4)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 1 top (.5,.5,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473464289744: New connection
webhooks client 281473464289744: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 979244928, 'value': 31178, '#name': 'analog_in_state', '#sent_time': 53100.574695736, '#receive_time': 53100.619411611}
mcu 'mcu': got {'oid': 19, 'next_clock': 982124928, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53100.626742653, '#receive_time': 53100.659443486}
mcu 'mcu': got {'oid': 27, 'next_clock': 987884928, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53100.730859278, '#receive_time': 53100.739410403}
mcu 'mcu': got {'oid': 15, 'next_clock': 1000844928, 'value': 31164, '#name': 'analog_in_state', '#sent_time': 53100.886039278004, '#receive_time': 53100.919475403}
mcu 'mcu': got {'oid': 19, 'next_clock': 1003724928, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 53100.938038444, '#receive_time': 53100.959413111}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53101.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3089 bytes_read=6267 bytes_retransmit=9 bytes_invalid=0 send_seq=213 receive_seq=210 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71995163  orange_pi: temp=47.4 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.55 cputime=1201.108 memavail=1721640 print_time=52627.765 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473464289744
webhooks: registering remote method 'reboot_machine' for connection id: 281473464289744
webhooks: registering remote method 'pause_job_queue' for connection id: 281473464289744
webhooks: registering remote method 'start_job_queue' for connection id: 281473464289744
Stats 53102.5: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000118 mcu_task_stddev=0.000267 bytes_write=7170 bytes_read=7073 bytes_retransmit=9 bytes_invalid=0 send_seq=307 receive_seq=307 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996591  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.55 cputime=1201.202 memavail=1721220 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53103.5: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000118 mcu_task_stddev=0.000267 bytes_write=9014 bytes_read=7811 bytes_retransmit=9 bytes_invalid=0 send_seq=369 receive_seq=368 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997428  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.50 cputime=1201.297 memavail=1720652 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53104.5: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000118 mcu_task_stddev=0.000267 bytes_write=10599 bytes_read=8504 bytes_retransmit=9 bytes_invalid=0 send_seq=423 receive_seq=423 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998089  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.50 cputime=1201.368 memavail=1721012 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53105.5: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000118 mcu_task_stddev=0.000267 bytes_write=12587 bytes_read=9580 bytes_retransmit=9 bytes_invalid=0 send_seq=508 receive_seq=507 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998058  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.50 cputime=1201.454 memavail=1721508 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53106.5: gcodein=0  mcu: mcu_awake=0.059 mcu_task_avg=0.000118 mcu_task_stddev=0.000267 bytes_write=14532 bytes_read=10594 bytes_retransmit=9 bytes_invalid=0 send_seq=588 receive_seq=588 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998021  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.50 cputime=1201.538 memavail=1722024 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53107.5: gcodein=0  mcu: mcu_awake=0.118 mcu_task_avg=0.000275 mcu_task_stddev=0.000271 bytes_write=16127 bytes_read=11252 bytes_retransmit=9 bytes_invalid=0 send_seq=640 receive_seq=639 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998030  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.50 cputime=1201.606 memavail=1722288 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53108.5: gcodein=0  mcu: mcu_awake=0.118 mcu_task_avg=0.000275 mcu_task_stddev=0.000271 bytes_write=18034 bytes_read=12203 bytes_retransmit=9 bytes_invalid=0 send_seq=715 receive_seq=714 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998024  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.46 cputime=1201.686 memavail=1721544 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53109.5: gcodein=0  mcu: mcu_awake=0.118 mcu_task_avg=0.000275 mcu_task_stddev=0.000271 bytes_write=19780 bytes_read=13077 bytes_retransmit=9 bytes_invalid=0 send_seq=784 receive_seq=783 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998043  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.46 cputime=1201.761 memavail=1721572 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53110.5: gcodein=0  mcu: mcu_awake=0.118 mcu_task_avg=0.000275 mcu_task_stddev=0.000271 bytes_write=21547 bytes_read=13850 bytes_retransmit=9 bytes_invalid=0 send_seq=846 receive_seq=846 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998061  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.46 cputime=1201.833 memavail=1721572 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53111.5: gcodein=0  mcu: mcu_awake=0.118 mcu_task_avg=0.000275 mcu_task_stddev=0.000271 bytes_write=23409 bytes_read=14705 bytes_retransmit=9 bytes_invalid=0 send_seq=913 receive_seq=913 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998093  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.46 cputime=1201.911 memavail=1721844 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53112.5: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000277 mcu_task_stddev=0.000271 bytes_write=25209 bytes_read=15650 bytes_retransmit=9 bytes_invalid=0 send_seq=988 receive_seq=988 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998103  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.46 cputime=1201.988 memavail=1721592 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53113.5: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000277 mcu_task_stddev=0.000271 bytes_write=27244 bytes_read=16758 bytes_retransmit=9 bytes_invalid=0 send_seq=1079 receive_seq=1078 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998111  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.43 cputime=1202.075 memavail=1721612 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53114.5: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000277 mcu_task_stddev=0.000271 bytes_write=28806 bytes_read=17434 bytes_retransmit=9 bytes_invalid=0 send_seq=1130 receive_seq=1130 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998539  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.43 cputime=1202.144 memavail=1721624 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53115.5: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000277 mcu_task_stddev=0.000271 bytes_write=30642 bytes_read=18188 bytes_retransmit=9 bytes_invalid=0 send_seq=1191 receive_seq=1191 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998459  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.43 cputime=1202.219 memavail=1721300 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53116.5: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000277 mcu_task_stddev=0.000271 bytes_write=32656 bytes_read=19249 bytes_retransmit=9 bytes_invalid=0 send_seq=1278 receive_seq=1278 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998405  orange_pi: temp=46.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.43 cputime=1202.302 memavail=1721440 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53117.5: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000290 mcu_task_stddev=0.000269 bytes_write=34378 bytes_read=20168 bytes_retransmit=9 bytes_invalid=0 send_seq=1348 receive_seq=1348 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998353  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.43 cputime=1202.378 memavail=1721188 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53118.5: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000290 mcu_task_stddev=0.000269 bytes_write=36313 bytes_read=21185 bytes_retransmit=9 bytes_invalid=0 send_seq=1428 receive_seq=1428 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998320  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.39 cputime=1202.478 memavail=1720936 print_time=52627.765 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53119.5: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000290 mcu_task_stddev=0.000269 bytes_write=37968 bytes_read=21862 bytes_retransmit=9 bytes_invalid=0 send_seq=1484 receive_seq=1483 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998310  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.8 pwm=0.000 sysload=1.39 cputime=1202.552 memavail=1721196 print_time=52646.411 buffer_time=0.876 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
webhooks client 281473464289744: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:19:05 2024 (1735550346.0 53121.5)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  2 1 top (.5,.5,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473445077840: New connection
webhooks client 281473445077840: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 27, 'next_clock': 2715884928, 'value': 31249, '#name': 'analog_in_state', '#sent_time': 53124.691521997, '#receive_time': 53124.739991164}
mcu 'mcu': got {'oid': 15, 'next_clock': 2728844928, 'value': 31191, '#name': 'analog_in_state', '#sent_time': 53124.899223789, '#receive_time': 53124.919981289}
mcu 'mcu': got {'oid': 19, 'next_clock': 2731724928, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 53124.950925831, '#receive_time': 53124.959982414}
mcu 'mcu': got {'oid': 27, 'next_clock': 2737484928, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53125.002703623, '#receive_time': 53125.040028831}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53125.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3094 bytes_read=6257 bytes_retransmit=9 bytes_invalid=0 send_seq=222 receive_seq=219 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1924 upcoming_bytes=257 freq=71995317  orange_pi: temp=48.4 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.60 cputime=1205.657 memavail=1720852 print_time=52651.882 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473445077840
webhooks: registering remote method 'reboot_machine' for connection id: 281473445077840
webhooks: registering remote method 'pause_job_queue' for connection id: 281473445077840
webhooks: registering remote method 'start_job_queue' for connection id: 281473445077840
Stats 53126.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7244 bytes_read=7178 bytes_retransmit=9 bytes_invalid=0 send_seq=325 receive_seq=325 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996691  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.60 cputime=1205.756 memavail=1720600 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53127.6: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000142 mcu_task_stddev=0.000276 bytes_write=9130 bytes_read=7996 bytes_retransmit=9 bytes_invalid=0 send_seq=393 receive_seq=392 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997350  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.60 cputime=1205.850 memavail=1720124 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53128.6: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000142 mcu_task_stddev=0.000276 bytes_write=11004 bytes_read=9002 bytes_retransmit=9 bytes_invalid=0 send_seq=470 receive_seq=470 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997720  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.55 cputime=1205.931 memavail=1720128 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53129.6: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000142 mcu_task_stddev=0.000276 bytes_write=12983 bytes_read=10055 bytes_retransmit=9 bytes_invalid=0 send_seq=554 receive_seq=554 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997908  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.55 cputime=1206.016 memavail=1720128 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53130.6: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000142 mcu_task_stddev=0.000276 bytes_write=14885 bytes_read=10929 bytes_retransmit=9 bytes_invalid=0 send_seq=626 receive_seq=626 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997952  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.55 cputime=1206.095 memavail=1720380 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53131.6: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000142 mcu_task_stddev=0.000276 bytes_write=16616 bytes_read=11589 bytes_retransmit=9 bytes_invalid=0 send_seq=679 receive_seq=678 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998058  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.55 cputime=1206.165 memavail=1720380 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53132.6: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000281 mcu_task_stddev=0.000269 bytes_write=18528 bytes_read=12581 bytes_retransmit=9 bytes_invalid=0 send_seq=756 receive_seq=756 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71999221  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.55 cputime=1206.247 memavail=1720400 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53133.6: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000281 mcu_task_stddev=0.000269 bytes_write=20465 bytes_read=13520 bytes_retransmit=9 bytes_invalid=0 send_seq=833 receive_seq=833 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998844  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.51 cputime=1206.329 memavail=1720312 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53134.6: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000281 mcu_task_stddev=0.000269 bytes_write=22388 bytes_read=14512 bytes_retransmit=9 bytes_invalid=0 send_seq=913 receive_seq=913 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998660  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.51 cputime=1206.409 memavail=1721208 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53135.6: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000281 mcu_task_stddev=0.000269 bytes_write=24225 bytes_read=15326 bytes_retransmit=9 bytes_invalid=0 send_seq=978 receive_seq=978 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998503  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.51 cputime=1206.484 memavail=1721732 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53136.6: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000281 mcu_task_stddev=0.000269 bytes_write=26115 bytes_read=16182 bytes_retransmit=9 bytes_invalid=0 send_seq=1048 receive_seq=1048 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998403  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.51 cputime=1206.563 memavail=1722004 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53137.6: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000289 mcu_task_stddev=0.000268 bytes_write=28047 bytes_read=17184 bytes_retransmit=9 bytes_invalid=0 send_seq=1125 receive_seq=1125 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998348  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.51 cputime=1206.647 memavail=1721752 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53138.6: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000289 mcu_task_stddev=0.000268 bytes_write=29962 bytes_read=18138 bytes_retransmit=9 bytes_invalid=0 send_seq=1202 receive_seq=1202 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998292  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.55 cputime=1206.725 memavail=1721752 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53139.6: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000289 mcu_task_stddev=0.000268 bytes_write=31874 bytes_read=19030 bytes_retransmit=9 bytes_invalid=0 send_seq=1276 receive_seq=1276 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998256  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.55 cputime=1206.802 memavail=1721792 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53140.6: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000289 mcu_task_stddev=0.000268 bytes_write=33708 bytes_read=19812 bytes_retransmit=9 bytes_invalid=0 send_seq=1338 receive_seq=1338 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998242  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.55 cputime=1206.877 memavail=1722320 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53141.6: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000289 mcu_task_stddev=0.000268 bytes_write=35813 bytes_read=21078 bytes_retransmit=9 bytes_invalid=0 send_seq=1439 receive_seq=1439 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998222  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.55 cputime=1206.971 memavail=1723356 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Neopixel update did not succeed
Stats 53142.6: gcodein=0  mcu: mcu_awake=0.145 mcu_task_avg=0.000294 mcu_task_stddev=0.000265 bytes_write=37705 bytes_read=22024 bytes_retransmit=9 bytes_invalid=0 send_seq=1515 receive_seq=1514 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998221  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.55 cputime=1207.074 memavail=1722148 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53143.6: gcodein=0  mcu: mcu_awake=0.145 mcu_task_avg=0.000294 mcu_task_stddev=0.000265 bytes_write=39617 bytes_read=22993 bytes_retransmit=9 bytes_invalid=0 send_seq=1591 receive_seq=1591 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998438  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.50 cputime=1207.154 memavail=1721896 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53144.6: gcodein=0  mcu: mcu_awake=0.145 mcu_task_avg=0.000294 mcu_task_stddev=0.000265 bytes_write=41428 bytes_read=23734 bytes_retransmit=9 bytes_invalid=0 send_seq=1651 receive_seq=1651 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998390  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.50 cputime=1207.226 memavail=1721408 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53145.6: gcodein=0  mcu: mcu_awake=0.145 mcu_task_avg=0.000294 mcu_task_stddev=0.000265 bytes_write=43325 bytes_read=24694 bytes_retransmit=9 bytes_invalid=0 send_seq=1729 receive_seq=1729 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998354  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.50 cputime=1207.306 memavail=1721688 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53146.6: gcodein=0  mcu: mcu_awake=0.145 mcu_task_avg=0.000294 mcu_task_stddev=0.000265 bytes_write=45276 bytes_read=25709 bytes_retransmit=9 bytes_invalid=0 send_seq=1809 receive_seq=1809 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998331  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.50 cputime=1207.393 memavail=1722228 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53147.6: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000270 bytes_write=47213 bytes_read=26669 bytes_retransmit=9 bytes_invalid=0 send_seq=1886 receive_seq=1886 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998307  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.50 cputime=1207.474 memavail=1723000 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53148.6: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000270 bytes_write=49040 bytes_read=27447 bytes_retransmit=9 bytes_invalid=0 send_seq=1952 receive_seq=1952 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998286  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.46 cputime=1207.547 memavail=1723520 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53149.6: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000270 bytes_write=50924 bytes_read=28349 bytes_retransmit=9 bytes_invalid=0 send_seq=2024 receive_seq=2024 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998271  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.46 cputime=1207.626 memavail=1723544 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53150.6: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000270 bytes_write=52849 bytes_read=29263 bytes_retransmit=9 bytes_invalid=0 send_seq=2098 receive_seq=2098 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998258  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.46 cputime=1207.704 memavail=1723544 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53151.6: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000270 bytes_write=54772 bytes_read=30184 bytes_retransmit=9 bytes_invalid=0 send_seq=2174 receive_seq=2173 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998248  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.46 cputime=1207.783 memavail=1723836 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53152.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=56681 bytes_read=31251 bytes_retransmit=9 bytes_invalid=0 send_seq=2255 receive_seq=2255 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998242  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.46 cputime=1207.869 memavail=1722604 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53153.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=58611 bytes_read=32192 bytes_retransmit=9 bytes_invalid=0 send_seq=2331 receive_seq=2331 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998236  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.43 cputime=1207.951 memavail=1722484 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53154.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=60590 bytes_read=33209 bytes_retransmit=9 bytes_invalid=0 send_seq=2414 receive_seq=2414 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998230  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.43 cputime=1208.035 memavail=1722856 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53155.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=62458 bytes_read=34087 bytes_retransmit=9 bytes_invalid=0 send_seq=2484 receive_seq=2484 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998235  orange_pi: temp=45.7 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.43 cputime=1208.111 memavail=1723600 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Transition to shutdown state: Shutdown due to webhooks request
Dumping gcode input 0 blocks
Dumping 20 requests for client 281473445077840
Received 53125.777909: b'{"id":281472834156864,"method":"info","params":{}}'
Received 53125.779591: b'{"id":281472834156528,"method":"objects/subscribe","params":{"objects":{"webhooks":null},"response_template":{"method":"process_status_update"}}}'
Received 53125.781605: b'{"id":281472834156528,"method":"gcode/subscribe_output","params":{"response_template":{"method":"process_gcode_response"}}}'
Received 53125.783685: b'{"id":281472835873392,"method":"list_endpoints","params":{}}'
Received 53125.785879: b'{"id":281472833843504,"method":"objects/subscribe","params":{"objects":{"webhooks":null,"print_stats":null},"response_template":{"method":"process_status_update"}}}'
Received 53126.032582: b'{"id":281472835873392,"method":"objects/list","params":{}}'
Received 53126.034949: b'{"id":281472835873392,"method":"objects/query","params":{"objects":{"configfile":null}}}'
Received 53126.291277: b'{"id":281472834156528,"method":"register_remote_method","params":{"response_template":{"method":"shutdown_machine"},"remote_method":"shutdown_machine"}}'
Received 53126.293650: b'{"id":281472834156528,"method":"register_remote_method","params":{"response_template":{"method":"reboot_machine"},"remote_method":"reboot_machine"}}'
Received 53126.295274: b'{"id":281472834156528,"method":"register_remote_method","params":{"response_template":{"method":"pause_job_queue"},"remote_method":"pause_job_queue"}}'
Received 53126.296815: b'{"id":281472834156528,"method":"register_remote_method","params":{"response_template":{"method":"start_job_queue"},"remote_method":"start_job_queue"}}'
Received 53126.300479: b'{"id":281472833838560,"method":"objects/query","params":{"objects":{"heaters":null}}}'
Received 53126.300479: b'{"id":281472833846288,"method":"objects/query","params":{"objects":{"heaters":null}}}'
Received 53126.310628: b'{"id":281472833840480,"method":"info","params":{}}'
Received 53126.310628: b'{"id":281472833844272,"method":"objects/list","params":{}}'
Received 53126.334741: b'{"id":281472833833664,"method":"objects/subscribe","params":{"objects":{"gcode":null,"webhooks":null,"configfile":null,"mcu":null,"gcode_move":null,"print_stats":null,"virtual_sdcard":null,"pause_resume":null,"display_status":null,"gcode_macro CANCEL_PRINT":null,"gcode_macro PAUSE":null,"gcode_macro RESUME":null,"gcode_macro SET_PAUSE_NEXT_LAYER":null,"gcode_macro SET_PAUSE_AT_LAYER":null,"gcode_macro SET_PRINT_STATS_INFO":null,"gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL":null,"gcode_macro _CLIENT_EXTRUDE":null,"gcode_macro _CLIENT_RETRACT":null,"gcode_macro _CLIENT_LINEAR_MOVE":null,"gcode_macro Backup_on_GitHub":null,"gcode_macro list_sensors":null,"gcode_macro Power_OFF":null,"gcode_macro _POWER_OFF_PRINTER":null,"gcode_macro ACTIVATE_POWER_OFF":null,"gcode_macro DEACTIVATE_POWER_OFF":null,"gcode_macro M141":null,"gcode_macro M80":null,"gcode_macro M81":null,"gcode_macro M486":null,"gcode_macro M190":null,"gcode_macro _CHOME":null,"gcode_macro M109":null,"gcode_macro _MOVE_AWAY":null,"gcode_macro PARK_CENTER_REAR":null,"gcode_macro START_PRINT":null,"gcode_macro pid_soplo":null,"gcode_macro pid_bed":null,"gcode_macro BED":null,"gcode_macro END_PRINT":null,"gcode_macro M300":null,"gcode_macro PRIME_LINE":null,"gcode_macro VINT":null,"gcode_macro LOW_TEMP_CHECK":null,"gcode_macro M76":null,"gcode_macro M601":null,"gcode_macro G27":null,"gcode_macro M125":null,"gcode_macro M600":null,"gcode_macro M701":null,"gcode_macro M702":null,"gcode_macro M500":null,"gcode_macro PARK":null,"gcode_macro START_DRYER":null,"gcode_macro STOP_DRYER":null,"gcode_macro DRYER_STATUS":null,"gcode_macro DRY_tpu":null,"gcode_macro DRY_PETG":null,"gcode_macro DRY_ABS":null,"gcode_macro M4":null,"gcode_macro M5":null,"gcode_macro NOTE":null,"gcode_macro TONE_GEN":null,"gcode_macro SONG_STAR_WARS_MAIN_THEME":null,"gcode_macro SONG_CRAB_RAVE":null,"gcode_macro one":null,"gcode_macro SONG_BOOMER":null,"gcode_macro GET_TIMELAPSE_SETUP":null,"gcode_macro _SET_TIMELAPSE_SETUP":null,"gcode_macro TIMELAPSE_TAKE_FRAME":null,"gcode_macro _TIMELAPSE_NEW_FRAME":null,"gcode_macro HYPERLAPSE":null,"gcode_macro TIMELAPSE_RENDER":null,"gcode_macro TEST_STREAM_DELAY":null,"gcode_macro BED_MESH_CALIBRATE":null,"gcode_macro SMART_PARK":null,"gcode_macro _KAMP_Settings":null,"exclude_object":null,"neopixel panel_ring":null,"output_pin Power":null,"heaters":null,"temperature_host orange_pi":null,"temperature_sensor orange_pi":null,"heater_generic chamber_heater":null,"filament_motion_sensor motion_sensor":null,"probe":null,"bltouch":null,"heater_bed":null,"heater_fan radiator":null,"fan":null,"bed_mesh":null,"screws_tilt_adjust":null,"stepper_enable":null,"tmc2209 stepper_x":null,"tmc2209 stepper_y":null,"tmc2209 stepper_z":null,"tmc2209 extruder":null,"pwm_cycle_time beeper":null,"firmware_retraction":null,"pwm_tool Laser":null,"motion_report":null,"query_endstops":null,"idle_timeout":null,"system_stats":null,"manual_probe":null,"toolhead":null,"extruder":null},"response_template":{"method":"process_status_update"}}}'
Received 53126.551845: b'{"id":281472835876608,"method":"objects/subscribe","params":{"objects":{"webhooks":null,"print_stats":null,"temperature_sensor orange_pi":null,"heater_generic chamber_heater":null,"heater_bed":null,"extruder":null,"gcode":null,"configfile":null,"mcu":null,"gcode_move":null,"virtual_sdcard":null,"pause_resume":null,"display_status":null,"gcode_macro CANCEL_PRINT":null,"gcode_macro PAUSE":null,"gcode_macro RESUME":null,"gcode_macro SET_PAUSE_NEXT_LAYER":null,"gcode_macro SET_PAUSE_AT_LAYER":null,"gcode_macro SET_PRINT_STATS_INFO":null,"gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL":null,"gcode_macro _CLIENT_EXTRUDE":null,"gcode_macro _CLIENT_RETRACT":null,"gcode_macro _CLIENT_LINEAR_MOVE":null,"gcode_macro Backup_on_GitHub":null,"gcode_macro list_sensors":null,"gcode_macro Power_OFF":null,"gcode_macro _POWER_OFF_PRINTER":null,"gcode_macro ACTIVATE_POWER_OFF":null,"gcode_macro DEACTIVATE_POWER_OFF":null,"gcode_macro M141":null,"gcode_macro M80":null,"gcode_macro M81":null,"gcode_macro M486":null,"gcode_macro M190":null,"gcode_macro _CHOME":null,"gcode_macro M109":null,"gcode_macro _MOVE_AWAY":null,"gcode_macro PARK_CENTER_REAR":null,"gcode_macro START_PRINT":null,"gcode_macro pid_soplo":null,"gcode_macro pid_bed":null,"gcode_macro BED":null,"gcode_macro END_PRINT":null,"gcode_macro M300":null,"gcode_macro PRIME_LINE":null,"gcode_macro VINT":null,"gcode_macro LOW_TEMP_CHECK":null,"gcode_macro M76":null,"gcode_macro M601":null,"gcode_macro G27":null,"gcode_macro M125":null,"gcode_macro M600":null,"gcode_macro M701":null,"gcode_macro M702":null,"gcode_macro M500":null,"gcode_macro PARK":null,"gcode_macro START_DRYER":null,"gcode_macro STOP_DRYER":null,"gcode_macro DRYER_STATUS":null,"gcode_macro DRY_tpu":null,"gcode_macro DRY_PETG":null,"gcode_macro DRY_ABS":null,"gcode_macro M4":null,"gcode_macro M5":null,"gcode_macro NOTE":null,"gcode_macro TONE_GEN":null,"gcode_macro SONG_STAR_WARS_MAIN_THEME":null,"gcode_macro SONG_CRAB_RAVE":null,"gcode_macro one":null,"gcode_macro SONG_BOOMER":null,"gcode_macro GET_TIMELAPSE_SETUP":null,"gcode_macro _SET_TIMELAPSE_SETUP":null,"gcode_macro TIMELAPSE_TAKE_FRAME":null,"gcode_macro _TIMELAPSE_NEW_FRAME":null,"gcode_macro HYPERLAPSE":null,"gcode_macro TIMELAPSE_RENDER":null,"gcode_macro TEST_STREAM_DELAY":null,"gcode_macro BED_MESH_CALIBRATE":null,"gcode_macro SMART_PARK":null,"gcode_macro _KAMP_Settings":null,"exclude_object":null,"neopixel panel_ring":null,"output_pin Power":null,"heaters":null,"temperature_host orange_pi":null,"filament_motion_sensor motion_sensor":null,"probe":null,"bltouch":null,"heater_fan radiator":null,"fan":null,"bed_mesh":null,"screws_tilt_adjust":null,"stepper_enable":null,"tmc2209 stepper_x":null,"tmc2209 stepper_y":null,"tmc2209 stepper_z":null,"tmc2209 extruder":null,"pwm_cycle_time beeper":null,"firmware_retraction":null,"pwm_tool Laser":null,"motion_report":null,"query_endstops":null,"idle_timeout":null,"system_stats":null,"manual_probe":null,"toolhead":null},"response_template":{"method":"process_status_update"}}}'
Received 53126.772859: b'{"id":281472834156816,"method":"objects/query","params":{"objects":{"extruder":["can_extrude"]}}}'
Received 53126.802246: b'{"id":281472834156144,"method":"objects/subscribe","params":{"objects":{"webhooks":null,"print_stats":null,"temperature_sensor orange_pi":null,"heater_generic chamber_heater":null,"heater_bed":null,"extruder":null,"gcode":null,"configfile":null,"mcu":null,"gcode_move":null,"virtual_sdcard":null,"pause_resume":null,"display_status":null,"gcode_macro CANCEL_PRINT":null,"gcode_macro PAUSE":null,"gcode_macro RESUME":null,"gcode_macro SET_PAUSE_NEXT_LAYER":null,"gcode_macro SET_PAUSE_AT_LAYER":null,"gcode_macro SET_PRINT_STATS_INFO":null,"gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL":null,"gcode_macro _CLIENT_EXTRUDE":null,"gcode_macro _CLIENT_RETRACT":null,"gcode_macro _CLIENT_LINEAR_MOVE":null,"gcode_macro Backup_on_GitHub":null,"gcode_macro list_sensors":null,"gcode_macro Power_OFF":null,"gcode_macro _POWER_OFF_PRINTER":null,"gcode_macro ACTIVATE_POWER_OFF":null,"gcode_macro DEACTIVATE_POWER_OFF":null,"gcode_macro M141":null,"gcode_macro M80":null,"gcode_macro M81":null,"gcode_macro M486":null,"gcode_macro M190":null,"gcode_macro _CHOME":null,"gcode_macro M109":null,"gcode_macro _MOVE_AWAY":null,"gcode_macro PARK_CENTER_REAR":null,"gcode_macro START_PRINT":null,"gcode_macro pid_soplo":null,"gcode_macro pid_bed":null,"gcode_macro BED":null,"gcode_macro END_PRINT":null,"gcode_macro M300":null,"gcode_macro PRIME_LINE":null,"gcode_macro VINT":null,"gcode_macro LOW_TEMP_CHECK":null,"gcode_macro M76":null,"gcode_macro M601":null,"gcode_macro G27":null,"gcode_macro M125":null,"gcode_macro M600":null,"gcode_macro M701":null,"gcode_macro M702":null,"gcode_macro M500":null,"gcode_macro PARK":null,"gcode_macro START_DRYER":null,"gcode_macro STOP_DRYER":null,"gcode_macro DRYER_STATUS":null,"gcode_macro DRY_tpu":null,"gcode_macro DRY_PETG":null,"gcode_macro DRY_ABS":null,"gcode_macro M4":null,"gcode_macro M5":null,"gcode_macro NOTE":null,"gcode_macro TONE_GEN":null,"gcode_macro SONG_STAR_WARS_MAIN_THEME":null,"gcode_macro SONG_CRAB_RAVE":null,"gcode_macro one":null,"gcode_macro SONG_BOOMER":null,"gcode_macro GET_TIMELAPSE_SETUP":null,"gcode_macro _SET_TIMELAPSE_SETUP":null,"gcode_macro TIMELAPSE_TAKE_FRAME":null,"gcode_macro _TIMELAPSE_NEW_FRAME":null,"gcode_macro HYPERLAPSE":null,"gcode_macro TIMELAPSE_RENDER":null,"gcode_macro TEST_STREAM_DELAY":null,"gcode_macro BED_MESH_CALIBRATE":null,"gcode_macro SMART_PARK":null,"gcode_macro _KAMP_Settings":null,"exclude_object":null,"neopixel panel_ring":null,"output_pin Power":null,"heaters":null,"temperature_host orange_pi":null,"filament_motion_sensor motion_sensor":null,"probe":null,"bltouch":null,"heater_fan radiator":null,"fan":null,"bed_mesh":null,"screws_tilt_adjust":null,"stepper_enable":null,"tmc2209 stepper_x":null,"tmc2209 stepper_y":null,"tmc2209 stepper_z":null,"tmc2209 extruder":null,"pwm_cycle_time beeper":null,"firmware_retraction":null,"pwm_tool Laser":null,"motion_report":null,"query_endstops":null,"idle_timeout":null,"system_stats":null,"manual_probe":null,"toolhead":null},"response_template":{"method":"process_status_update"}}}'
Received 53156.054925: b'{"id":281472834153888,"method":"emergency_stop","params":{}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (53154.224155428, 53142.323901298, 0.0)
Shutdown due to webhooks request
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Printer is shutdown

MCU 'mcu' shutdown: Command request
clocksync state: mcu_freq=72000000 last_clock=3793079906821 clock_est=(53136.938 3791734204811 71998233.733) min_half_rtt=0.000119 min_rtt_time=53139.878 time_avg=53136.938(127.465) clock_avg=3791734204811.439(9177270842.572) pred_variance=1355803847.795
Dumping serial stats: bytes_write=63254 bytes_read=34433 bytes_retransmit=9 bytes_invalid=0 send_seq=2512 receive_seq=2512 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0
Dumping send queue 100 messages
Sent 0 53154.605000 53154.604000 25: seq: 1c, neopixel_update oid=0 pos=0 data=b'EE\x8bEE\x8bEE\x8bEE\x8bEE\x8bE'
Sent 1 53154.612457 53154.610577 47: seq: 1d, neopixel_update oid=0 pos=16 data=b'E\x8bEE\x8bEE\x8bEE\x8bEE\x8bEE', neopixel_update oid=0 pos=32 data=b'\x8bEE\x8bEE\x8bEE\x8bEE\x8bEE\x8b', neopixel_send oid=0
Sent 2 53154.644037 53154.643797 6: seq: 1e, get_clock
Sent 3 53154.648023 53154.646223 45: seq: 1f, neopixel_update oid=0 pos=0 data=b'22e22e22e22e22e2', neopixel_update oid=0 pos=16 data=b'2e22e22e22e22e22'
Sent 4 53154.654622 53154.653542 27: seq: 10, neopixel_update oid=0 pos=32 data=b'e22e22e22e22e22e', neopixel_send oid=0
Sent 5 53154.689387 53154.688387 25: seq: 11, neopixel_update oid=0 pos=0 data=b'""E""E""E""E""E"'
Sent 6 53154.696779 53154.694899 47: seq: 12, neopixel_update oid=0 pos=16 data=b'"E""E""E""E""E""', neopixel_update oid=0 pos=32 data=b'E""E""E""E""E""E', neopixel_send oid=0
Sent 7 53154.702835 53154.702555 7: seq: 13, neopixel_send oid=0
Sent 8 53154.708674 53154.708394 7: seq: 14, neopixel_send oid=0
Sent 9 53154.731578 53154.730578 25: seq: 15, neopixel_update oid=0 pos=0 data=b'\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16'
Sent 10 53154.738975 53154.737095 47: seq: 16, neopixel_update oid=0 pos=16 data=b'\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16', neopixel_update oid=0 pos=32 data=b',\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16,', neopixel_send oid=0
Sent 11 53154.744641 53154.744361 7: seq: 17, neopixel_send oid=0
Sent 12 53154.773386 53154.772386 25: seq: 18, neopixel_update oid=0 pos=0 data=b'\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r'
Sent 13 53154.780789 53154.778909 47: seq: 19, neopixel_update oid=0 pos=16 data=b'\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r', neopixel_update oid=0 pos=32 data=b'\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a', neopixel_send oid=0
Sent 14 53154.786753 53154.786473 7: seq: 1a, neopixel_send oid=0
Sent 15 53154.792668 53154.792388 7: seq: 1b, neopixel_send oid=0
Sent 16 53154.815386 53154.814386 25: seq: 1c, neopixel_update oid=0 pos=0 data=b'\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07'
Sent 17 53154.822788 53154.820908 47: seq: 1d, neopixel_update oid=0 pos=16 data=b'\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07', neopixel_update oid=0 pos=32 data=b'\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e', neopixel_send oid=0
Sent 18 53154.828745 53154.828465 7: seq: 1e, neopixel_send oid=0
Sent 19 53154.834668 53154.834388 7: seq: 1f, neopixel_send oid=0
Sent 20 53154.857972 53154.856972 25: seq: 10, neopixel_update oid=0 pos=0 data=b'\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03'
Sent 21 53154.865405 53154.863525 47: seq: 11, neopixel_update oid=0 pos=16 data=b'\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03', neopixel_update oid=0 pos=32 data=b'\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06', neopixel_send oid=0
Sent 22 53154.900191 53154.899191 25: seq: 12, neopixel_update oid=0 pos=0 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01'
Sent 23 53154.907585 53154.905705 47: seq: 13, neopixel_update oid=0 pos=16 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01', neopixel_update oid=0 pos=32 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01', neopixel_send oid=0
Sent 24 53154.942449 53154.941449 25: seq: 14, neopixel_update oid=0 pos=0 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
Sent 25 53154.949846 53154.947966 47: seq: 15, neopixel_update oid=0 pos=16 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_update oid=0 pos=32 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_send oid=0
Sent 26 53154.984586 53154.983586 25: seq: 16, neopixel_update oid=0 pos=0 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01'
Sent 27 53154.991978 53154.990098 47: seq: 17, neopixel_update oid=0 pos=16 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01', neopixel_update oid=0 pos=32 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01', neopixel_send oid=0
Sent 28 53155.026718 53155.025718 25: seq: 18, neopixel_update oid=0 pos=0 data=b'\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03'
Sent 29 53155.034126 53155.032246 47: seq: 19, neopixel_update oid=0 pos=16 data=b'\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03', neopixel_update oid=0 pos=32 data=b'\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06', neopixel_send oid=0
Sent 30 53155.068898 53155.067898 25: seq: 1a, neopixel_update oid=0 pos=0 data=b'\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07'
Sent 31 53155.076300 53155.074420 47: seq: 1b, neopixel_update oid=0 pos=16 data=b'\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07', neopixel_update oid=0 pos=32 data=b'\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e', neopixel_send oid=0
Sent 32 53155.112184 53155.110384 45: seq: 1c, neopixel_update oid=0 pos=0 data=b'\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r', neopixel_update oid=0 pos=16 data=b'\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r'
Sent 33 53155.118824 53155.117744 27: seq: 1d, neopixel_update oid=0 pos=32 data=b'\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a', neopixel_send oid=0
Sent 34 53155.124909 53155.124629 7: seq: 1e, neopixel_send oid=0
Sent 35 53155.130772 53155.130492 7: seq: 1f, neopixel_send oid=0
Sent 36 53155.136658 53155.136218 11: seq: 10, neopixel_send oid=0, st7920_send_cmds oid=4 cmds=b'\x82'
Sent 37 53155.142512 53155.142112 10: seq: 11, st7920_send_data oid=4 data=b'5 '
Sent 38 53155.153637 53155.152637 25: seq: 12, neopixel_update oid=0 pos=0 data=b'\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16'
Sent 39 53155.161036 53155.159156 47: seq: 13, neopixel_update oid=0 pos=16 data=b'\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16', neopixel_update oid=0 pos=32 data=b',\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16,', neopixel_send oid=0
Sent 40 53155.167122 53155.166842 7: seq: 14, neopixel_send oid=0
Sent 41 53155.172749 53155.172469 7: seq: 15, neopixel_send oid=0
Sent 42 53155.178673 53155.178393 7: seq: 16, neopixel_send oid=0
Sent 43 53155.195370 53155.194370 25: seq: 17, neopixel_update oid=0 pos=0 data=b'""E""E""E""E""E"'
Sent 44 53155.202762 53155.200882 47: seq: 18, neopixel_update oid=0 pos=16 data=b'"E""E""E""E""E""', neopixel_update oid=0 pos=32 data=b'E""E""E""E""E""E', neopixel_send oid=0
Sent 45 53155.208761 53155.208481 7: seq: 19, neopixel_send oid=0
Sent 46 53155.214672 53155.214392 7: seq: 1a, neopixel_send oid=0
Sent 47 53155.237321 53155.236321 25: seq: 1b, neopixel_update oid=0 pos=0 data=b'22e22e22e22e22e2'
Sent 48 53155.244713 53155.242833 47: seq: 1c, neopixel_update oid=0 pos=16 data=b'2e22e22e22e22e22', neopixel_update oid=0 pos=32 data=b'e22e22e22e22e22e', neopixel_send oid=0
Sent 49 53155.279519 53155.278519 25: seq: 1d, neopixel_update oid=0 pos=0 data=b'EE\x8bEE\x8bEE\x8bEE\x8bEE\x8bE'
Sent 50 53155.286918 53155.285038 47: seq: 1e, neopixel_update oid=0 pos=16 data=b'E\x8bEE\x8bEE\x8bEE\x8bEE\x8bEE', neopixel_update oid=0 pos=32 data=b'\x8bEE\x8bEE\x8bEE\x8bEE\x8bEE\x8b', neopixel_send oid=0
Sent 51 53155.292766 53155.292486 7: seq: 1f, neopixel_send oid=0
Sent 52 53155.298683 53155.298403 7: seq: 10, neopixel_send oid=0
Sent 53 53155.321392 53155.320392 25: seq: 11, neopixel_update oid=0 pos=0 data=b'ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4Z'
Sent 54 53155.328792 53155.326912 47: seq: 12, neopixel_update oid=0 pos=16 data=b'Z\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ', neopixel_update oid=0 pos=32 data=b'\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4', neopixel_send oid=0
Sent 55 53155.334793 53155.334513 7: seq: 13, neopixel_send oid=0
Sent 56 53155.340688 53155.340408 7: seq: 14, neopixel_send oid=0
Sent 57 53155.364847 53155.363047 45: seq: 15, neopixel_update oid=0 pos=0 data=b'mm\xdamm\xdamm\xdamm\xdamm\xdam', neopixel_update oid=0 pos=16 data=b'm\xdamm\xdamm\xdamm\xdamm\xdamm'
Sent 58 53155.371487 53155.370407 27: seq: 16, neopixel_update oid=0 pos=32 data=b'\xdamm\xdamm\xdamm\xdamm\xdamm\xda', neopixel_send oid=0
Sent 59 53155.406299 53155.405299 25: seq: 17, neopixel_update oid=0 pos=0 data=b'{{\xf5{{\xf5{{\xf5{{\xf5{{\xf5{'
Sent 60 53155.413699 53155.411819 47: seq: 18, neopixel_update oid=0 pos=16 data=b'{\xf5{{\xf5{{\xf5{{\xf5{{\xf5{{', neopixel_update oid=0 pos=32 data=b'\xf5{{\xf5{{\xf5{{\xf5{{\xf5{{\xf5', neopixel_send oid=0
Sent 61 53155.448605 53155.447605 25: seq: 19, neopixel_update oid=0 pos=0 data=b'\x80\x80\xff\x80\x80\xff\x80\x80\xff\x80\x80\xff\x80\x80\xff\x80'
Sent 62 53155.456001 53155.454121 47: seq: 1a, neopixel_update oid=0 pos=16 data=b'\x80\xff\x80\x80\xff\x80\x80\xff\x80\x80\xff\x80\x80\xff\x80\x80', neopixel_update oid=0 pos=32 data=b'\xff\x80\x80\xff\x80\x80\xff\x80\x80\xff\x80\x80\xff\x80\x80\xff', neopixel_send oid=0
Sent 63 53155.490813 53155.489813 25: seq: 1b, neopixel_update oid=0 pos=0 data=b'{{\xf5{{\xf5{{\xf5{{\xf5{{\xf5{'
Sent 64 53155.498218 53155.496338 47: seq: 1c, neopixel_update oid=0 pos=16 data=b'{\xf5{{\xf5{{\xf5{{\xf5{{\xf5{{', neopixel_update oid=0 pos=32 data=b'\xf5{{\xf5{{\xf5{{\xf5{{\xf5{{\xf5', neopixel_send oid=0
Sent 65 53155.533086 53155.532086 25: seq: 1d, neopixel_update oid=0 pos=0 data=b'mm\xdamm\xdamm\xdamm\xdamm\xdam'
Sent 66 53155.540483 53155.538603 47: seq: 1e, neopixel_update oid=0 pos=16 data=b'm\xdamm\xdamm\xdamm\xdamm\xdamm', neopixel_update oid=0 pos=32 data=b'\xdamm\xdamm\xdamm\xdamm\xdamm\xda', neopixel_send oid=0
Sent 67 53155.576361 53155.574561 45: seq: 1f, neopixel_update oid=0 pos=0 data=b'ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4Z', neopixel_update oid=0 pos=16 data=b'Z\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ'
Sent 68 53155.582995 53155.581915 27: seq: 10, neopixel_update oid=0 pos=32 data=b'\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4ZZ\xb4', neopixel_send oid=0
Sent 69 53155.588847 53155.588567 7: seq: 11, neopixel_send oid=0
Sent 70 53155.594703 53155.594423 7: seq: 12, neopixel_send oid=0
Sent 71 53155.618831 53155.617031 45: seq: 13, neopixel_update oid=0 pos=0 data=b'EE\x8bEE\x8bEE\x8bEE\x8bEE\x8bE', neopixel_update oid=0 pos=16 data=b'E\x8bEE\x8bEE\x8bEE\x8bEE\x8bEE'
Sent 72 53155.625475 53155.624395 27: seq: 14, neopixel_update oid=0 pos=32 data=b'\x8bEE\x8bEE\x8bEE\x8bEE\x8bEE\x8b', neopixel_send oid=0
Sent 73 53155.628668 53155.628428 6: seq: 15, get_clock
Sent 74 53155.660374 53155.659374 25: seq: 16, neopixel_update oid=0 pos=0 data=b'22e22e22e22e22e2'
Sent 75 53155.667780 53155.665900 47: seq: 17, neopixel_update oid=0 pos=16 data=b'2e22e22e22e22e22', neopixel_update oid=0 pos=32 data=b'e22e22e22e22e22e', neopixel_send oid=0
Sent 76 53155.702540 53155.701540 25: seq: 18, neopixel_update oid=0 pos=0 data=b'""E""E""E""E""E"'
Sent 77 53155.709933 53155.708053 47: seq: 19, neopixel_update oid=0 pos=16 data=b'"E""E""E""E""E""', neopixel_update oid=0 pos=32 data=b'E""E""E""E""E""E', neopixel_send oid=0
Sent 78 53155.744823 53155.743823 25: seq: 1a, neopixel_update oid=0 pos=0 data=b'\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16'
Sent 79 53155.752215 53155.750335 47: seq: 1b, neopixel_update oid=0 pos=16 data=b'\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16', neopixel_update oid=0 pos=32 data=b',\x16\x16,\x16\x16,\x16\x16,\x16\x16,\x16\x16,', neopixel_send oid=0
Sent 80 53155.786972 53155.785972 25: seq: 1c, neopixel_update oid=0 pos=0 data=b'\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r'
Sent 81 53155.794369 53155.792489 47: seq: 1d, neopixel_update oid=0 pos=16 data=b'\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r', neopixel_update oid=0 pos=32 data=b'\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a\r\r\x1a', neopixel_send oid=0
Sent 82 53155.829132 53155.828132 25: seq: 1e, neopixel_update oid=0 pos=0 data=b'\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07'
Sent 83 53155.836524 53155.834644 47: seq: 1f, neopixel_update oid=0 pos=16 data=b'\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07', neopixel_update oid=0 pos=32 data=b'\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e\x07\x07\x0e', neopixel_send oid=0
Sent 84 53155.871115 53155.870115 25: seq: 10, neopixel_update oid=0 pos=0 data=b'\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03'
Sent 85 53155.878525 53155.876645 47: seq: 11, neopixel_update oid=0 pos=16 data=b'\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03', neopixel_update oid=0 pos=32 data=b'\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06', neopixel_send oid=0
Sent 86 53155.913397 53155.912397 25: seq: 12, neopixel_update oid=0 pos=0 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01'
Sent 87 53155.920806 53155.918926 47: seq: 13, neopixel_update oid=0 pos=16 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01', neopixel_update oid=0 pos=32 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01', neopixel_send oid=0
Sent 88 53155.926818 53155.926538 7: seq: 14, neopixel_send oid=0
Sent 89 53155.932697 53155.932417 7: seq: 15, neopixel_send oid=0
Sent 90 53155.955414 53155.954414 25: seq: 16, neopixel_update oid=0 pos=0 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
Sent 91 53155.962808 53155.960928 47: seq: 17, neopixel_update oid=0 pos=16 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_update oid=0 pos=32 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_send oid=0
Sent 92 53155.968786 53155.968506 7: seq: 18, neopixel_send oid=0
Sent 93 53155.974694 53155.974414 7: seq: 19, neopixel_send oid=0
Sent 94 53155.997302 53155.996302 25: seq: 1a, neopixel_update oid=0 pos=0 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01'
Sent 95 53156.004702 53156.002822 47: seq: 1b, neopixel_update oid=0 pos=16 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01', neopixel_update oid=0 pos=32 data=b'\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01', neopixel_send oid=0
Sent 96 53156.039527 53156.038527 25: seq: 1c, neopixel_update oid=0 pos=0 data=b'\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03'
Sent 97 53156.046930 53156.045050 47: seq: 1d, neopixel_update oid=0 pos=16 data=b'\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03', neopixel_update oid=0 pos=32 data=b'\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06\x03\x03\x06', neopixel_send oid=0
Sent 98 53156.052791 53156.052511 7: seq: 1e, neopixel_send oid=0
Sent 99 53156.057517 53156.057197 8: seq: 1f, emergency_stop, neopixel_send oid=0
Dumping receive queue 100 messages
Receive: 0 53154.401700 53154.400817 8: seq: 15, neopixel_result oid=0 success=0
Receive: 1 53154.407711 53154.406743 8: seq: 16, neopixel_result oid=0 success=0
Receive: 2 53154.413724 53154.412775 8: seq: 17, neopixel_result oid=0 success=0
Receive: 3 53154.419704 53154.418695 8: seq: 18, neopixel_result oid=0 success=0
Receive: 4 53154.425679 53154.424650 8: seq: 19, neopixel_result oid=0 success=1
Receive: 5 53154.440667 53154.435431 15: seq: 1a, analog_in_state oid=27 next_clock=559317632 value=31253
Receive: 6 53154.443701 53154.442830 8: seq: 1b, neopixel_result oid=0 success=0
Receive: 7 53154.449721 53154.448730 8: seq: 1c, neopixel_result oid=0 success=0
Receive: 8 53154.455689 53154.454687 8: seq: 1d, neopixel_result oid=0 success=1
Receive: 9 53154.485706 53154.484761 8: seq: 1f, neopixel_result oid=0 success=0
Receive: 10 53154.491705 53154.490734 8: seq: 10, neopixel_result oid=0 success=0
Receive: 11 53154.497688 53154.496659 8: seq: 11, neopixel_result oid=0 success=1
Receive: 12 53154.527706 53154.526864 8: seq: 13, neopixel_result oid=0 success=0
Receive: 13 53154.533708 53154.532729 8: seq: 14, neopixel_result oid=0 success=0
Receive: 14 53154.539711 53154.538699 8: seq: 15, neopixel_result oid=0 success=0
Receive: 15 53154.545666 53154.544658 8: seq: 16, neopixel_result oid=0 success=1
Receive: 16 53154.569747 53154.569173 8: seq: 18, neopixel_result oid=0 success=0
Receive: 17 53154.575722 53154.575034 8: seq: 19, neopixel_result oid=0 success=0
Receive: 18 53154.581724 53154.580723 8: seq: 1a, neopixel_result oid=0 success=0
Receive: 19 53154.587719 53154.586828 8: seq: 1b, neopixel_result oid=0 success=0
Receive: 20 53154.593716 53154.592707 8: seq: 1c, neopixel_result oid=0 success=1
Receive: 21 53154.613470 53154.612457 8: seq: 1e, neopixel_result oid=0 success=1
Receive: 22 53154.620729 53154.612457 15: seq: 1e, analog_in_state oid=15 next_clock=572277632 value=31172
Receive: 23 53154.644513 53154.644037 11: seq: 1f, clock clock=552894009
Receive: 24 53154.655613 53154.654622 8: seq: 11, neopixel_result oid=0 success=1
Receive: 25 53154.660687 53154.654622 15: seq: 11, analog_in_state oid=19 next_clock=575157632 value=31248
Receive: 26 53154.697711 53154.696779 8: seq: 13, neopixel_result oid=0 success=0
Receive: 27 53154.703710 53154.702835 8: seq: 14, neopixel_result oid=0 success=0
Receive: 28 53154.709647 53154.708674 8: seq: 15, neopixel_result oid=0 success=1
Receive: 29 53154.739707 53154.738975 8: seq: 17, neopixel_result oid=0 success=0
Receive: 30 53154.740689 53154.738975 15: seq: 17, analog_in_state oid=27 next_clock=580917632 value=31264
Receive: 31 53154.745620 53154.744641 8: seq: 18, neopixel_result oid=0 success=1
Receive: 32 53154.781710 53154.780789 8: seq: 1a, neopixel_result oid=0 success=0
Receive: 33 53154.787714 53154.786753 8: seq: 1b, neopixel_result oid=0 success=0
Receive: 34 53154.793657 53154.792668 8: seq: 1c, neopixel_result oid=0 success=1
Receive: 35 53154.823710 53154.822788 8: seq: 1e, neopixel_result oid=0 success=0
Receive: 36 53154.829715 53154.828745 8: seq: 1f, neopixel_result oid=0 success=0
Receive: 37 53154.835661 53154.834668 8: seq: 10, neopixel_result oid=0 success=1
Receive: 38 53154.866403 53154.865405 8: seq: 12, neopixel_result oid=0 success=1
Receive: 39 53154.908584 53154.907585 8: seq: 14, neopixel_result oid=0 success=1
Receive: 40 53154.920695 53154.907585 15: seq: 14, analog_in_state oid=15 next_clock=593877632 value=31150
Receive: 41 53154.950821 53154.949846 8: seq: 16, neopixel_result oid=0 success=1
Receive: 42 53154.960691 53154.949846 15: seq: 16, analog_in_state oid=19 next_clock=596757632 value=31250
Receive: 43 53154.992966 53154.991978 8: seq: 18, neopixel_result oid=0 success=1
Receive: 44 53155.035127 53155.034126 8: seq: 1a, neopixel_result oid=0 success=1
Receive: 45 53155.040700 53155.034126 15: seq: 1a, analog_in_state oid=27 next_clock=602517632 value=31263
Receive: 46 53155.077311 53155.076300 8: seq: 1c, neopixel_result oid=0 success=1
Receive: 47 53155.119722 53155.118824 8: seq: 1e, neopixel_result oid=0 success=0
Receive: 48 53155.125735 53155.124909 8: seq: 1f, neopixel_result oid=0 success=0
Receive: 49 53155.131722 53155.130772 8: seq: 10, neopixel_result oid=0 success=0
Receive: 50 53155.137689 53155.136658 8: seq: 11, neopixel_result oid=0 success=1
Receive: 51 53155.161718 53155.161036 8: seq: 14, neopixel_result oid=0 success=0
Receive: 52 53155.167728 53155.167122 8: seq: 15, neopixel_result oid=0 success=0
Receive: 53 53155.173724 53155.172749 8: seq: 16, neopixel_result oid=0 success=0
Receive: 54 53155.179653 53155.178673 8: seq: 17, neopixel_result oid=0 success=1
Receive: 55 53155.203720 53155.202762 8: seq: 19, neopixel_result oid=0 success=0
Receive: 56 53155.209723 53155.208761 8: seq: 1a, neopixel_result oid=0 success=0
Receive: 57 53155.215646 53155.214672 8: seq: 1b, neopixel_result oid=0 success=1
Receive: 58 53155.220698 53155.214672 15: seq: 1b, analog_in_state oid=15 next_clock=615477632 value=31180
Receive: 59 53155.245721 53155.244713 8: seq: 1d, neopixel_result oid=0 success=1
Receive: 60 53155.260700 53155.244713 15: seq: 1d, analog_in_state oid=19 next_clock=618357632 value=31256
Receive: 61 53155.287721 53155.286918 8: seq: 1f, neopixel_result oid=0 success=0
Receive: 62 53155.293727 53155.292766 8: seq: 10, neopixel_result oid=0 success=0
Receive: 63 53155.299671 53155.298683 8: seq: 11, neopixel_result oid=0 success=1
Receive: 64 53155.329723 53155.328792 8: seq: 13, neopixel_result oid=0 success=0
Receive: 65 53155.335728 53155.334793 8: seq: 14, neopixel_result oid=0 success=0
Receive: 66 53155.340707 53155.334793 15: seq: 14, analog_in_state oid=27 next_clock=624117632 value=31256
Receive: 67 53155.341688 53155.340688 8: seq: 15, neopixel_result oid=0 success=1
Receive: 68 53155.372500 53155.371487 8: seq: 17, neopixel_result oid=0 success=1
Receive: 69 53155.414745 53155.413699 8: seq: 19, neopixel_result oid=0 success=1
Receive: 70 53155.457017 53155.456001 8: seq: 1b, neopixel_result oid=0 success=1
Receive: 71 53155.499257 53155.498218 8: seq: 1d, neopixel_result oid=0 success=1
Receive: 72 53155.520708 53155.498218 15: seq: 1d, analog_in_state oid=15 next_clock=637077632 value=31173
Receive: 73 53155.541507 53155.540483 8: seq: 1f, neopixel_result oid=0 success=1
Receive: 74 53155.560812 53155.540483 15: seq: 1f, analog_in_state oid=19 next_clock=639957632 value=31249
Receive: 75 53155.583729 53155.582995 8: seq: 11, neopixel_result oid=0 success=0
Receive: 76 53155.589733 53155.588847 8: seq: 12, neopixel_result oid=0 success=0
Receive: 77 53155.595691 53155.594703 8: seq: 13, neopixel_result oid=0 success=1
Receive: 78 53155.626517 53155.625475 8: seq: 15, neopixel_result oid=0 success=1
Receive: 79 53155.629108 53155.628668 11: seq: 16, clock clock=623784453
Receive: 80 53155.640769 53155.628668 15: seq: 16, analog_in_state oid=27 next_clock=645717632 value=31254
Receive: 81 53155.668782 53155.667780 8: seq: 18, neopixel_result oid=0 success=1
Receive: 82 53155.710923 53155.709933 8: seq: 1a, neopixel_result oid=0 success=1
Receive: 83 53155.753213 53155.752215 8: seq: 1c, neopixel_result oid=0 success=1
Receive: 84 53155.795373 53155.794369 8: seq: 1e, neopixel_result oid=0 success=1
Receive: 85 53155.820714 53155.794369 15: seq: 1e, analog_in_state oid=15 next_clock=658677632 value=31178
Receive: 86 53155.837534 53155.836524 8: seq: 10, neopixel_result oid=0 success=1
Receive: 87 53155.860778 53155.836524 15: seq: 10, analog_in_state oid=19 next_clock=661557632 value=31257
Receive: 88 53155.879524 53155.878525 8: seq: 12, neopixel_result oid=0 success=1
Receive: 89 53155.921737 53155.920806 8: seq: 14, neopixel_result oid=0 success=0
Receive: 90 53155.927738 53155.926818 8: seq: 15, neopixel_result oid=0 success=0
Receive: 91 53155.933669 53155.932697 8: seq: 16, neopixel_result oid=0 success=1
Receive: 92 53155.940720 53155.932697 15: seq: 16, analog_in_state oid=27 next_clock=667317632 value=31261
Receive: 93 53155.963741 53155.962808 8: seq: 18, neopixel_result oid=0 success=0
Receive: 94 53155.969741 53155.968786 8: seq: 19, neopixel_result oid=0 success=0
Receive: 95 53155.975651 53155.974694 8: seq: 1a, neopixel_result oid=0 success=1
Receive: 96 53156.005723 53156.004702 8: seq: 1c, neopixel_result oid=0 success=1
Receive: 97 53156.047745 53156.046930 8: seq: 1e, neopixel_result oid=0 success=0
Receive: 98 53156.053840 53156.052791 8: seq: 1f, neopixel_result oid=0 success=0
Receive: 99 53156.058113 53156.057517 12: seq: 10, shutdown clock=654663569 static_string_id=Command request
Unhandled exception during run
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/mcu.py", line 71, in _do_send
    return xh.get_response(cmds, self._cmd_queue, minclock, reqclock)
  File "/home/klipper/klipper/klippy/serialhdl.py", line 327, in get_response
    raise error("Unable to obtain '%s' response" % (self.name,))
serialhdl.error: Unable to obtain 'neopixel_result' response

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 176, in run
    self.reactor.run()
  File "/home/klipper/klipper/klippy/reactor.py", line 292, in run
    g_next.switch()
  File "/home/klipper/klipper/klippy/reactor.py", line 340, in _dispatch_loop
    timeout = self._check_timers(eventtime, busy)
  File "/home/klipper/klipper/klippy/reactor.py", line 158, in _check_timers
    t.waketime = waketime = t.callback(eventtime)
  File "/home/klipper/klipper/klippy/reactor.py", line 48, in invoke
    res = self.callback(eventtime)
  File "/home/klipper/klipper/klippy/extras/neopixel.py", line 105, in reactor_bgfunc
    self.send_data(print_time)
  File "/home/klipper/klipper/klippy/extras/neopixel.py", line 95, in send_data
    params = scmd([self.oid], minclock=minclock,
  File "/home/klipper/klipper/klippy/mcu.py", line 75, in send
    return self._do_send([self._cmd.encode(data)], minclock, reqclock)
  File "/home/klipper/klipper/klippy/mcu.py", line 73, in _do_send
    raise self._error(str(e))
gcode.CommandError: Unable to obtain 'neopixel_result' response
Stats 53156.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=63295 bytes_read=34559 bytes_retransmit=9 bytes_invalid=0 send_seq=2518 receive_seq=2518 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998238  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.43 cputime=1208.196 memavail=1723420 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53157.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=63334 bytes_read=34785 bytes_retransmit=9 bytes_invalid=0 send_seq=2522 receive_seq=2522 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998243  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.43 cputime=1208.222 memavail=1723160 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53158.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=63340 bytes_read=34951 bytes_retransmit=9 bytes_invalid=0 send_seq=2523 receive_seq=2523 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998248  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.39 cputime=1208.245 memavail=1723304 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53159.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=63346 bytes_read=35117 bytes_retransmit=9 bytes_invalid=0 send_seq=2524 receive_seq=2524 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998254  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.39 cputime=1208.267 memavail=1723320 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53160.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=63352 bytes_read=35283 bytes_retransmit=9 bytes_invalid=0 send_seq=2525 receive_seq=2525 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998255  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.39 cputime=1208.290 memavail=1723848 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53161.6: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000279 mcu_task_stddev=0.000266 bytes_write=63358 bytes_read=35449 bytes_retransmit=9 bytes_invalid=0 send_seq=2526 receive_seq=2526 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998255  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.39 cputime=1208.312 memavail=1723600 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53162.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63378 bytes_read=35648 bytes_retransmit=9 bytes_invalid=0 send_seq=2528 receive_seq=2528 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998256  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.39 cputime=1208.335 memavail=1721620 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53163.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63398 bytes_read=35833 bytes_retransmit=9 bytes_invalid=0 send_seq=2530 receive_seq=2530 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998256  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.36 cputime=1208.358 memavail=1721900 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53164.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63404 bytes_read=35999 bytes_retransmit=9 bytes_invalid=0 send_seq=2531 receive_seq=2531 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998259  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.36 cputime=1208.381 memavail=1722680 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53165.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63410 bytes_read=36165 bytes_retransmit=9 bytes_invalid=0 send_seq=2532 receive_seq=2532 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998259  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.36 cputime=1208.403 memavail=1722940 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53166.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63416 bytes_read=36331 bytes_retransmit=9 bytes_invalid=0 send_seq=2533 receive_seq=2533 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998259  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.36 cputime=1208.426 memavail=1722952 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53167.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63436 bytes_read=36530 bytes_retransmit=9 bytes_invalid=0 send_seq=2535 receive_seq=2535 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998261  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.36 cputime=1208.448 memavail=1722960 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53168.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63456 bytes_read=36715 bytes_retransmit=9 bytes_invalid=0 send_seq=2537 receive_seq=2537 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998261  orange_pi: temp=45.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.33 cputime=1208.469 memavail=1722972 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53169.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63462 bytes_read=36881 bytes_retransmit=9 bytes_invalid=0 send_seq=2538 receive_seq=2538 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998264  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.33 cputime=1208.491 memavail=1723004 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53170.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63468 bytes_read=37047 bytes_retransmit=9 bytes_invalid=0 send_seq=2539 receive_seq=2539 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998266  orange_pi: temp=46.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.33 cputime=1208.514 memavail=1722788 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53171.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000012 bytes_write=63474 bytes_read=37213 bytes_retransmit=9 bytes_invalid=0 send_seq=2540 receive_seq=2540 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998269  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.33 cputime=1208.537 memavail=1722784 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 53172.6: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000013 bytes_write=63480 bytes_read=37393 bytes_retransmit=9 bytes_invalid=0 send_seq=2541 receive_seq=2541 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=46.0 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.33 cputime=1208.559 memavail=1722308 print_time=52651.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
webhooks client 281473445077840: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:19:58 2024 (1735550398.2 53173.8)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  .5 1 top (.5,.5,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473466150112: New connection
webhooks client 281473466150112: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 27, 'next_clock': 2179317632, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53176.893110106, '#receive_time': 53176.941243106}
mcu 'mcu': got {'count': 186, 'sum': 347072, 'sumsq': 3234548, '#name': 'stats', '#sent_time': 53176.996957397, '#receive_time': 53176.997872772}
mcu 'mcu': got {'oid': 15, 'next_clock': 2192277632, 'value': 31180, '#name': 'analog_in_state', '#sent_time': 53177.102339481, '#receive_time': 53177.121230272}
mcu 'mcu': got {'oid': 19, 'next_clock': 2195157632, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 53177.154170939, '#receive_time': 53177.161228231}
mcu 'mcu': got {'oid': 27, 'next_clock': 2200917632, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 53177.205956564, '#receive_time': 53177.241240814}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
MCU error during connect
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 135, in _connect
    cb()
  File "/home/klipper/klipper/klippy/mcu.py", line 742, in _connect
    config_params = self._send_get_config()
  File "/home/klipper/klipper/klippy/mcu.py", line 728, in _send_get_config
    raise error("Can not update MCU '%s' config as it is shutdown" % (
mcu.error: Can not update MCU 'mcu' config as it is shutdown
Can not update MCU 'mcu' config as it is shutdown
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Error configuring printer

No build file /home/klipper/klipper/klippy/../.config
No build file /home/klipper/klipper/klippy/../out/klipper.dict
No build file /home/klipper/klipper/klippy/../out/klipper.elf
mcu 'mcu': got {'oid': 15, 'next_clock': 2213877632, 'value': 31181, '#name': 'analog_in_state', '#sent_time': 53177.313329189004, '#receive_time': 53177.421261273}
mcu 'mcu': got {'oid': 19, 'next_clock': 2216757632, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53177.313329189004, '#receive_time': 53177.461254023}
mcu 'mcu': got {'oid': 27, 'next_clock': 2222517632, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 53177.313329189004, '#receive_time': 53177.541297189004}
mcu 'mcu': got {'oid': 15, 'next_clock': 2235477632, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 53177.313329189004, '#receive_time': 53177.721303148}
mcu 'mcu': got {'oid': 19, 'next_clock': 2238357632, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 53177.313329189004, '#receive_time': 53177.761301689}
mcu 'mcu': got {'oid': 27, 'next_clock': 2244117632, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 53177.313329189004, '#receive_time': 53177.841272023}
mcu 'mcu': got {'oid': 15, 'next_clock': 2257077632, 'value': 31185, '#name': 'analog_in_state', '#sent_time': 53177.313329189004, '#receive_time': 53178.021274856}
mcu 'mcu': got {'oid': 19, 'next_clock': 2259957632, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 53177.313329189004, '#receive_time': 53178.061263398}
mcu 'mcu': got {'oid': 27, 'next_clock': 2265717632, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 53177.313329189004, '#receive_time': 53178.141282065}
mcu 'mcu': got {'oid': 15, 'next_clock': 2278677632, 'value': 31187, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53178.321246731}
mcu 'mcu': got {'oid': 19, 'next_clock': 2281557632, 'value': 31252, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53178.361265815}
mcu 'mcu': got {'oid': 27, 'next_clock': 2287317632, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53178.44127569}
mcu 'mcu': got {'oid': 15, 'next_clock': 2300277632, 'value': 31191, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53178.621322023}
mcu 'mcu': got {'oid': 19, 'next_clock': 2303157632, 'value': 31244, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53178.661300190004}
mcu 'mcu': got {'oid': 27, 'next_clock': 2308917632, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53178.741324523}
mcu 'mcu': got {'oid': 15, 'next_clock': 2321877632, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53178.92130419}
mcu 'mcu': got {'oid': 19, 'next_clock': 2324757632, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53178.961288982}
mcu 'mcu': got {'oid': 27, 'next_clock': 2330517632, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53179.041300523}
mcu 'mcu': got {'oid': 15, 'next_clock': 2343477632, 'value': 31180, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53179.221303815}
mcu 'mcu': got {'oid': 19, 'next_clock': 2346357632, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 53178.297493481004, '#receive_time': 53179.26130144}
mcu 'mcu': got {'oid': 27, 'next_clock': 2352117632, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53179.341275315004}
mcu 'mcu': got {'oid': 15, 'next_clock': 2365077632, 'value': 31183, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53179.521299732}
mcu 'mcu': got {'oid': 19, 'next_clock': 2367957632, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53179.561343607}
mcu 'mcu': got {'oid': 27, 'next_clock': 2373717632, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53179.641349607}
mcu 'mcu': got {'oid': 15, 'next_clock': 2386677632, 'value': 31182, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53179.821319607}
mcu 'mcu': got {'oid': 19, 'next_clock': 2389557632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53179.861313232}
mcu 'mcu': got {'oid': 27, 'next_clock': 2395317632, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53179.941309107}
mcu 'mcu': got {'oid': 15, 'next_clock': 2408277632, 'value': 31225, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53180.121318941}
mcu 'mcu': got {'oid': 19, 'next_clock': 2411157632, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53180.161329191}
mcu 'mcu': got {'oid': 27, 'next_clock': 2416917632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53179.281608732, '#receive_time': 53180.241325774}
mcu 'mcu': got {'oid': 15, 'next_clock': 2429877632, 'value': 31187, '#name': 'analog_in_state', '#sent_time': 53180.266256607, '#receive_time': 53180.421305316}
mcu 'mcu': got {'oid': 19, 'next_clock': 2432757632, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 53180.266256607, '#receive_time': 53180.461321607}
mcu 'mcu': got {'oid': 27, 'next_clock': 2438517632, 'value': 31252, '#name': 'analog_in_state', '#sent_time': 53180.266256607, '#receive_time': 53180.541333107}
mcu 'mcu': got {'oid': 15, 'next_clock': 2451477632, 'value': 31185, '#name': 'analog_in_state', '#sent_time': 53180.266256607, '#receive_time': 53180.721371274}
mcu 'mcu': got {'oid': 19, 'next_clock': 2454357632, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 53180.266256607, '#receive_time': 53180.761347649}
mcu 'mcu': got {'oid': 27, 'next_clock': 2460117632, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 53180.266256607, '#receive_time': 53180.841344691}
mcu 'mcu': got {'oid': 15, 'next_clock': 2473077632, 'value': 31193, '#name': 'analog_in_state', '#sent_time': 53180.266256607, '#receive_time': 53181.021342774}
mcu 'mcu': got {'oid': 19, 'next_clock': 2475957632, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53180.266256607, '#receive_time': 53181.061346524}
mcu 'mcu': got {'oid': 27, 'next_clock': 2481717632, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53180.266256607, '#receive_time': 53181.141343899}
mcu 'mcu': got {'oid': 15, 'next_clock': 2494677632, 'value': 31182, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53181.321351399}
mcu 'mcu': got {'oid': 19, 'next_clock': 2497557632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53181.361358983}
mcu 'mcu': got {'oid': 27, 'next_clock': 2503317632, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53181.441357441}
mcu 'mcu': got {'oid': 15, 'next_clock': 2516277632, 'value': 31183, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53181.621397150004}
mcu 'mcu': got {'oid': 19, 'next_clock': 2519157632, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53181.661372233}
mcu 'mcu': got {'oid': 27, 'next_clock': 2524917632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53181.74136265}
mcu 'mcu': got {'oid': 15, 'next_clock': 2537877632, 'value': 31180, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53181.921367275}
mcu 'mcu': got {'oid': 19, 'next_clock': 2540757632, 'value': 31252, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53181.961364441}
mcu 'mcu': got {'oid': 27, 'next_clock': 2546517632, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53182.041937108}
mcu 'mcu': got {'oid': 15, 'next_clock': 2559477632, 'value': 31185, '#name': 'analog_in_state', '#sent_time': 53181.250729691004, '#receive_time': 53182.221375942}
mcu 'mcu': got {'oid': 19, 'next_clock': 2562357632, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53182.261342192}
mcu 'mcu': got {'oid': 27, 'next_clock': 2568117632, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53182.341369608}
mcu 'mcu': got {'oid': 15, 'next_clock': 2581077632, 'value': 31183, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53182.521368192}
mcu 'mcu': got {'oid': 19, 'next_clock': 2583957632, 'value': 31250, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53182.561376817}
mcu 'mcu': got {'oid': 27, 'next_clock': 2589717632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53182.64142665}
mcu 'mcu': got {'oid': 15, 'next_clock': 2602677632, 'value': 31184, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53182.821407025}
mcu 'mcu': got {'oid': 19, 'next_clock': 2605557632, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53182.8613909}
mcu 'mcu': got {'oid': 27, 'next_clock': 2611317632, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53182.941387734}
mcu 'mcu': got {'oid': 15, 'next_clock': 2624277632, 'value': 31175, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53183.121394192}
mcu 'mcu': got {'oid': 19, 'next_clock': 2627157632, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53182.235597692, '#receive_time': 53183.161392025}
mcu 'mcu': got {'oid': 27, 'next_clock': 2632917632, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53183.241369150004}
mcu 'mcu': got {'oid': 15, 'next_clock': 2645877632, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53183.421395109}
mcu 'mcu': got {'oid': 19, 'next_clock': 2648757632, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53183.461399609}
mcu 'mcu': got {'oid': 27, 'next_clock': 2654517632, 'value': 31260, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53183.541399651}
mcu 'mcu': got {'oid': 15, 'next_clock': 2667477632, 'value': 31189, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53183.721442942}
mcu 'mcu': got {'oid': 19, 'next_clock': 2670357632, 'value': 31260, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53183.761412609}
mcu 'mcu': got {'oid': 27, 'next_clock': 2676117632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53183.841410317}
mcu 'mcu': got {'oid': 15, 'next_clock': 2689077632, 'value': 31182, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53184.021408901004}
mcu 'mcu': got {'oid': 19, 'next_clock': 2691957632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53184.061408359}
mcu 'mcu': got {'oid': 27, 'next_clock': 2697717632, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 53183.220694484, '#receive_time': 53184.141413401}
mcu 'mcu': got {'oid': 15, 'next_clock': 2710677632, 'value': 31175, '#name': 'analog_in_state', '#sent_time': 53184.205566192, '#receive_time': 53184.321397901}
mcu 'mcu': got {'oid': 19, 'next_clock': 2713557632, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53184.205566192, '#receive_time': 53184.361415068}
mcu 'mcu': got {'oid': 27, 'next_clock': 2719317632, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 53184.205566192, '#receive_time': 53184.441414609}
mcu 'mcu': got {'oid': 15, 'next_clock': 2732277632, 'value': 31176, '#name': 'analog_in_state', '#sent_time': 53184.205566192, '#receive_time': 53184.621467859004}
mcu 'mcu': got {'oid': 19, 'next_clock': 2735157632, 'value': 31252, '#name': 'analog_in_state', '#sent_time': 53184.205566192, '#receive_time': 53184.661463318}
mcu 'mcu': got {'oid': 27, 'next_clock': 2740917632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53184.205566192, '#receive_time': 53184.741468984}
mcu 'mcu': got {'oid': 15, 'next_clock': 2753877632, 'value': 31181, '#name': 'analog_in_state', '#sent_time': 53184.205566192, '#receive_time': 53184.921445026004}
mcu 'mcu': got {'oid': 19, 'next_clock': 2756757632, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53184.205566192, '#receive_time': 53184.961441235}
mcu 'mcu': got {'oid': 27, 'next_clock': 2762517632, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 53184.205566192, '#receive_time': 53185.041443985}
mcu 'mcu': got {'oid': 15, 'next_clock': 2775477632, 'value': 31188, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53185.221410943}
mcu 'mcu': got {'oid': 19, 'next_clock': 2778357632, 'value': 31249, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53185.261435026}
mcu 'mcu': got {'oid': 27, 'next_clock': 2784117632, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53185.341442943}
mcu 'mcu': got {'oid': 15, 'next_clock': 2797077632, 'value': 31184, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53185.521457318}
mcu 'mcu': got {'oid': 19, 'next_clock': 2799957632, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53185.561451735004}
mcu 'mcu': got {'oid': 27, 'next_clock': 2805717632, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53185.641496652}
mcu 'mcu': got {'oid': 15, 'next_clock': 2818677632, 'value': 31216, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53185.82148036}
mcu 'mcu': got {'oid': 19, 'next_clock': 2821557632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53185.861497527}
mcu 'mcu': got {'oid': 27, 'next_clock': 2827317632, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53185.941489027}
mcu 'mcu': got {'oid': 15, 'next_clock': 2840277632, 'value': 31187, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53186.121470818}
mcu 'mcu': got {'oid': 19, 'next_clock': 2843157632, 'value': 31252, '#name': 'analog_in_state', '#sent_time': 53185.190263068, '#receive_time': 53186.161463360004}
mcu 'mcu': got {'oid': 27, 'next_clock': 2848917632, 'value': 31260, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53186.24145436}
mcu 'mcu': got {'oid': 15, 'next_clock': 2861877632, 'value': 31185, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53186.42147386}
mcu 'mcu': got {'oid': 19, 'next_clock': 2864757632, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53186.461475527}
mcu 'mcu': got {'oid': 27, 'next_clock': 2870517632, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53186.541472319004}
mcu 'mcu': got {'oid': 15, 'next_clock': 2883477632, 'value': 31183, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53186.721526735004}
mcu 'mcu': got {'oid': 19, 'next_clock': 2886357632, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53186.761488485}
mcu 'mcu': got {'oid': 27, 'next_clock': 2892117632, 'value': 31260, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53186.841487777}
mcu 'mcu': got {'oid': 15, 'next_clock': 2905077632, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53187.02148111}
mcu 'mcu': got {'oid': 19, 'next_clock': 2907957632, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53187.062052944}
mcu 'mcu': got {'oid': 27, 'next_clock': 2913717632, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53186.175247277, '#receive_time': 53187.141487236004}
mcu 'mcu': got {'oid': 15, 'next_clock': 2926677632, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 53187.160075569, '#receive_time': 53187.321493527}
mcu 'mcu': got {'oid': 19, 'next_clock': 2929557632, 'value': 31250, '#name': 'analog_in_state', '#sent_time': 53187.160075569, '#receive_time': 53187.361497861}
mcu 'mcu': got {'oid': 27, 'next_clock': 2935317632, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 53187.160075569, '#receive_time': 53187.441490236}
mcu 'mcu': got {'oid': 15, 'next_clock': 2948277632, 'value': 31179, '#name': 'analog_in_state', '#sent_time': 53187.160075569, '#receive_time': 53187.621551694}
mcu 'mcu': got {'oid': 19, 'next_clock': 2951157632, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53187.160075569, '#receive_time': 53187.661528152}
mcu 'mcu': got {'oid': 27, 'next_clock': 2956917632, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53187.160075569, '#receive_time': 53187.741567403}
mcu 'mcu': got {'oid': 15, 'next_clock': 2969877632, 'value': 31187, '#name': 'analog_in_state', '#sent_time': 53187.160075569, '#receive_time': 53187.921524528}
mcu 'mcu': got {'oid': 19, 'next_clock': 2972757632, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53187.160075569, '#receive_time': 53187.961521528}
mcu 'mcu': got {'oid': 27, 'next_clock': 2978517632, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53187.160075569, '#receive_time': 53188.041527153}
mcu 'mcu': got {'oid': 15, 'next_clock': 2991477632, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 53188.144938653, '#receive_time': 53188.221492069}
mcu 'mcu': got {'oid': 19, 'next_clock': 2994357632, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53188.144938653, '#receive_time': 53188.261535278}
mcu 'mcu': got {'oid': 27, 'next_clock': 3000117632, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 53188.144938653, '#receive_time': 53188.341528319}
mcu 'mcu': got {'oid': 15, 'next_clock': 3013077632, 'value': 31187, '#name': 'analog_in_state', '#sent_time': 53188.144938653, '#receive_time': 53188.52153132}
mcu 'mcu': got {'oid': 19, 'next_clock': 3015957632, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53188.144938653, '#receive_time': 53188.561537736}
mcu 'mcu': got {'oid': 27, 'next_clock': 3021717632, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 53188.144938653, '#receive_time': 53188.64158382}
mcu 'mcu': got {'oid': 15, 'next_clock': 3034677632, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 53188.144938653, '#receive_time': 53188.821566236}
mcu 'mcu': got {'oid': 19, 'next_clock': 3037557632, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53188.144938653, '#receive_time': 53188.861548611}
mcu 'mcu': got {'oid': 27, 'next_clock': 3043317632, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 53188.144938653, '#receive_time': 53188.941542403}
Attempting MCU 'mcu' reset command
webhooks client 281473466150112: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:20:14 2024 (1735550414.6 53190.2)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  .5 1 top (.5,.5,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473445081056: New connection
webhooks client 281473445081056: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53194.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000030 mcu_task_stddev=0.000050 bytes_write=3266 bytes_read=6191 bytes_retransmit=0 bytes_invalid=0 send_seq=230 receive_seq=227 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71995695  orange_pi: temp=47.5 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.35 cputime=1214.615 memavail=1718508 print_time=5.390 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473445081056
webhooks: registering remote method 'reboot_machine' for connection id: 281473445081056
webhooks: registering remote method 'pause_job_queue' for connection id: 281473445081056
webhooks: registering remote method 'start_job_queue' for connection id: 281473445081056
Stats 53195.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000030 mcu_task_stddev=0.000050 bytes_write=7324 bytes_read=6851 bytes_retransmit=0 bytes_invalid=0 send_seq=320 receive_seq=320 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996757  orange_pi: temp=47.0 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.35 cputime=1214.706 memavail=1718044 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 53196.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000030 mcu_task_stddev=0.000050 bytes_write=9239 bytes_read=7749 bytes_retransmit=0 bytes_invalid=0 send_seq=392 receive_seq=392 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997578  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.35 cputime=1214.807 memavail=1717820 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53197.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000030 mcu_task_stddev=0.000050 bytes_write=11057 bytes_read=8602 bytes_retransmit=0 bytes_invalid=0 send_seq=460 receive_seq=460 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997807  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.35 cputime=1214.885 memavail=1717820 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53198.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000030 mcu_task_stddev=0.000050 bytes_write=12870 bytes_read=9336 bytes_retransmit=0 bytes_invalid=0 send_seq=520 receive_seq=520 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997908  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.41 cputime=1214.955 memavail=1717820 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53199.2: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000271 mcu_task_stddev=0.000319 bytes_write=14639 bytes_read=10010 bytes_retransmit=0 bytes_invalid=0 send_seq=573 receive_seq=573 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997978  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.41 cputime=1215.026 memavail=1717984 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53200.2: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000271 mcu_task_stddev=0.000319 bytes_write=16529 bytes_read=10967 bytes_retransmit=0 bytes_invalid=0 send_seq=650 receive_seq=649 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997967  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.41 cputime=1215.107 memavail=1718612 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53201.2: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000271 mcu_task_stddev=0.000319 bytes_write=18385 bytes_read=11823 bytes_retransmit=0 bytes_invalid=0 send_seq=719 receive_seq=719 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998078  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.41 cputime=1215.180 memavail=1719640 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53202.2: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000271 mcu_task_stddev=0.000319 bytes_write=20236 bytes_read=12607 bytes_retransmit=0 bytes_invalid=0 send_seq=783 receive_seq=783 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998108  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.41 cputime=1215.256 memavail=1719388 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53203.2: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000271 mcu_task_stddev=0.000319 bytes_write=21986 bytes_read=13304 bytes_retransmit=0 bytes_invalid=0 send_seq=840 receive_seq=839 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998099  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.37 cputime=1215.329 memavail=1719168 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53204.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000268 mcu_task_stddev=0.000270 bytes_write=23816 bytes_read=14112 bytes_retransmit=0 bytes_invalid=0 send_seq=904 receive_seq=904 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998098  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.37 cputime=1215.404 memavail=1719944 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53205.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000268 mcu_task_stddev=0.000270 bytes_write=25629 bytes_read=14855 bytes_retransmit=0 bytes_invalid=0 send_seq=963 receive_seq=963 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998120  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.37 cputime=1215.479 memavail=1719872 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53206.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000268 mcu_task_stddev=0.000270 bytes_write=27498 bytes_read=15778 bytes_retransmit=0 bytes_invalid=0 send_seq=1037 receive_seq=1037 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998119  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.37 cputime=1215.561 memavail=1719992 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53207.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000268 mcu_task_stddev=0.000270 bytes_write=29347 bytes_read=16616 bytes_retransmit=0 bytes_invalid=0 send_seq=1105 receive_seq=1105 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998127  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.37 cputime=1215.638 memavail=1719996 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53208.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000268 mcu_task_stddev=0.000270 bytes_write=31209 bytes_read=17471 bytes_retransmit=0 bytes_invalid=0 send_seq=1172 receive_seq=1172 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998155  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.34 cputime=1215.714 memavail=1719996 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53209.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000270 bytes_write=33009 bytes_read=18250 bytes_retransmit=0 bytes_invalid=0 send_seq=1233 receive_seq=1233 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998158  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.34 cputime=1215.790 memavail=1719512 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53210.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000270 bytes_write=34919 bytes_read=19220 bytes_retransmit=0 bytes_invalid=0 send_seq=1310 receive_seq=1310 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998183  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.34 cputime=1215.873 memavail=1720276 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53211.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000270 bytes_write=36989 bytes_read=20421 bytes_retransmit=0 bytes_invalid=0 send_seq=1406 receive_seq=1406 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998182  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.34 cputime=1215.964 memavail=1720588 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53212.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000270 bytes_write=38854 bytes_read=21224 bytes_retransmit=0 bytes_invalid=0 send_seq=1473 receive_seq=1472 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998441  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.34 cputime=1216.058 memavail=1721092 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53213.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000270 bytes_write=40642 bytes_read=22051 bytes_retransmit=0 bytes_invalid=0 send_seq=1538 receive_seq=1538 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998399  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.48 cputime=1216.134 memavail=1721640 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53214.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000284 mcu_task_stddev=0.000263 bytes_write=42481 bytes_read=22840 bytes_retransmit=0 bytes_invalid=0 send_seq=1601 receive_seq=1601 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998365  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.48 cputime=1216.210 memavail=1721920 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53215.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000284 mcu_task_stddev=0.000263 bytes_write=44404 bytes_read=23776 bytes_retransmit=0 bytes_invalid=0 send_seq=1677 receive_seq=1676 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998337  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.48 cputime=1216.291 memavail=1721920 print_time=5.390 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53216.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000284 mcu_task_stddev=0.000263 bytes_write=46289 bytes_read=24678 bytes_retransmit=0 bytes_invalid=0 send_seq=1749 receive_seq=1749 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998315  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.48 cputime=1216.376 memavail=1721920 print_time=27.537 buffer_time=0.375 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473445081056: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:20:42 2024 (1735550442.2 53217.8)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  1 1 top (.5,.5,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473465549392: New connection
webhooks client 281473465549392: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 2322000000, 'value': 31183, '#name': 'analog_in_state', '#sent_time': 53221.014645918, '#receive_time': 53221.040688668}
mcu 'mcu': got {'oid': 19, 'next_clock': 2324880000, 'value': 31251, '#name': 'analog_in_state', '#sent_time': 53221.067249335, '#receive_time': 53221.080653335004}
mcu 'mcu': got {'oid': 27, 'next_clock': 2330640000, 'value': 31251, '#name': 'analog_in_state', '#sent_time': 53221.119056793, '#receive_time': 53221.160656335}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53221.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3089 bytes_read=6251 bytes_retransmit=0 bytes_invalid=0 send_seq=215 receive_seq=212 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71996310  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.52 cputime=1219.433 memavail=1720540 print_time=32.981 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473465549392
webhooks: registering remote method 'reboot_machine' for connection id: 281473465549392
webhooks: registering remote method 'pause_job_queue' for connection id: 281473465549392
webhooks: registering remote method 'start_job_queue' for connection id: 281473465549392
Stats 53222.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7237 bytes_read=7112 bytes_retransmit=0 bytes_invalid=0 send_seq=315 receive_seq=314 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996698  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.48 cputime=1219.533 memavail=1720568 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53223.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=9186 bytes_read=8104 bytes_retransmit=0 bytes_invalid=0 send_seq=394 receive_seq=394 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997656  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.48 cputime=1219.635 memavail=1720364 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53224.8: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000176 mcu_task_stddev=0.000284 bytes_write=11179 bytes_read=9187 bytes_retransmit=0 bytes_invalid=0 send_seq=480 receive_seq=479 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997709  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.48 cputime=1219.721 memavail=1719868 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53225.8: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000176 mcu_task_stddev=0.000284 bytes_write=13116 bytes_read=10259 bytes_retransmit=0 bytes_invalid=0 send_seq=565 receive_seq=565 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997759  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.48 cputime=1219.806 memavail=1719616 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53226.8: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000176 mcu_task_stddev=0.000284 bytes_write=15090 bytes_read=11280 bytes_retransmit=0 bytes_invalid=0 send_seq=646 receive_seq=646 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997875  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.48 cputime=1219.889 memavail=1718860 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53227.8: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000176 mcu_task_stddev=0.000284 bytes_write=17013 bytes_read=12187 bytes_retransmit=0 bytes_invalid=0 send_seq=720 receive_seq=720 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997905  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.44 cputime=1219.969 memavail=1718104 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53228.8: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000176 mcu_task_stddev=0.000284 bytes_write=18873 bytes_read=13053 bytes_retransmit=0 bytes_invalid=0 send_seq=792 receive_seq=792 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997937  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.44 cputime=1220.047 memavail=1717596 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53229.8: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000289 mcu_task_stddev=0.000261 bytes_write=20738 bytes_read=13972 bytes_retransmit=0 bytes_invalid=0 send_seq=862 receive_seq=862 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998001  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.44 cputime=1220.126 memavail=1717632 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53230.8: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000289 mcu_task_stddev=0.000261 bytes_write=22761 bytes_read=15111 bytes_retransmit=0 bytes_invalid=0 send_seq=952 receive_seq=952 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998016  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.44 cputime=1220.212 memavail=1717648 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53231.8: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000289 mcu_task_stddev=0.000261 bytes_write=24642 bytes_read=15967 bytes_retransmit=0 bytes_invalid=0 send_seq=1022 receive_seq=1022 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998041  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.44 cputime=1220.289 memavail=1716904 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53232.8: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000289 mcu_task_stddev=0.000261 bytes_write=26530 bytes_read=16923 bytes_retransmit=0 bytes_invalid=0 send_seq=1098 receive_seq=1098 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998089  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.40 cputime=1220.368 memavail=1718216 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53233.8: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000289 mcu_task_stddev=0.000261 bytes_write=28518 bytes_read=17976 bytes_retransmit=0 bytes_invalid=0 send_seq=1182 receive_seq=1182 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998095  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1220.454 memavail=1718476 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53234.8: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000294 mcu_task_stddev=0.000263 bytes_write=30448 bytes_read=18927 bytes_retransmit=0 bytes_invalid=0 send_seq=1259 receive_seq=1258 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998104  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1220.534 memavail=1718504 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53235.8: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000294 mcu_task_stddev=0.000263 bytes_write=32228 bytes_read=19717 bytes_retransmit=0 bytes_invalid=0 send_seq=1320 receive_seq=1320 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998122  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1220.609 memavail=1717776 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53236.8: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000294 mcu_task_stddev=0.000263 bytes_write=34042 bytes_read=20505 bytes_retransmit=0 bytes_invalid=0 send_seq=1383 receive_seq=1383 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998127  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1220.683 memavail=1717524 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Stats 53237.8: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000294 mcu_task_stddev=0.000263 bytes_write=35948 bytes_read=21374 bytes_retransmit=0 bytes_invalid=0 send_seq=1454 receive_seq=1454 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998155  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.37 cputime=1220.762 memavail=1717524 print_time=32.981 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53238.8: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000294 mcu_task_stddev=0.000263 bytes_write=37910 bytes_read=22317 bytes_retransmit=0 bytes_invalid=0 send_seq=1530 receive_seq=1529 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998166  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.37 cputime=1220.867 memavail=1718292 print_time=49.820 buffer_time=0.070 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
webhooks client 281473465549392: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:21:04 2024 (1735550464.5 53240.0)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  2 1 top (.5,.5,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462127344: New connection
webhooks client 281473462127344: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 3920400000, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 53243.233087804, '#receive_time': 53243.241854887}
mcu 'mcu': got {'oid': 19, 'next_clock': 3923280000, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53243.245390262004, '#receive_time': 53243.281203304}
mcu 'mcu': got {'oid': 27, 'next_clock': 3929040000, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 53243.350424637, '#receive_time': 53243.361188471}
mcu 'mcu': got {'oid': 15, 'next_clock': 3942000000, 'value': 31182, '#name': 'analog_in_state', '#sent_time': 53243.505651679, '#receive_time': 53243.541197387}
mcu 'mcu': got {'oid': 19, 'next_clock': 3944880000, 'value': 31250, '#name': 'analog_in_state', '#sent_time': 53243.557379012, '#receive_time': 53243.581231262004}
mcu 'mcu': got {'oid': 27, 'next_clock': 3950640000, 'value': 31251, '#name': 'analog_in_state', '#sent_time': 53243.609596762, '#receive_time': 53243.661907054004}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53244.2: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3089 bytes_read=6266 bytes_retransmit=9 bytes_invalid=0 send_seq=214 receive_seq=211 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1842 upcoming_bytes=339 freq=71998200  orange_pi: temp=49.5 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.42 cputime=1223.937 memavail=1715184 print_time=55.317 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462127344
webhooks: registering remote method 'reboot_machine' for connection id: 281473462127344
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462127344
webhooks: registering remote method 'start_job_queue' for connection id: 281473462127344
Stats 53245.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000116 mcu_task_stddev=0.000266 bytes_write=7147 bytes_read=6943 bytes_retransmit=9 bytes_invalid=0 send_seq=304 receive_seq=304 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997537  orange_pi: temp=46.5 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.42 cputime=1224.027 memavail=1715244 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 53246.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000116 mcu_task_stddev=0.000266 bytes_write=9131 bytes_read=7954 bytes_retransmit=9 bytes_invalid=0 send_seq=385 receive_seq=384 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997495  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.42 cputime=1224.128 memavail=1715244 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53247.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000116 mcu_task_stddev=0.000266 bytes_write=10940 bytes_read=8835 bytes_retransmit=9 bytes_invalid=0 send_seq=453 receive_seq=453 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997996  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.42 cputime=1224.204 memavail=1715748 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53248.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000116 mcu_task_stddev=0.000266 bytes_write=12968 bytes_read=9937 bytes_retransmit=9 bytes_invalid=0 send_seq=543 receive_seq=543 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998229  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.39 cputime=1224.289 memavail=1715244 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53249.2: gcodein=0  mcu: mcu_awake=0.058 mcu_task_avg=0.000116 mcu_task_stddev=0.000266 bytes_write=15110 bytes_read=11231 bytes_retransmit=9 bytes_invalid=0 send_seq=648 receive_seq=647 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998114  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.39 cputime=1224.383 memavail=1714996 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53250.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000304 mcu_task_stddev=0.000268 bytes_write=16939 bytes_read=12075 bytes_retransmit=9 bytes_invalid=0 send_seq=714 receive_seq=714 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998114  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.39 cputime=1224.459 memavail=1715252 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53251.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000304 mcu_task_stddev=0.000268 bytes_write=18818 bytes_read=12921 bytes_retransmit=9 bytes_invalid=0 send_seq=784 receive_seq=784 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998086  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.39 cputime=1224.535 memavail=1715252 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53252.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000304 mcu_task_stddev=0.000268 bytes_write=20865 bytes_read=14075 bytes_retransmit=9 bytes_invalid=0 send_seq=877 receive_seq=877 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998071  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.39 cputime=1224.621 memavail=1715252 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53253.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000304 mcu_task_stddev=0.000268 bytes_write=22748 bytes_read=14956 bytes_retransmit=9 bytes_invalid=0 send_seq=947 receive_seq=946 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998100  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.36 cputime=1224.701 memavail=1715508 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53254.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000304 mcu_task_stddev=0.000268 bytes_write=24545 bytes_read=15768 bytes_retransmit=9 bytes_invalid=0 send_seq=1012 receive_seq=1012 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998158  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.36 cputime=1224.775 memavail=1715508 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53255.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000282 mcu_task_stddev=0.000269 bytes_write=26461 bytes_read=16708 bytes_retransmit=9 bytes_invalid=0 send_seq=1087 receive_seq=1086 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998159  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.36 cputime=1224.853 memavail=1715772 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53256.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000282 mcu_task_stddev=0.000269 bytes_write=28258 bytes_read=17479 bytes_retransmit=9 bytes_invalid=0 send_seq=1149 receive_seq=1149 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998158  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.36 cputime=1224.929 memavail=1716536 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53257.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000282 mcu_task_stddev=0.000269 bytes_write=30125 bytes_read=18338 bytes_retransmit=9 bytes_invalid=0 send_seq=1218 receive_seq=1218 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998175  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.36 cputime=1225.005 memavail=1716540 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Neopixel update did not succeed
Stats 53258.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000282 mcu_task_stddev=0.000269 bytes_write=32129 bytes_read=19383 bytes_retransmit=9 bytes_invalid=0 send_seq=1302 receive_seq=1302 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998175  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.33 cputime=1225.090 memavail=1716300 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53259.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000282 mcu_task_stddev=0.000269 bytes_write=34059 bytes_read=20360 bytes_retransmit=9 bytes_invalid=0 send_seq=1379 receive_seq=1379 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998185  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.33 cputime=1225.172 memavail=1716832 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53260.2: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000280 mcu_task_stddev=0.000266 bytes_write=36035 bytes_read=21496 bytes_retransmit=9 bytes_invalid=0 send_seq=1468 receive_seq=1468 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998192  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.33 cputime=1225.258 memavail=1717096 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53261.2: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000280 mcu_task_stddev=0.000266 bytes_write=37986 bytes_read=22455 bytes_retransmit=9 bytes_invalid=0 send_seq=1546 receive_seq=1546 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.33 cputime=1225.358 memavail=1717096 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53262.2: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000280 mcu_task_stddev=0.000266 bytes_write=39895 bytes_read=23393 bytes_retransmit=9 bytes_invalid=0 send_seq=1620 receive_seq=1620 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998211  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.33 cputime=1225.439 memavail=1717096 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53263.2: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000280 mcu_task_stddev=0.000266 bytes_write=41729 bytes_read=24210 bytes_retransmit=9 bytes_invalid=0 send_seq=1688 receive_seq=1687 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998216  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.30 cputime=1225.517 memavail=1717376 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53264.2: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000280 mcu_task_stddev=0.000266 bytes_write=43660 bytes_read=25195 bytes_retransmit=9 bytes_invalid=0 send_seq=1767 receive_seq=1767 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998212  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.30 cputime=1225.597 memavail=1717128 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53265.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000293 mcu_task_stddev=0.000269 bytes_write=45534 bytes_read=26085 bytes_retransmit=9 bytes_invalid=0 send_seq=1836 receive_seq=1836 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998210  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.30 cputime=1225.672 memavail=1717648 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53266.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000293 mcu_task_stddev=0.000269 bytes_write=47487 bytes_read=27128 bytes_retransmit=9 bytes_invalid=0 send_seq=1921 receive_seq=1921 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998225  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.30 cputime=1225.758 memavail=1717232 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53267.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000293 mcu_task_stddev=0.000269 bytes_write=49531 bytes_read=28314 bytes_retransmit=9 bytes_invalid=0 send_seq=2014 receive_seq=2014 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998224  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.30 cputime=1225.846 memavail=1717252 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53268.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000293 mcu_task_stddev=0.000269 bytes_write=51496 bytes_read=29335 bytes_retransmit=9 bytes_invalid=0 send_seq=2095 receive_seq=2095 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998221  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.28 cputime=1225.929 memavail=1717252 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Stats 53269.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000293 mcu_task_stddev=0.000269 bytes_write=53421 bytes_read=30256 bytes_retransmit=9 bytes_invalid=0 send_seq=2170 receive_seq=2170 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998225  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.28 cputime=1226.010 memavail=1717256 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53270.2: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000299 mcu_task_stddev=0.000267 bytes_write=55227 bytes_read=31058 bytes_retransmit=9 bytes_invalid=0 send_seq=2234 receive_seq=2234 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998226  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.28 cputime=1226.084 memavail=1717256 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53271.2: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000299 mcu_task_stddev=0.000267 bytes_write=57076 bytes_read=31926 bytes_retransmit=9 bytes_invalid=0 send_seq=2302 receive_seq=2302 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998231  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.28 cputime=1226.159 memavail=1717032 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53272.2: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000299 mcu_task_stddev=0.000267 bytes_write=58966 bytes_read=32790 bytes_retransmit=9 bytes_invalid=0 send_seq=2373 receive_seq=2372 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998245  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.28 cputime=1226.236 memavail=1717036 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53273.2: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000299 mcu_task_stddev=0.000267 bytes_write=60744 bytes_read=33557 bytes_retransmit=9 bytes_invalid=0 send_seq=2434 receive_seq=2434 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998245  orange_pi: temp=46.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.25 cputime=1226.311 memavail=1717080 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53274.2: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000299 mcu_task_stddev=0.000267 bytes_write=62558 bytes_read=34360 bytes_retransmit=9 bytes_invalid=0 send_seq=2497 receive_seq=2497 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998251  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.25 cputime=1226.383 memavail=1717080 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53275.2: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000273 mcu_task_stddev=0.000273 bytes_write=64503 bytes_read=35361 bytes_retransmit=9 bytes_invalid=0 send_seq=2576 receive_seq=2576 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998257  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.25 cputime=1226.464 memavail=1716828 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53276.2: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000273 mcu_task_stddev=0.000273 bytes_write=66391 bytes_read=36232 bytes_retransmit=9 bytes_invalid=0 send_seq=2647 receive_seq=2646 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998253  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.25 cputime=1226.543 memavail=1716576 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53277.2: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000273 mcu_task_stddev=0.000273 bytes_write=68102 bytes_read=36931 bytes_retransmit=9 bytes_invalid=0 send_seq=2701 receive_seq=2701 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998251  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.25 cputime=1226.612 memavail=1716324 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53278.2: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000273 mcu_task_stddev=0.000273 bytes_write=70167 bytes_read=38112 bytes_retransmit=9 bytes_invalid=0 send_seq=2796 receive_seq=2796 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998249  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1226.700 memavail=1716576 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53279.2: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000273 mcu_task_stddev=0.000273 bytes_write=72071 bytes_read=38996 bytes_retransmit=9 bytes_invalid=0 send_seq=2868 receive_seq=2867 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998248  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1226.779 memavail=1717084 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53280.2: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000290 mcu_task_stddev=0.000268 bytes_write=73989 bytes_read=40055 bytes_retransmit=9 bytes_invalid=0 send_seq=2949 receive_seq=2949 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998248  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.23 cputime=1226.860 memavail=1717860 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53281.2: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000290 mcu_task_stddev=0.000268 bytes_write=75761 bytes_read=40687 bytes_retransmit=9 bytes_invalid=0 send_seq=3003 receive_seq=3003 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998250  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.23 cputime=1226.928 memavail=1717608 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53282.2: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000290 mcu_task_stddev=0.000268 bytes_write=77672 bytes_read=41612 bytes_retransmit=9 bytes_invalid=0 send_seq=3076 receive_seq=3076 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998345  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1227.007 memavail=1717624 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53283.2: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000290 mcu_task_stddev=0.000268 bytes_write=79630 bytes_read=42613 bytes_retransmit=9 bytes_invalid=0 send_seq=3157 receive_seq=3156 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998335  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1227.092 memavail=1716916 print_time=55.317 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53284.2: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000290 mcu_task_stddev=0.000268 bytes_write=81460 bytes_read=43456 bytes_retransmit=9 bytes_invalid=0 send_seq=3225 receive_seq=3225 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998327  orange_pi: temp=46.6 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.21 cputime=1227.174 memavail=1716664 print_time=95.144 buffer_time=0.042 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
webhooks client 281473462127344: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:21:49 2024 (1735550509.8 53285.4)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  2 1 top (255,255,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473464765456: New connection
webhooks client 281473464765456: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 27, 'next_clock': 2888472704, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53288.526606034, '#receive_time': 53288.562321534}
mcu 'mcu': got {'oid': 15, 'next_clock': 2901432704, 'value': 31174, '#name': 'analog_in_state', '#sent_time': 53288.735668326, '#receive_time': 53288.742266909}
mcu 'mcu': got {'oid': 19, 'next_clock': 2904312704, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 53288.735668326, '#receive_time': 53288.782287867}
mcu 'mcu': got {'oid': 27, 'next_clock': 2910072704, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53288.839127076004, '#receive_time': 53288.862274784}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53289.4: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=3089 bytes_read=6266 bytes_retransmit=0 bytes_invalid=0 send_seq=215 receive_seq=212 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71981533  orange_pi: temp=48.0 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.28 cputime=1230.214 memavail=1715764 print_time=100.593 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473464765456
webhooks: registering remote method 'reboot_machine' for connection id: 281473464765456
webhooks: registering remote method 'pause_job_queue' for connection id: 281473464765456
webhooks: registering remote method 'start_job_queue' for connection id: 281473464765456
Stats 53290.4: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=7048 bytes_read=6994 bytes_retransmit=0 bytes_invalid=0 send_seq=307 receive_seq=306 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71991631  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.28 cputime=1230.309 memavail=1716544 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53291.4: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=8768 bytes_read=7785 bytes_retransmit=0 bytes_invalid=0 send_seq=371 receive_seq=371 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71995568  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.28 cputime=1230.402 memavail=1716588 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53292.4: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=10398 bytes_read=8437 bytes_retransmit=0 bytes_invalid=0 send_seq=424 receive_seq=423 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996239  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.28 cputime=1230.468 memavail=1716864 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53293.4: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=12005 bytes_read=9173 bytes_retransmit=0 bytes_invalid=0 send_seq=482 receive_seq=482 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996665  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.25 cputime=1230.538 memavail=1716108 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53294.4: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000296 mcu_task_stddev=0.000340 bytes_write=13693 bytes_read=9937 bytes_retransmit=0 bytes_invalid=0 send_seq=543 receive_seq=543 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998418  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.25 cputime=1230.608 memavail=1716884 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Stats 53295.4: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000296 mcu_task_stddev=0.000340 bytes_write=15418 bytes_read=10774 bytes_retransmit=0 bytes_invalid=0 send_seq=609 receive_seq=608 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998046  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.25 cputime=1230.682 memavail=1716632 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53296.4: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000296 mcu_task_stddev=0.000340 bytes_write=17122 bytes_read=11583 bytes_retransmit=0 bytes_invalid=0 send_seq=672 receive_seq=672 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997889  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.25 cputime=1230.758 memavail=1716888 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 53297.4: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000296 mcu_task_stddev=0.000340 bytes_write=18774 bytes_read=12372 bytes_retransmit=0 bytes_invalid=0 send_seq=735 receive_seq=735 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997816  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.25 cputime=1230.832 memavail=1716888 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53298.4: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000296 mcu_task_stddev=0.000340 bytes_write=20478 bytes_read=13183 bytes_retransmit=0 bytes_invalid=0 send_seq=798 receive_seq=798 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997793  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.23 cputime=1230.906 memavail=1717664 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53299.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000297 mcu_task_stddev=0.000298 bytes_write=22187 bytes_read=13980 bytes_retransmit=0 bytes_invalid=0 send_seq=861 receive_seq=861 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997799  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.23 cputime=1230.978 memavail=1717664 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53300.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000297 mcu_task_stddev=0.000298 bytes_write=23946 bytes_read=14806 bytes_retransmit=0 bytes_invalid=0 send_seq=931 receive_seq=930 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997819  orange_pi: temp=46.5 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1231.051 memavail=1718440 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53301.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000297 mcu_task_stddev=0.000298 bytes_write=25585 bytes_read=15565 bytes_retransmit=0 bytes_invalid=0 send_seq=992 receive_seq=992 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997877  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.23 cputime=1231.122 memavail=1718216 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Stats 53302.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000297 mcu_task_stddev=0.000298 bytes_write=27338 bytes_read=16431 bytes_retransmit=0 bytes_invalid=0 send_seq=1061 receive_seq=1061 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997893  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1231.196 memavail=1718236 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53303.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000297 mcu_task_stddev=0.000298 bytes_write=29137 bytes_read=17391 bytes_retransmit=0 bytes_invalid=0 send_seq=1136 receive_seq=1136 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997904  orange_pi: temp=46.1 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1231.276 memavail=1718236 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53304.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000281 mcu_task_stddev=0.000294 bytes_write=30754 bytes_read=18071 bytes_retransmit=0 bytes_invalid=0 send_seq=1190 receive_seq=1190 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71997912  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1231.346 memavail=1717736 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53305.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000281 mcu_task_stddev=0.000294 bytes_write=32456 bytes_read=18893 bytes_retransmit=0 bytes_invalid=0 send_seq=1255 receive_seq=1255 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997934  orange_pi: temp=46.6 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.21 cputime=1231.420 memavail=1717736 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53306.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000281 mcu_task_stddev=0.000294 bytes_write=34132 bytes_read=19595 bytes_retransmit=0 bytes_invalid=0 send_seq=1312 receive_seq=1312 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997966  orange_pi: temp=46.6 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1231.510 memavail=1717736 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53307.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000281 mcu_task_stddev=0.000294 bytes_write=35871 bytes_read=20433 bytes_retransmit=0 bytes_invalid=0 send_seq=1379 receive_seq=1379 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997989  orange_pi: temp=46.3 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.21 cputime=1231.587 memavail=1717532 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53308.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000281 mcu_task_stddev=0.000294 bytes_write=37562 bytes_read=21147 bytes_retransmit=0 bytes_invalid=0 send_seq=1440 receive_seq=1439 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998004  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.20 cputime=1231.657 memavail=1718056 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53309.4: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000277 mcu_task_stddev=0.000297 bytes_write=39191 bytes_read=21923 bytes_retransmit=0 bytes_invalid=0 send_seq=1500 receive_seq=1500 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998029  orange_pi: temp=46.0 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.20 cputime=1231.728 memavail=1718328 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53310.4: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000277 mcu_task_stddev=0.000297 bytes_write=40881 bytes_read=22682 bytes_retransmit=0 bytes_invalid=0 send_seq=1561 receive_seq=1561 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998039  orange_pi: temp=46.2 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.20 cputime=1231.800 memavail=1719104 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 53311.5: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000277 mcu_task_stddev=0.000297 bytes_write=42641 bytes_read=23577 bytes_retransmit=0 bytes_invalid=0 send_seq=1632 receive_seq=1632 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998043  orange_pi: temp=46.2 chamber_heater: target=0 temp=27.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.20 cputime=1231.881 memavail=1718856 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53312.5: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000277 mcu_task_stddev=0.000297 bytes_write=44359 bytes_read=24399 bytes_retransmit=0 bytes_invalid=0 send_seq=1697 receive_seq=1697 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998051  orange_pi: temp=46.0 chamber_heater: target=0 temp=27.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.20 cputime=1231.957 memavail=1718856 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53313.5: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000277 mcu_task_stddev=0.000297 bytes_write=46078 bytes_read=25255 bytes_retransmit=0 bytes_invalid=0 send_seq=1765 receive_seq=1764 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998058  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1232.036 memavail=1719708 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 53314.5: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000305 mcu_task_stddev=0.000293 bytes_write=47850 bytes_read=26271 bytes_retransmit=0 bytes_invalid=0 send_seq=1842 receive_seq=1842 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998065  orange_pi: temp=46.8 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.18 cputime=1232.117 memavail=1719960 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53315.5: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000305 mcu_task_stddev=0.000293 bytes_write=49584 bytes_read=27085 bytes_retransmit=0 bytes_invalid=0 send_seq=1907 receive_seq=1907 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998071  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1232.190 memavail=1719960 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53316.5: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000305 mcu_task_stddev=0.000293 bytes_write=51307 bytes_read=27891 bytes_retransmit=0 bytes_invalid=0 send_seq=1972 receive_seq=1972 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998079  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1232.268 memavail=1719708 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53317.5: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000305 mcu_task_stddev=0.000293 bytes_write=53028 bytes_read=28676 bytes_retransmit=0 bytes_invalid=0 send_seq=2037 receive_seq=2036 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998089  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.18 cputime=1232.339 memavail=1719456 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53318.5: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000305 mcu_task_stddev=0.000293 bytes_write=54694 bytes_read=29498 bytes_retransmit=0 bytes_invalid=0 send_seq=2101 receive_seq=2101 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998095  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1232.413 memavail=1719460 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53319.5: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000280 mcu_task_stddev=0.000297 bytes_write=56331 bytes_read=30157 bytes_retransmit=0 bytes_invalid=0 send_seq=2154 receive_seq=2154 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998100  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1232.482 memavail=1719116 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53320.5: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000280 mcu_task_stddev=0.000297 bytes_write=58027 bytes_read=30943 bytes_retransmit=0 bytes_invalid=0 send_seq=2216 receive_seq=2216 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998198  orange_pi: temp=46.2 chamber_heater: target=0 temp=27.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1232.557 memavail=1718984 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 53321.5: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000280 mcu_task_stddev=0.000297 bytes_write=59754 bytes_read=31773 bytes_retransmit=0 bytes_invalid=0 send_seq=2282 receive_seq=2281 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998193  orange_pi: temp=46.3 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1232.633 memavail=1718984 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 53322.5: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000280 mcu_task_stddev=0.000297 bytes_write=61513 bytes_read=32751 bytes_retransmit=0 bytes_invalid=0 send_seq=2358 receive_seq=2358 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998189  orange_pi: temp=46.5 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1232.712 memavail=1718732 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53323.5: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000280 mcu_task_stddev=0.000297 bytes_write=63301 bytes_read=33703 bytes_retransmit=0 bytes_invalid=0 send_seq=2433 receive_seq=2433 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998186  orange_pi: temp=47.2 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1232.792 memavail=1718272 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 53324.5: gcodein=0  mcu: mcu_awake=0.161 mcu_task_avg=0.000335 mcu_task_stddev=0.000290 bytes_write=65283 bytes_read=35058 bytes_retransmit=0 bytes_invalid=0 send_seq=2534 receive_seq=2534 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998191  orange_pi: temp=46.6 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.23 cputime=1232.889 memavail=1718528 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53325.5: gcodein=0  mcu: mcu_awake=0.161 mcu_task_avg=0.000335 mcu_task_stddev=0.000290 bytes_write=66950 bytes_read=35768 bytes_retransmit=0 bytes_invalid=0 send_seq=2592 receive_seq=2591 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998191  orange_pi: temp=47.0 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.23 cputime=1232.959 memavail=1719280 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53326.5: gcodein=0  mcu: mcu_awake=0.161 mcu_task_avg=0.000335 mcu_task_stddev=0.000290 bytes_write=68679 bytes_read=36728 bytes_retransmit=0 bytes_invalid=0 send_seq=2666 receive_seq=2666 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998191  orange_pi: temp=46.8 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1233.040 memavail=1719812 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 53327.5: gcodein=0  mcu: mcu_awake=0.161 mcu_task_avg=0.000335 mcu_task_stddev=0.000290 bytes_write=70427 bytes_read=37610 bytes_retransmit=0 bytes_invalid=0 send_seq=2735 receive_seq=2735 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998189  orange_pi: temp=46.8 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.23 cputime=1233.118 memavail=1719560 print_time=100.593 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53328.5: gcodein=0  mcu: mcu_awake=0.161 mcu_task_avg=0.000335 mcu_task_stddev=0.000290 bytes_write=72117 bytes_read=38333 bytes_retransmit=0 bytes_invalid=0 send_seq=2793 receive_seq=2793 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998191  orange_pi: temp=46.2 chamber_heater: target=0 temp=27.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.38 cputime=1233.196 memavail=1719312 print_time=139.684 buffer_time=0.307 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473464765456: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:22:34 2024 (1735550554.4 53329.9)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  2 1 top (255,0,0)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473465787648: New connection
webhooks client 281473465787648: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 1803265408, 'value': 31148, '#name': 'analog_in_state', '#sent_time': 53333.09235118, '#receive_time': 53333.14335293}
mcu 'mcu': got {'oid': 19, 'next_clock': 1806145408, 'value': 31251, '#name': 'analog_in_state', '#sent_time': 53333.144324472, '#receive_time': 53333.183356639}
mcu 'mcu': got {'oid': 27, 'next_clock': 1811905408, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53333.248071889, '#receive_time': 53333.26334368}
mcu 'mcu': got {'oid': 15, 'next_clock': 1824865408, 'value': 31146, '#name': 'analog_in_state', '#sent_time': 53333.40458093, '#receive_time': 53333.443399722004}
mcu 'mcu': got {'oid': 19, 'next_clock': 1827745408, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 53333.457396389, '#receive_time': 53333.483341264}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53334.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3089 bytes_read=6266 bytes_retransmit=9 bytes_invalid=0 send_seq=214 receive_seq=211 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71995996  orange_pi: temp=48.5 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.34 cputime=1236.268 memavail=1719956 print_time=145.159 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473465787648
webhooks: registering remote method 'reboot_machine' for connection id: 281473465787648
webhooks: registering remote method 'pause_job_queue' for connection id: 281473465787648
webhooks: registering remote method 'start_job_queue' for connection id: 281473465787648
Stats 53335.0: gcodein=0  mcu: mcu_awake=0.057 mcu_task_avg=0.000115 mcu_task_stddev=0.000266 bytes_write=5678 bytes_read=6725 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=265 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997158  orange_pi: temp=47.8 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.34 cputime=1236.338 memavail=1719496 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53336.0: gcodein=0  mcu: mcu_awake=0.057 mcu_task_avg=0.000115 mcu_task_stddev=0.000266 bytes_write=5851 bytes_read=6956 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=274 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997873  orange_pi: temp=47.0 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.34 cputime=1236.401 memavail=1719272 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53337.0: gcodein=0  mcu: mcu_awake=0.057 mcu_task_avg=0.000115 mcu_task_stddev=0.000266 bytes_write=5989 bytes_read=7178 bytes_retransmit=9 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997945  orange_pi: temp=46.5 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.34 cputime=1236.444 memavail=1720032 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53338.0: gcodein=0  mcu: mcu_awake=0.057 mcu_task_avg=0.000115 mcu_task_stddev=0.000266 bytes_write=6127 bytes_read=7367 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=284 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998099  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.32 cputime=1236.483 memavail=1719992 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53339.0: gcodein=0  mcu: mcu_awake=0.057 mcu_task_avg=0.000115 mcu_task_stddev=0.000266 bytes_write=6213 bytes_read=7575 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998138  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.32 cputime=1236.526 memavail=1719352 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53340.0: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000085 mcu_task_stddev=0.000174 bytes_write=6365 bytes_read=7833 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998153  orange_pi: temp=46.5 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.32 cputime=1236.571 memavail=1720360 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53341.0: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000085 mcu_task_stddev=0.000174 bytes_write=6531 bytes_read=8087 bytes_retransmit=9 bytes_invalid=0 send_seq=306 receive_seq=306 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998164  orange_pi: temp=46.5 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.32 cputime=1236.615 memavail=1720632 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53342.0: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000085 mcu_task_stddev=0.000174 bytes_write=6669 bytes_read=8274 bytes_retransmit=9 bytes_invalid=0 send_seq=311 receive_seq=311 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998176  orange_pi: temp=46.2 chamber_heater: target=0 temp=27.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.32 cputime=1236.658 memavail=1720904 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53343.0: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000085 mcu_task_stddev=0.000174 bytes_write=6814 bytes_read=8504 bytes_retransmit=9 bytes_invalid=0 send_seq=317 receive_seq=317 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998260  orange_pi: temp=46.3 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.29 cputime=1236.702 memavail=1719652 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53344.0: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000085 mcu_task_stddev=0.000174 bytes_write=6966 bytes_read=8732 bytes_retransmit=9 bytes_invalid=0 send_seq=324 receive_seq=324 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998243  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.29 cputime=1236.745 memavail=1719192 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53345.0: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000078 mcu_task_stddev=0.000168 bytes_write=7104 bytes_read=8934 bytes_retransmit=9 bytes_invalid=0 send_seq=329 receive_seq=329 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998244  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.29 cputime=1236.789 memavail=1719716 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53346.0: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000078 mcu_task_stddev=0.000168 bytes_write=7256 bytes_read=9177 bytes_retransmit=9 bytes_invalid=0 send_seq=336 receive_seq=336 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998250  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.29 cputime=1236.834 memavail=1720240 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53347.0: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000078 mcu_task_stddev=0.000168 bytes_write=7408 bytes_read=9405 bytes_retransmit=9 bytes_invalid=0 send_seq=343 receive_seq=343 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998245  orange_pi: temp=46.0 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.29 cputime=1236.878 memavail=1720512 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53348.0: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000078 mcu_task_stddev=0.000168 bytes_write=7546 bytes_read=9592 bytes_retransmit=9 bytes_invalid=0 send_seq=348 receive_seq=348 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998243  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1236.919 memavail=1720272 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53349.0: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000078 mcu_task_stddev=0.000168 bytes_write=7698 bytes_read=9835 bytes_retransmit=9 bytes_invalid=0 send_seq=355 receive_seq=355 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998249  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1236.963 memavail=1720800 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53350.0: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000175 bytes_write=7850 bytes_read=10078 bytes_retransmit=9 bytes_invalid=0 send_seq=362 receive_seq=362 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998245  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.27 cputime=1237.007 memavail=1721348 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53351.0: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000175 bytes_write=8002 bytes_read=10291 bytes_retransmit=9 bytes_invalid=0 send_seq=369 receive_seq=369 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998250  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1237.050 memavail=1721100 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53352.0: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000175 bytes_write=8140 bytes_read=10508 bytes_retransmit=9 bytes_invalid=0 send_seq=374 receive_seq=374 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998244  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1237.112 memavail=1720848 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53353.0: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000175 bytes_write=8278 bytes_read=10710 bytes_retransmit=9 bytes_invalid=0 send_seq=379 receive_seq=379 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.25 cputime=1237.154 memavail=1720916 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53354.0: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000175 bytes_write=8416 bytes_read=10897 bytes_retransmit=9 bytes_invalid=0 send_seq=384 receive_seq=384 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998235  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.25 cputime=1237.197 memavail=1720684 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53355.0: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000159 bytes_write=8561 bytes_read=11142 bytes_retransmit=9 bytes_invalid=0 send_seq=390 receive_seq=390 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998226  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.25 cputime=1237.241 memavail=1721208 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53356.0: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000159 bytes_write=8694 bytes_read=11339 bytes_retransmit=9 bytes_invalid=0 send_seq=394 receive_seq=394 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998226  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.25 cputime=1237.283 memavail=1721004 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53357.0: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000159 bytes_write=8839 bytes_read=11539 bytes_retransmit=9 bytes_invalid=0 send_seq=400 receive_seq=400 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998229  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.25 cputime=1237.327 memavail=1720500 print_time=145.159 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53358.0: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000159 bytes_write=8977 bytes_read=11756 bytes_retransmit=9 bytes_invalid=0 send_seq=405 receive_seq=405 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.23 cputime=1237.373 memavail=1719400 print_time=169.441 buffer_time=0.511 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
webhooks client 281473465787648: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:23:04 2024 (1735550584.1 53359.7)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  2 1 top (0,255,0)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462569472: New connection
webhooks client 281473462569472: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 27, 'next_clock': 3943105408, 'value': 31248, '#name': 'analog_in_state', '#sent_time': 53362.825603653, '#receive_time': 53362.864046028}
mcu 'mcu': got {'oid': 15, 'next_clock': 3956065408, 'value': 31157, '#name': 'analog_in_state', '#sent_time': 53363.033954403, '#receive_time': 53363.044035653}
mcu 'mcu': got {'oid': 19, 'next_clock': 3958945408, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53363.033954403, '#receive_time': 53363.084078403}
mcu 'mcu': got {'oid': 27, 'next_clock': 3964705408, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53363.137520111, '#receive_time': 53363.164045361}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53363.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3089 bytes_read=6251 bytes_retransmit=0 bytes_invalid=0 send_seq=222 receive_seq=219 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1847 upcoming_bytes=334 freq=71994539  orange_pi: temp=47.7 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.29 cputime=1240.435 memavail=1721236 print_time=174.891 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462569472
webhooks: registering remote method 'reboot_machine' for connection id: 281473462569472
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462569472
webhooks: registering remote method 'start_job_queue' for connection id: 281473462569472
Stats 53364.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=5631 bytes_read=6638 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997266  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.29 cputime=1240.502 memavail=1721552 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53365.7: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000119 mcu_task_stddev=0.000266 bytes_write=5823 bytes_read=6891 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998290  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.29 cputime=1240.566 memavail=1721808 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53366.7: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000119 mcu_task_stddev=0.000266 bytes_write=5961 bytes_read=7095 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=285 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998110  orange_pi: temp=46.4 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.29 cputime=1240.610 memavail=1722080 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53367.7: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000119 mcu_task_stddev=0.000266 bytes_write=6052 bytes_read=7287 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998116  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.29 cputime=1240.653 memavail=1722128 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53368.7: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000119 mcu_task_stddev=0.000266 bytes_write=6171 bytes_read=7459 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998138  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1240.695 memavail=1722924 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53369.7: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000119 mcu_task_stddev=0.000266 bytes_write=6323 bytes_read=7690 bytes_retransmit=0 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998133  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.27 cputime=1240.738 memavail=1722672 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53370.7: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=6461 bytes_read=7898 bytes_retransmit=0 bytes_invalid=0 send_seq=306 receive_seq=306 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998158  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.27 cputime=1240.781 memavail=1722420 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53371.7: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=6599 bytes_read=8085 bytes_retransmit=0 bytes_invalid=0 send_seq=311 receive_seq=311 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998190  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1240.824 memavail=1722936 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53372.7: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=6737 bytes_read=8302 bytes_retransmit=0 bytes_invalid=0 send_seq=316 receive_seq=316 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998185  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1240.867 memavail=1722712 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53373.7: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=6875 bytes_read=8504 bytes_retransmit=0 bytes_invalid=0 send_seq=321 receive_seq=321 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998201  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.24 cputime=1240.910 memavail=1722248 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53374.7: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=7013 bytes_read=8691 bytes_retransmit=0 bytes_invalid=0 send_seq=326 receive_seq=326 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998203  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.24 cputime=1240.953 memavail=1721996 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53375.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000155 bytes_write=7151 bytes_read=8923 bytes_retransmit=0 bytes_invalid=0 send_seq=331 receive_seq=331 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998203  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.24 cputime=1240.995 memavail=1722000 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53376.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000155 bytes_write=7289 bytes_read=9125 bytes_retransmit=0 bytes_invalid=0 send_seq=336 receive_seq=336 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.24 cputime=1241.039 memavail=1721496 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53377.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000155 bytes_write=7427 bytes_read=9312 bytes_retransmit=0 bytes_invalid=0 send_seq=341 receive_seq=341 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998214  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.24 cputime=1241.082 memavail=1721244 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53378.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000155 bytes_write=7565 bytes_read=9529 bytes_retransmit=0 bytes_invalid=0 send_seq=346 receive_seq=346 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998220  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.22 cputime=1241.125 memavail=1720992 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53379.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000155 bytes_write=7703 bytes_read=9731 bytes_retransmit=0 bytes_invalid=0 send_seq=351 receive_seq=351 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998224  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.22 cputime=1241.168 memavail=1720740 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53380.7: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000068 mcu_task_stddev=0.000160 bytes_write=7855 bytes_read=9974 bytes_retransmit=0 bytes_invalid=0 send_seq=358 receive_seq=358 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998229  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.22 cputime=1241.212 memavail=1720488 print_time=174.891 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53381.7: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000068 mcu_task_stddev=0.000160 bytes_write=8021 bytes_read=10181 bytes_retransmit=0 bytes_invalid=0 send_seq=364 receive_seq=364 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998223  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.22 cputime=1241.276 memavail=1720488 print_time=192.909 buffer_time=0.250 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
webhooks client 281473462569472: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:23:27 2024 (1735550607.6 53383.1)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  2 1 top (0,0,255)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462404000: New connection
webhooks client 281473462404000: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 1345898112, 'value': 31180, '#name': 'analog_in_state', '#sent_time': 53386.411681372, '#receive_time': 53386.444604289}
mcu 'mcu': got {'oid': 19, 'next_clock': 1348778112, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53386.463560456, '#receive_time': 53386.484601747}
mcu 'mcu': got {'oid': 27, 'next_clock': 1354538112, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 53386.515374997, '#receive_time': 53386.564604372}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53387.2: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3081 bytes_read=6231 bytes_retransmit=9 bytes_invalid=0 send_seq=211 receive_seq=208 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1847 upcoming_bytes=334 freq=71995157  orange_pi: temp=47.6 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.21 cputime=1244.322 memavail=1721124 print_time=198.371 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462404000
webhooks: registering remote method 'reboot_machine' for connection id: 281473462404000
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462404000
webhooks: registering remote method 'start_job_queue' for connection id: 281473462404000
Stats 53388.2: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=5615 bytes_read=6513 bytes_retransmit=9 bytes_invalid=0 send_seq=259 receive_seq=259 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997292  orange_pi: temp=47.4 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.19 cputime=1244.386 memavail=1721680 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 53389.2: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=5808 bytes_read=6781 bytes_retransmit=9 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997867  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.19 cputime=1244.450 memavail=1721980 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53390.2: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000121 mcu_task_stddev=0.000268 bytes_write=5946 bytes_read=7000 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997981  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.19 cputime=1244.492 memavail=1721476 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53391.2: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000121 mcu_task_stddev=0.000268 bytes_write=6084 bytes_read=7187 bytes_retransmit=9 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998006  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.19 cputime=1244.535 memavail=1722252 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53392.2: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000121 mcu_task_stddev=0.000268 bytes_write=6189 bytes_read=7417 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998038  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.19 cputime=1244.579 memavail=1722272 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53393.2: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000121 mcu_task_stddev=0.000268 bytes_write=6308 bytes_read=7614 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998076  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1244.623 memavail=1722572 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53394.2: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000121 mcu_task_stddev=0.000268 bytes_write=6446 bytes_read=7801 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998123  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1244.666 memavail=1722848 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53395.2: gcodein=0  mcu: mcu_awake=0.061 mcu_task_avg=0.000121 mcu_task_stddev=0.000268 bytes_write=6584 bytes_read=8018 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998122  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1244.709 memavail=1722848 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53396.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=6729 bytes_read=8248 bytes_retransmit=9 bytes_invalid=0 send_seq=305 receive_seq=305 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998137  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1244.752 memavail=1722596 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53397.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=6867 bytes_read=8435 bytes_retransmit=9 bytes_invalid=0 send_seq=310 receive_seq=310 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998170  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.17 cputime=1244.795 memavail=1722504 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53398.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=7005 bytes_read=8652 bytes_retransmit=9 bytes_invalid=0 send_seq=315 receive_seq=315 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998175  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.16 cputime=1244.837 memavail=1721868 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53399.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=7143 bytes_read=8854 bytes_retransmit=9 bytes_invalid=0 send_seq=320 receive_seq=320 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=1244.880 memavail=1722140 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53400.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000162 bytes_write=7281 bytes_read=9041 bytes_retransmit=9 bytes_invalid=0 send_seq=325 receive_seq=325 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998200  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.16 cputime=1244.923 memavail=1721384 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53401.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000066 mcu_task_stddev=0.000157 bytes_write=7419 bytes_read=9273 bytes_retransmit=9 bytes_invalid=0 send_seq=330 receive_seq=330 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998205  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=1244.966 memavail=1721660 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53402.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000066 mcu_task_stddev=0.000157 bytes_write=7557 bytes_read=9475 bytes_retransmit=9 bytes_invalid=0 send_seq=335 receive_seq=335 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998202  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=1245.007 memavail=1720652 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53403.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000066 mcu_task_stddev=0.000157 bytes_write=7695 bytes_read=9662 bytes_retransmit=9 bytes_invalid=0 send_seq=340 receive_seq=340 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998201  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=1245.051 memavail=1718544 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53404.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000066 mcu_task_stddev=0.000157 bytes_write=7833 bytes_read=9879 bytes_retransmit=9 bytes_invalid=0 send_seq=345 receive_seq=345 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998212  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=1245.094 memavail=1718928 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53405.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000066 mcu_task_stddev=0.000157 bytes_write=7971 bytes_read=10081 bytes_retransmit=9 bytes_invalid=0 send_seq=350 receive_seq=350 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998210  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=1245.155 memavail=1718928 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53406.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000157 bytes_write=8109 bytes_read=10283 bytes_retransmit=9 bytes_invalid=0 send_seq=355 receive_seq=355 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998203  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=1245.197 memavail=1719452 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53407.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000157 bytes_write=8247 bytes_read=10500 bytes_retransmit=9 bytes_invalid=0 send_seq=360 receive_seq=360 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998197  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.15 cputime=1245.241 memavail=1719976 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53408.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000157 bytes_write=8385 bytes_read=10702 bytes_retransmit=9 bytes_invalid=0 send_seq=365 receive_seq=365 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998194  orange_pi: temp=46.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.13 cputime=1245.283 memavail=1719980 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53409.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000157 bytes_write=8539 bytes_read=10923 bytes_retransmit=9 bytes_invalid=0 send_seq=372 receive_seq=372 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998192  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=1245.327 memavail=1719544 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53410.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000064 mcu_task_stddev=0.000157 bytes_write=8691 bytes_read=11166 bytes_retransmit=9 bytes_invalid=0 send_seq=379 receive_seq=379 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998198  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.13 cputime=1245.371 memavail=1720336 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53411.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000163 bytes_write=8829 bytes_read=11383 bytes_retransmit=9 bytes_invalid=0 send_seq=384 receive_seq=384 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998206  orange_pi: temp=46.3 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.13 cputime=1245.416 memavail=1720084 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53412.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000163 bytes_write=8967 bytes_read=11570 bytes_retransmit=9 bytes_invalid=0 send_seq=389 receive_seq=389 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998215  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.13 cputime=1245.458 memavail=1720084 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53413.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000163 bytes_write=9105 bytes_read=11787 bytes_retransmit=9 bytes_invalid=0 send_seq=394 receive_seq=394 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998218  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=1245.501 memavail=1719832 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53414.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000163 bytes_write=9257 bytes_read=12015 bytes_retransmit=9 bytes_invalid=0 send_seq=401 receive_seq=401 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998223  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=1245.545 memavail=1719580 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53415.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000163 bytes_write=9409 bytes_read=12228 bytes_retransmit=9 bytes_invalid=0 send_seq=408 receive_seq=408 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998230  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=1245.589 memavail=1719876 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53416.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000072 mcu_task_stddev=0.000161 bytes_write=9594 bytes_read=12501 bytes_retransmit=9 bytes_invalid=0 send_seq=418 receive_seq=418 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998228  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=1245.634 memavail=1720400 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53417.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000072 mcu_task_stddev=0.000161 bytes_write=9746 bytes_read=12729 bytes_retransmit=9 bytes_invalid=0 send_seq=425 receive_seq=425 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=1245.679 memavail=1720424 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53418.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000072 mcu_task_stddev=0.000161 bytes_write=9904 bytes_read=12958 bytes_retransmit=9 bytes_invalid=0 send_seq=433 receive_seq=433 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998243  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=1245.722 memavail=1721180 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53419.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000072 mcu_task_stddev=0.000161 bytes_write=10056 bytes_read=13201 bytes_retransmit=9 bytes_invalid=0 send_seq=440 receive_seq=440 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998243  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=1245.766 memavail=1721180 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53420.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000072 mcu_task_stddev=0.000161 bytes_write=10194 bytes_read=13403 bytes_retransmit=9 bytes_invalid=0 send_seq=445 receive_seq=445 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998244  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=1245.807 memavail=1721956 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53421.2: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000086 mcu_task_stddev=0.000174 bytes_write=10339 bytes_read=13618 bytes_retransmit=9 bytes_invalid=0 send_seq=451 receive_seq=451 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998247  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.11 cputime=1245.851 memavail=1722256 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53422.2: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000086 mcu_task_stddev=0.000174 bytes_write=10477 bytes_read=13835 bytes_retransmit=9 bytes_invalid=0 send_seq=456 receive_seq=456 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998248  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=1245.894 memavail=1722780 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53423.2: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000086 mcu_task_stddev=0.000174 bytes_write=10615 bytes_read=14037 bytes_retransmit=9 bytes_invalid=0 send_seq=461 receive_seq=461 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998250  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1245.937 memavail=1722844 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53424.2: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000086 mcu_task_stddev=0.000174 bytes_write=10767 bytes_read=14250 bytes_retransmit=9 bytes_invalid=0 send_seq=468 receive_seq=468 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998252  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1245.980 memavail=1722340 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53425.2: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000086 mcu_task_stddev=0.000174 bytes_write=10905 bytes_read=14467 bytes_retransmit=9 bytes_invalid=0 send_seq=473 receive_seq=473 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998255  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1246.024 memavail=1721840 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53426.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000160 bytes_write=11043 bytes_read=14684 bytes_retransmit=9 bytes_invalid=0 send_seq=478 receive_seq=478 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998256  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1246.067 memavail=1721588 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53427.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000160 bytes_write=11181 bytes_read=14864 bytes_retransmit=9 bytes_invalid=0 send_seq=483 receive_seq=483 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998258  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=1246.110 memavail=1721112 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53428.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000160 bytes_write=11333 bytes_read=15095 bytes_retransmit=9 bytes_invalid=0 send_seq=490 receive_seq=490 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998261  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=1246.153 memavail=1721628 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53429.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000160 bytes_write=11485 bytes_read=15312 bytes_retransmit=9 bytes_invalid=0 send_seq=497 receive_seq=497 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998262  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1246.197 memavail=1721400 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53430.2: gcodein=0  mcu: mcu_awake=0.009 mcu_task_avg=0.000070 mcu_task_stddev=0.000160 bytes_write=11637 bytes_read=15515 bytes_retransmit=9 bytes_invalid=0 send_seq=504 receive_seq=504 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998263  orange_pi: temp=46.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.10 cputime=1246.241 memavail=1721424 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53431.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000162 bytes_write=11789 bytes_read=15773 bytes_retransmit=9 bytes_invalid=0 send_seq=511 receive_seq=511 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998265  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1246.284 memavail=1720920 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53432.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000162 bytes_write=11927 bytes_read=15975 bytes_retransmit=9 bytes_invalid=0 send_seq=516 receive_seq=516 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998265  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=1246.327 memavail=1720924 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53433.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000162 bytes_write=12079 bytes_read=16203 bytes_retransmit=9 bytes_invalid=0 send_seq=523 receive_seq=523 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998264  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=1246.371 memavail=1718908 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53434.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000162 bytes_write=12231 bytes_read=16431 bytes_retransmit=9 bytes_invalid=0 send_seq=530 receive_seq=530 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998264  orange_pi: temp=46.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=1246.415 memavail=1718908 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53435.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000074 mcu_task_stddev=0.000162 bytes_write=12369 bytes_read=16633 bytes_retransmit=9 bytes_invalid=0 send_seq=535 receive_seq=535 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998264  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=1246.457 memavail=1718668 print_time=198.371 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53436.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000077 mcu_task_stddev=0.000167 bytes_write=12507 bytes_read=16850 bytes_retransmit=9 bytes_invalid=0 send_seq=540 receive_seq=540 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998265  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=1246.505 memavail=1718668 print_time=247.816 buffer_time=0.657 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473462404000: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:24:22 2024 (1735550662.5 53438.1)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 1 top (255,0,255)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473464291904: New connection
webhooks client 281473464291904: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 1003730816, 'value': 31211, '#name': 'analog_in_state', '#sent_time': 53441.323623357, '#receive_time': 53441.345923357}
mcu 'mcu': got {'oid': 19, 'next_clock': 1006610816, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53441.375638398, '#receive_time': 53441.385910898}
mcu 'mcu': got {'oid': 27, 'next_clock': 1012370816, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 53441.427542648, '#receive_time': 53441.465916232}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53442.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3094 bytes_read=6256 bytes_retransmit=9 bytes_invalid=0 send_seq=214 receive_seq=211 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71995050  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.08 cputime=1249.559 memavail=1719292 print_time=253.280 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473464291904
webhooks: registering remote method 'reboot_machine' for connection id: 281473464291904
webhooks: registering remote method 'pause_job_queue' for connection id: 281473464291904
webhooks: registering remote method 'start_job_queue' for connection id: 281473464291904
Stats 53443.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=5636 bytes_read=6538 bytes_retransmit=9 bytes_invalid=0 send_seq=262 receive_seq=262 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997439  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.07 cputime=1249.626 memavail=1719060 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 53444.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=5683 bytes_read=6714 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997853  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=1249.685 memavail=1719596 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53445.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=6151 bytes_read=7081 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997778  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.07 cputime=1249.736 memavail=1720120 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53446.1: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000124 mcu_task_stddev=0.000268 bytes_write=6157 bytes_read=7264 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998028  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.07 cputime=1249.778 memavail=1720400 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53447.1: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000124 mcu_task_stddev=0.000268 bytes_write=6317 bytes_read=7477 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998098  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.07 cputime=1249.819 memavail=1720924 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53448.1: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000124 mcu_task_stddev=0.000268 bytes_write=6617 bytes_read=7756 bytes_retransmit=9 bytes_invalid=0 send_seq=304 receive_seq=304 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998126  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.07 cputime=1249.865 memavail=1720696 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53449.1: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000124 mcu_task_stddev=0.000268 bytes_write=6623 bytes_read=7922 bytes_retransmit=9 bytes_invalid=0 send_seq=305 receive_seq=305 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998159  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=1249.906 memavail=1721452 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53450.1: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000124 mcu_task_stddev=0.000268 bytes_write=7063 bytes_read=8207 bytes_retransmit=9 bytes_invalid=0 send_seq=320 receive_seq=320 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.07 cputime=1249.955 memavail=1721976 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53451.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000090 mcu_task_stddev=0.000188 bytes_write=7069 bytes_read=8403 bytes_retransmit=9 bytes_invalid=0 send_seq=321 receive_seq=321 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998205  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=1249.996 memavail=1722252 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53452.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000090 mcu_task_stddev=0.000188 bytes_write=7145 bytes_read=8587 bytes_retransmit=9 bytes_invalid=0 send_seq=324 receive_seq=324 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998232  orange_pi: temp=46.1 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=1250.039 memavail=1722532 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53453.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000090 mcu_task_stddev=0.000188 bytes_write=7501 bytes_read=8828 bytes_retransmit=9 bytes_invalid=0 send_seq=335 receive_seq=335 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998227  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=1250.084 memavail=1722300 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53454.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000090 mcu_task_stddev=0.000188 bytes_write=7507 bytes_read=9009 bytes_retransmit=9 bytes_invalid=0 send_seq=336 receive_seq=336 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998222  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=1250.125 memavail=1722300 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53455.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000090 mcu_task_stddev=0.000188 bytes_write=8005 bytes_read=9379 bytes_retransmit=9 bytes_invalid=0 send_seq=357 receive_seq=357 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998223  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=1250.176 memavail=1721796 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53456.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000088 mcu_task_stddev=0.000180 bytes_write=8039 bytes_read=9555 bytes_retransmit=9 bytes_invalid=0 send_seq=360 receive_seq=360 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998228  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=1250.217 memavail=1721544 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53457.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000088 mcu_task_stddev=0.000180 bytes_write=8045 bytes_read=9736 bytes_retransmit=9 bytes_invalid=0 send_seq=361 receive_seq=361 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.06 cputime=1250.258 memavail=1721292 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53458.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000088 mcu_task_stddev=0.000180 bytes_write=8471 bytes_read=10010 bytes_retransmit=9 bytes_invalid=0 send_seq=374 receive_seq=374 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998220  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=1250.306 memavail=1720820 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53459.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000088 mcu_task_stddev=0.000180 bytes_write=8477 bytes_read=10161 bytes_retransmit=9 bytes_invalid=0 send_seq=375 receive_seq=375 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998221  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=1250.366 memavail=1720580 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53460.1: gcodein=0  mcu: mcu_awake=0.012 mcu_task_avg=0.000088 mcu_task_stddev=0.000180 bytes_write=8931 bytes_read=10502 bytes_retransmit=9 bytes_invalid=0 send_seq=392 receive_seq=392 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998228  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=1250.414 memavail=1721340 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53461.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=8937 bytes_read=10683 bytes_retransmit=9 bytes_invalid=0 send_seq=393 receive_seq=393 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=1250.457 memavail=1721340 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53462.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=8943 bytes_read=10834 bytes_retransmit=9 bytes_invalid=0 send_seq=394 receive_seq=394 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998236  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=1250.498 memavail=1721340 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53463.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=9411 bytes_read=11201 bytes_retransmit=9 bytes_invalid=0 send_seq=413 receive_seq=413 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998227  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.05 cputime=1250.547 memavail=1721116 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53464.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=9417 bytes_read=11367 bytes_retransmit=9 bytes_invalid=0 send_seq=414 receive_seq=414 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=1250.588 memavail=1721116 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53465.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=9857 bytes_read=11652 bytes_retransmit=9 bytes_invalid=0 send_seq=429 receive_seq=429 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998235  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=1250.635 memavail=1720864 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53466.1: gcodein=0  mcu: mcu_awake=0.013 mcu_task_avg=0.000093 mcu_task_stddev=0.000188 bytes_write=9863 bytes_read=11848 bytes_retransmit=9 bytes_invalid=0 send_seq=430 receive_seq=430 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998236  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=1250.677 memavail=1720888 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53467.1: gcodein=0  mcu: mcu_awake=0.013 mcu_task_avg=0.000093 mcu_task_stddev=0.000188 bytes_write=9869 bytes_read=12014 bytes_retransmit=9 bytes_invalid=0 send_seq=431 receive_seq=431 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=1250.718 memavail=1720900 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53468.1: gcodein=0  mcu: mcu_awake=0.013 mcu_task_avg=0.000093 mcu_task_stddev=0.000188 bytes_write=10295 bytes_read=12273 bytes_retransmit=9 bytes_invalid=0 send_seq=444 receive_seq=444 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998245  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=1250.765 memavail=1720928 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53469.1: gcodein=0  mcu: mcu_awake=0.013 mcu_task_avg=0.000093 mcu_task_stddev=0.000188 bytes_write=10301 bytes_read=12454 bytes_retransmit=9 bytes_invalid=0 send_seq=445 receive_seq=445 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998244  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=1250.807 memavail=1720696 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53470.1: gcodein=0  mcu: mcu_awake=0.013 mcu_task_avg=0.000093 mcu_task_stddev=0.000188 bytes_write=10755 bytes_read=12780 bytes_retransmit=9 bytes_invalid=0 send_seq=462 receive_seq=462 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998246  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=1250.856 memavail=1720212 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53471.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000079 mcu_task_stddev=0.000175 bytes_write=10761 bytes_read=12946 bytes_retransmit=9 bytes_invalid=0 send_seq=463 receive_seq=463 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998250  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.05 cputime=1250.897 memavail=1720464 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53472.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000079 mcu_task_stddev=0.000175 bytes_write=10767 bytes_read=13127 bytes_retransmit=9 bytes_invalid=0 send_seq=464 receive_seq=464 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998252  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=1250.937 memavail=1720232 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53473.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000079 mcu_task_stddev=0.000175 bytes_write=11213 bytes_read=13443 bytes_retransmit=9 bytes_invalid=0 send_seq=480 receive_seq=480 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998257  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.04 cputime=1250.986 memavail=1720024 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53474.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000079 mcu_task_stddev=0.000175 bytes_write=11219 bytes_read=13594 bytes_retransmit=9 bytes_invalid=0 send_seq=481 receive_seq=481 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998259  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.04 cputime=1251.027 memavail=1720048 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53475.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000079 mcu_task_stddev=0.000175 bytes_write=11659 bytes_read=13909 bytes_retransmit=9 bytes_invalid=0 send_seq=496 receive_seq=496 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998256  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.04 cputime=1251.076 memavail=1720068 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53476.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=11665 bytes_read=14090 bytes_retransmit=9 bytes_invalid=0 send_seq=497 receive_seq=497 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998256  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.04 cputime=1251.118 memavail=1719864 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53477.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=11671 bytes_read=14256 bytes_retransmit=9 bytes_invalid=0 send_seq=498 receive_seq=498 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998257  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.04 cputime=1251.160 memavail=1719876 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53478.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=12097 bytes_read=14530 bytes_retransmit=9 bytes_invalid=0 send_seq=511 receive_seq=511 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998258  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.04 cputime=1251.207 memavail=1720380 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53479.1: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=12103 bytes_read=14696 bytes_retransmit=9 bytes_invalid=0 send_seq=512 receive_seq=512 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998260  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.04 cputime=1251.248 memavail=1719896 print_time=253.280 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53480.2: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000084 mcu_task_stddev=0.000181 bytes_write=12571 bytes_read=15048 bytes_retransmit=9 bytes_invalid=0 send_seq=531 receive_seq=531 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998262  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.04 cputime=1251.302 memavail=1719896 print_time=291.936 buffer_time=0.875 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473464291904: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:25:06 2024 (1735550706.6 53482.2)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 1 top (1,0,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473465800768: New connection
webhooks client 281473465800768: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 27, 'next_clock': 4173170816, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53485.325594544, '#receive_time': 53485.366985586}
mcu 'mcu': got {'oid': 15, 'next_clock': 4186130816, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 53485.533917336004, '#receive_time': 53485.546978003}
mcu 'mcu': got {'oid': 19, 'next_clock': 4189010816, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 53485.585692628, '#receive_time': 53485.586973836}
mcu 'mcu': got {'oid': 27, 'next_clock': 4194770816, 'value': 31251, '#name': 'analog_in_state', '#sent_time': 53485.637569128005, '#receive_time': 53485.66698667}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53486.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=3094 bytes_read=6271 bytes_retransmit=0 bytes_invalid=0 send_seq=216 receive_seq=213 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1857 upcoming_bytes=324 freq=71995458  orange_pi: temp=48.4 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.12 cputime=1254.381 memavail=1719876 print_time=297.393 buffer_time=0.240 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473465800768
webhooks: registering remote method 'reboot_machine' for connection id: 281473465800768
webhooks: registering remote method 'pause_job_queue' for connection id: 281473465800768
webhooks: registering remote method 'start_job_queue' for connection id: 281473465800768
Stats 53487.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=7106 bytes_read=6930 bytes_retransmit=0 bytes_invalid=0 send_seq=306 receive_seq=306 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997543  orange_pi: temp=47.4 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.12 cputime=1254.470 memavail=1719060 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 53488.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=8938 bytes_read=7751 bytes_retransmit=0 bytes_invalid=0 send_seq=373 receive_seq=373 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997941  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=1254.566 memavail=1718964 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53489.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=10561 bytes_read=8432 bytes_retransmit=0 bytes_invalid=0 send_seq=429 receive_seq=428 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998010  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=1254.636 memavail=1718724 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53490.2: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000027 mcu_task_stddev=0.000030 bytes_write=12261 bytes_read=9159 bytes_retransmit=0 bytes_invalid=0 send_seq=488 receive_seq=488 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997903  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.11 cputime=1254.707 memavail=1718472 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53491.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000280 mcu_task_stddev=0.000323 bytes_write=14031 bytes_read=9924 bytes_retransmit=0 bytes_invalid=0 send_seq=548 receive_seq=548 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997944  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=1254.779 memavail=1718220 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53492.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000280 mcu_task_stddev=0.000323 bytes_write=15654 bytes_read=10595 bytes_retransmit=0 bytes_invalid=0 send_seq=603 receive_seq=602 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71999116  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=1254.848 memavail=1717968 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53493.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000280 mcu_task_stddev=0.000323 bytes_write=17452 bytes_read=11448 bytes_retransmit=0 bytes_invalid=0 send_seq=673 receive_seq=673 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998703  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.10 cputime=1254.923 memavail=1717496 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53494.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000280 mcu_task_stddev=0.000323 bytes_write=19049 bytes_read=12103 bytes_retransmit=0 bytes_invalid=0 send_seq=724 receive_seq=724 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998493  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.10 cputime=1254.992 memavail=1718304 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53495.2: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000280 mcu_task_stddev=0.000323 bytes_write=20868 bytes_read=12948 bytes_retransmit=0 bytes_invalid=0 send_seq=792 receive_seq=792 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998380  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=1255.069 memavail=1718556 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53496.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000262 mcu_task_stddev=0.000274 bytes_write=22611 bytes_read=13706 bytes_retransmit=0 bytes_invalid=0 send_seq=852 receive_seq=852 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998291  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=1255.143 memavail=1718328 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53497.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000262 mcu_task_stddev=0.000274 bytes_write=24170 bytes_read=14367 bytes_retransmit=0 bytes_invalid=0 send_seq=904 receive_seq=904 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998244  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1255.211 memavail=1718856 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53498.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000262 mcu_task_stddev=0.000274 bytes_write=25982 bytes_read=15199 bytes_retransmit=0 bytes_invalid=0 send_seq=971 receive_seq=971 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998205  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=1255.285 memavail=1718604 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53499.3: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000262 mcu_task_stddev=0.000274 bytes_write=27570 bytes_read=15839 bytes_retransmit=0 bytes_invalid=0 send_seq=1022 receive_seq=1022 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998184  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=1255.352 memavail=1718352 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53500.3: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000262 mcu_task_stddev=0.000274 bytes_write=29230 bytes_read=16458 bytes_retransmit=0 bytes_invalid=0 send_seq=1073 receive_seq=1072 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998178  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=1255.419 memavail=1718124 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53501.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000241 mcu_task_stddev=0.000273 bytes_write=30956 bytes_read=17190 bytes_retransmit=0 bytes_invalid=0 send_seq=1130 receive_seq=1130 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998471  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=1255.491 memavail=1718648 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53502.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000241 mcu_task_stddev=0.000273 bytes_write=32665 bytes_read=18017 bytes_retransmit=0 bytes_invalid=0 send_seq=1196 receive_seq=1196 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998404  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=1255.565 memavail=1718920 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53503.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000241 mcu_task_stddev=0.000273 bytes_write=34437 bytes_read=18849 bytes_retransmit=0 bytes_invalid=0 send_seq=1263 receive_seq=1263 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998376  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.08 cputime=1255.664 memavail=1718940 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53504.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000241 mcu_task_stddev=0.000273 bytes_write=36025 bytes_read=19531 bytes_retransmit=0 bytes_invalid=0 send_seq=1316 receive_seq=1316 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998342  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.08 cputime=1255.731 memavail=1718940 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53505.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000241 mcu_task_stddev=0.000273 bytes_write=37809 bytes_read=20311 bytes_retransmit=0 bytes_invalid=0 send_seq=1379 receive_seq=1379 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998326  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=1255.807 memavail=1718940 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53506.3: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000264 mcu_task_stddev=0.000268 bytes_write=39642 bytes_read=21199 bytes_retransmit=0 bytes_invalid=0 send_seq=1449 receive_seq=1449 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998296  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=1255.885 memavail=1718688 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53507.3: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000264 mcu_task_stddev=0.000268 bytes_write=41181 bytes_read=21860 bytes_retransmit=0 bytes_invalid=0 send_seq=1501 receive_seq=1501 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998486  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=1255.952 memavail=1718452 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53508.3: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000264 mcu_task_stddev=0.000268 bytes_write=42916 bytes_read=22549 bytes_retransmit=0 bytes_invalid=0 send_seq=1557 receive_seq=1557 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998436  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=1256.023 memavail=1718452 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53509.3: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000264 mcu_task_stddev=0.000268 bytes_write=44541 bytes_read=23241 bytes_retransmit=0 bytes_invalid=0 send_seq=1612 receive_seq=1612 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998394  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=1256.093 memavail=1718200 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53510.3: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000264 mcu_task_stddev=0.000268 bytes_write=46428 bytes_read=24174 bytes_retransmit=0 bytes_invalid=0 send_seq=1689 receive_seq=1688 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998357  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=1256.173 memavail=1718708 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53511.3: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000257 mcu_task_stddev=0.000269 bytes_write=48177 bytes_read=25031 bytes_retransmit=0 bytes_invalid=0 send_seq=1755 receive_seq=1755 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998329  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=1256.248 memavail=1718232 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53512.3: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000257 mcu_task_stddev=0.000269 bytes_write=49821 bytes_read=25775 bytes_retransmit=0 bytes_invalid=0 send_seq=1814 receive_seq=1814 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998307  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.08 cputime=1256.319 memavail=1718016 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53513.3: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000257 mcu_task_stddev=0.000269 bytes_write=51647 bytes_read=26633 bytes_retransmit=0 bytes_invalid=0 send_seq=1883 receive_seq=1883 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998288  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=1256.398 memavail=1718584 print_time=297.393 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53514.3: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000257 mcu_task_stddev=0.000269 bytes_write=53284 bytes_read=27387 bytes_retransmit=0 bytes_invalid=0 send_seq=1944 receive_seq=1944 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998273  orange_pi: temp=46.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=1256.474 memavail=1718604 print_time=325.531 buffer_time=0.362 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473465800768: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:25:40 2024 (1735550740.2 53515.8)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 5 top (1,0,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473444467648: New connection
webhooks client 281473444467648: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': Timeout on connect
mcu 'mcu': Wait for identify_response
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/serialhdl.py", line 68, in _get_identify_data
    params = self.send_with_response(msg, 'identify_response')
  File "/home/klipper/klipper/klippy/serialhdl.py", line 262, in send_with_response
    return src.get_response([cmd], self.default_cmd_queue)
  File "/home/klipper/klipper/klippy/serialhdl.py", line 319, in get_response
    self.serial.raw_send_wait_ack(cmds[-1], minclock, reqclock,
  File "/home/klipper/klipper/klippy/serialhdl.py", line 254, in raw_send_wait_ack
    self._error("Serial connection closed")
  File "/home/klipper/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'mcu': Serial connection closed
mcu 'mcu': got {'oid': 15, 'next_clock': 2670363520, 'value': 31199, '#name': 'analog_in_state', '#sent_time': 53524.139864938, '#receive_time': 53524.147896813}
mcu 'mcu': got {'oid': 19, 'next_clock': 2673243520, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 53524.139864938, '#receive_time': 53524.18792048}
mcu 'mcu': got {'oid': 27, 'next_clock': 2679003520, 'value': 31242, '#name': 'analog_in_state', '#sent_time': 53524.243352021, '#receive_time': 53524.267903521}
mcu 'mcu': got {'oid': 15, 'next_clock': 2691963520, 'value': 31195, '#name': 'analog_in_state', '#sent_time': 53524.399233771, '#receive_time': 53524.447907688}
mcu 'mcu': got {'oid': 19, 'next_clock': 2694843520, 'value': 31247, '#name': 'analog_in_state', '#sent_time': 53524.45099523, '#receive_time': 53524.487912188}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53525.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3089 bytes_read=6266 bytes_retransmit=9 bytes_invalid=0 send_seq=212 receive_seq=209 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1940 upcoming_bytes=241 freq=71994681  orange_pi: temp=47.0 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.13 cputime=1259.591 memavail=1717028 print_time=336.150 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473444467648
webhooks: registering remote method 'reboot_machine' for connection id: 281473444467648
webhooks: registering remote method 'pause_job_queue' for connection id: 281473444467648
webhooks: registering remote method 'start_job_queue' for connection id: 281473444467648
Stats 53526.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7188 bytes_read=7159 bytes_retransmit=9 bytes_invalid=0 send_seq=311 receive_seq=310 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=5 upcoming_bytes=0 freq=71996388  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.13 cputime=1259.692 memavail=1717496 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53527.0: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000137 mcu_task_stddev=0.000269 bytes_write=8982 bytes_read=7925 bytes_retransmit=9 bytes_invalid=0 send_seq=374 receive_seq=373 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=9 upcoming_bytes=0 freq=71997200  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.13 cputime=1259.783 memavail=1718268 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 53528.0: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000137 mcu_task_stddev=0.000269 bytes_write=10600 bytes_read=8694 bytes_retransmit=9 bytes_invalid=0 send_seq=434 receive_seq=434 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997510  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.12 cputime=1259.855 memavail=1717888 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53529.0: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000137 mcu_task_stddev=0.000269 bytes_write=12361 bytes_read=9448 bytes_retransmit=9 bytes_invalid=0 send_seq=495 receive_seq=495 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997677  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=1259.927 memavail=1718160 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53530.0: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000137 mcu_task_stddev=0.000269 bytes_write=14131 bytes_read=10166 bytes_retransmit=9 bytes_invalid=0 send_seq=555 receive_seq=555 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997795  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=1259.998 memavail=1717932 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53531.0: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000137 mcu_task_stddev=0.000269 bytes_write=15831 bytes_read=11016 bytes_retransmit=9 bytes_invalid=0 send_seq=622 receive_seq=621 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71999505  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.12 cputime=1260.074 memavail=1718208 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53532.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=17599 bytes_read=11862 bytes_retransmit=9 bytes_invalid=0 send_seq=689 receive_seq=689 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998991  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=1260.148 memavail=1718732 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53533.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=19208 bytes_read=12526 bytes_retransmit=9 bytes_invalid=0 send_seq=743 receive_seq=743 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998692  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=1260.219 memavail=1718248 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53534.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=20992 bytes_read=13321 bytes_retransmit=9 bytes_invalid=0 send_seq=806 receive_seq=806 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998482  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=1260.293 memavail=1718264 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53535.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=22707 bytes_read=14005 bytes_retransmit=9 bytes_invalid=0 send_seq=862 receive_seq=861 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998415  orange_pi: temp=46.5 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=1260.365 memavail=1718268 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53536.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000251 mcu_task_stddev=0.000268 bytes_write=24336 bytes_read=14786 bytes_retransmit=9 bytes_invalid=0 send_seq=924 receive_seq=924 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998331  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=1260.442 memavail=1718528 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53537.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=26162 bytes_read=15655 bytes_retransmit=9 bytes_invalid=0 send_seq=992 receive_seq=992 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998799  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.11 cputime=1260.518 memavail=1719284 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53538.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=27820 bytes_read=16391 bytes_retransmit=9 bytes_invalid=0 send_seq=1052 receive_seq=1051 retransmit_seq=2 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998638  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1260.590 memavail=1719548 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53539.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=29576 bytes_read=17208 bytes_retransmit=9 bytes_invalid=0 send_seq=1118 receive_seq=1118 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998523  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1260.664 memavail=1719576 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53540.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=31441 bytes_read=18141 bytes_retransmit=9 bytes_invalid=0 send_seq=1191 receive_seq=1191 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998447  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.18 cputime=1260.744 memavail=1719836 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53541.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=33085 bytes_read=18885 bytes_retransmit=9 bytes_invalid=0 send_seq=1250 receive_seq=1250 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998380  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.18 cputime=1260.815 memavail=1719596 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53542.0: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000266 mcu_task_stddev=0.000267 bytes_write=34850 bytes_read=19706 bytes_retransmit=9 bytes_invalid=0 send_seq=1316 receive_seq=1316 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998329  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.18 cputime=1260.889 memavail=1720372 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53543.0: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000266 mcu_task_stddev=0.000267 bytes_write=36431 bytes_read=20390 bytes_retransmit=9 bytes_invalid=0 send_seq=1368 receive_seq=1368 retransmit_seq=2 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998301  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1260.981 memavail=1720648 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53544.0: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000266 mcu_task_stddev=0.000267 bytes_write=38201 bytes_read=21144 bytes_retransmit=9 bytes_invalid=0 send_seq=1429 receive_seq=1429 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998514  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1261.053 memavail=1720156 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53545.0: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000266 mcu_task_stddev=0.000267 bytes_write=39959 bytes_read=21935 bytes_retransmit=9 bytes_invalid=0 send_seq=1494 receive_seq=1494 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998463  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1261.129 memavail=1719652 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53546.0: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000266 mcu_task_stddev=0.000267 bytes_write=41575 bytes_read=22682 bytes_retransmit=9 bytes_invalid=0 send_seq=1551 receive_seq=1551 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998416  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1261.200 memavail=1719144 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53547.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000255 mcu_task_stddev=0.000270 bytes_write=43373 bytes_read=23481 bytes_retransmit=9 bytes_invalid=0 send_seq=1616 receive_seq=1615 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998372  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1261.277 memavail=1718896 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53548.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000255 mcu_task_stddev=0.000270 bytes_write=44975 bytes_read=24122 bytes_retransmit=9 bytes_invalid=0 send_seq=1669 receive_seq=1668 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998350  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=1261.345 memavail=1720428 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53549.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000255 mcu_task_stddev=0.000270 bytes_write=46745 bytes_read=25004 bytes_retransmit=9 bytes_invalid=0 send_seq=1738 receive_seq=1738 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998332  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=1261.420 memavail=1719208 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53550.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000255 mcu_task_stddev=0.000270 bytes_write=48515 bytes_read=25753 bytes_retransmit=9 bytes_invalid=0 send_seq=1799 receive_seq=1799 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998305  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=1261.493 memavail=1718964 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53551.0: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000255 mcu_task_stddev=0.000270 bytes_write=50110 bytes_read=26391 bytes_retransmit=9 bytes_invalid=0 send_seq=1851 receive_seq=1851 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998285  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.15 cputime=1261.562 memavail=1718968 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53552.0: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=51901 bytes_read=27328 bytes_retransmit=9 bytes_invalid=0 send_seq=1923 receive_seq=1923 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998269  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=1261.640 memavail=1718208 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53553.0: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=53559 bytes_read=28098 bytes_retransmit=9 bytes_invalid=0 send_seq=1984 receive_seq=1984 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998255  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.14 cputime=1261.714 memavail=1716972 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53554.0: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=55511 bytes_read=29175 bytes_retransmit=9 bytes_invalid=0 send_seq=2071 receive_seq=2071 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998244  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.14 cputime=1261.798 memavail=1716628 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53555.0: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=57365 bytes_read=30087 bytes_retransmit=9 bytes_invalid=0 send_seq=2144 receive_seq=2143 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998242  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.14 cputime=1261.876 memavail=1716768 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53556.0: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000253 mcu_task_stddev=0.000268 bytes_write=58961 bytes_read=30876 bytes_retransmit=9 bytes_invalid=0 send_seq=2204 receive_seq=2204 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998230  orange_pi: temp=46.9 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.14 cputime=1261.948 memavail=1717532 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53557.0: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000273 mcu_task_stddev=0.000265 bytes_write=60780 bytes_read=31723 bytes_retransmit=9 bytes_invalid=0 send_seq=2272 receive_seq=2272 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998225  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.14 cputime=1262.026 memavail=1717300 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53558.0: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000273 mcu_task_stddev=0.000265 bytes_write=62417 bytes_read=32469 bytes_retransmit=9 bytes_invalid=0 send_seq=2330 receive_seq=2330 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998219  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.13 cputime=1262.097 memavail=1717572 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53559.0: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000273 mcu_task_stddev=0.000265 bytes_write=64112 bytes_read=33200 bytes_retransmit=9 bytes_invalid=0 send_seq=2388 receive_seq=2388 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998215  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.13 cputime=1262.168 memavail=1717576 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53560.0: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000273 mcu_task_stddev=0.000265 bytes_write=65910 bytes_read=33991 bytes_retransmit=9 bytes_invalid=0 send_seq=2453 receive_seq=2453 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998211  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.13 cputime=1262.243 memavail=1717856 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53561.0: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000273 mcu_task_stddev=0.000265 bytes_write=67568 bytes_read=34776 bytes_retransmit=9 bytes_invalid=0 send_seq=2514 receive_seq=2514 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.13 cputime=1262.317 memavail=1717868 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53562.0: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000251 mcu_task_stddev=0.000267 bytes_write=69256 bytes_read=35469 bytes_retransmit=9 bytes_invalid=0 send_seq=2569 receive_seq=2569 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998212  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.13 cputime=1262.388 memavail=1718632 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53563.0: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000251 mcu_task_stddev=0.000267 bytes_write=70849 bytes_read=36141 bytes_retransmit=9 bytes_invalid=0 send_seq=2623 receive_seq=2623 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998210  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.8 pwm=0.000 sysload=1.12 cputime=1262.457 memavail=1717636 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53564.0: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000251 mcu_task_stddev=0.000267 bytes_write=72682 bytes_read=37027 bytes_retransmit=9 bytes_invalid=0 send_seq=2693 receive_seq=2693 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998283  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=1262.534 memavail=1717392 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53565.0: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000251 mcu_task_stddev=0.000267 bytes_write=74514 bytes_read=37895 bytes_retransmit=9 bytes_invalid=0 send_seq=2764 receive_seq=2764 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998355  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=1262.611 memavail=1717412 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53566.0: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000251 mcu_task_stddev=0.000267 bytes_write=76114 bytes_read=38580 bytes_retransmit=9 bytes_invalid=0 send_seq=2819 receive_seq=2819 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998344  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=1262.681 memavail=1717972 print_time=336.150 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Neopixel update did not succeed
Stats 53567.0: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000259 mcu_task_stddev=0.000270 bytes_write=78047 bytes_read=39613 bytes_retransmit=9 bytes_invalid=0 send_seq=2900 receive_seq=2899 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998328  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=1262.769 memavail=1718760 print_time=378.346 buffer_time=0.414 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
webhooks client 281473444467648: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:26:33 2024 (1735550793.1 53568.6)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 20 top (1,0,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462758960: New connection
webhooks client 281473462758960: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 19, 'next_clock': 1805476224, 'value': 31248, '#name': 'analog_in_state', '#sent_time': 53571.756630919, '#receive_time': 53571.789101086004}
mcu 'mcu': got {'oid': 27, 'next_clock': 1811236224, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 53571.861026752, '#receive_time': 53571.869054169}
mcu 'mcu': got {'oid': 15, 'next_clock': 1824196224, 'value': 31222, '#name': 'analog_in_state', '#sent_time': 53572.016282086, '#receive_time': 53572.049049336}
mcu 'mcu': got {'oid': 19, 'next_clock': 1827076224, 'value': 31247, '#name': 'analog_in_state', '#sent_time': 53572.067972419, '#receive_time': 53572.089104461}
mcu 'mcu': got {'oid': 27, 'next_clock': 1832836224, 'value': 31249, '#name': 'analog_in_state', '#sent_time': 53572.120043419, '#receive_time': 53572.169058711}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53572.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3094 bytes_read=6288 bytes_retransmit=9 bytes_invalid=0 send_seq=215 receive_seq=212 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71996524  orange_pi: temp=47.9 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.11 cputime=1265.827 memavail=1718900 print_time=383.813 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462758960
webhooks: registering remote method 'reboot_machine' for connection id: 281473462758960
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462758960
webhooks: registering remote method 'start_job_queue' for connection id: 281473462758960
Stats 53573.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7131 bytes_read=7038 bytes_retransmit=9 bytes_invalid=0 send_seq=307 receive_seq=306 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71996720  orange_pi: temp=47.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=1265.923 memavail=1718728 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53574.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=8945 bytes_read=7841 bytes_retransmit=9 bytes_invalid=0 send_seq=373 receive_seq=372 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997431  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1266.016 memavail=1718504 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53575.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=10458 bytes_read=8471 bytes_retransmit=9 bytes_invalid=0 send_seq=421 receive_seq=421 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997714  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1266.082 memavail=1718508 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53576.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000182 mcu_task_stddev=0.000287 bytes_write=12270 bytes_read=9320 bytes_retransmit=9 bytes_invalid=0 send_seq=488 receive_seq=488 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998452  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=1266.157 memavail=1719280 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53577.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000182 mcu_task_stddev=0.000287 bytes_write=14019 bytes_read=10035 bytes_retransmit=9 bytes_invalid=0 send_seq=546 receive_seq=546 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998213  orange_pi: temp=46.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1266.229 memavail=1718804 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53578.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000182 mcu_task_stddev=0.000287 bytes_write=15569 bytes_read=10683 bytes_retransmit=9 bytes_invalid=0 send_seq=597 receive_seq=597 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998155  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1266.297 memavail=1718552 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53579.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000182 mcu_task_stddev=0.000287 bytes_write=17288 bytes_read=11395 bytes_retransmit=9 bytes_invalid=0 send_seq=653 receive_seq=653 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998117  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.17 cputime=1266.369 memavail=1719076 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53580.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000182 mcu_task_stddev=0.000287 bytes_write=18925 bytes_read=12111 bytes_retransmit=9 bytes_invalid=0 send_seq=711 receive_seq=711 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998102  orange_pi: temp=46.9 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1266.437 memavail=1719076 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53581.7: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000270 bytes_write=20737 bytes_read=12960 bytes_retransmit=9 bytes_invalid=0 send_seq=778 receive_seq=778 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998898  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1266.511 memavail=1719600 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53582.7: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000270 bytes_write=22502 bytes_read=13815 bytes_retransmit=9 bytes_invalid=0 send_seq=845 receive_seq=845 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998680  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1266.586 memavail=1720608 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53583.7: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000270 bytes_write=24118 bytes_read=14471 bytes_retransmit=9 bytes_invalid=0 send_seq=899 receive_seq=899 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998530  orange_pi: temp=47.0 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=1266.655 memavail=1720060 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53584.7: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000270 bytes_write=25918 bytes_read=15264 bytes_retransmit=9 bytes_invalid=0 send_seq=963 receive_seq=963 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998440  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.16 cputime=1266.733 memavail=1720200 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53585.7: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000270 bytes_write=27452 bytes_read=15893 bytes_retransmit=9 bytes_invalid=0 send_seq=1012 receive_seq=1012 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998370  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.16 cputime=1266.802 memavail=1719948 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53586.7: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000245 mcu_task_stddev=0.000267 bytes_write=29185 bytes_read=16597 bytes_retransmit=9 bytes_invalid=0 send_seq=1069 receive_seq=1069 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998347  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=1266.872 memavail=1719696 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53587.7: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000245 mcu_task_stddev=0.000267 bytes_write=30915 bytes_read=17268 bytes_retransmit=9 bytes_invalid=0 send_seq=1124 receive_seq=1123 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998311  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.16 cputime=1266.943 memavail=1720220 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53588.7: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000245 mcu_task_stddev=0.000267 bytes_write=32519 bytes_read=17957 bytes_retransmit=9 bytes_invalid=0 send_seq=1177 receive_seq=1176 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998276  orange_pi: temp=46.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.31 cputime=1267.013 memavail=1719980 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53589.7: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000245 mcu_task_stddev=0.000267 bytes_write=34247 bytes_read=18743 bytes_retransmit=9 bytes_invalid=0 send_seq=1240 receive_seq=1240 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998257  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.31 cputime=1267.105 memavail=1720428 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53590.7: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000245 mcu_task_stddev=0.000267 bytes_write=35851 bytes_read=19417 bytes_retransmit=9 bytes_invalid=0 send_seq=1293 receive_seq=1293 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998266  orange_pi: temp=46.8 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.31 cputime=1267.174 memavail=1721584 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53591.7: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000246 mcu_task_stddev=0.000269 bytes_write=37677 bytes_read=20307 bytes_retransmit=9 bytes_invalid=0 send_seq=1362 receive_seq=1362 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998247  orange_pi: temp=46.6 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.31 cputime=1267.252 memavail=1721608 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53592.7: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000246 mcu_task_stddev=0.000269 bytes_write=39451 bytes_read=21132 bytes_retransmit=9 bytes_invalid=0 send_seq=1429 receive_seq=1429 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.31 cputime=1267.327 memavail=1721860 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53593.7: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000246 mcu_task_stddev=0.000269 bytes_write=41067 bytes_read=21782 bytes_retransmit=9 bytes_invalid=0 send_seq=1482 receive_seq=1482 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998235  orange_pi: temp=46.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.28 cputime=1267.398 memavail=1721916 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53594.7: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000246 mcu_task_stddev=0.000269 bytes_write=42965 bytes_read=22772 bytes_retransmit=9 bytes_invalid=0 send_seq=1560 receive_seq=1560 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998223  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.28 cputime=1267.482 memavail=1722188 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53595.7: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000246 mcu_task_stddev=0.000269 bytes_write=44520 bytes_read=23431 bytes_retransmit=9 bytes_invalid=0 send_seq=1613 receive_seq=1613 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998218  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.28 cputime=1267.551 memavail=1723224 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53596.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000273 mcu_task_stddev=0.000267 bytes_write=46437 bytes_read=24475 bytes_retransmit=9 bytes_invalid=0 send_seq=1695 receive_seq=1695 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998220  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.28 cputime=1267.639 memavail=1723224 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53597.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000273 mcu_task_stddev=0.000267 bytes_write=48277 bytes_read=25374 bytes_retransmit=9 bytes_invalid=0 send_seq=1766 receive_seq=1766 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998214  orange_pi: temp=46.7 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.28 cputime=1267.715 memavail=1723232 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53598.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000273 mcu_task_stddev=0.000267 bytes_write=49811 bytes_read=25973 bytes_retransmit=9 bytes_invalid=0 send_seq=1815 receive_seq=1815 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998210  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.26 cputime=1267.783 memavail=1723768 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53599.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000273 mcu_task_stddev=0.000267 bytes_write=51719 bytes_read=27021 bytes_retransmit=9 bytes_invalid=0 send_seq=1898 receive_seq=1898 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.26 cputime=1267.865 memavail=1723516 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53600.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000273 mcu_task_stddev=0.000267 bytes_write=53363 bytes_read=27780 bytes_retransmit=9 bytes_invalid=0 send_seq=1957 receive_seq=1957 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998352  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.26 cputime=1267.940 memavail=1723268 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53601.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000265 mcu_task_stddev=0.000270 bytes_write=55102 bytes_read=28465 bytes_retransmit=9 bytes_invalid=0 send_seq=2015 receive_seq=2015 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998333  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.26 cputime=1268.010 memavail=1722924 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53602.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000265 mcu_task_stddev=0.000270 bytes_write=56899 bytes_read=29344 bytes_retransmit=9 bytes_invalid=0 send_seq=2085 receive_seq=2085 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998323  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.26 cputime=1268.086 memavail=1722540 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53603.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000265 mcu_task_stddev=0.000270 bytes_write=58537 bytes_read=30101 bytes_retransmit=9 bytes_invalid=0 send_seq=2143 receive_seq=2143 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998302  orange_pi: temp=47.0 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.24 cputime=1268.162 memavail=1723824 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53604.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000265 mcu_task_stddev=0.000270 bytes_write=60398 bytes_read=31009 bytes_retransmit=9 bytes_invalid=0 send_seq=2217 receive_seq=2217 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998289  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.24 cputime=1268.240 memavail=1723828 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53605.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000265 mcu_task_stddev=0.000270 bytes_write=61955 bytes_read=31668 bytes_retransmit=9 bytes_invalid=0 send_seq=2269 receive_seq=2269 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998281  orange_pi: temp=46.5 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.24 cputime=1268.310 memavail=1724320 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53606.7: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000263 mcu_task_stddev=0.000271 bytes_write=63702 bytes_read=32436 bytes_retransmit=9 bytes_invalid=0 send_seq=2329 receive_seq=2329 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998272  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.24 cputime=1268.383 memavail=1723576 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53607.7: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000263 mcu_task_stddev=0.000271 bytes_write=65675 bytes_read=33542 bytes_retransmit=9 bytes_invalid=0 send_seq=2419 receive_seq=2419 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998263  orange_pi: temp=46.1 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.24 cputime=1268.472 memavail=1724092 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53608.7: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000263 mcu_task_stddev=0.000271 bytes_write=67259 bytes_read=34205 bytes_retransmit=9 bytes_invalid=0 send_seq=2472 receive_seq=2472 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998258  orange_pi: temp=46.6 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.30 cputime=1268.542 memavail=1724628 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53609.7: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000263 mcu_task_stddev=0.000271 bytes_write=69058 bytes_read=35102 bytes_retransmit=9 bytes_invalid=0 send_seq=2542 receive_seq=2542 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998252  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.30 cputime=1268.618 memavail=1724124 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53610.7: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000263 mcu_task_stddev=0.000271 bytes_write=70723 bytes_read=35870 bytes_retransmit=9 bytes_invalid=0 send_seq=2604 receive_seq=2604 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998247  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.30 cputime=1268.693 memavail=1724648 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53611.7: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000278 mcu_task_stddev=0.000266 bytes_write=72509 bytes_read=36675 bytes_retransmit=9 bytes_invalid=0 send_seq=2667 receive_seq=2667 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998245  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.30 cputime=1268.772 memavail=1724920 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53612.7: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000278 mcu_task_stddev=0.000266 bytes_write=74274 bytes_read=37488 bytes_retransmit=9 bytes_invalid=0 send_seq=2732 receive_seq=2732 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998240  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.30 cputime=1268.845 memavail=1725168 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53613.7: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000278 mcu_task_stddev=0.000266 bytes_write=75879 bytes_read=38157 bytes_retransmit=9 bytes_invalid=0 send_seq=2787 receive_seq=2787 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998237  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1268.911 memavail=1724968 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53614.7: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000278 mcu_task_stddev=0.000266 bytes_write=77609 bytes_read=38856 bytes_retransmit=9 bytes_invalid=0 send_seq=2842 receive_seq=2842 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998236  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1268.980 memavail=1724716 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53615.7: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000278 mcu_task_stddev=0.000266 bytes_write=79274 bytes_read=39527 bytes_retransmit=9 bytes_invalid=0 send_seq=2896 receive_seq=2896 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998235  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.27 cputime=1269.049 memavail=1724212 print_time=383.813 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53616.7: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000243 mcu_task_stddev=0.000272 bytes_write=80869 bytes_read=40182 bytes_retransmit=9 bytes_invalid=0 send_seq=2948 receive_seq=2948 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998238  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.27 cputime=1269.120 memavail=1724728 print_time=428.513 buffer_time=0.913 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473462758960: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:27:23 2024 (1735550843.2 53618.8)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 1 top (1,0,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473464763152: New connection
webhooks client 281473464763152: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 27, 'next_clock': 1123468928, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53621.963756026, '#receive_time': 53621.970259485}
mcu 'mcu': got {'oid': 15, 'next_clock': 1136428928, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 53622.119208901, '#receive_time': 53622.150259401}
mcu 'mcu': got {'oid': 19, 'next_clock': 1139308928, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 53622.170940818, '#receive_time': 53622.190262693}
mcu 'mcu': got {'oid': 27, 'next_clock': 1145068928, 'value': 31251, '#name': 'analog_in_state', '#sent_time': 53622.222733818, '#receive_time': 53622.270327235}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53622.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3094 bytes_read=6256 bytes_retransmit=9 bytes_invalid=0 send_seq=218 receive_seq=215 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1914 upcoming_bytes=267 freq=71994408  orange_pi: temp=49.0 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.25 cputime=1272.219 memavail=1723152 print_time=433.975 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473464763152
webhooks: registering remote method 'reboot_machine' for connection id: 281473464763152
webhooks: registering remote method 'pause_job_queue' for connection id: 281473464763152
webhooks: registering remote method 'start_job_queue' for connection id: 281473464763152
Stats 53623.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7152 bytes_read=7065 bytes_retransmit=9 bytes_invalid=0 send_seq=313 receive_seq=313 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71995984  orange_pi: temp=48.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.23 cputime=1272.311 memavail=1722704 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53624.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=8969 bytes_read=7854 bytes_retransmit=9 bytes_invalid=0 send_seq=379 receive_seq=378 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996898  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.23 cputime=1272.402 memavail=1722480 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53625.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=10669 bytes_read=8785 bytes_retransmit=9 bytes_invalid=0 send_seq=452 receive_seq=452 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997395  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1272.480 memavail=1722232 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53626.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000183 mcu_task_stddev=0.000283 bytes_write=12481 bytes_read=9619 bytes_retransmit=9 bytes_invalid=0 send_seq=519 receive_seq=519 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997715  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.23 cputime=1272.556 memavail=1721980 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53627.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000183 mcu_task_stddev=0.000283 bytes_write=14361 bytes_read=10546 bytes_retransmit=9 bytes_invalid=0 send_seq=594 receive_seq=594 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997770  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1272.635 memavail=1720984 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53628.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000183 mcu_task_stddev=0.000283 bytes_write=15986 bytes_read=11204 bytes_retransmit=9 bytes_invalid=0 send_seq=648 receive_seq=647 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997905  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.21 cputime=1272.705 memavail=1720480 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53629.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000183 mcu_task_stddev=0.000283 bytes_write=17709 bytes_read=11964 bytes_retransmit=9 bytes_invalid=0 send_seq=709 receive_seq=709 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997916  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1272.776 memavail=1721504 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53630.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000183 mcu_task_stddev=0.000283 bytes_write=19325 bytes_read=12671 bytes_retransmit=9 bytes_invalid=0 send_seq=764 receive_seq=764 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997943  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1272.846 memavail=1721516 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53631.8: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000270 bytes_write=21167 bytes_read=13567 bytes_retransmit=9 bytes_invalid=0 send_seq=835 receive_seq=834 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997989  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1272.928 memavail=1721520 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53632.8: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000270 bytes_write=22888 bytes_read=14340 bytes_retransmit=9 bytes_invalid=0 send_seq=897 receive_seq=897 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998721  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.21 cputime=1273.002 memavail=1719504 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53633.8: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000270 bytes_write=24462 bytes_read=14969 bytes_retransmit=9 bytes_invalid=0 send_seq=946 receive_seq=946 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998554  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.20 cputime=1273.067 memavail=1719504 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53634.8: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000270 bytes_write=26248 bytes_read=15757 bytes_retransmit=9 bytes_invalid=0 send_seq=1009 receive_seq=1009 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998450  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.20 cputime=1273.141 memavail=1719504 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53635.8: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000270 bytes_write=27900 bytes_read=16538 bytes_retransmit=9 bytes_invalid=0 send_seq=1072 receive_seq=1072 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998368  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.20 cputime=1273.215 memavail=1719012 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53636.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000256 mcu_task_stddev=0.000268 bytes_write=29669 bytes_read=17397 bytes_retransmit=9 bytes_invalid=0 send_seq=1138 receive_seq=1138 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998320  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.20 cputime=1273.291 memavail=1719272 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53637.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000256 mcu_task_stddev=0.000268 bytes_write=31392 bytes_read=18068 bytes_retransmit=9 bytes_invalid=0 send_seq=1192 receive_seq=1192 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998291  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.20 cputime=1273.362 memavail=1719432 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53638.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000256 mcu_task_stddev=0.000268 bytes_write=33015 bytes_read=18737 bytes_retransmit=9 bytes_invalid=0 send_seq=1247 receive_seq=1247 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998257  orange_pi: temp=46.4 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1273.430 memavail=1719832 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53639.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000256 mcu_task_stddev=0.000268 bytes_write=34778 bytes_read=19542 bytes_retransmit=9 bytes_invalid=0 send_seq=1312 receive_seq=1312 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998252  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1273.523 memavail=1720340 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53640.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000256 mcu_task_stddev=0.000268 bytes_write=36394 bytes_read=20276 bytes_retransmit=9 bytes_invalid=0 send_seq=1369 receive_seq=1369 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1273.592 memavail=1720616 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53641.8: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000245 mcu_task_stddev=0.000270 bytes_write=38115 bytes_read=20941 bytes_retransmit=9 bytes_invalid=0 send_seq=1423 receive_seq=1423 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998225  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.18 cputime=1273.661 memavail=1720376 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53642.8: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000245 mcu_task_stddev=0.000270 bytes_write=39858 bytes_read=21697 bytes_retransmit=9 bytes_invalid=0 send_seq=1483 receive_seq=1483 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998214  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1273.734 memavail=1720804 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53643.8: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000245 mcu_task_stddev=0.000270 bytes_write=41419 bytes_read=22366 bytes_retransmit=9 bytes_invalid=0 send_seq=1535 receive_seq=1535 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998206  orange_pi: temp=47.7 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1273.804 memavail=1721212 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53644.8: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000245 mcu_task_stddev=0.000270 bytes_write=43203 bytes_read=23131 bytes_retransmit=9 bytes_invalid=0 send_seq=1598 receive_seq=1598 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998214  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.17 cputime=1273.877 memavail=1721212 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53645.8: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000245 mcu_task_stddev=0.000270 bytes_write=44791 bytes_read=23786 bytes_retransmit=9 bytes_invalid=0 send_seq=1649 receive_seq=1649 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998206  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1273.946 memavail=1721212 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53646.8: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000245 mcu_task_stddev=0.000269 bytes_write=46535 bytes_read=24625 bytes_retransmit=9 bytes_invalid=0 send_seq=1714 receive_seq=1714 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1274.020 memavail=1720964 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53647.8: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000245 mcu_task_stddev=0.000269 bytes_write=48335 bytes_read=25424 bytes_retransmit=9 bytes_invalid=0 send_seq=1779 receive_seq=1779 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998202  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1274.095 memavail=1720724 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53648.8: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000245 mcu_task_stddev=0.000269 bytes_write=49965 bytes_read=26157 bytes_retransmit=9 bytes_invalid=0 send_seq=1836 receive_seq=1836 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998199  orange_pi: temp=46.2 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.23 cputime=1274.165 memavail=1720220 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53649.8: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000245 mcu_task_stddev=0.000269 bytes_write=51835 bytes_read=27088 bytes_retransmit=9 bytes_invalid=0 send_seq=1911 receive_seq=1910 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998199  orange_pi: temp=46.9 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1274.246 memavail=1719744 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53650.8: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000245 mcu_task_stddev=0.000269 bytes_write=53339 bytes_read=27682 bytes_retransmit=9 bytes_invalid=0 send_seq=1958 receive_seq=1958 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998197  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.23 cputime=1274.311 memavail=1719744 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53651.8: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000269 bytes_write=55081 bytes_read=28416 bytes_retransmit=9 bytes_invalid=0 send_seq=2015 receive_seq=2015 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998203  orange_pi: temp=46.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1274.384 memavail=1719744 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53652.8: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000269 bytes_write=56872 bytes_read=29209 bytes_retransmit=9 bytes_invalid=0 send_seq=2079 receive_seq=2079 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998331  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.23 cputime=1274.458 memavail=1720692 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53653.8: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000269 bytes_write=58419 bytes_read=29837 bytes_retransmit=9 bytes_invalid=0 send_seq=2130 receive_seq=2130 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998313  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1274.525 memavail=1720820 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53654.8: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000269 bytes_write=60229 bytes_read=30718 bytes_retransmit=9 bytes_invalid=0 send_seq=2199 receive_seq=2199 retransmit_seq=2 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998421  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.21 cputime=1274.599 memavail=1721324 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53655.8: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000269 bytes_write=61831 bytes_read=31384 bytes_retransmit=9 bytes_invalid=0 send_seq=2252 receive_seq=2252 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998400  orange_pi: temp=47.1 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.21 cputime=1274.668 memavail=1721600 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53656.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000262 mcu_task_stddev=0.000273 bytes_write=63650 bytes_read=32218 bytes_retransmit=9 bytes_invalid=0 send_seq=2320 receive_seq=2319 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998376  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.21 cputime=1274.744 memavail=1721356 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53657.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000262 mcu_task_stddev=0.000273 bytes_write=65359 bytes_read=33003 bytes_retransmit=9 bytes_invalid=0 send_seq=2380 receive_seq=2380 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998357  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.21 cputime=1274.816 memavail=1721356 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53658.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000262 mcu_task_stddev=0.000273 bytes_write=66989 bytes_read=33721 bytes_retransmit=9 bytes_invalid=0 send_seq=2437 receive_seq=2437 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998339  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.20 cputime=1274.886 memavail=1721104 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53659.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000262 mcu_task_stddev=0.000273 bytes_write=68717 bytes_read=34382 bytes_retransmit=9 bytes_invalid=0 send_seq=2492 receive_seq=2492 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998322  orange_pi: temp=46.7 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.20 cputime=1274.957 memavail=1721100 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 53660.8: gcodein=0  mcu: mcu_awake=0.107 mcu_task_avg=0.000262 mcu_task_stddev=0.000273 bytes_write=70223 bytes_read=35001 bytes_retransmit=9 bytes_invalid=0 send_seq=2539 receive_seq=2539 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998310  orange_pi: temp=47.0 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.20 cputime=1275.023 memavail=1721124 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 53661.8: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000273 bytes_write=72044 bytes_read=35829 bytes_retransmit=9 bytes_invalid=0 send_seq=2605 receive_seq=2605 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998296  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.20 cputime=1275.097 memavail=1721916 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53662.8: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000273 bytes_write=73814 bytes_read=36568 bytes_retransmit=9 bytes_invalid=0 send_seq=2666 receive_seq=2666 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998286  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.20 cputime=1275.169 memavail=1721952 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53663.8: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000273 bytes_write=75390 bytes_read=37192 bytes_retransmit=9 bytes_invalid=0 send_seq=2715 receive_seq=2714 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998278  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.18 cputime=1275.237 memavail=1722464 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53664.9: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000273 bytes_write=77146 bytes_read=38045 bytes_retransmit=9 bytes_invalid=0 send_seq=2782 receive_seq=2782 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998272  orange_pi: temp=46.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1275.312 memavail=1723000 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53665.9: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000273 bytes_write=78811 bytes_read=38708 bytes_retransmit=9 bytes_invalid=0 send_seq=2836 receive_seq=2836 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998266  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.18 cputime=1275.384 memavail=1722764 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53666.9: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000274 bytes_write=80455 bytes_read=39346 bytes_retransmit=9 bytes_invalid=0 send_seq=2887 receive_seq=2887 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998264  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.18 cputime=1275.454 memavail=1722516 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53667.9: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000274 bytes_write=82227 bytes_read=40167 bytes_retransmit=9 bytes_invalid=0 send_seq=2954 receive_seq=2954 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998260  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.18 cputime=1275.528 memavail=1722424 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53668.9: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000274 bytes_write=83834 bytes_read=40870 bytes_retransmit=9 bytes_invalid=0 send_seq=3010 receive_seq=3010 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998254  orange_pi: temp=46.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.17 cputime=1275.598 memavail=1722544 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53669.9: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000274 bytes_write=85592 bytes_read=41606 bytes_retransmit=9 bytes_invalid=0 send_seq=3069 receive_seq=3069 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998252  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1275.670 memavail=1722556 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53670.9: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000251 mcu_task_stddev=0.000274 bytes_write=87355 bytes_read=42334 bytes_retransmit=9 bytes_invalid=0 send_seq=3129 receive_seq=3128 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998247  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1275.742 memavail=1722316 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53671.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000258 mcu_task_stddev=0.000271 bytes_write=88957 bytes_read=43142 bytes_retransmit=9 bytes_invalid=0 send_seq=3190 receive_seq=3190 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998244  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=1275.814 memavail=1721308 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53672.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000258 mcu_task_stddev=0.000271 bytes_write=90701 bytes_read=43852 bytes_retransmit=9 bytes_invalid=0 send_seq=3247 receive_seq=3247 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998242  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=1275.888 memavail=1721860 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53673.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000258 mcu_task_stddev=0.000271 bytes_write=92317 bytes_read=44544 bytes_retransmit=9 bytes_invalid=0 send_seq=3302 receive_seq=3302 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998241  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=1275.959 memavail=1722396 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53674.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000258 mcu_task_stddev=0.000271 bytes_write=94180 bytes_read=45524 bytes_retransmit=9 bytes_invalid=0 send_seq=3381 receive_seq=3381 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998237  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=1276.041 memavail=1721908 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53675.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000258 mcu_task_stddev=0.000271 bytes_write=96071 bytes_read=46528 bytes_retransmit=9 bytes_invalid=0 send_seq=3460 receive_seq=3460 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998236  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=1276.124 memavail=1721656 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53676.9: gcodein=0  mcu: mcu_awake=0.109 mcu_task_avg=0.000260 mcu_task_stddev=0.000266 bytes_write=97659 bytes_read=47185 bytes_retransmit=9 bytes_invalid=0 send_seq=3511 receive_seq=3511 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998234  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=1276.192 memavail=1721668 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53677.9: gcodein=0  mcu: mcu_awake=0.109 mcu_task_avg=0.000260 mcu_task_stddev=0.000266 bytes_write=99569 bytes_read=48199 bytes_retransmit=9 bytes_invalid=0 send_seq=3592 receive_seq=3592 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998232  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=1276.274 memavail=1721440 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53678.9: gcodein=0  mcu: mcu_awake=0.109 mcu_task_avg=0.000260 mcu_task_stddev=0.000266 bytes_write=101124 bytes_read=48894 bytes_retransmit=9 bytes_invalid=0 send_seq=3646 receive_seq=3646 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998231  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.14 cputime=1276.341 memavail=1721696 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 53679.9: gcodein=0  mcu: mcu_awake=0.109 mcu_task_avg=0.000260 mcu_task_stddev=0.000266 bytes_write=102945 bytes_read=49747 bytes_retransmit=9 bytes_invalid=0 send_seq=3714 receive_seq=3714 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998229  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.8 pwm=0.000 sysload=1.14 cputime=1276.419 memavail=1721236 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53680.9: gcodein=0  mcu: mcu_awake=0.109 mcu_task_avg=0.000260 mcu_task_stddev=0.000266 bytes_write=104722 bytes_read=50514 bytes_retransmit=9 bytes_invalid=0 send_seq=3776 receive_seq=3776 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998281  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.14 cputime=1276.494 memavail=1721128 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53681.9: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000270 mcu_task_stddev=0.000270 bytes_write=106272 bytes_read=51179 bytes_retransmit=9 bytes_invalid=0 send_seq=3827 receive_seq=3827 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998276  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.14 cputime=1276.561 memavail=1722012 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53682.9: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000270 mcu_task_stddev=0.000270 bytes_write=108007 bytes_read=51910 bytes_retransmit=9 bytes_invalid=0 send_seq=3885 receive_seq=3885 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998270  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.14 cputime=1276.633 memavail=1721268 print_time=433.975 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53734.9: gcodein=0  mcu: mcu_awake=0.101 mcu_task_avg=0.000250 mcu_task_stddev=0.000270 bytes_write=197310 bytes_read=91840 bytes_retransmit=9 bytes_invalid=0 send_seq=7076 receive_seq=7076 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998272  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.05 cputime=1280.424 memavail=1721876 print_time=545.753 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473464763152: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:29:20 2024 (1735550960.5 53736.0)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 1 top (.8,.2,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462762848: New connection
webhooks client 281473462762848: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 984894336, 'value': 31164, '#name': 'analog_in_state', '#sent_time': 53739.322899124, '#receive_time': 53739.353071999}
mcu 'mcu': got {'oid': 19, 'next_clock': 987774336, 'value': 31247, '#name': 'analog_in_state', '#sent_time': 53739.374716374004, '#receive_time': 53739.393074832}
mcu 'mcu': got {'oid': 27, 'next_clock': 993534336, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53739.426526957, '#receive_time': 53739.473082332}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53740.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3094 bytes_read=6241 bytes_retransmit=18 bytes_invalid=8 send_seq=216 receive_seq=213 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71993606  orange_pi: temp=47.6 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.13 cputime=1283.456 memavail=1722336 print_time=551.277 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462762848
webhooks: registering remote method 'reboot_machine' for connection id: 281473462762848
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462762848
webhooks: registering remote method 'start_job_queue' for connection id: 281473462762848
Stats 53741.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7144 bytes_read=6901 bytes_retransmit=18 bytes_invalid=8 send_seq=306 receive_seq=306 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996031  orange_pi: temp=48.0 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.13 cputime=1283.549 memavail=1722412 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 53742.1: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000155 mcu_task_stddev=0.000282 bytes_write=9106 bytes_read=7885 bytes_retransmit=18 bytes_invalid=8 send_seq=385 receive_seq=385 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71996954  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.13 cputime=1283.650 memavail=1721716 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53743.1: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000155 mcu_task_stddev=0.000282 bytes_write=10813 bytes_read=8787 bytes_retransmit=18 bytes_invalid=8 send_seq=455 receive_seq=455 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997477  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.13 cputime=1283.726 memavail=1720964 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53744.1: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000155 mcu_task_stddev=0.000282 bytes_write=12802 bytes_read=9866 bytes_retransmit=18 bytes_invalid=8 send_seq=541 receive_seq=541 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72000683  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=1283.810 memavail=1720712 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53745.1: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000155 mcu_task_stddev=0.000282 bytes_write=14701 bytes_read=10745 bytes_retransmit=18 bytes_invalid=8 send_seq=614 receive_seq=614 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71999615  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=1283.888 memavail=1720728 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53746.1: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000155 mcu_task_stddev=0.000282 bytes_write=16306 bytes_read=11418 bytes_retransmit=18 bytes_invalid=8 send_seq=667 receive_seq=667 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998947  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=1283.957 memavail=1720500 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53747.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000281 mcu_task_stddev=0.000268 bytes_write=18265 bytes_read=12504 bytes_retransmit=18 bytes_invalid=8 send_seq=751 receive_seq=751 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998580  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=1284.040 memavail=1721528 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53748.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000281 mcu_task_stddev=0.000268 bytes_write=20028 bytes_read=13381 bytes_retransmit=18 bytes_invalid=8 send_seq=822 receive_seq=822 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998379  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=1284.117 memavail=1721276 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53749.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000281 mcu_task_stddev=0.000268 bytes_write=21926 bytes_read=14285 bytes_retransmit=18 bytes_invalid=8 send_seq=894 receive_seq=894 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998291  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=1284.195 memavail=1721024 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53750.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000281 mcu_task_stddev=0.000268 bytes_write=23738 bytes_read=15151 bytes_retransmit=18 bytes_invalid=8 send_seq=963 receive_seq=963 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998219  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=1284.272 memavail=1721044 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53751.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000281 mcu_task_stddev=0.000268 bytes_write=25379 bytes_read=15815 bytes_retransmit=18 bytes_invalid=8 send_seq=1017 receive_seq=1017 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998175  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=1284.344 memavail=1721048 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53752.1: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000277 mcu_task_stddev=0.000266 bytes_write=27263 bytes_read=16731 bytes_retransmit=18 bytes_invalid=8 send_seq=1088 receive_seq=1088 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998160  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=1284.422 memavail=1721048 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53753.1: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000277 mcu_task_stddev=0.000266 bytes_write=28856 bytes_read=17444 bytes_retransmit=18 bytes_invalid=8 send_seq=1144 receive_seq=1144 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998560  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.11 cputime=1284.493 memavail=1721048 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53754.1: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000277 mcu_task_stddev=0.000266 bytes_write=30789 bytes_read=18404 bytes_retransmit=18 bytes_invalid=8 send_seq=1222 receive_seq=1222 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998457  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1284.575 memavail=1721576 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53755.1: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000277 mcu_task_stddev=0.000266 bytes_write=32610 bytes_read=19173 bytes_retransmit=18 bytes_invalid=8 send_seq=1284 receive_seq=1283 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998385  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=1284.649 memavail=1721576 print_time=551.277 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53756.1: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000277 mcu_task_stddev=0.000266 bytes_write=34321 bytes_read=20013 bytes_retransmit=18 bytes_invalid=8 send_seq=1351 receive_seq=1350 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998328  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=1284.728 memavail=1721596 print_time=567.315 buffer_time=0.271 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473462762848: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:29:42 2024 (1735550982.0 53757.6)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 1 top (.8,.4,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473463909536: New connection
webhooks client 281473463909536: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 2525694336, 'value': 31204, '#name': 'analog_in_state', '#sent_time': 53760.722099342, '#receive_time': 53760.753595592}
mcu 'mcu': got {'oid': 19, 'next_clock': 2528574336, 'value': 31242, '#name': 'analog_in_state', '#sent_time': 53760.774093967004, '#receive_time': 53760.793588176}
mcu 'mcu': got {'oid': 27, 'next_clock': 2534334336, 'value': 31252, '#name': 'analog_in_state', '#sent_time': 53760.826525801, '#receive_time': 53760.873647009}
mcu 'mcu': got {'oid': 15, 'next_clock': 2547294336, 'value': 31191, '#name': 'analog_in_state', '#sent_time': 53761.033702968, '#receive_time': 53761.053593843004}
mcu 'mcu': got {'oid': 19, 'next_clock': 2550174336, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53761.085554926, '#receive_time': 53761.093598343}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53761.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3084 bytes_read=6256 bytes_retransmit=0 bytes_invalid=0 send_seq=225 receive_seq=222 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1945 upcoming_bytes=236 freq=71995641  orange_pi: temp=48.3 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.25 cputime=1287.785 memavail=1720412 print_time=572.777 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473463909536
webhooks: registering remote method 'reboot_machine' for connection id: 281473463909536
webhooks: registering remote method 'pause_job_queue' for connection id: 281473463909536
webhooks: registering remote method 'start_job_queue' for connection id: 281473463909536
Neopixel update did not succeed
Stats 53762.6: gcodein=0  mcu: mcu_awake=0.060 mcu_task_avg=0.000119 mcu_task_stddev=0.000268 bytes_write=7270 bytes_read=7226 bytes_retransmit=0 bytes_invalid=0 send_seq=332 receive_seq=331 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71997711  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.25 cputime=1287.892 memavail=1719940 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53763.6: gcodein=0  mcu: mcu_awake=0.060 mcu_task_avg=0.000119 mcu_task_stddev=0.000268 bytes_write=9274 bytes_read=8289 bytes_retransmit=0 bytes_invalid=0 send_seq=417 receive_seq=417 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=72005365  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.39 cputime=1288.000 memavail=1719348 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53764.6: gcodein=0  mcu: mcu_awake=0.060 mcu_task_avg=0.000119 mcu_task_stddev=0.000268 bytes_write=10902 bytes_read=9000 bytes_retransmit=0 bytes_invalid=0 send_seq=474 receive_seq=474 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=72000881  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.39 cputime=1288.068 memavail=1719444 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53765.6: gcodein=0  mcu: mcu_awake=0.060 mcu_task_avg=0.000119 mcu_task_stddev=0.000268 bytes_write=12772 bytes_read=9907 bytes_retransmit=0 bytes_invalid=0 send_seq=545 receive_seq=545 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71999250  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.39 cputime=1288.146 memavail=1719956 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53766.6: gcodein=0  mcu: mcu_awake=0.060 mcu_task_avg=0.000119 mcu_task_stddev=0.000268 bytes_write=14747 bytes_read=10960 bytes_retransmit=0 bytes_invalid=0 send_seq=629 receive_seq=629 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998599  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.39 cputime=1288.229 memavail=1720220 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53767.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000284 mcu_task_stddev=0.000269 bytes_write=16515 bytes_read=11849 bytes_retransmit=0 bytes_invalid=0 send_seq=700 receive_seq=699 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998369  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.39 cputime=1288.307 memavail=1720216 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53768.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000284 mcu_task_stddev=0.000269 bytes_write=18540 bytes_read=13052 bytes_retransmit=0 bytes_invalid=0 send_seq=794 receive_seq=794 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998204  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.36 cputime=1288.397 memavail=1719716 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53769.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000284 mcu_task_stddev=0.000269 bytes_write=20176 bytes_read=13760 bytes_retransmit=0 bytes_invalid=0 send_seq=849 receive_seq=849 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998145  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.36 cputime=1288.467 memavail=1719724 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53770.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000284 mcu_task_stddev=0.000269 bytes_write=22064 bytes_read=14608 bytes_retransmit=0 bytes_invalid=0 send_seq=919 receive_seq=919 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998091  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.36 cputime=1288.543 memavail=1719908 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53771.6: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000284 mcu_task_stddev=0.000269 bytes_write=23992 bytes_read=15564 bytes_retransmit=0 bytes_invalid=0 send_seq=995 receive_seq=995 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998078  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.36 cputime=1288.628 memavail=1719760 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53772.6: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000291 mcu_task_stddev=0.000269 bytes_write=25583 bytes_read=16276 bytes_retransmit=0 bytes_invalid=0 send_seq=1049 receive_seq=1049 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998084  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.36 cputime=1288.698 memavail=1719756 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53773.6: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000291 mcu_task_stddev=0.000269 bytes_write=27464 bytes_read=17132 bytes_retransmit=0 bytes_invalid=0 send_seq=1119 receive_seq=1119 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998078  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.41 cputime=1288.777 memavail=1719016 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53774.6: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000291 mcu_task_stddev=0.000269 bytes_write=29158 bytes_read=17917 bytes_retransmit=0 bytes_invalid=0 send_seq=1180 receive_seq=1180 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998077  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.41 cputime=1288.849 memavail=1718764 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53775.6: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000291 mcu_task_stddev=0.000269 bytes_write=31071 bytes_read=18905 bytes_retransmit=0 bytes_invalid=0 send_seq=1259 receive_seq=1259 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998090  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.41 cputime=1288.932 memavail=1718260 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53776.6: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000291 mcu_task_stddev=0.000269 bytes_write=32999 bytes_read=19873 bytes_retransmit=0 bytes_invalid=0 send_seq=1337 receive_seq=1337 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998093  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.41 cputime=1289.015 memavail=1717460 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53777.6: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000281 mcu_task_stddev=0.000270 bytes_write=34791 bytes_read=20844 bytes_retransmit=0 bytes_invalid=0 send_seq=1412 receive_seq=1411 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998122  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.41 cputime=1289.098 memavail=1717772 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53778.6: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000281 mcu_task_stddev=0.000270 bytes_write=36681 bytes_read=21728 bytes_retransmit=0 bytes_invalid=0 send_seq=1482 receive_seq=1482 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998124  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.46 cputime=1289.197 memavail=1718540 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53779.6: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000281 mcu_task_stddev=0.000270 bytes_write=38403 bytes_read=22634 bytes_retransmit=0 bytes_invalid=0 send_seq=1554 receive_seq=1554 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998128  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.46 cputime=1289.275 memavail=1718552 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53780.6: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000281 mcu_task_stddev=0.000270 bytes_write=40396 bytes_read=23715 bytes_retransmit=0 bytes_invalid=0 send_seq=1640 receive_seq=1639 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998154  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.46 cputime=1289.362 memavail=1718552 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53781.6: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000281 mcu_task_stddev=0.000270 bytes_write=42475 bytes_read=24950 bytes_retransmit=0 bytes_invalid=0 send_seq=1737 receive_seq=1737 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998153  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.46 cputime=1289.452 memavail=1717556 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53782.6: gcodein=0  mcu: mcu_awake=0.152 mcu_task_avg=0.000300 mcu_task_stddev=0.000263 bytes_write=44134 bytes_read=25636 bytes_retransmit=0 bytes_invalid=0 send_seq=1792 receive_seq=1792 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998155  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.46 cputime=1289.522 memavail=1717308 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53783.6: gcodein=0  mcu: mcu_awake=0.152 mcu_task_avg=0.000300 mcu_task_stddev=0.000263 bytes_write=46067 bytes_read=26709 bytes_retransmit=0 bytes_invalid=0 send_seq=1877 receive_seq=1877 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998157  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.42 cputime=1289.607 memavail=1717612 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53784.6: gcodein=0  mcu: mcu_awake=0.152 mcu_task_avg=0.000300 mcu_task_stddev=0.000263 bytes_write=47821 bytes_read=27575 bytes_retransmit=0 bytes_invalid=0 send_seq=1945 receive_seq=1945 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998159  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.42 cputime=1289.686 memavail=1717108 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53785.6: gcodein=0  mcu: mcu_awake=0.152 mcu_task_avg=0.000300 mcu_task_stddev=0.000263 bytes_write=49681 bytes_read=28382 bytes_retransmit=0 bytes_invalid=0 send_seq=2012 receive_seq=2012 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998161  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.42 cputime=1289.764 memavail=1717884 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53786.6: gcodein=0  mcu: mcu_awake=0.152 mcu_task_avg=0.000300 mcu_task_stddev=0.000263 bytes_write=51641 bytes_read=29477 bytes_retransmit=0 bytes_invalid=0 send_seq=2099 receive_seq=2099 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998164  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.42 cputime=1289.852 memavail=1718400 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53787.6: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000283 mcu_task_stddev=0.000265 bytes_write=53361 bytes_read=30334 bytes_retransmit=0 bytes_invalid=0 send_seq=2166 receive_seq=2165 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998166  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.42 cputime=1289.927 memavail=1718936 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53788.6: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000283 mcu_task_stddev=0.000265 bytes_write=55326 bytes_read=31353 bytes_retransmit=0 bytes_invalid=0 send_seq=2248 receive_seq=2248 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998169  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.47 cputime=1290.012 memavail=1719696 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53789.6: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000283 mcu_task_stddev=0.000265 bytes_write=57076 bytes_read=32229 bytes_retransmit=0 bytes_invalid=0 send_seq=2317 receive_seq=2316 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998175  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.47 cputime=1290.090 memavail=1719480 print_time=572.777 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53790.6: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000283 mcu_task_stddev=0.000265 bytes_write=58971 bytes_read=33212 bytes_retransmit=0 bytes_invalid=0 send_seq=2394 receive_seq=2394 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998318  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.47 cputime=1290.178 memavail=1720248 print_time=601.984 buffer_time=0.433 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473463909536: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:30:16 2024 (1735551016.7 53792.2)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 1 top (.6,.4,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462749936: New connection
webhooks client 281473462749936: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 736327040, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 53795.510964567, '#receive_time': 53795.554434567}
mcu 'mcu': got {'oid': 19, 'next_clock': 739207040, 'value': 31253, '#name': 'analog_in_state', '#sent_time': 53795.562886109, '#receive_time': 53795.594423859}
mcu 'mcu': got {'oid': 27, 'next_clock': 744967040, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 53795.666517192, '#receive_time': 53795.674429942}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53796.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3089 bytes_read=6236 bytes_retransmit=9 bytes_invalid=0 send_seq=224 receive_seq=221 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1857 upcoming_bytes=324 freq=71996208  orange_pi: temp=49.7 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.51 cputime=1293.249 memavail=1719120 print_time=607.461 buffer_time=0.240 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462749936
webhooks: registering remote method 'reboot_machine' for connection id: 281473462749936
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462749936
webhooks: registering remote method 'start_job_queue' for connection id: 281473462749936
Stats 53797.3: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000125 mcu_task_stddev=0.000270 bytes_write=7150 bytes_read=6958 bytes_retransmit=9 bytes_invalid=0 send_seq=315 receive_seq=315 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996993  orange_pi: temp=47.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.51 cputime=1293.342 memavail=1718872 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 53798.3: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000125 mcu_task_stddev=0.000270 bytes_write=8985 bytes_read=7758 bytes_retransmit=9 bytes_invalid=0 send_seq=382 receive_seq=382 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997848  orange_pi: temp=47.9 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.47 cputime=1293.438 memavail=1718624 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53799.3: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000125 mcu_task_stddev=0.000270 bytes_write=10696 bytes_read=8594 bytes_retransmit=9 bytes_invalid=0 send_seq=448 receive_seq=448 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998176  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.47 cputime=1293.514 memavail=1718876 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53800.3: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000125 mcu_task_stddev=0.000270 bytes_write=12908 bytes_read=10078 bytes_retransmit=9 bytes_invalid=0 send_seq=564 receive_seq=564 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998030  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.47 cputime=1293.616 memavail=1718624 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53801.3: gcodein=0  mcu: mcu_awake=0.065 mcu_task_avg=0.000125 mcu_task_stddev=0.000270 bytes_write=14868 bytes_read=11084 bytes_retransmit=9 bytes_invalid=0 send_seq=645 receive_seq=645 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997985  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.47 cputime=1293.700 memavail=1717868 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53802.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000292 mcu_task_stddev=0.000263 bytes_write=16562 bytes_read=11929 bytes_retransmit=9 bytes_invalid=0 send_seq=711 receive_seq=711 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998017  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.47 cputime=1293.776 memavail=1718392 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53803.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000292 mcu_task_stddev=0.000263 bytes_write=18425 bytes_read=12823 bytes_retransmit=9 bytes_invalid=0 send_seq=781 receive_seq=781 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998011  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.43 cputime=1293.855 memavail=1717428 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53804.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000292 mcu_task_stddev=0.000263 bytes_write=20229 bytes_read=13788 bytes_retransmit=9 bytes_invalid=0 send_seq=858 receive_seq=857 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998021  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.43 cputime=1293.933 memavail=1718208 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53805.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000292 mcu_task_stddev=0.000263 bytes_write=22166 bytes_read=14761 bytes_retransmit=9 bytes_invalid=0 send_seq=936 receive_seq=936 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998969  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.43 cputime=1294.012 memavail=1718232 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53806.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000292 mcu_task_stddev=0.000263 bytes_write=24011 bytes_read=15660 bytes_retransmit=9 bytes_invalid=0 send_seq=1007 receive_seq=1007 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998719  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.43 cputime=1294.091 memavail=1718512 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53807.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000266 bytes_write=25730 bytes_read=16533 bytes_retransmit=9 bytes_invalid=0 send_seq=1074 receive_seq=1074 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998554  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.43 cputime=1294.165 memavail=1718008 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53808.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000266 bytes_write=27611 bytes_read=17376 bytes_retransmit=9 bytes_invalid=0 send_seq=1144 receive_seq=1143 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71999048  orange_pi: temp=47.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1294.244 memavail=1718784 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53809.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000266 bytes_write=29429 bytes_read=18408 bytes_retransmit=9 bytes_invalid=0 send_seq=1223 receive_seq=1223 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998830  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.40 cputime=1294.324 memavail=1718784 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53810.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000266 bytes_write=31308 bytes_read=19391 bytes_retransmit=9 bytes_invalid=0 send_seq=1301 receive_seq=1301 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998675  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.40 cputime=1294.405 memavail=1719288 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53811.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000285 mcu_task_stddev=0.000266 bytes_write=33161 bytes_read=20195 bytes_retransmit=9 bytes_invalid=0 send_seq=1367 receive_seq=1367 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998556  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.40 cputime=1294.479 memavail=1719044 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53812.3: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000288 mcu_task_stddev=0.000265 bytes_write=34956 bytes_read=21163 bytes_retransmit=9 bytes_invalid=0 send_seq=1442 receive_seq=1442 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998476  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1294.556 memavail=1718792 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53813.3: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000288 mcu_task_stddev=0.000265 bytes_write=36874 bytes_read=22177 bytes_retransmit=9 bytes_invalid=0 send_seq=1523 receive_seq=1523 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998410  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.37 cputime=1294.660 memavail=1717824 print_time=607.461 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53814.3: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000288 mcu_task_stddev=0.000265 bytes_write=38686 bytes_read=23124 bytes_retransmit=9 bytes_invalid=0 send_seq=1600 receive_seq=1600 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998365  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.37 cputime=1294.741 memavail=1717332 print_time=625.559 buffer_time=0.328 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
webhooks client 281473462749936: Disconnected
Restarting printer
Start printer at Mon Dec 30 12:30:40 2024 (1735551040.3 53815.8)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  5 1 top (.4,.4,1)

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473465484192: New connection
webhooks client 281473465484192: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 27, 'next_clock': 2422567040, 'value': 31254, '#name': 'analog_in_state', '#sent_time': 53818.962578828, '#receive_time': 53818.97573112}
mcu 'mcu': got {'oid': 15, 'next_clock': 2435527040, 'value': 31216, '#name': 'analog_in_state', '#sent_time': 53819.132308995, '#receive_time': 53819.154987537004}
mcu 'mcu': got {'oid': 19, 'next_clock': 2438407040, 'value': 31255, '#name': 'analog_in_state', '#sent_time': 53819.184331954, '#receive_time': 53819.195033704}
mcu 'mcu': got {'oid': 27, 'next_clock': 2444167040, 'value': 31248, '#name': 'analog_in_state', '#sent_time': 53819.236700412, '#receive_time': 53819.275001120004}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 53819.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3089 bytes_read=6236 bytes_retransmit=9 bytes_invalid=0 send_seq=221 receive_seq=218 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1940 upcoming_bytes=241 freq=71995486  orange_pi: temp=48.2 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.42 cputime=1297.798 memavail=1717196 print_time=631.031 buffer_time=0.241 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473465484192
webhooks: registering remote method 'reboot_machine' for connection id: 281473465484192
webhooks: registering remote method 'pause_job_queue' for connection id: 281473465484192
webhooks: registering remote method 'start_job_queue' for connection id: 281473465484192
Stats 53820.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7264 bytes_read=7198 bytes_retransmit=9 bytes_invalid=0 send_seq=326 receive_seq=326 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996521  orange_pi: temp=48.1 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.42 cputime=1297.899 memavail=1716972 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53821.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=9132 bytes_read=8097 bytes_retransmit=9 bytes_invalid=0 send_seq=397 receive_seq=397 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71997111  orange_pi: temp=48.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.42 cputime=1297.998 memavail=1716508 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53822.9: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000166 mcu_task_stddev=0.000282 bytes_write=10739 bytes_read=8820 bytes_retransmit=9 bytes_invalid=0 send_seq=453 receive_seq=453 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997762  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.42 cputime=1298.071 memavail=1716048 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53823.9: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000166 mcu_task_stddev=0.000282 bytes_write=12795 bytes_read=10003 bytes_retransmit=9 bytes_invalid=0 send_seq=548 receive_seq=547 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997892  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.38 cputime=1298.162 memavail=1716048 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53824.9: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000166 mcu_task_stddev=0.000282 bytes_write=14706 bytes_read=10980 bytes_retransmit=9 bytes_invalid=0 send_seq=624 receive_seq=624 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997955  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.38 cputime=1298.244 memavail=1716324 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53825.9: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000166 mcu_task_stddev=0.000282 bytes_write=16345 bytes_read=11756 bytes_retransmit=9 bytes_invalid=0 send_seq=686 receive_seq=686 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998070  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.38 cputime=1298.315 memavail=1716732 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53826.9: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000166 mcu_task_stddev=0.000282 bytes_write=18233 bytes_read=12640 bytes_retransmit=9 bytes_invalid=0 send_seq=757 receive_seq=757 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998058  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.38 cputime=1298.394 memavail=1716600 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53827.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000283 mcu_task_stddev=0.000265 bytes_write=19925 bytes_read=13468 bytes_retransmit=9 bytes_invalid=0 send_seq=820 receive_seq=820 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998043  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.38 cputime=1298.468 memavail=1716600 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53828.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000283 mcu_task_stddev=0.000265 bytes_write=21815 bytes_read=14415 bytes_retransmit=9 bytes_invalid=0 send_seq=897 receive_seq=897 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998044  orange_pi: temp=47.7 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.35 cputime=1298.550 memavail=1717368 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53829.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000283 mcu_task_stddev=0.000265 bytes_write=23728 bytes_read=15398 bytes_retransmit=9 bytes_invalid=0 send_seq=975 receive_seq=975 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998059  orange_pi: temp=48.1 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.35 cputime=1298.632 memavail=1717672 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53830.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000283 mcu_task_stddev=0.000265 bytes_write=25552 bytes_read=16443 bytes_retransmit=9 bytes_invalid=0 send_seq=1056 receive_seq=1056 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998069  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.35 cputime=1298.715 memavail=1718436 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53831.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000283 mcu_task_stddev=0.000265 bytes_write=27559 bytes_read=17533 bytes_retransmit=9 bytes_invalid=0 send_seq=1144 receive_seq=1144 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998088  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.35 cputime=1298.804 memavail=1718956 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53832.9: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000295 mcu_task_stddev=0.000263 bytes_write=29260 bytes_read=18437 bytes_retransmit=9 bytes_invalid=0 send_seq=1214 receive_seq=1214 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998099  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.35 cputime=1298.883 memavail=1718964 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53833.9: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000295 mcu_task_stddev=0.000263 bytes_write=31088 bytes_read=19266 bytes_retransmit=9 bytes_invalid=0 send_seq=1279 receive_seq=1279 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998114  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1298.958 memavail=1719492 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53834.9: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000295 mcu_task_stddev=0.000263 bytes_write=32850 bytes_read=19901 bytes_retransmit=9 bytes_invalid=0 send_seq=1332 receive_seq=1332 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998128  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.40 cputime=1299.029 memavail=1719236 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53835.9: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000295 mcu_task_stddev=0.000263 bytes_write=34586 bytes_read=20853 bytes_retransmit=9 bytes_invalid=0 send_seq=1407 receive_seq=1407 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998136  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1299.112 memavail=1719764 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53836.9: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000295 mcu_task_stddev=0.000263 bytes_write=36575 bytes_read=21981 bytes_retransmit=9 bytes_invalid=0 send_seq=1495 receive_seq=1495 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998145  orange_pi: temp=47.4 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1299.216 memavail=1720028 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53837.9: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000280 mcu_task_stddev=0.000270 bytes_write=38169 bytes_read=22597 bytes_retransmit=9 bytes_invalid=0 send_seq=1544 receive_seq=1544 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998168  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.40 cputime=1299.284 memavail=1719536 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53838.9: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000280 mcu_task_stddev=0.000270 bytes_write=40043 bytes_read=23470 bytes_retransmit=9 bytes_invalid=0 send_seq=1613 receive_seq=1613 retransmit_seq=2 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998168  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.37 cputime=1299.359 memavail=1719028 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53839.9: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000280 mcu_task_stddev=0.000270 bytes_write=42009 bytes_read=24531 bytes_retransmit=9 bytes_invalid=0 send_seq=1698 receive_seq=1697 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998170  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.37 cputime=1299.443 memavail=1718276 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53840.9: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000280 mcu_task_stddev=0.000270 bytes_write=43644 bytes_read=25294 bytes_retransmit=9 bytes_invalid=0 send_seq=1758 receive_seq=1758 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998174  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.37 cputime=1299.514 memavail=1718280 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53841.9: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000280 mcu_task_stddev=0.000270 bytes_write=45602 bytes_read=26323 bytes_retransmit=9 bytes_invalid=0 send_seq=1839 receive_seq=1839 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998333  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.37 cputime=1299.597 memavail=1717540 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53842.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000277 mcu_task_stddev=0.000269 bytes_write=47176 bytes_read=26954 bytes_retransmit=9 bytes_invalid=0 send_seq=1888 receive_seq=1888 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998312  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.37 cputime=1299.664 memavail=1717292 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53843.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000277 mcu_task_stddev=0.000269 bytes_write=49033 bytes_read=27844 bytes_retransmit=9 bytes_invalid=0 send_seq=1960 receive_seq=1960 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998297  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.34 cputime=1299.744 memavail=1717308 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53844.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000277 mcu_task_stddev=0.000269 bytes_write=50830 bytes_read=28565 bytes_retransmit=9 bytes_invalid=0 send_seq=2018 receive_seq=2018 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998282  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.34 cputime=1299.817 memavail=1716804 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53845.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000277 mcu_task_stddev=0.000269 bytes_write=52438 bytes_read=29193 bytes_retransmit=9 bytes_invalid=0 send_seq=2069 receive_seq=2069 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998272  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.34 cputime=1299.885 memavail=1716828 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53846.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000277 mcu_task_stddev=0.000269 bytes_write=54233 bytes_read=29995 bytes_retransmit=9 bytes_invalid=0 send_seq=2135 receive_seq=2135 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998262  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.34 cputime=1299.958 memavail=1717076 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53847.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000272 bytes_write=55841 bytes_read=30657 bytes_retransmit=9 bytes_invalid=0 send_seq=2186 receive_seq=2186 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998408  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.34 cputime=1300.026 memavail=1716888 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53848.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000272 bytes_write=57785 bytes_read=31644 bytes_retransmit=9 bytes_invalid=0 send_seq=2265 receive_seq=2265 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998386  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.31 cputime=1300.107 memavail=1716904 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53849.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000272 bytes_write=59722 bytes_read=32591 bytes_retransmit=9 bytes_invalid=0 send_seq=2343 receive_seq=2342 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998364  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.31 cputime=1300.185 memavail=1717168 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53850.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000272 bytes_write=61390 bytes_read=33491 bytes_retransmit=9 bytes_invalid=0 send_seq=2411 receive_seq=2411 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998340  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.31 cputime=1300.261 memavail=1716948 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53851.9: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000257 mcu_task_stddev=0.000272 bytes_write=63208 bytes_read=34245 bytes_retransmit=9 bytes_invalid=0 send_seq=2472 receive_seq=2472 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998334  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.31 cputime=1300.336 memavail=1717460 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53852.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000275 mcu_task_stddev=0.000269 bytes_write=64941 bytes_read=35108 bytes_retransmit=9 bytes_invalid=0 send_seq=2540 receive_seq=2540 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998322  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.31 cputime=1300.412 memavail=1717172 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53853.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000275 mcu_task_stddev=0.000269 bytes_write=66700 bytes_read=35869 bytes_retransmit=9 bytes_invalid=0 send_seq=2601 receive_seq=2601 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998311  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.29 cputime=1300.484 memavail=1717576 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53854.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000275 mcu_task_stddev=0.000269 bytes_write=68604 bytes_read=36766 bytes_retransmit=9 bytes_invalid=0 send_seq=2673 receive_seq=2673 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998306  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.29 cputime=1300.562 memavail=1718112 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53855.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000275 mcu_task_stddev=0.000269 bytes_write=70284 bytes_read=37529 bytes_retransmit=9 bytes_invalid=0 send_seq=2734 receive_seq=2734 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998298  orange_pi: temp=47.5 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.29 cputime=1300.635 memavail=1718380 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53856.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000275 mcu_task_stddev=0.000269 bytes_write=72202 bytes_read=38558 bytes_retransmit=9 bytes_invalid=0 send_seq=2815 receive_seq=2815 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998289  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.29 cputime=1300.715 memavail=1718424 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53857.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000282 mcu_task_stddev=0.000272 bytes_write=73930 bytes_read=39457 bytes_retransmit=9 bytes_invalid=0 send_seq=2884 receive_seq=2884 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998281  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.29 cputime=1300.789 memavail=1718432 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53858.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000282 mcu_task_stddev=0.000272 bytes_write=75790 bytes_read=40271 bytes_retransmit=9 bytes_invalid=0 send_seq=2952 receive_seq=2952 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998354  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.27 cputime=1300.864 memavail=1718192 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 53859.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000282 mcu_task_stddev=0.000272 bytes_write=77720 bytes_read=41227 bytes_retransmit=9 bytes_invalid=0 send_seq=3028 receive_seq=3028 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998339  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1300.944 memavail=1718196 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53860.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000282 mcu_task_stddev=0.000272 bytes_write=79249 bytes_read=41836 bytes_retransmit=9 bytes_invalid=0 send_seq=3076 receive_seq=3076 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998327  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1301.010 memavail=1717944 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53861.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000282 mcu_task_stddev=0.000272 bytes_write=81179 bytes_read=42783 bytes_retransmit=9 bytes_invalid=0 send_seq=3153 receive_seq=3153 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998314  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=1301.090 memavail=1717944 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53862.9: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000274 mcu_task_stddev=0.000271 bytes_write=82969 bytes_read=43655 bytes_retransmit=9 bytes_invalid=0 send_seq=3220 receive_seq=3220 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998305  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.27 cputime=1301.168 memavail=1717228 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53863.9: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000274 mcu_task_stddev=0.000271 bytes_write=84679 bytes_read=44383 bytes_retransmit=9 bytes_invalid=0 send_seq=3279 receive_seq=3279 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998301  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.24 cputime=1301.239 memavail=1717988 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53864.9: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000274 mcu_task_stddev=0.000271 bytes_write=86768 bytes_read=45671 bytes_retransmit=9 bytes_invalid=0 send_seq=3381 receive_seq=3381 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998292  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.24 cputime=1301.330 memavail=1718764 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53865.9: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000274 mcu_task_stddev=0.000271 bytes_write=88497 bytes_read=46513 bytes_retransmit=9 bytes_invalid=0 send_seq=3447 receive_seq=3447 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998285  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.24 cputime=1301.408 memavail=1718512 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53866.9: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000274 mcu_task_stddev=0.000271 bytes_write=90415 bytes_read=47457 bytes_retransmit=9 bytes_invalid=0 send_seq=3522 receive_seq=3522 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998280  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.24 cputime=1301.488 memavail=1719288 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53867.9: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000289 mcu_task_stddev=0.000267 bytes_write=92236 bytes_read=48278 bytes_retransmit=9 bytes_invalid=0 send_seq=3588 receive_seq=3588 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998274  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.24 cputime=1301.563 memavail=1719564 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53868.9: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000289 mcu_task_stddev=0.000267 bytes_write=93839 bytes_read=48980 bytes_retransmit=9 bytes_invalid=0 send_seq=3642 receive_seq=3642 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998269  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.22 cputime=1301.630 memavail=1719564 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53869.9: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000289 mcu_task_stddev=0.000267 bytes_write=95811 bytes_read=50020 bytes_retransmit=9 bytes_invalid=0 send_seq=3725 receive_seq=3725 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998265  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.22 cputime=1301.715 memavail=1719824 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53870.9: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000289 mcu_task_stddev=0.000267 bytes_write=97629 bytes_read=51022 bytes_retransmit=9 bytes_invalid=0 send_seq=3806 receive_seq=3805 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998261  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.22 cputime=1301.795 memavail=1720864 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 53871.9: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000289 mcu_task_stddev=0.000267 bytes_write=99515 bytes_read=52046 bytes_retransmit=9 bytes_invalid=0 send_seq=3885 receive_seq=3885 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998258  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.22 cputime=1301.878 memavail=1720360 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53872.9: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000288 mcu_task_stddev=0.000266 bytes_write=101334 bytes_read=52830 bytes_retransmit=9 bytes_invalid=0 send_seq=3947 receive_seq=3947 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998255  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.22 cputime=1301.953 memavail=1720148 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 53873.9: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000288 mcu_task_stddev=0.000266 bytes_write=103067 bytes_read=53676 bytes_retransmit=9 bytes_invalid=0 send_seq=4015 receive_seq=4015 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998252  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.21 cputime=1302.030 memavail=1720404 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53874.9: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000288 mcu_task_stddev=0.000266 bytes_write=104939 bytes_read=54661 bytes_retransmit=9 bytes_invalid=0 send_seq=4092 receive_seq=4092 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998250  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.21 cputime=1302.114 memavail=1721180 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53875.9: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000288 mcu_task_stddev=0.000266 bytes_write=106661 bytes_read=55496 bytes_retransmit=9 bytes_invalid=0 send_seq=4158 receive_seq=4158 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998249  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1302.189 memavail=1720932 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 53876.9: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000288 mcu_task_stddev=0.000266 bytes_write=108502 bytes_read=56261 bytes_retransmit=9 bytes_invalid=0 send_seq=4221 receive_seq=4221 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998247  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=1302.266 memavail=1720932 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53877.9: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000272 mcu_task_stddev=0.000270 bytes_write=110371 bytes_read=57216 bytes_retransmit=9 bytes_invalid=0 send_seq=4295 receive_seq=4295 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998245  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.21 cputime=1302.348 memavail=1720932 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 53878.9: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000272 mcu_task_stddev=0.000270 bytes_write=111942 bytes_read=57812 bytes_retransmit=9 bytes_invalid=0 send_seq=4342 receive_seq=4342 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998244  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.19 cputime=1302.413 memavail=1720952 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Neopixel update did not succeed
Stats 53879.9: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000272 mcu_task_stddev=0.000270 bytes_write=113942 bytes_read=58868 bytes_retransmit=9 bytes_invalid=0 send_seq=4428 receive_seq=4428 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998295  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.19 cputime=1302.500 memavail=1721204 print_time=631.031 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Unknown command:"SUDO"
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 61769.0: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000280 mcu_task_stddev=0.000268 bytes_write=14432053 bytes_read=7074506 bytes_retransmit=9 bytes_invalid=0 send_seq=560867 receive_seq=560867 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998327  orange_pi: temp=45.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=1914.974 memavail=1715852 print_time=8580.031 buffer_time=0.326 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
webhooks client 281473465484192: Disconnected
Restarting printer
Start printer at Mon Dec 30 14:43:14 2024 (1735558994.9 61770.5)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel sb_leds]
pin = PA8
chain_count = 16
color_order = RGB
initial_red = 1.0
initial_green = 0.0
initial_blue = 1.0

[led_effect sb_logo_busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:sb_leds
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:sb_leds
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:sb_leds (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[neopixel panel_ring]
pin = PA8
chain_count = 16

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Config error
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 130, in _connect
    self._read_config()
  File "/home/klipper/klipper/klippy/klippy.py", line 123, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/klipper/klipper/klippy/klippy.py", line 112, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/klipper/klipper/klippy/extras/neopixel.py", line 111, in load_config_prefix
    return PrinterNeoPixel(config)
  File "/home/klipper/klipper/klippy/extras/neopixel.py", line 22, in __init__
    pin_params = ppins.lookup_pin(config.get('pin'))
  File "/home/klipper/klipper/klippy/pins.py", line 106, in lookup_pin
    raise error("pin %s used multiple times in config" % (pin,))
pins.error: pin PA8 used multiple times in config
webhooks client 281473445117328: New connection
webhooks client 281473445117328: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
webhooks client 281473445117328: Disconnected
Restarting printer
Start printer at Mon Dec 30 14:44:04 2024 (1735559045.0 61820.5)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel sb_leds]
pin = PA8
chain_count = 16
color_order = RGB
initial_red = 1.0
initial_green = 0.0
initial_blue = 1.0

[led_effect sb_logo_busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:sb_leds
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:sb_leds
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:sb_leds (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462410960: New connection
webhooks client 281473462410960: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 3233909376, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 61823.835573021, '#receive_time': 61823.844829396}
mcu 'mcu': got {'oid': 19, 'next_clock': 3236789376, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 61823.835573021, '#receive_time': 61823.884902771}
mcu 'mcu': got {'oid': 27, 'next_clock': 3242549376, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 61823.939441229, '#receive_time': 61823.964851771}
mcu 'mcu': got {'oid': 15, 'next_clock': 3255509376, 'value': 31191, '#name': 'analog_in_state', '#sent_time': 61824.095246854, '#receive_time': 61824.144892146}
mcu 'mcu': got {'oid': 19, 'next_clock': 3258389376, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 61824.148011396, '#receive_time': 61824.184838854}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 61824.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3102 bytes_read=6272 bytes_retransmit=9 bytes_invalid=0 send_seq=218 receive_seq=215 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1996 upcoming_bytes=177 freq=71995484  orange_pi: temp=47.0 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.06 cputime=1920.184 memavail=1718928 print_time=8635.646 buffer_time=0.198 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462410960
webhooks: registering remote method 'reboot_machine' for connection id: 281473462410960
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462410960
webhooks: registering remote method 'start_job_queue' for connection id: 281473462410960
Stats 61825.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7157 bytes_read=7000 bytes_retransmit=9 bytes_invalid=0 send_seq=310 receive_seq=309 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71996540  orange_pi: temp=46.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=1920.305 memavail=1718224 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 61826.7: gcodein=0  mcu: mcu_awake=0.077 mcu_task_avg=0.000136 mcu_task_stddev=0.000273 bytes_write=8977 bytes_read=7822 bytes_retransmit=9 bytes_invalid=0 send_seq=374 receive_seq=374 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997713  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=1920.412 memavail=1718000 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61827.7: gcodein=0  mcu: mcu_awake=0.077 mcu_task_avg=0.000136 mcu_task_stddev=0.000273 bytes_write=10771 bytes_read=8610 bytes_retransmit=9 bytes_invalid=0 send_seq=438 receive_seq=437 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997674  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.06 cputime=1920.494 memavail=1718000 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61828.7: gcodein=0  mcu: mcu_awake=0.077 mcu_task_avg=0.000136 mcu_task_stddev=0.000273 bytes_write=12745 bytes_read=9713 bytes_retransmit=9 bytes_invalid=0 send_seq=526 receive_seq=526 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997755  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=1920.584 memavail=1718000 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61829.7: gcodein=0  mcu: mcu_awake=0.077 mcu_task_avg=0.000136 mcu_task_stddev=0.000273 bytes_write=14675 bytes_read=10742 bytes_retransmit=9 bytes_invalid=0 send_seq=607 receive_seq=607 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997884  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=1920.672 memavail=1718000 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61830.7: gcodein=0  mcu: mcu_awake=0.077 mcu_task_avg=0.000136 mcu_task_stddev=0.000273 bytes_write=16703 bytes_read=11899 bytes_retransmit=9 bytes_invalid=0 send_seq=700 receive_seq=699 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997956  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=1920.766 memavail=1718000 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61831.7: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000285 mcu_task_stddev=0.000251 bytes_write=18660 bytes_read=13053 bytes_retransmit=9 bytes_invalid=0 send_seq=790 receive_seq=790 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998004  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=1920.857 memavail=1717752 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61832.7: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000285 mcu_task_stddev=0.000251 bytes_write=20514 bytes_read=13939 bytes_retransmit=9 bytes_invalid=0 send_seq=860 receive_seq=860 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998094  orange_pi: temp=45.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.06 cputime=1920.940 memavail=1718028 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61833.7: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000285 mcu_task_stddev=0.000251 bytes_write=22350 bytes_read=14771 bytes_retransmit=9 bytes_invalid=0 send_seq=927 receive_seq=927 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998101  orange_pi: temp=45.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=1921.020 memavail=1717572 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 61834.7: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000285 mcu_task_stddev=0.000251 bytes_write=24261 bytes_read=15752 bytes_retransmit=9 bytes_invalid=0 send_seq=1007 receive_seq=1006 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998095  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.05 cputime=1921.105 memavail=1716816 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61835.7: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000285 mcu_task_stddev=0.000251 bytes_write=26152 bytes_read=16742 bytes_retransmit=9 bytes_invalid=0 send_seq=1084 receive_seq=1084 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998105  orange_pi: temp=45.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1921.189 memavail=1716836 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 61836.7: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000275 mcu_task_stddev=0.000258 bytes_write=27956 bytes_read=17539 bytes_retransmit=9 bytes_invalid=0 send_seq=1147 receive_seq=1147 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998546  orange_pi: temp=45.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1921.271 memavail=1714832 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61837.7: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000275 mcu_task_stddev=0.000258 bytes_write=29845 bytes_read=18499 bytes_retransmit=9 bytes_invalid=0 send_seq=1225 receive_seq=1225 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998454  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1921.357 memavail=1715088 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61838.7: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000275 mcu_task_stddev=0.000258 bytes_write=31710 bytes_read=19407 bytes_retransmit=9 bytes_invalid=0 send_seq=1297 receive_seq=1297 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998388  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1921.439 memavail=1715084 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61839.7: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000275 mcu_task_stddev=0.000258 bytes_write=33591 bytes_read=20319 bytes_retransmit=9 bytes_invalid=0 send_seq=1371 receive_seq=1371 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998472  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1921.545 memavail=1715088 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61840.7: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000275 mcu_task_stddev=0.000258 bytes_write=35476 bytes_read=21191 bytes_retransmit=9 bytes_invalid=0 send_seq=1444 receive_seq=1443 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998411  orange_pi: temp=45.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=1921.624 memavail=1715244 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61841.7: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=37381 bytes_read=22263 bytes_retransmit=9 bytes_invalid=0 send_seq=1526 receive_seq=1526 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998389  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.05 cputime=1921.710 memavail=1716140 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61842.7: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=39288 bytes_read=23233 bytes_retransmit=9 bytes_invalid=0 send_seq=1603 receive_seq=1603 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998358  orange_pi: temp=44.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1921.797 memavail=1716148 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61843.7: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=41239 bytes_read=24273 bytes_retransmit=9 bytes_invalid=0 send_seq=1687 receive_seq=1686 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998325  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1921.889 memavail=1716428 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61844.7: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=43039 bytes_read=25126 bytes_retransmit=9 bytes_invalid=0 send_seq=1754 receive_seq=1754 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998304  orange_pi: temp=44.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.13 cputime=1921.970 memavail=1715928 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 61845.7: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=44967 bytes_read=26122 bytes_retransmit=9 bytes_invalid=0 send_seq=1833 receive_seq=1833 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998291  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.13 cputime=1922.057 memavail=1716240 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61846.7: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000286 mcu_task_stddev=0.000256 bytes_write=46778 bytes_read=26932 bytes_retransmit=9 bytes_invalid=0 send_seq=1897 receive_seq=1897 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998292  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=1922.138 memavail=1716684 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61847.7: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000286 mcu_task_stddev=0.000256 bytes_write=48583 bytes_read=27798 bytes_retransmit=9 bytes_invalid=0 send_seq=1966 receive_seq=1966 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998279  orange_pi: temp=45.3 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.13 cputime=1922.218 memavail=1717044 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61848.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000286 mcu_task_stddev=0.000256 bytes_write=50497 bytes_read=28747 bytes_retransmit=9 bytes_invalid=0 send_seq=2042 receive_seq=2042 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998269  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=1922.303 memavail=1717044 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61849.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000286 mcu_task_stddev=0.000256 bytes_write=52252 bytes_read=29436 bytes_retransmit=9 bytes_invalid=0 send_seq=2098 receive_seq=2098 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998263  orange_pi: temp=45.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=1922.379 memavail=1717572 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61850.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000286 mcu_task_stddev=0.000256 bytes_write=54129 bytes_read=30411 bytes_retransmit=9 bytes_invalid=0 send_seq=2176 receive_seq=2176 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998256  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=1922.463 memavail=1718084 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61851.8: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000267 mcu_task_stddev=0.000260 bytes_write=56034 bytes_read=31385 bytes_retransmit=9 bytes_invalid=0 send_seq=2252 receive_seq=2252 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998259  orange_pi: temp=45.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=1922.545 memavail=1717892 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61852.8: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000267 mcu_task_stddev=0.000260 bytes_write=57813 bytes_read=32116 bytes_retransmit=9 bytes_invalid=0 send_seq=2311 receive_seq=2311 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998376  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=1922.620 memavail=1717660 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61853.8: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000267 mcu_task_stddev=0.000260 bytes_write=59806 bytes_read=33247 bytes_retransmit=9 bytes_invalid=0 send_seq=2401 receive_seq=2401 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998361  orange_pi: temp=44.7 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.12 cputime=1922.714 memavail=1717408 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61854.8: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000267 mcu_task_stddev=0.000260 bytes_write=61640 bytes_read=34160 bytes_retransmit=9 bytes_invalid=0 send_seq=2473 receive_seq=2473 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998350  orange_pi: temp=45.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=1922.799 memavail=1716904 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 61855.8: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000267 mcu_task_stddev=0.000260 bytes_write=63632 bytes_read=35265 bytes_retransmit=9 bytes_invalid=0 send_seq=2561 receive_seq=2561 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998448  orange_pi: temp=45.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=1922.887 memavail=1716904 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61856.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000277 mcu_task_stddev=0.000255 bytes_write=65485 bytes_read=36153 bytes_retransmit=9 bytes_invalid=0 send_seq=2631 receive_seq=2631 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998423  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=1922.974 memavail=1717440 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61857.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000277 mcu_task_stddev=0.000255 bytes_write=67261 bytes_read=36975 bytes_retransmit=9 bytes_invalid=0 send_seq=2696 receive_seq=2696 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998402  orange_pi: temp=45.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=1923.053 memavail=1717952 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61858.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000277 mcu_task_stddev=0.000255 bytes_write=69220 bytes_read=38002 bytes_retransmit=9 bytes_invalid=0 send_seq=2778 receive_seq=2778 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998380  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=1923.140 memavail=1718488 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61859.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000277 mcu_task_stddev=0.000255 bytes_write=71081 bytes_read=38886 bytes_retransmit=9 bytes_invalid=0 send_seq=2849 receive_seq=2849 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998362  orange_pi: temp=45.7 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=1923.219 memavail=1718248 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61860.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000277 mcu_task_stddev=0.000255 bytes_write=72929 bytes_read=39856 bytes_retransmit=9 bytes_invalid=0 send_seq=2926 receive_seq=2926 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998347  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=1923.303 memavail=1718004 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61861.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=74852 bytes_read=40822 bytes_retransmit=9 bytes_invalid=0 send_seq=3002 receive_seq=3002 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998340  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=1923.391 memavail=1717752 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61862.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=76831 bytes_read=41914 bytes_retransmit=9 bytes_invalid=0 send_seq=3089 receive_seq=3089 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998327  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=1923.480 memavail=1717500 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 61863.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=78670 bytes_read=42798 bytes_retransmit=9 bytes_invalid=0 send_seq=3160 receive_seq=3160 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998317  orange_pi: temp=45.1 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=1923.563 memavail=1717508 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61864.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=80457 bytes_read=43586 bytes_retransmit=9 bytes_invalid=0 send_seq=3223 receive_seq=3223 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998309  orange_pi: temp=45.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.09 cputime=1923.641 memavail=1717768 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61865.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000275 mcu_task_stddev=0.000259 bytes_write=82424 bytes_read=44639 bytes_retransmit=9 bytes_invalid=0 send_seq=3307 receive_seq=3307 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998301  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.09 cputime=1923.730 memavail=1717768 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61866.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=84347 bytes_read=45657 bytes_retransmit=9 bytes_invalid=0 send_seq=3387 receive_seq=3387 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998296  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.09 cputime=1923.818 memavail=1717768 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61867.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=86160 bytes_read=46549 bytes_retransmit=9 bytes_invalid=0 send_seq=3458 receive_seq=3458 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998290  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.09 cputime=1923.898 memavail=1718016 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61868.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=87983 bytes_read=47303 bytes_retransmit=9 bytes_invalid=0 send_seq=3520 receive_seq=3519 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998286  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.09 cputime=1923.976 memavail=1718764 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61869.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=90014 bytes_read=48512 bytes_retransmit=9 bytes_invalid=0 send_seq=3615 receive_seq=3615 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998281  orange_pi: temp=45.3 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=1924.071 memavail=1718272 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61870.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=91827 bytes_read=49352 bytes_retransmit=9 bytes_invalid=0 send_seq=3682 receive_seq=3682 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998276  orange_pi: temp=45.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.08 cputime=1924.153 memavail=1718272 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61871.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000285 mcu_task_stddev=0.000259 bytes_write=93732 bytes_read=50365 bytes_retransmit=9 bytes_invalid=0 send_seq=3761 receive_seq=3761 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998272  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=1924.238 memavail=1717772 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61872.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000285 mcu_task_stddev=0.000259 bytes_write=95574 bytes_read=51197 bytes_retransmit=9 bytes_invalid=0 send_seq=3828 receive_seq=3828 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=1924.320 memavail=1717520 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61873.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000285 mcu_task_stddev=0.000259 bytes_write=97506 bytes_read=52219 bytes_retransmit=9 bytes_invalid=0 send_seq=3909 receive_seq=3909 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998267  orange_pi: temp=45.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=1924.407 memavail=1717268 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 61874.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000285 mcu_task_stddev=0.000259 bytes_write=99503 bytes_read=53373 bytes_retransmit=9 bytes_invalid=0 send_seq=4000 receive_seq=3999 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998264  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=1924.498 memavail=1717268 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61875.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000285 mcu_task_stddev=0.000259 bytes_write=101351 bytes_read=54268 bytes_retransmit=9 bytes_invalid=0 send_seq=4072 receive_seq=4072 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998262  orange_pi: temp=45.0 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.08 cputime=1924.580 memavail=1717016 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 61876.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=103253 bytes_read=55247 bytes_retransmit=9 bytes_invalid=0 send_seq=4149 receive_seq=4149 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998262  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=1924.668 memavail=1716552 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61877.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=105114 bytes_read=56133 bytes_retransmit=9 bytes_invalid=0 send_seq=4219 receive_seq=4219 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998260  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=1924.753 memavail=1716552 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61878.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=106937 bytes_read=56997 bytes_retransmit=9 bytes_invalid=0 send_seq=4289 receive_seq=4289 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998259  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=1924.836 memavail=1716812 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61879.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=108803 bytes_read=57889 bytes_retransmit=9 bytes_invalid=0 send_seq=4360 receive_seq=4360 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998259  orange_pi: temp=45.1 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=1924.916 memavail=1716560 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61880.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=110649 bytes_read=58762 bytes_retransmit=9 bytes_invalid=0 send_seq=4429 receive_seq=4429 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998258  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.07 cputime=1924.996 memavail=1716560 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61881.8: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000273 mcu_task_stddev=0.000260 bytes_write=112555 bytes_read=59765 bytes_retransmit=9 bytes_invalid=0 send_seq=4509 receive_seq=4509 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998260  orange_pi: temp=45.1 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=1925.081 memavail=1716056 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61882.8: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000273 mcu_task_stddev=0.000260 bytes_write=114454 bytes_read=60743 bytes_retransmit=9 bytes_invalid=0 send_seq=4586 receive_seq=4586 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998264  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=1925.166 memavail=1715804 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61883.8: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000273 mcu_task_stddev=0.000260 bytes_write=116330 bytes_read=61676 bytes_retransmit=9 bytes_invalid=0 send_seq=4659 receive_seq=4659 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998262  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=1925.248 memavail=1715556 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61884.8: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000273 mcu_task_stddev=0.000260 bytes_write=118190 bytes_read=62506 bytes_retransmit=9 bytes_invalid=0 send_seq=4728 receive_seq=4727 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998261  orange_pi: temp=44.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.06 cputime=1925.328 memavail=1716604 print_time=8635.646 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Unknown command:"SB_LOGO_BUSY"
Neopixel update did not succeed
TMC 'stepper_z' reports GSTAT:      00000001 reset=1(Reset)
TMC 'stepper_z' reports GSTAT:      00000000
Stats 61957.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000287 mcu_task_stddev=0.000257 bytes_write=257069 bytes_read=133189 bytes_retransmit=9 bytes_invalid=0 send_seq=10323 receive_seq=10323 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998286  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.07 cputime=1931.558 memavail=1716040 print_time=8768.738 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
TMC 'stepper_x' reports GSTAT:      00000001 reset=1(Reset)
TMC 'stepper_x' reports GSTAT:      00000000
Stats 61958.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000287 mcu_task_stddev=0.000257 bytes_write=259741 bytes_read=134878 bytes_retransmit=9 bytes_invalid=0 send_seq=10438 receive_seq=10437 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998286  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.07 cputime=1931.684 memavail=1715788 print_time=8769.738 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61959.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000287 mcu_task_stddev=0.000257 bytes_write=262081 bytes_read=136180 bytes_retransmit=9 bytes_invalid=0 send_seq=10543 receive_seq=10542 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998285  orange_pi: temp=45.7 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.06 cputime=1931.788 memavail=1715536 print_time=8770.738 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 61960.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000287 mcu_task_stddev=0.000257 bytes_write=264443 bytes_read=137492 bytes_retransmit=9 bytes_invalid=0 send_seq=10643 receive_seq=10643 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998284  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=1931.892 memavail=1715536 print_time=8771.730 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
TMC 'stepper_y' reports GSTAT:      00000001 reset=1(Reset)
Neopixel update did not succeed
TMC 'stepper_y' reports GSTAT:      00000000
Stats 61961.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000179 mcu_task_stddev=0.000233 bytes_write=267329 bytes_read=139444 bytes_retransmit=9 bytes_invalid=0 send_seq=10769 receive_seq=10768 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998283  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.06 cputime=1932.032 memavail=1715536 print_time=8772.717 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61962.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000179 mcu_task_stddev=0.000233 bytes_write=269676 bytes_read=140774 bytes_retransmit=9 bytes_invalid=0 send_seq=10871 receive_seq=10870 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998283  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=1932.136 memavail=1715284 print_time=8773.717 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61963.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000179 mcu_task_stddev=0.000233 bytes_write=271986 bytes_read=142234 bytes_retransmit=9 bytes_invalid=0 send_seq=10976 receive_seq=10976 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998281  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=1932.243 memavail=1714780 print_time=8774.717 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 61964.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000179 mcu_task_stddev=0.000233 bytes_write=274251 bytes_read=143479 bytes_retransmit=9 bytes_invalid=0 send_seq=11068 receive_seq=11068 retransmit_seq=2 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998284  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=1932.344 memavail=1714280 print_time=8775.717 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 61965.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000179 mcu_task_stddev=0.000233 bytes_write=276541 bytes_read=144673 bytes_retransmit=9 bytes_invalid=0 send_seq=11163 receive_seq=11162 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998283  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.8 pwm=0.000 sysload=1.06 cputime=1932.443 memavail=1714544 print_time=8776.717 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61966.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000170 mcu_task_stddev=0.000227 bytes_write=279082 bytes_read=146110 bytes_retransmit=9 bytes_invalid=0 send_seq=11270 receive_seq=11270 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998282  orange_pi: temp=45.9 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.06 cputime=1932.555 memavail=1714292 print_time=8777.719 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 61967.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000170 mcu_task_stddev=0.000227 bytes_write=281804 bytes_read=147481 bytes_retransmit=9 bytes_invalid=0 send_seq=11374 receive_seq=11374 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998281  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.06 cputime=1932.667 memavail=1714540 print_time=8782.247 buffer_time=3.710 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61968.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000170 mcu_task_stddev=0.000227 bytes_write=283726 bytes_read=148444 bytes_retransmit=9 bytes_invalid=0 send_seq=11447 receive_seq=11447 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998281  orange_pi: temp=45.0 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.06 cputime=1932.756 memavail=1714292 print_time=8782.247 buffer_time=2.709 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 61969.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000170 mcu_task_stddev=0.000227 bytes_write=285665 bytes_read=149544 bytes_retransmit=9 bytes_invalid=0 send_seq=11527 receive_seq=11527 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998280  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.05 cputime=1932.851 memavail=1714176 print_time=8782.247 buffer_time=1.709 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 61970.8: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000170 mcu_task_stddev=0.000227 bytes_write=287629 bytes_read=150603 bytes_retransmit=9 bytes_invalid=0 send_seq=11605 receive_seq=11605 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998280  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.9 pwm=0.000 sysload=1.05 cputime=1932.944 memavail=1714548 print_time=8782.247 buffer_time=0.708 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61971.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000220 mcu_task_stddev=0.000249 bytes_write=289583 bytes_read=151635 bytes_retransmit=9 bytes_invalid=0 send_seq=11682 receive_seq=11682 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=18 freq=71998280  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=1933.038 memavail=1714712 print_time=8782.247 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 61972.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000220 mcu_task_stddev=0.000249 bytes_write=291622 bytes_read=152752 bytes_retransmit=9 bytes_invalid=0 send_seq=11762 receive_seq=11762 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=18 freq=71998309  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.05 cputime=1933.133 memavail=1714328 print_time=8784.215 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Neopixel update did not succeed
Stats 61973.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000220 mcu_task_stddev=0.000249 bytes_write=293967 bytes_read=154037 bytes_retransmit=9 bytes_invalid=0 send_seq=11860 receive_seq=11860 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998306  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.05 cputime=1933.238 memavail=1714336 print_time=8784.715 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 61974.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000220 mcu_task_stddev=0.000249 bytes_write=296472 bytes_read=155715 bytes_retransmit=9 bytes_invalid=0 send_seq=11990 receive_seq=11990 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998305  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.05 cputime=1933.356 memavail=1713592 print_time=8785.715 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 61975.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000220 mcu_task_stddev=0.000249 bytes_write=298993 bytes_read=156948 bytes_retransmit=9 bytes_invalid=0 send_seq=12086 receive_seq=12086 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=36 freq=71998303  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.05 cputime=1933.457 memavail=1712984 print_time=8788.429 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 61976.8: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000197 mcu_task_stddev=0.000239 bytes_write=300998 bytes_read=158011 bytes_retransmit=9 bytes_invalid=0 send_seq=12163 receive_seq=12163 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=18 freq=71998301  orange_pi: temp=46.1 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1933.555 memavail=1712584 print_time=8788.429 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61977.8: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000197 mcu_task_stddev=0.000239 bytes_write=303083 bytes_read=158998 bytes_retransmit=9 bytes_invalid=0 send_seq=12240 receive_seq=12240 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998301  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.05 cputime=1933.649 memavail=1712888 print_time=8788.729 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 61978.8: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000197 mcu_task_stddev=0.000239 bytes_write=305647 bytes_read=160527 bytes_retransmit=9 bytes_invalid=0 send_seq=12355 receive_seq=12355 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=18 freq=71998301  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.05 cputime=1933.762 memavail=1712888 print_time=8790.945 buffer_time=1.404 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61979.8: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000197 mcu_task_stddev=0.000239 bytes_write=307701 bytes_read=161653 bytes_retransmit=9 bytes_invalid=0 send_seq=12440 receive_seq=12440 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998301  orange_pi: temp=45.1 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1933.860 memavail=1712892 print_time=8790.945 buffer_time=0.404 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Neopixel update did not succeed
Stats 61980.8: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000197 mcu_task_stddev=0.000239 bytes_write=309797 bytes_read=162822 bytes_retransmit=9 bytes_invalid=0 send_seq=12527 receive_seq=12527 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998299  orange_pi: temp=44.7 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.0 pwm=0.000 sysload=1.05 cputime=1933.959 memavail=1713656 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61981.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000223 mcu_task_stddev=0.000248 bytes_write=311758 bytes_read=163941 bytes_retransmit=9 bytes_invalid=0 send_seq=12609 receive_seq=12609 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998298  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1934.053 memavail=1713940 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61982.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000223 mcu_task_stddev=0.000248 bytes_write=313671 bytes_read=164922 bytes_retransmit=9 bytes_invalid=0 send_seq=12681 receive_seq=12681 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998296  orange_pi: temp=46.1 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1934.141 memavail=1714208 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61983.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000223 mcu_task_stddev=0.000248 bytes_write=315645 bytes_read=165958 bytes_retransmit=9 bytes_invalid=0 send_seq=12759 receive_seq=12759 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998314  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=1934.233 memavail=1714000 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61984.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000223 mcu_task_stddev=0.000248 bytes_write=317507 bytes_read=166886 bytes_retransmit=9 bytes_invalid=0 send_seq=12827 receive_seq=12827 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998311  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.04 cputime=1934.318 memavail=1713748 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 61985.8: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000223 mcu_task_stddev=0.000248 bytes_write=319494 bytes_read=168054 bytes_retransmit=9 bytes_invalid=0 send_seq=12914 receive_seq=12914 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998308  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.04 cputime=1934.413 memavail=1713496 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61986.8: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000245 mcu_task_stddev=0.000258 bytes_write=321441 bytes_read=169053 bytes_retransmit=9 bytes_invalid=0 send_seq=12986 receive_seq=12986 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998307  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.04 cputime=1934.505 memavail=1714032 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 61987.8: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000245 mcu_task_stddev=0.000258 bytes_write=323314 bytes_read=169955 bytes_retransmit=9 bytes_invalid=0 send_seq=13052 receive_seq=13052 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998304  orange_pi: temp=45.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.04 cputime=1934.589 memavail=1714808 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61988.8: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000245 mcu_task_stddev=0.000258 bytes_write=325225 bytes_read=170962 bytes_retransmit=9 bytes_invalid=0 send_seq=13127 receive_seq=13126 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998302  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.04 cputime=1934.678 memavail=1715332 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61989.8: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000245 mcu_task_stddev=0.000258 bytes_write=327342 bytes_read=172305 bytes_retransmit=9 bytes_invalid=0 send_seq=13227 receive_seq=13227 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998301  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.04 cputime=1934.779 memavail=1714832 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61990.8: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000245 mcu_task_stddev=0.000258 bytes_write=329284 bytes_read=173327 bytes_retransmit=9 bytes_invalid=0 send_seq=13301 receive_seq=13301 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998298  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.04 cputime=1934.868 memavail=1715608 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 61991.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000250 mcu_task_stddev=0.000254 bytes_write=331158 bytes_read=174275 bytes_retransmit=9 bytes_invalid=0 send_seq=13371 receive_seq=13371 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998298  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.04 cputime=1934.955 memavail=1716132 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 61992.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000250 mcu_task_stddev=0.000254 bytes_write=333148 bytes_read=175431 bytes_retransmit=9 bytes_invalid=0 send_seq=13457 receive_seq=13457 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998297  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.04 cputime=1935.055 memavail=1716132 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61993.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000250 mcu_task_stddev=0.000254 bytes_write=335157 bytes_read=176565 bytes_retransmit=9 bytes_invalid=0 send_seq=13539 receive_seq=13539 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998295  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.04 cputime=1935.150 memavail=1715880 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 61994.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000250 mcu_task_stddev=0.000254 bytes_write=337094 bytes_read=177585 bytes_retransmit=9 bytes_invalid=0 send_seq=13614 receive_seq=13614 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998294  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.04 cputime=1935.240 memavail=1715884 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 61995.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000250 mcu_task_stddev=0.000254 bytes_write=339069 bytes_read=178775 bytes_retransmit=9 bytes_invalid=0 send_seq=13702 receive_seq=13702 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998293  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.04 cputime=1935.334 memavail=1716900 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 61996.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000261 mcu_task_stddev=0.000255 bytes_write=341047 bytes_read=179840 bytes_retransmit=9 bytes_invalid=0 send_seq=13779 receive_seq=13778 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998293  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.04 cputime=1935.427 memavail=1716900 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61997.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000261 mcu_task_stddev=0.000255 bytes_write=343104 bytes_read=181089 bytes_retransmit=9 bytes_invalid=0 send_seq=13870 receive_seq=13870 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998291  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.04 cputime=1935.524 memavail=1716920 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61998.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000261 mcu_task_stddev=0.000255 bytes_write=344987 bytes_read=182000 bytes_retransmit=9 bytes_invalid=0 send_seq=13940 receive_seq=13939 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998290  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.04 cputime=1935.612 memavail=1717676 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 61999.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000261 mcu_task_stddev=0.000255 bytes_write=346903 bytes_read=183030 bytes_retransmit=9 bytes_invalid=0 send_seq=14013 receive_seq=14013 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998289  orange_pi: temp=45.8 chamber_heater: target=0 temp=24.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.03 cputime=1935.703 memavail=1717676 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62000.8: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000261 mcu_task_stddev=0.000255 bytes_write=348928 bytes_read=184164 bytes_retransmit=9 bytes_invalid=0 send_seq=14099 receive_seq=14098 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998287  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.03 cputime=1935.796 memavail=1717432 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62001.8: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000247 mcu_task_stddev=0.000252 bytes_write=350878 bytes_read=185212 bytes_retransmit=9 bytes_invalid=0 send_seq=14176 receive_seq=14175 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998287  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.03 cputime=1935.888 memavail=1717220 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62002.8: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000247 mcu_task_stddev=0.000252 bytes_write=352728 bytes_read=186187 bytes_retransmit=9 bytes_invalid=0 send_seq=14246 receive_seq=14246 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998286  orange_pi: temp=46.2 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.03 cputime=1935.975 memavail=1716716 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62003.8: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000247 mcu_task_stddev=0.000252 bytes_write=354739 bytes_read=187298 bytes_retransmit=9 bytes_invalid=0 send_seq=14328 receive_seq=14328 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998285  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.03 cputime=1936.068 memavail=1716992 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 62004.8: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000247 mcu_task_stddev=0.000252 bytes_write=356697 bytes_read=188334 bytes_retransmit=9 bytes_invalid=0 send_seq=14406 receive_seq=14406 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998285  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.03 cputime=1936.161 memavail=1716488 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 62005.8: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000247 mcu_task_stddev=0.000252 bytes_write=358669 bytes_read=189507 bytes_retransmit=9 bytes_invalid=0 send_seq=14492 receive_seq=14491 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998285  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.03 cputime=1936.258 memavail=1716236 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62006.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=360705 bytes_read=190726 bytes_retransmit=9 bytes_invalid=0 send_seq=14580 receive_seq=14580 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998284  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.03 cputime=1936.357 memavail=1715744 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Stats 62007.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=362646 bytes_read=191726 bytes_retransmit=9 bytes_invalid=0 send_seq=14654 receive_seq=14654 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998283  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.03 cputime=1936.446 memavail=1715492 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62008.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=364599 bytes_read=192873 bytes_retransmit=9 bytes_invalid=0 send_seq=14737 receive_seq=14737 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998311  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.03 cputime=1936.541 memavail=1715240 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62009.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=366610 bytes_read=194036 bytes_retransmit=9 bytes_invalid=0 send_seq=14823 receive_seq=14823 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998311  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.03 cputime=1936.637 memavail=1715240 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62010.9: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=368563 bytes_read=195035 bytes_retransmit=9 bytes_invalid=0 send_seq=14898 receive_seq=14897 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998308  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.03 cputime=1936.723 memavail=1715244 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62011.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000253 mcu_task_stddev=0.000250 bytes_write=370485 bytes_read=196046 bytes_retransmit=9 bytes_invalid=0 send_seq=14971 receive_seq=14970 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998325  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.03 cputime=1936.812 memavail=1715244 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62012.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000253 mcu_task_stddev=0.000250 bytes_write=372390 bytes_read=197118 bytes_retransmit=9 bytes_invalid=0 send_seq=15049 receive_seq=15049 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998349  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.03 cputime=1936.902 memavail=1715244 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62013.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000253 mcu_task_stddev=0.000250 bytes_write=374331 bytes_read=198091 bytes_retransmit=9 bytes_invalid=0 send_seq=15121 receive_seq=15121 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998344  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.03 cputime=1936.992 memavail=1714992 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62014.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000253 mcu_task_stddev=0.000250 bytes_write=376255 bytes_read=199064 bytes_retransmit=9 bytes_invalid=0 send_seq=15194 receive_seq=15193 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998340  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.02 cputime=1937.081 memavail=1714740 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62015.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000253 mcu_task_stddev=0.000250 bytes_write=378174 bytes_read=200175 bytes_retransmit=9 bytes_invalid=0 send_seq=15275 receive_seq=15275 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998335  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.02 cputime=1937.173 memavail=1714636 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62016.9: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=380111 bytes_read=201171 bytes_retransmit=9 bytes_invalid=0 send_seq=15347 receive_seq=15347 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998330  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=1937.265 memavail=1715040 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62017.9: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=382228 bytes_read=202479 bytes_retransmit=9 bytes_invalid=0 send_seq=15446 receive_seq=15445 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998327  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.02 cputime=1937.367 memavail=1714788 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62018.9: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=384189 bytes_read=203615 bytes_retransmit=9 bytes_invalid=0 send_seq=15531 receive_seq=15531 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998323  orange_pi: temp=45.7 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.02 cputime=1937.462 memavail=1715556 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 62019.9: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=386243 bytes_read=204861 bytes_retransmit=9 bytes_invalid=0 send_seq=15623 receive_seq=15623 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998321  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.02 cputime=1937.561 memavail=1715580 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 62020.9: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=388306 bytes_read=206057 bytes_retransmit=9 bytes_invalid=0 send_seq=15713 receive_seq=15712 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998318  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.02 cputime=1937.660 memavail=1715860 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62021.9: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000263 mcu_task_stddev=0.000247 bytes_write=390188 bytes_read=207081 bytes_retransmit=9 bytes_invalid=0 send_seq=15786 receive_seq=15786 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998316  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.02 cputime=1937.751 memavail=1716108 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62022.9: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000263 mcu_task_stddev=0.000247 bytes_write=392100 bytes_read=208080 bytes_retransmit=9 bytes_invalid=0 send_seq=15860 receive_seq=15860 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998312  orange_pi: temp=45.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=1937.839 memavail=1716636 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62023.9: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000263 mcu_task_stddev=0.000247 bytes_write=393992 bytes_read=208962 bytes_retransmit=9 bytes_invalid=0 send_seq=15925 receive_seq=15925 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998309  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.02 cputime=1937.926 memavail=1716904 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62024.9: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000263 mcu_task_stddev=0.000247 bytes_write=395908 bytes_read=210008 bytes_retransmit=9 bytes_invalid=0 send_seq=16002 receive_seq=16002 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998305  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=1938.018 memavail=1717428 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 62025.9: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000263 mcu_task_stddev=0.000247 bytes_write=397845 bytes_read=211059 bytes_retransmit=9 bytes_invalid=0 send_seq=16080 receive_seq=16080 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998302  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.0 pwm=0.000 sysload=1.02 cputime=1938.108 memavail=1717960 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62026.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=399747 bytes_read=211989 bytes_retransmit=9 bytes_invalid=0 send_seq=16148 receive_seq=16148 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998299  orange_pi: temp=45.4 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.02 cputime=1938.197 memavail=1717456 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62027.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=401739 bytes_read=213079 bytes_retransmit=9 bytes_invalid=0 send_seq=16229 receive_seq=16229 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998326  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.02 cputime=1938.290 memavail=1717204 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 62028.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=403639 bytes_read=214146 bytes_retransmit=9 bytes_invalid=0 send_seq=16307 receive_seq=16307 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998321  orange_pi: temp=45.1 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.02 cputime=1938.382 memavail=1716952 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62029.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=405606 bytes_read=215205 bytes_retransmit=9 bytes_invalid=0 send_seq=16385 receive_seq=16385 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998316  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=1938.474 memavail=1716952 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62030.9: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=407496 bytes_read=216087 bytes_retransmit=9 bytes_invalid=0 send_seq=16450 receive_seq=16450 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998313  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.02 cputime=1938.560 memavail=1716952 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62031.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000242 mcu_task_stddev=0.000254 bytes_write=409369 bytes_read=217111 bytes_retransmit=9 bytes_invalid=0 send_seq=16524 receive_seq=16524 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998309  orange_pi: temp=45.3 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=24.9 pwm=0.000 sysload=1.02 cputime=1938.651 memavail=1716952 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62032.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000242 mcu_task_stddev=0.000254 bytes_write=411354 bytes_read=218222 bytes_retransmit=9 bytes_invalid=0 send_seq=16606 receive_seq=16606 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998305  orange_pi: temp=45.3 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=1938.744 memavail=1716956 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62033.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000242 mcu_task_stddev=0.000254 bytes_write=413402 bytes_read=219395 bytes_retransmit=9 bytes_invalid=0 send_seq=16694 receive_seq=16694 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998304  orange_pi: temp=45.1 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=1938.840 memavail=1716956 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62034.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000242 mcu_task_stddev=0.000254 bytes_write=415374 bytes_read=220543 bytes_retransmit=9 bytes_invalid=0 send_seq=16778 receive_seq=16777 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998300  orange_pi: temp=45.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.02 cputime=1938.935 memavail=1716724 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62035.9: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000242 mcu_task_stddev=0.000254 bytes_write=417390 bytes_read=221750 bytes_retransmit=9 bytes_invalid=0 send_seq=16867 receive_seq=16867 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998297  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=1939.032 memavail=1716724 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62036.9: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000256 mcu_task_stddev=0.000251 bytes_write=419390 bytes_read=222881 bytes_retransmit=9 bytes_invalid=0 send_seq=16949 receive_seq=16949 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998292  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.02 cputime=1939.130 memavail=1716724 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.1 pwm=0.000
Stats 62037.9: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000256 mcu_task_stddev=0.000251 bytes_write=421404 bytes_read=223989 bytes_retransmit=9 bytes_invalid=0 send_seq=17033 receive_seq=17032 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998290  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=1939.223 memavail=1716724 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62038.9: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000256 mcu_task_stddev=0.000251 bytes_write=423264 bytes_read=224999 bytes_retransmit=9 bytes_invalid=0 send_seq=17105 receive_seq=17105 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998290  orange_pi: temp=45.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=1939.311 memavail=1716472 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62039.9: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000256 mcu_task_stddev=0.000251 bytes_write=425247 bytes_read=226089 bytes_retransmit=9 bytes_invalid=0 send_seq=17186 receive_seq=17186 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998287  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.02 cputime=1939.403 memavail=1716476 print_time=8790.945 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Unknown command:"LED_EFFECT"
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 62581.2: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000242 mcu_task_stddev=0.000263 bytes_write=1487413 bytes_read=812772 bytes_retransmit=9 bytes_invalid=0 send_seq=60414 receive_seq=60414 retransmit_seq=2 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998231  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.26 cputime=1989.902 memavail=1718128 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62582.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000244 mcu_task_stddev=0.000269 bytes_write=1489155 bytes_read=813551 bytes_retransmit=9 bytes_invalid=0 send_seq=60475 receive_seq=60475 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=44 upcoming_bytes=0 freq=71998231  orange_pi: temp=45.9 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.26 cputime=1989.999 memavail=1718652 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62583.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000244 mcu_task_stddev=0.000269 bytes_write=1490914 bytes_read=814259 bytes_retransmit=9 bytes_invalid=0 send_seq=60533 receive_seq=60533 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998230  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.26 cputime=1990.092 memavail=1718672 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62584.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000244 mcu_task_stddev=0.000269 bytes_write=1492726 bytes_read=815054 bytes_retransmit=9 bytes_invalid=0 send_seq=60596 receive_seq=60596 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998232  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.26 cputime=1990.191 memavail=1718672 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 62585.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000244 mcu_task_stddev=0.000269 bytes_write=1494478 bytes_read=815733 bytes_retransmit=9 bytes_invalid=0 send_seq=60651 receive_seq=60650 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=45.7 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.26 cputime=1990.288 memavail=1718180 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62586.2: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000244 mcu_task_stddev=0.000269 bytes_write=1496220 bytes_read=816522 bytes_retransmit=9 bytes_invalid=0 send_seq=60714 receive_seq=60714 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998244  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.23 cputime=1990.385 memavail=1717676 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62587.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000258 mcu_task_stddev=0.000276 bytes_write=1498022 bytes_read=817308 bytes_retransmit=9 bytes_invalid=0 send_seq=60775 receive_seq=60775 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998242  orange_pi: temp=46.3 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.23 cputime=1990.485 memavail=1718232 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62588.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000258 mcu_task_stddev=0.000276 bytes_write=1499743 bytes_read=817919 bytes_retransmit=9 bytes_invalid=0 send_seq=60825 receive_seq=60825 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998241  orange_pi: temp=45.9 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.23 cputime=1990.577 memavail=1717980 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62589.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000258 mcu_task_stddev=0.000276 bytes_write=1501497 bytes_read=818705 bytes_retransmit=9 bytes_invalid=0 send_seq=60889 receive_seq=60889 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=45.9 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.23 cputime=1990.675 memavail=1717728 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62590.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000258 mcu_task_stddev=0.000276 bytes_write=1503267 bytes_read=819422 bytes_retransmit=9 bytes_invalid=0 send_seq=60946 receive_seq=60946 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998239  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.23 cputime=1990.770 memavail=1717728 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62591.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000258 mcu_task_stddev=0.000276 bytes_write=1505072 bytes_read=820197 bytes_retransmit=9 bytes_invalid=0 send_seq=61008 receive_seq=61008 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998239  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.22 cputime=1990.868 memavail=1717728 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62592.2: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000277 bytes_write=1506754 bytes_read=820849 bytes_retransmit=9 bytes_invalid=0 send_seq=61061 receive_seq=61061 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998238  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.22 cputime=1990.961 memavail=1717728 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62593.2: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000277 bytes_write=1508452 bytes_read=821483 bytes_retransmit=9 bytes_invalid=0 send_seq=61111 receive_seq=61111 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998237  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.22 cputime=1991.050 memavail=1717728 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62594.2: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000277 bytes_write=1510306 bytes_read=822341 bytes_retransmit=9 bytes_invalid=0 send_seq=61180 receive_seq=61180 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998237  orange_pi: temp=46.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.22 cputime=1991.150 memavail=1717728 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62595.2: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000277 bytes_write=1512051 bytes_read=823002 bytes_retransmit=9 bytes_invalid=0 send_seq=61235 receive_seq=61235 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998237  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.22 cputime=1991.245 memavail=1717228 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62596.2: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000247 mcu_task_stddev=0.000277 bytes_write=1513772 bytes_read=823766 bytes_retransmit=9 bytes_invalid=0 send_seq=61295 receive_seq=61295 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998237  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.20 cputime=1991.342 memavail=1716976 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62597.2: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000255 mcu_task_stddev=0.000277 bytes_write=1515560 bytes_read=824519 bytes_retransmit=9 bytes_invalid=0 send_seq=61354 receive_seq=61354 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998236  orange_pi: temp=46.3 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.20 cputime=1991.440 memavail=1716976 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62598.2: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000255 mcu_task_stddev=0.000277 bytes_write=1517418 bytes_read=825375 bytes_retransmit=9 bytes_invalid=0 send_seq=61424 receive_seq=61424 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998238  orange_pi: temp=45.5 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.20 cputime=1991.539 memavail=1716976 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62599.2: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000255 mcu_task_stddev=0.000277 bytes_write=1519142 bytes_read=826092 bytes_retransmit=9 bytes_invalid=0 send_seq=61481 receive_seq=61481 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998237  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.20 cputime=1991.635 memavail=1716724 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62600.2: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000255 mcu_task_stddev=0.000277 bytes_write=1520872 bytes_read=826763 bytes_retransmit=9 bytes_invalid=0 send_seq=61535 receive_seq=61535 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998236  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.20 cputime=1991.727 memavail=1716724 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62601.2: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000255 mcu_task_stddev=0.000277 bytes_write=1522684 bytes_read=827536 bytes_retransmit=9 bytes_invalid=0 send_seq=61598 receive_seq=61598 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998235  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.26 cputime=1991.824 memavail=1716472 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62602.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000277 bytes_write=1524471 bytes_read=828322 bytes_retransmit=9 bytes_invalid=0 send_seq=61659 receive_seq=61659 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.26 cputime=1991.922 memavail=1716476 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62603.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000277 bytes_write=1526193 bytes_read=829027 bytes_retransmit=9 bytes_invalid=0 send_seq=61716 receive_seq=61715 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998234  orange_pi: temp=46.1 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.26 cputime=1992.017 memavail=1716224 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62604.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000277 bytes_write=1527967 bytes_read=829766 bytes_retransmit=9 bytes_invalid=0 send_seq=61776 receive_seq=61776 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.26 cputime=1992.111 memavail=1716224 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62605.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000277 bytes_write=1529782 bytes_read=830574 bytes_retransmit=9 bytes_invalid=0 send_seq=61840 receive_seq=61840 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.26 cputime=1992.211 memavail=1716224 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62606.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000277 bytes_write=1531539 bytes_read=831263 bytes_retransmit=9 bytes_invalid=0 send_seq=61897 receive_seq=61896 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=46.2 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.24 cputime=1992.305 memavail=1716224 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62607.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000275 bytes_write=1533321 bytes_read=832118 bytes_retransmit=9 bytes_invalid=0 send_seq=61964 receive_seq=61964 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.24 cputime=1992.405 memavail=1715972 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62608.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000275 bytes_write=1535092 bytes_read=832835 bytes_retransmit=9 bytes_invalid=0 send_seq=62021 receive_seq=62021 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.24 cputime=1992.501 memavail=1715720 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62609.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000275 bytes_write=1536904 bytes_read=833623 bytes_retransmit=9 bytes_invalid=0 send_seq=62084 receive_seq=62084 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.24 cputime=1992.600 memavail=1715616 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62610.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000275 bytes_write=1538761 bytes_read=834557 bytes_retransmit=9 bytes_invalid=0 send_seq=62160 receive_seq=62160 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998233  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.24 cputime=1992.704 memavail=1716248 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Stats 62611.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000258 mcu_task_stddev=0.000275 bytes_write=1540626 bytes_read=835498 bytes_retransmit=9 bytes_invalid=0 send_seq=62233 receive_seq=62233 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.30 cputime=1992.807 memavail=1716252 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62612.2: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000277 mcu_task_stddev=0.000277 bytes_write=1542450 bytes_read=836334 bytes_retransmit=9 bytes_invalid=0 send_seq=62299 receive_seq=62299 retransmit_seq=2 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.30 cputime=1992.907 memavail=1716252 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62613.2: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000277 mcu_task_stddev=0.000277 bytes_write=1544334 bytes_read=837255 bytes_retransmit=9 bytes_invalid=0 send_seq=62374 receive_seq=62374 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.30 cputime=1993.007 memavail=1716272 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62614.2: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000277 mcu_task_stddev=0.000277 bytes_write=1546031 bytes_read=837903 bytes_retransmit=9 bytes_invalid=0 send_seq=62426 receive_seq=62426 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998233  orange_pi: temp=46.2 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.30 cputime=1993.101 memavail=1716524 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62615.2: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000277 mcu_task_stddev=0.000277 bytes_write=1547794 bytes_read=838628 bytes_retransmit=9 bytes_invalid=0 send_seq=62485 receive_seq=62485 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.30 cputime=1993.195 memavail=1717048 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62616.2: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000277 mcu_task_stddev=0.000277 bytes_write=1549589 bytes_read=839370 bytes_retransmit=9 bytes_invalid=0 send_seq=62547 receive_seq=62547 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998233  orange_pi: temp=46.2 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.28 cputime=1993.294 memavail=1717320 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62617.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000261 mcu_task_stddev=0.000281 bytes_write=1551330 bytes_read=840039 bytes_retransmit=9 bytes_invalid=0 send_seq=62600 receive_seq=62599 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.28 cputime=1993.388 memavail=1718096 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62618.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000261 mcu_task_stddev=0.000281 bytes_write=1553120 bytes_read=840905 bytes_retransmit=9 bytes_invalid=0 send_seq=62668 receive_seq=62668 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.28 cputime=1993.489 memavail=1718372 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62619.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000261 mcu_task_stddev=0.000281 bytes_write=1554917 bytes_read=841644 bytes_retransmit=9 bytes_invalid=0 send_seq=62729 receive_seq=62729 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.28 cputime=1993.586 memavail=1718120 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62620.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000261 mcu_task_stddev=0.000281 bytes_write=1556742 bytes_read=842478 bytes_retransmit=9 bytes_invalid=0 send_seq=62795 receive_seq=62795 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998234  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.28 cputime=1993.684 memavail=1717868 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62621.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000261 mcu_task_stddev=0.000281 bytes_write=1558622 bytes_read=843375 bytes_retransmit=9 bytes_invalid=0 send_seq=62868 receive_seq=62867 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=46.6 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.26 cputime=1993.786 memavail=1717616 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62622.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000261 mcu_task_stddev=0.000281 bytes_write=1560282 bytes_read=844005 bytes_retransmit=9 bytes_invalid=0 send_seq=62919 receive_seq=62919 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998235  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.26 cputime=1993.879 memavail=1717364 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62623.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000273 mcu_task_stddev=0.000278 bytes_write=1562080 bytes_read=844817 bytes_retransmit=9 bytes_invalid=0 send_seq=62982 receive_seq=62982 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.26 cputime=1993.978 memavail=1717364 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62624.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000273 mcu_task_stddev=0.000278 bytes_write=1563856 bytes_read=845532 bytes_retransmit=9 bytes_invalid=0 send_seq=63040 receive_seq=63040 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998235  orange_pi: temp=46.2 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.26 cputime=1994.074 memavail=1717364 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62625.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000273 mcu_task_stddev=0.000278 bytes_write=1565620 bytes_read=846292 bytes_retransmit=9 bytes_invalid=0 send_seq=63103 receive_seq=63102 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998237  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.26 cputime=1994.170 memavail=1717128 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62626.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000273 mcu_task_stddev=0.000278 bytes_write=1567358 bytes_read=847009 bytes_retransmit=9 bytes_invalid=0 send_seq=63159 receive_seq=63159 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998237  orange_pi: temp=46.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=1994.262 memavail=1717128 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62627.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000273 mcu_task_stddev=0.000278 bytes_write=1569129 bytes_read=847724 bytes_retransmit=9 bytes_invalid=0 send_seq=63217 receive_seq=63217 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998238  orange_pi: temp=46.6 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.23 cputime=1994.358 memavail=1717128 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62628.2: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000254 mcu_task_stddev=0.000278 bytes_write=1570959 bytes_read=848545 bytes_retransmit=9 bytes_invalid=0 send_seq=63283 receive_seq=63283 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=45.6 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.23 cputime=1994.456 memavail=1717128 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62629.2: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000254 mcu_task_stddev=0.000278 bytes_write=1572668 bytes_read=849257 bytes_retransmit=9 bytes_invalid=0 send_seq=63339 receive_seq=63339 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.23 cputime=1994.550 memavail=1717128 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62630.2: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000254 mcu_task_stddev=0.000278 bytes_write=1574420 bytes_read=849946 bytes_retransmit=9 bytes_invalid=0 send_seq=63395 receive_seq=63395 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998239  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.23 cputime=1994.644 memavail=1717128 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62631.2: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000254 mcu_task_stddev=0.000278 bytes_write=1576239 bytes_read=850732 bytes_retransmit=9 bytes_invalid=0 send_seq=63459 receive_seq=63459 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998240  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.22 cputime=1994.743 memavail=1717128 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62632.2: gcodein=0  mcu: mcu_awake=0.103 mcu_task_avg=0.000254 mcu_task_stddev=0.000278 bytes_write=1578009 bytes_read=851527 bytes_retransmit=9 bytes_invalid=0 send_seq=63522 receive_seq=63522 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998240  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.22 cputime=1994.844 memavail=1717136 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62633.2: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000278 bytes_write=1579845 bytes_read=852436 bytes_retransmit=9 bytes_invalid=0 send_seq=63593 receive_seq=63593 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998239  orange_pi: temp=46.4 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.22 cputime=1994.944 memavail=1716888 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62634.2: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000278 bytes_write=1581592 bytes_read=853092 bytes_retransmit=9 bytes_invalid=0 send_seq=63647 receive_seq=63647 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=46.4 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.22 cputime=1995.038 memavail=1717648 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62635.2: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000278 bytes_write=1583358 bytes_read=853809 bytes_retransmit=9 bytes_invalid=0 send_seq=63704 receive_seq=63704 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998239  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.22 cputime=1995.132 memavail=1718172 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62636.2: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000278 bytes_write=1585138 bytes_read=854615 bytes_retransmit=9 bytes_invalid=0 send_seq=63769 receive_seq=63769 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998240  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.20 cputime=1995.232 memavail=1717436 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 62637.2: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000262 mcu_task_stddev=0.000278 bytes_write=1586878 bytes_read=855305 bytes_retransmit=9 bytes_invalid=0 send_seq=63825 receive_seq=63825 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=46.6 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.20 cputime=1995.328 memavail=1717212 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.3 pwm=0.000
Stats 62638.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000257 mcu_task_stddev=0.000278 bytes_write=1588628 bytes_read=856000 bytes_retransmit=9 bytes_invalid=0 send_seq=63879 receive_seq=63879 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=46.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.20 cputime=1995.420 memavail=1717464 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.2 pwm=0.000
Stats 62639.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000257 mcu_task_stddev=0.000278 bytes_write=1590364 bytes_read=856702 bytes_retransmit=9 bytes_invalid=0 send_seq=63936 receive_seq=63936 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998242  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.20 cputime=1995.515 memavail=1717464 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Stats 62640.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000257 mcu_task_stddev=0.000278 bytes_write=1592158 bytes_read=857504 bytes_retransmit=9 bytes_invalid=0 send_seq=64000 receive_seq=64000 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998243  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.20 cputime=1995.612 memavail=1717468 print_time=9391.882 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.4 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 71066.1: gcodein=0  mcu: mcu_awake=0.124 mcu_task_avg=0.000279 mcu_task_stddev=0.000277 bytes_write=16529330 bytes_read=7202170 bytes_retransmit=9 bytes_invalid=0 send_seq=573251 receive_seq=573250 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998295  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.02 cputime=2803.465 memavail=1717400 print_time=17877.341 buffer_time=0.726 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 281473462410960: Disconnected
Restarting printer
Start printer at Mon Dec 30 17:18:12 2024 (1735568292.4 71068.0)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel sb_leds]
pin = PA8
chain_count = 16
color_order = RGB
initial_red = 1.0
initial_green = 0.0
initial_blue = 1.0

[led_effect sb_logo_busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:sb_leds
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:sb_leds
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:sb_leds (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473466147664: New connection
webhooks client 281473466147664: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 71072.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000057 bytes_write=3274 bytes_read=6191 bytes_retransmit=0 bytes_invalid=0 send_seq=230 receive_seq=227 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2001 upcoming_bytes=172 freq=71996523  orange_pi: temp=47.0 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.02 cputime=2806.731 memavail=1716084 print_time=5.504 buffer_time=0.200 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473466147664
webhooks: registering remote method 'reboot_machine' for connection id: 281473466147664
webhooks: registering remote method 'pause_job_queue' for connection id: 281473466147664
webhooks: registering remote method 'start_job_queue' for connection id: 281473466147664
Stats 71073.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000057 bytes_write=7331 bytes_read=6950 bytes_retransmit=0 bytes_invalid=0 send_seq=324 receive_seq=324 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71996864  orange_pi: temp=46.3 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.02 cputime=2806.858 memavail=1715188 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71074.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000057 bytes_write=9179 bytes_read=7741 bytes_retransmit=0 bytes_invalid=0 send_seq=390 receive_seq=389 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997903  orange_pi: temp=46.9 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.02 cputime=2806.986 memavail=1715216 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71075.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000057 bytes_write=11188 bytes_read=8931 bytes_retransmit=0 bytes_invalid=0 send_seq=484 receive_seq=483 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997854  orange_pi: temp=46.4 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.02 cputime=2807.091 memavail=1715224 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71076.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000057 bytes_write=13024 bytes_read=9797 bytes_retransmit=0 bytes_invalid=0 send_seq=552 receive_seq=552 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997890  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.02 cputime=2807.172 memavail=1716272 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71077.2: gcodein=0  mcu: mcu_awake=0.160 mcu_task_avg=0.000255 mcu_task_stddev=0.000302 bytes_write=14863 bytes_read=10644 bytes_retransmit=0 bytes_invalid=0 send_seq=620 receive_seq=620 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997934  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.02 cputime=2807.254 memavail=1716024 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71078.2: gcodein=0  mcu: mcu_awake=0.160 mcu_task_avg=0.000255 mcu_task_stddev=0.000302 bytes_write=16753 bytes_read=11647 bytes_retransmit=0 bytes_invalid=0 send_seq=699 receive_seq=699 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997987  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.02 cputime=2807.341 memavail=1715520 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71079.2: gcodein=0  mcu: mcu_awake=0.160 mcu_task_avg=0.000255 mcu_task_stddev=0.000302 bytes_write=18659 bytes_read=12617 bytes_retransmit=0 bytes_invalid=0 send_seq=776 receive_seq=776 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998038  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.02 cputime=2807.427 memavail=1715268 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71080.2: gcodein=0  mcu: mcu_awake=0.160 mcu_task_avg=0.000255 mcu_task_stddev=0.000302 bytes_write=20534 bytes_read=13512 bytes_retransmit=0 bytes_invalid=0 send_seq=849 receive_seq=849 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998061  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.02 cputime=2807.510 memavail=1715016 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71081.2: gcodein=0  mcu: mcu_awake=0.160 mcu_task_avg=0.000255 mcu_task_stddev=0.000302 bytes_write=22378 bytes_read=14450 bytes_retransmit=0 bytes_invalid=0 send_seq=923 receive_seq=923 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998080  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.02 cputime=2807.595 memavail=1715288 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71082.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000281 mcu_task_stddev=0.000257 bytes_write=24314 bytes_read=15484 bytes_retransmit=0 bytes_invalid=0 send_seq=1003 receive_seq=1003 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998123  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2807.681 memavail=1715056 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71083.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000281 mcu_task_stddev=0.000257 bytes_write=26211 bytes_read=16392 bytes_retransmit=0 bytes_invalid=0 send_seq=1077 receive_seq=1077 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998156  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2807.763 memavail=1715056 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71084.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000281 mcu_task_stddev=0.000257 bytes_write=28078 bytes_read=17283 bytes_retransmit=0 bytes_invalid=0 send_seq=1148 receive_seq=1148 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998156  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.01 cputime=2807.846 memavail=1715060 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71085.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000281 mcu_task_stddev=0.000257 bytes_write=29939 bytes_read=18235 bytes_retransmit=0 bytes_invalid=0 send_seq=1223 receive_seq=1223 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998174  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2807.932 memavail=1714556 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71086.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000281 mcu_task_stddev=0.000257 bytes_write=31922 bytes_read=19286 bytes_retransmit=0 bytes_invalid=0 send_seq=1308 receive_seq=1308 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998179  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.01 cputime=2808.046 memavail=1714556 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71087.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000279 mcu_task_stddev=0.000256 bytes_write=33803 bytes_read=20220 bytes_retransmit=0 bytes_invalid=0 send_seq=1381 receive_seq=1381 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998184  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2808.131 memavail=1714556 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71088.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000279 mcu_task_stddev=0.000256 bytes_write=35657 bytes_read=21109 bytes_retransmit=0 bytes_invalid=0 send_seq=1453 receive_seq=1453 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998213  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.01 cputime=2808.213 memavail=1714316 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71089.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000279 mcu_task_stddev=0.000256 bytes_write=37604 bytes_read=22116 bytes_retransmit=0 bytes_invalid=0 send_seq=1534 receive_seq=1534 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998216  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2808.297 memavail=1714316 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71090.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000279 mcu_task_stddev=0.000256 bytes_write=39514 bytes_read=23077 bytes_retransmit=0 bytes_invalid=0 send_seq=1611 receive_seq=1611 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998216  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2808.382 memavail=1714828 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71091.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000279 mcu_task_stddev=0.000256 bytes_write=41472 bytes_read=24109 bytes_retransmit=0 bytes_invalid=0 send_seq=1695 receive_seq=1694 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998229  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.01 cputime=2808.469 memavail=1715332 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71092.2: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=43342 bytes_read=25094 bytes_retransmit=0 bytes_invalid=0 send_seq=1772 receive_seq=1772 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998230  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2808.553 memavail=1715588 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71093.2: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=45198 bytes_read=25967 bytes_retransmit=0 bytes_invalid=0 send_seq=1841 receive_seq=1841 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998229  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2808.635 memavail=1715588 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71094.2: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=47165 bytes_read=27054 bytes_retransmit=0 bytes_invalid=0 send_seq=1927 receive_seq=1927 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998243  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2808.727 memavail=1715588 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71095.3: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=49086 bytes_read=28079 bytes_retransmit=0 bytes_invalid=0 send_seq=2010 receive_seq=2010 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998240  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2808.816 memavail=1715588 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71096.3: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=50940 bytes_read=28952 bytes_retransmit=0 bytes_invalid=0 send_seq=2079 receive_seq=2079 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998239  orange_pi: temp=45.0 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2808.897 memavail=1715588 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71097.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000275 mcu_task_stddev=0.000257 bytes_write=52758 bytes_read=29775 bytes_retransmit=0 bytes_invalid=0 send_seq=2144 receive_seq=2144 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998238  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.01 cputime=2808.977 memavail=1715588 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71098.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000275 mcu_task_stddev=0.000257 bytes_write=54672 bytes_read=30766 bytes_retransmit=0 bytes_invalid=0 send_seq=2225 receive_seq=2225 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998401  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.01 cputime=2809.068 memavail=1715336 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71099.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000275 mcu_task_stddev=0.000257 bytes_write=56546 bytes_read=31668 bytes_retransmit=0 bytes_invalid=0 send_seq=2295 receive_seq=2295 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998380  orange_pi: temp=44.8 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2809.151 memavail=1715092 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71100.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000275 mcu_task_stddev=0.000257 bytes_write=58411 bytes_read=32563 bytes_retransmit=0 bytes_invalid=0 send_seq=2366 receive_seq=2366 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998356  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2809.236 memavail=1714628 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71101.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000275 mcu_task_stddev=0.000257 bytes_write=60209 bytes_read=33393 bytes_retransmit=0 bytes_invalid=0 send_seq=2434 receive_seq=2434 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998344  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.01 cputime=2809.317 memavail=1714884 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71102.3: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000264 mcu_task_stddev=0.000257 bytes_write=62089 bytes_read=34343 bytes_retransmit=0 bytes_invalid=0 send_seq=2507 receive_seq=2507 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998330  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.01 cputime=2809.400 memavail=1714884 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71103.3: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000264 mcu_task_stddev=0.000257 bytes_write=63955 bytes_read=35214 bytes_retransmit=0 bytes_invalid=0 send_seq=2577 receive_seq=2577 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998325  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.01 cputime=2809.482 memavail=1715136 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71104.3: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000264 mcu_task_stddev=0.000257 bytes_write=65837 bytes_read=36179 bytes_retransmit=0 bytes_invalid=0 send_seq=2656 receive_seq=2656 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998372  orange_pi: temp=45.1 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2809.571 memavail=1715388 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71105.3: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000264 mcu_task_stddev=0.000257 bytes_write=67799 bytes_read=37281 bytes_retransmit=0 bytes_invalid=0 send_seq=2742 receive_seq=2742 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998356  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2809.660 memavail=1714896 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71106.3: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000264 mcu_task_stddev=0.000257 bytes_write=69690 bytes_read=38165 bytes_retransmit=0 bytes_invalid=0 send_seq=2813 receive_seq=2813 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998344  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.01 cputime=2809.744 memavail=1715668 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71107.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=71530 bytes_read=38999 bytes_retransmit=0 bytes_invalid=0 send_seq=2881 receive_seq=2880 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998336  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.01 cputime=2809.824 memavail=1715672 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71108.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=73444 bytes_read=40069 bytes_retransmit=0 bytes_invalid=0 send_seq=2966 receive_seq=2966 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998325  orange_pi: temp=45.1 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2809.909 memavail=1715672 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71109.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=75402 bytes_read=41083 bytes_retransmit=0 bytes_invalid=0 send_seq=3047 receive_seq=3047 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998316  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.01 cputime=2809.997 memavail=1715676 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71110.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=77318 bytes_read=42030 bytes_retransmit=0 bytes_invalid=0 send_seq=3125 receive_seq=3124 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998308  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2810.087 memavail=1716500 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71111.3: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=79156 bytes_read=42952 bytes_retransmit=0 bytes_invalid=0 send_seq=3198 receive_seq=3198 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998303  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.01 cputime=2810.170 memavail=1716248 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71112.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000254 bytes_write=81075 bytes_read=43965 bytes_retransmit=0 bytes_invalid=0 send_seq=3277 receive_seq=3277 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998303  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2810.254 memavail=1716248 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71113.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000254 bytes_write=83012 bytes_read=44922 bytes_retransmit=0 bytes_invalid=0 send_seq=3356 receive_seq=3356 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998344  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2810.338 memavail=1716752 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71114.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000254 bytes_write=84830 bytes_read=45730 bytes_retransmit=0 bytes_invalid=0 send_seq=3421 receive_seq=3420 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998335  orange_pi: temp=45.0 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2810.418 memavail=1716756 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71115.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000254 bytes_write=86683 bytes_read=46684 bytes_retransmit=0 bytes_invalid=0 send_seq=3497 receive_seq=3497 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998334  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2810.500 memavail=1716136 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71116.3: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000254 bytes_write=88613 bytes_read=47639 bytes_retransmit=0 bytes_invalid=0 send_seq=3574 receive_seq=3574 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998328  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2810.586 memavail=1716540 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71117.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=90492 bytes_read=48589 bytes_retransmit=0 bytes_invalid=0 send_seq=3647 receive_seq=3647 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998319  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=23.8 pwm=0.000 sysload=1.01 cputime=2810.670 memavail=1716300 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71118.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=92412 bytes_read=49673 bytes_retransmit=0 bytes_invalid=0 send_seq=3734 receive_seq=3734 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998312  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.01 cputime=2810.758 memavail=1716056 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71119.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=94306 bytes_read=50563 bytes_retransmit=0 bytes_invalid=0 send_seq=3806 receive_seq=3806 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998307  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2810.841 memavail=1716056 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71120.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=96169 bytes_read=51449 bytes_retransmit=0 bytes_invalid=0 send_seq=3876 receive_seq=3876 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998300  orange_pi: temp=45.6 chamber_heater: target=0 temp=24.9 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2810.924 memavail=1715548 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71121.3: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=98141 bytes_read=52528 bytes_retransmit=0 bytes_invalid=0 send_seq=3963 receive_seq=3962 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998295  orange_pi: temp=46.4 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.01 cputime=2811.010 memavail=1715300 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71122.3: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=99934 bytes_read=53391 bytes_retransmit=0 bytes_invalid=0 send_seq=4030 receive_seq=4030 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998293  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.09 cputime=2811.090 memavail=1714800 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71123.3: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=101885 bytes_read=54386 bytes_retransmit=0 bytes_invalid=0 send_seq=4109 receive_seq=4109 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998288  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.09 cputime=2811.173 memavail=1715292 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Neopixel update did not succeed
Stats 71124.3: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=103745 bytes_read=55270 bytes_retransmit=0 bytes_invalid=0 send_seq=4180 receive_seq=4180 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998284  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.09 cputime=2811.258 memavail=1714820 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71125.3: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=105641 bytes_read=56311 bytes_retransmit=0 bytes_invalid=0 send_seq=4263 receive_seq=4263 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998283  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.09 cputime=2811.344 memavail=1714840 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71126.3: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=107508 bytes_read=57140 bytes_retransmit=0 bytes_invalid=0 send_seq=4330 receive_seq=4330 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998282  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.09 cputime=2811.426 memavail=1715092 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71127.3: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=109316 bytes_read=57925 bytes_retransmit=0 bytes_invalid=0 send_seq=4393 receive_seq=4393 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998280  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.08 cputime=2811.506 memavail=1715616 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71128.3: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=111091 bytes_read=58740 bytes_retransmit=0 bytes_invalid=0 send_seq=4460 receive_seq=4460 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998281  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.08 cputime=2811.587 memavail=1715364 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71129.3: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=112964 bytes_read=59587 bytes_retransmit=0 bytes_invalid=0 send_seq=4529 receive_seq=4529 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998339  orange_pi: temp=44.1 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.08 cputime=2811.670 memavail=1715364 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71130.3: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=114802 bytes_read=60406 bytes_retransmit=0 bytes_invalid=0 send_seq=4595 receive_seq=4595 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998332  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.08 cputime=2811.751 memavail=1714640 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71131.3: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=116621 bytes_read=61275 bytes_retransmit=0 bytes_invalid=0 send_seq=4666 receive_seq=4666 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998325  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.08 cputime=2811.833 memavail=1714400 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71132.3: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000275 mcu_task_stddev=0.000260 bytes_write=118627 bytes_read=62480 bytes_retransmit=0 bytes_invalid=0 send_seq=4758 receive_seq=4758 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998320  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.07 cputime=2811.925 memavail=1714400 print_time=5.504 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 71251.3: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000280 mcu_task_stddev=0.000256 bytes_write=344785 bytes_read=175861 bytes_retransmit=0 bytes_invalid=0 send_seq=13780 receive_seq=13779 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998271  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=23.7 pwm=0.000 sysload=1.07 cputime=2822.121 memavail=1716424 print_time=184.606 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.2 pwm=0.000
Stats 71252.3: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000280 mcu_task_stddev=0.000256 bytes_write=346980 bytes_read=177098 bytes_retransmit=0 bytes_invalid=0 send_seq=13873 receive_seq=13873 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998270  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.06 cputime=2822.220 memavail=1716676 print_time=185.606 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71253.3: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000218 mcu_task_stddev=0.000240 bytes_write=349265 bytes_read=178371 bytes_retransmit=0 bytes_invalid=0 send_seq=13971 receive_seq=13971 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998272  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.06 cputime=2822.324 memavail=1717228 print_time=186.606 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71254.4: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000218 mcu_task_stddev=0.000240 bytes_write=351601 bytes_read=179779 bytes_retransmit=0 bytes_invalid=0 send_seq=14077 receive_seq=14077 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998270  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.06 cputime=2822.427 memavail=1717752 print_time=187.606 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71255.4: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000218 mcu_task_stddev=0.000240 bytes_write=354091 bytes_read=181036 bytes_retransmit=0 bytes_invalid=0 send_seq=14177 receive_seq=14177 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998270  orange_pi: temp=45.3 chamber_heater: target=0 temp=24.8 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.06 cputime=2822.525 memavail=1718784 print_time=188.622 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Neopixel update did not succeed
Stats 71256.4: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000218 mcu_task_stddev=0.000240 bytes_write=356894 bytes_read=182842 bytes_retransmit=0 bytes_invalid=0 send_seq=14301 receive_seq=14301 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998270  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.06 cputime=2822.668 memavail=1719056 print_time=189.607 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Neopixel update did not succeed
Stats 71257.4: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000218 mcu_task_stddev=0.000240 bytes_write=359168 bytes_read=184045 bytes_retransmit=0 bytes_invalid=0 send_seq=14395 receive_seq=14394 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998269  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.06 cputime=2822.767 memavail=1719580 print_time=190.607 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71258.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000162 mcu_task_stddev=0.000225 bytes_write=361584 bytes_read=185404 bytes_retransmit=0 bytes_invalid=0 send_seq=14492 receive_seq=14492 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.06 cputime=2822.875 memavail=1719852 print_time=191.744 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71259.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000162 mcu_task_stddev=0.000225 bytes_write=364337 bytes_read=186704 bytes_retransmit=0 bytes_invalid=0 send_seq=14594 receive_seq=14593 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998269  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.06 cputime=2822.990 memavail=1719880 print_time=196.467 buffer_time=4.051 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71260.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000162 mcu_task_stddev=0.000225 bytes_write=366243 bytes_read=187650 bytes_retransmit=0 bytes_invalid=0 send_seq=14663 receive_seq=14663 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=26 freq=71998270  orange_pi: temp=45.4 chamber_heater: target=0 temp=24.7 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.06 cputime=2823.083 memavail=1720448 print_time=196.467 buffer_time=3.050 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71261.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000162 mcu_task_stddev=0.000225 bytes_write=368190 bytes_read=188707 bytes_retransmit=0 bytes_invalid=0 send_seq=14739 receive_seq=14739 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998270  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.06 cputime=2823.176 memavail=1720724 print_time=196.467 buffer_time=2.050 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71262.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000162 mcu_task_stddev=0.000225 bytes_write=370152 bytes_read=189696 bytes_retransmit=0 bytes_invalid=0 send_seq=14815 receive_seq=14814 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998270  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=23.6 pwm=0.000 sysload=1.22 cputime=2823.268 memavail=1720220 print_time=196.467 buffer_time=1.049 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71263.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000208 mcu_task_stddev=0.000246 bytes_write=372008 bytes_read=190680 bytes_retransmit=0 bytes_invalid=0 send_seq=14885 receive_seq=14885 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=26 freq=71998270  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.22 cputime=2823.360 memavail=1720744 print_time=196.467 buffer_time=0.049 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71264.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000208 mcu_task_stddev=0.000246 bytes_write=374016 bytes_read=191694 bytes_retransmit=0 bytes_invalid=0 send_seq=14957 receive_seq=14957 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998270  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.22 cputime=2823.448 memavail=1720496 print_time=198.434 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71265.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000208 mcu_task_stddev=0.000246 bytes_write=376088 bytes_read=192605 bytes_retransmit=0 bytes_invalid=0 send_seq=15028 receive_seq=15028 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998269  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.22 cputime=2823.537 memavail=1720544 print_time=198.634 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 71266.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000208 mcu_task_stddev=0.000246 bytes_write=378868 bytes_read=194194 bytes_retransmit=0 bytes_invalid=0 send_seq=15150 receive_seq=15150 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=36 freq=71998269  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.22 cputime=2823.660 memavail=1720544 print_time=201.434 buffer_time=2.014 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71267.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000208 mcu_task_stddev=0.000246 bytes_write=380908 bytes_read=195375 bytes_retransmit=0 bytes_invalid=0 send_seq=15238 receive_seq=15238 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998269  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.28 cputime=2823.756 memavail=1720544 print_time=201.434 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.1 pwm=0.000
Stats 71268.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000212 mcu_task_stddev=0.000246 bytes_write=383062 bytes_read=196488 bytes_retransmit=0 bytes_invalid=0 send_seq=15323 receive_seq=15322 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998269  orange_pi: temp=45.0 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.28 cputime=2823.851 memavail=1720292 print_time=201.634 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71269.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000212 mcu_task_stddev=0.000246 bytes_write=385470 bytes_read=197970 bytes_retransmit=0 bytes_invalid=0 send_seq=15434 receive_seq=15433 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998268  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.0 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.28 cputime=2823.960 memavail=1721068 print_time=203.364 buffer_time=0.942 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71270.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000212 mcu_task_stddev=0.000246 bytes_write=387609 bytes_read=199012 bytes_retransmit=0 bytes_invalid=0 send_seq=15514 receive_seq=15514 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.4 chamber_heater: target=0 temp=24.9 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.28 cputime=2824.056 memavail=1721388 print_time=203.950 buffer_time=0.527 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71271.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000212 mcu_task_stddev=0.000246 bytes_write=389790 bytes_read=200282 bytes_retransmit=0 bytes_invalid=0 send_seq=15610 receive_seq=15610 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998267  orange_pi: temp=45.2 chamber_heater: target=0 temp=24.7 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.28 cputime=2824.158 memavail=1720688 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71272.4: gcodein=0  mcu: mcu_awake=0.123 mcu_task_avg=0.000212 mcu_task_stddev=0.000246 bytes_write=391755 bytes_read=201267 bytes_retransmit=0 bytes_invalid=0 send_seq=15683 receive_seq=15683 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.0 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=23.6 pwm=0.000 sysload=1.34 cputime=2824.248 memavail=1720688 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71273.4: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000219 mcu_task_stddev=0.000245 bytes_write=393660 bytes_read=202335 bytes_retransmit=0 bytes_invalid=0 send_seq=15761 receive_seq=15761 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.34 cputime=2824.338 memavail=1720940 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71274.4: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000219 mcu_task_stddev=0.000245 bytes_write=395663 bytes_read=203410 bytes_retransmit=0 bytes_invalid=0 send_seq=15842 receive_seq=15842 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.2 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=23.8 pwm=0.000 sysload=1.34 cputime=2824.434 memavail=1720940 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71275.4: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000219 mcu_task_stddev=0.000245 bytes_write=397697 bytes_read=204583 bytes_retransmit=0 bytes_invalid=0 send_seq=15927 receive_seq=15927 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=23.3 pwm=0.000 sysload=1.34 cputime=2824.531 memavail=1720960 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71276.4: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000219 mcu_task_stddev=0.000245 bytes_write=399634 bytes_read=205558 bytes_retransmit=0 bytes_invalid=0 send_seq=16002 receive_seq=16001 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.34 cputime=2824.622 memavail=1720960 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71277.4: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000219 mcu_task_stddev=0.000245 bytes_write=401525 bytes_read=206581 bytes_retransmit=0 bytes_invalid=0 send_seq=16078 receive_seq=16078 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.31 cputime=2824.713 memavail=1720484 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71278.4: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000245 mcu_task_stddev=0.000252 bytes_write=403580 bytes_read=207781 bytes_retransmit=0 bytes_invalid=0 send_seq=16165 receive_seq=16165 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998269  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.31 cputime=2824.812 memavail=1720488 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71279.4: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000245 mcu_task_stddev=0.000252 bytes_write=405514 bytes_read=208751 bytes_retransmit=0 bytes_invalid=0 send_seq=16239 receive_seq=16238 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=23.7 pwm=0.000 sysload=1.31 cputime=2824.902 memavail=1720236 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71280.4: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000245 mcu_task_stddev=0.000252 bytes_write=407431 bytes_read=209818 bytes_retransmit=0 bytes_invalid=0 send_seq=16319 receive_seq=16319 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998268  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=23.8 pwm=0.000 sysload=1.31 cputime=2824.997 memavail=1720788 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.1 pwm=0.000
Stats 71281.4: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000245 mcu_task_stddev=0.000252 bytes_write=409401 bytes_read=210863 bytes_retransmit=0 bytes_invalid=0 send_seq=16396 receive_seq=16396 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998269  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.31 cputime=2825.089 memavail=1720788 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71282.4: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000245 mcu_task_stddev=0.000252 bytes_write=411285 bytes_read=211766 bytes_retransmit=0 bytes_invalid=0 send_seq=16462 receive_seq=16462 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998270  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.28 cputime=2825.175 memavail=1721544 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71283.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000253 bytes_write=413180 bytes_read=212822 bytes_retransmit=0 bytes_invalid=0 send_seq=16540 receive_seq=16540 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998271  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.28 cputime=2825.269 memavail=1721068 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71284.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000253 bytes_write=415180 bytes_read=213948 bytes_retransmit=0 bytes_invalid=0 send_seq=16622 receive_seq=16622 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998271  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.28 cputime=2825.362 memavail=1720816 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71285.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000253 bytes_write=417176 bytes_read=215017 bytes_retransmit=0 bytes_invalid=0 send_seq=16702 receive_seq=16702 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998270  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.28 cputime=2825.457 memavail=1720472 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71286.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000253 bytes_write=419069 bytes_read=216035 bytes_retransmit=0 bytes_invalid=0 send_seq=16778 receive_seq=16778 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998270  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=23.8 pwm=0.000 sysload=1.28 cputime=2825.548 memavail=1721128 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71287.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000253 bytes_write=421030 bytes_read=217101 bytes_retransmit=0 bytes_invalid=0 send_seq=16856 receive_seq=16856 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998270  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.26 cputime=2825.640 memavail=1721892 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71288.4: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000252 mcu_task_stddev=0.000255 bytes_write=423013 bytes_read=218148 bytes_retransmit=0 bytes_invalid=0 send_seq=16933 receive_seq=16933 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998298  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.26 cputime=2825.734 memavail=1722680 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71289.4: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000252 mcu_task_stddev=0.000255 bytes_write=425088 bytes_read=219457 bytes_retransmit=0 bytes_invalid=0 send_seq=17032 receive_seq=17032 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998299  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=23.8 pwm=0.000 sysload=1.26 cputime=2825.836 memavail=1722456 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71290.4: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000252 mcu_task_stddev=0.000255 bytes_write=426927 bytes_read=220341 bytes_retransmit=0 bytes_invalid=0 send_seq=17096 receive_seq=17096 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998298  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.26 cputime=2825.921 memavail=1722256 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71291.4: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000252 mcu_task_stddev=0.000255 bytes_write=428911 bytes_read=221424 bytes_retransmit=0 bytes_invalid=0 send_seq=17174 receive_seq=17174 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998297  orange_pi: temp=46.1 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.26 cputime=2826.017 memavail=1722792 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71292.4: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000252 mcu_task_stddev=0.000255 bytes_write=430890 bytes_read=222559 bytes_retransmit=0 bytes_invalid=0 send_seq=17259 receive_seq=17259 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998295  orange_pi: temp=46.6 chamber_heater: target=0 temp=24.7 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.32 cputime=2826.113 memavail=1722788 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71293.4: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000260 mcu_task_stddev=0.000253 bytes_write=432885 bytes_read=223733 bytes_retransmit=0 bytes_invalid=0 send_seq=17344 receive_seq=17344 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998295  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=23.7 pwm=0.000 sysload=1.32 cputime=2826.211 memavail=1723560 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71294.4: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000260 mcu_task_stddev=0.000253 bytes_write=434749 bytes_read=224597 bytes_retransmit=0 bytes_invalid=0 send_seq=17407 receive_seq=17407 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998294  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.32 cputime=2826.298 memavail=1723580 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71295.4: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000260 mcu_task_stddev=0.000253 bytes_write=436658 bytes_read=225500 bytes_retransmit=0 bytes_invalid=0 send_seq=17476 receive_seq=17476 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998292  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.32 cputime=2826.385 memavail=1723624 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.2 pwm=0.000
Stats 71296.4: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000260 mcu_task_stddev=0.000253 bytes_write=438635 bytes_read=226657 bytes_retransmit=0 bytes_invalid=0 send_seq=17561 receive_seq=17561 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998290  orange_pi: temp=46.1 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.32 cputime=2826.480 memavail=1723892 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71297.4: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000260 mcu_task_stddev=0.000253 bytes_write=440665 bytes_read=227812 bytes_retransmit=0 bytes_invalid=0 send_seq=17647 receive_seq=17647 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998288  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.29 cputime=2826.576 memavail=1723912 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71298.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000245 mcu_task_stddev=0.000256 bytes_write=442652 bytes_read=228857 bytes_retransmit=0 bytes_invalid=0 send_seq=17726 receive_seq=17725 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998299  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.29 cputime=2826.668 memavail=1724688 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71299.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000245 mcu_task_stddev=0.000256 bytes_write=444588 bytes_read=230004 bytes_retransmit=0 bytes_invalid=0 send_seq=17808 receive_seq=17808 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998296  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.29 cputime=2826.764 memavail=1724960 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71300.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000245 mcu_task_stddev=0.000256 bytes_write=446501 bytes_read=230977 bytes_retransmit=0 bytes_invalid=0 send_seq=17880 receive_seq=17880 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998294  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.29 cputime=2826.855 memavail=1724252 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71301.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000245 mcu_task_stddev=0.000256 bytes_write=448390 bytes_read=231906 bytes_retransmit=0 bytes_invalid=0 send_seq=17951 receive_seq=17951 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998292  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.29 cputime=2826.941 memavail=1723524 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71302.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000245 mcu_task_stddev=0.000256 bytes_write=450370 bytes_read=233014 bytes_retransmit=0 bytes_invalid=0 send_seq=18031 receive_seq=18031 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998290  orange_pi: temp=45.3 chamber_heater: target=0 temp=24.5 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.27 cputime=2827.032 memavail=1723020 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71303.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000255 bytes_write=452458 bytes_read=234287 bytes_retransmit=0 bytes_invalid=0 send_seq=18126 receive_seq=18126 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998288  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.27 cputime=2827.134 memavail=1722300 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71304.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000255 bytes_write=454368 bytes_read=235214 bytes_retransmit=0 bytes_invalid=0 send_seq=18196 receive_seq=18195 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998286  orange_pi: temp=45.7 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.27 cputime=2827.221 memavail=1722824 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71305.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000255 bytes_write=456314 bytes_read=236328 bytes_retransmit=0 bytes_invalid=0 send_seq=18277 receive_seq=18277 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998285  orange_pi: temp=45.8 chamber_heater: target=0 temp=24.9 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.27 cputime=2827.316 memavail=1722824 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71306.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000255 bytes_write=458200 bytes_read=237230 bytes_retransmit=0 bytes_invalid=0 send_seq=18345 receive_seq=18345 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998311  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.27 cputime=2827.406 memavail=1723348 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71307.4: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000243 mcu_task_stddev=0.000255 bytes_write=460150 bytes_read=238238 bytes_retransmit=0 bytes_invalid=0 send_seq=18422 receive_seq=18421 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998308  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.0 pwm=0.000 heater_bed: target=0 temp=23.6 pwm=0.000 sysload=1.41 cputime=2827.497 memavail=1722528 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71308.4: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000248 mcu_task_stddev=0.000256 bytes_write=462124 bytes_read=239419 bytes_retransmit=0 bytes_invalid=0 send_seq=18506 receive_seq=18506 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998307  orange_pi: temp=45.3 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.41 cputime=2827.593 memavail=1722156 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71309.4: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000248 mcu_task_stddev=0.000256 bytes_write=464042 bytes_read=240379 bytes_retransmit=0 bytes_invalid=0 send_seq=18577 receive_seq=18577 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998305  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.0 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.41 cputime=2827.683 memavail=1721400 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71310.4: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000248 mcu_task_stddev=0.000256 bytes_write=465842 bytes_read=241199 bytes_retransmit=0 bytes_invalid=0 send_seq=18639 receive_seq=18639 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998301  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.41 cputime=2827.772 memavail=1720432 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71311.4: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000248 mcu_task_stddev=0.000256 bytes_write=467786 bytes_read=242231 bytes_retransmit=0 bytes_invalid=0 send_seq=18715 receive_seq=18715 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998298  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.41 cputime=2827.861 memavail=1720432 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.2 pwm=0.000
Stats 71312.4: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000248 mcu_task_stddev=0.000256 bytes_write=469731 bytes_read=243212 bytes_retransmit=0 bytes_invalid=0 send_seq=18787 receive_seq=18787 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998296  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.38 cputime=2827.952 memavail=1720432 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71313.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=471661 bytes_read=244197 bytes_retransmit=0 bytes_invalid=0 send_seq=18862 receive_seq=18861 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998294  orange_pi: temp=46.2 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.38 cputime=2828.044 memavail=1720436 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Neopixel update did not succeed
Stats 71314.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=473513 bytes_read=245185 bytes_retransmit=0 bytes_invalid=0 send_seq=18933 receive_seq=18933 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998291  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.38 cputime=2828.145 memavail=1720436 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Neopixel update did not succeed
Stats 71315.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=475582 bytes_read=246379 bytes_retransmit=0 bytes_invalid=0 send_seq=19022 receive_seq=19022 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998289  orange_pi: temp=50.5 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.38 cputime=2828.271 memavail=1719516 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71316.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=477450 bytes_read=247285 bytes_retransmit=0 bytes_invalid=0 send_seq=19090 receive_seq=19090 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998313  orange_pi: temp=46.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.38 cputime=2828.363 memavail=1720544 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71317.4: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000241 mcu_task_stddev=0.000256 bytes_write=479468 bytes_read=248510 bytes_retransmit=0 bytes_invalid=0 send_seq=19179 receive_seq=19179 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998310  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=23.7 pwm=0.000 sysload=1.35 cputime=2828.461 memavail=1720544 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71318.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000244 mcu_task_stddev=0.000250 bytes_write=481422 bytes_read=249526 bytes_retransmit=0 bytes_invalid=0 send_seq=19254 receive_seq=19253 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998307  orange_pi: temp=46.0 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.35 cputime=2828.548 memavail=1720292 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71319.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000244 mcu_task_stddev=0.000250 bytes_write=483339 bytes_read=250557 bytes_retransmit=0 bytes_invalid=0 send_seq=19330 receive_seq=19330 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998309  orange_pi: temp=45.4 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.35 cputime=2828.642 memavail=1720592 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.2 pwm=0.000
Stats 71320.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000244 mcu_task_stddev=0.000250 bytes_write=485318 bytes_read=251659 bytes_retransmit=0 bytes_invalid=0 send_seq=19412 receive_seq=19412 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998305  orange_pi: temp=46.4 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.35 cputime=2828.735 memavail=1720088 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.0 pwm=0.000
Stats 71321.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000244 mcu_task_stddev=0.000250 bytes_write=487292 bytes_read=252729 bytes_retransmit=0 bytes_invalid=0 send_seq=19490 receive_seq=19489 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998301  orange_pi: temp=46.6 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.35 cputime=2828.829 memavail=1719900 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71322.4: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000244 mcu_task_stddev=0.000250 bytes_write=489327 bytes_read=253848 bytes_retransmit=0 bytes_invalid=0 send_seq=19575 receive_seq=19574 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998299  orange_pi: temp=45.5 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.32 cputime=2828.924 memavail=1720404 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71323.4: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000252 mcu_task_stddev=0.000254 bytes_write=491206 bytes_read=254884 bytes_retransmit=0 bytes_invalid=0 send_seq=19649 receive_seq=19649 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998295  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.32 cputime=2829.015 memavail=1720680 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.2 pwm=0.000
Stats 71324.4: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000252 mcu_task_stddev=0.000254 bytes_write=493049 bytes_read=255714 bytes_retransmit=0 bytes_invalid=0 send_seq=19711 receive_seq=19710 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998292  orange_pi: temp=45.9 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.32 cputime=2829.099 memavail=1721204 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71325.4: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000252 mcu_task_stddev=0.000254 bytes_write=495035 bytes_read=256755 bytes_retransmit=0 bytes_invalid=0 send_seq=19790 receive_seq=19789 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998289  orange_pi: temp=45.8 chamber_heater: target=0 temp=24.8 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.32 cputime=2829.193 memavail=1720132 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.1 pwm=0.000
Stats 71326.4: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000252 mcu_task_stddev=0.000254 bytes_write=496940 bytes_read=257834 bytes_retransmit=0 bytes_invalid=0 send_seq=19868 receive_seq=19868 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998305  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.32 cputime=2829.285 memavail=1719736 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71327.4: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000252 mcu_task_stddev=0.000254 bytes_write=498816 bytes_read=258734 bytes_retransmit=0 bytes_invalid=0 send_seq=19935 receive_seq=19935 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998301  orange_pi: temp=46.4 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.29 cputime=2829.374 memavail=1719484 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71328.4: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000233 mcu_task_stddev=0.000257 bytes_write=500725 bytes_read=259670 bytes_retransmit=0 bytes_invalid=0 send_seq=20004 receive_seq=20004 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998297  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.29 cputime=2829.464 memavail=1719484 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71329.4: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000233 mcu_task_stddev=0.000257 bytes_write=502601 bytes_read=260674 bytes_retransmit=0 bytes_invalid=0 send_seq=20076 receive_seq=20076 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998294  orange_pi: temp=45.6 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.29 cputime=2829.553 memavail=1719232 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.0 pwm=0.000
Stats 71330.4: gcodein=0  mcu: mcu_awake=0.115 mcu_task_avg=0.000233 mcu_task_stddev=0.000257 bytes_write=504574 bytes_read=261767 bytes_retransmit=0 bytes_invalid=0 send_seq=20156 receive_seq=20156 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998291  orange_pi: temp=45.8 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.29 cputime=2829.649 memavail=1718728 print_time=203.950 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Unknown command:"MPLE:"
Neopixel update did not succeed
Stats 71865.9: gcodein=0  mcu: mcu_awake=0.118 mcu_task_avg=0.000238 mcu_task_stddev=0.000255 bytes_write=1417026 bytes_read=818798 bytes_retransmit=0 bytes_invalid=0 send_seq=61161 receive_seq=61161 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998230  orange_pi: temp=47.1 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.17 cputime=2878.614 memavail=1718380 print_time=799.098 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71866.9: gcodein=0  mcu: mcu_awake=0.118 mcu_task_avg=0.000238 mcu_task_stddev=0.000255 bytes_write=1419400 bytes_read=819986 bytes_retransmit=0 bytes_invalid=0 send_seq=61255 receive_seq=61255 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998228  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.17 cputime=2878.715 memavail=1719916 print_time=800.098 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71867.9: gcodein=0  mcu: mcu_awake=0.118 mcu_task_avg=0.000238 mcu_task_stddev=0.000255 bytes_write=1421692 bytes_read=821252 bytes_retransmit=0 bytes_invalid=0 send_seq=61352 receive_seq=61351 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998226  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.15 cputime=2878.818 memavail=1719424 print_time=801.098 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71868.9: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000213 mcu_task_stddev=0.000248 bytes_write=1423990 bytes_read=822663 bytes_retransmit=0 bytes_invalid=0 send_seq=61458 receive_seq=61458 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998225  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.1 pwm=0.000 heater_bed: target=0 temp=23.7 pwm=0.000 sysload=1.15 cputime=2878.922 memavail=1720188 print_time=802.098 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71869.9: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000213 mcu_task_stddev=0.000248 bytes_write=1426494 bytes_read=823945 bytes_retransmit=0 bytes_invalid=0 send_seq=61558 receive_seq=61558 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998223  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.15 cputime=2879.028 memavail=1720208 print_time=803.129 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71870.9: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000213 mcu_task_stddev=0.000248 bytes_write=1428873 bytes_read=825185 bytes_retransmit=0 bytes_invalid=0 send_seq=61652 receive_seq=61652 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998222  orange_pi: temp=46.9 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=23.8 pwm=0.000 sysload=1.15 cputime=2879.135 memavail=1719492 print_time=804.123 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71871.9: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000213 mcu_task_stddev=0.000248 bytes_write=1431107 bytes_read=826439 bytes_retransmit=0 bytes_invalid=0 send_seq=61747 receive_seq=61747 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998221  orange_pi: temp=47.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.15 cputime=2879.234 memavail=1719488 print_time=805.123 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71872.9: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000213 mcu_task_stddev=0.000248 bytes_write=1433387 bytes_read=827673 bytes_retransmit=0 bytes_invalid=0 send_seq=61841 receive_seq=61841 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998220  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.14 cputime=2879.332 memavail=1719764 print_time=806.123 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71873.9: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000158 mcu_task_stddev=0.000226 bytes_write=1435894 bytes_read=829059 bytes_retransmit=0 bytes_invalid=0 send_seq=61945 receive_seq=61945 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998221  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.14 cputime=2879.440 memavail=1720272 print_time=807.104 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Stats 71874.9: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000158 mcu_task_stddev=0.000226 bytes_write=1438488 bytes_read=830365 bytes_retransmit=0 bytes_invalid=0 send_seq=62046 receive_seq=62045 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=26 freq=71998222  orange_pi: temp=47.3 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.14 cputime=2879.556 memavail=1720796 print_time=811.278 buffer_time=3.365 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71875.9: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000158 mcu_task_stddev=0.000226 bytes_write=1440415 bytes_read=831375 bytes_retransmit=0 bytes_invalid=0 send_seq=62121 receive_seq=62121 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998220  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.14 cputime=2879.648 memavail=1720564 print_time=811.278 buffer_time=2.364 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71876.9: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000158 mcu_task_stddev=0.000226 bytes_write=1442421 bytes_read=832485 bytes_retransmit=0 bytes_invalid=0 send_seq=62203 receive_seq=62203 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998218  orange_pi: temp=47.5 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.14 cputime=2879.746 memavail=1720332 print_time=811.278 buffer_time=1.363 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Stats 71877.9: gcodein=0  mcu: mcu_awake=0.111 mcu_task_avg=0.000158 mcu_task_stddev=0.000226 bytes_write=1444445 bytes_read=833655 bytes_retransmit=0 bytes_invalid=0 send_seq=62292 receive_seq=62292 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=26 freq=71998217  orange_pi: temp=47.3 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.13 cputime=2879.842 memavail=1720604 print_time=811.278 buffer_time=0.363 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71878.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000224 mcu_task_stddev=0.000247 bytes_write=1446426 bytes_read=834802 bytes_retransmit=0 bytes_invalid=0 send_seq=62376 receive_seq=62376 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8 freq=71998216  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.13 cputime=2879.937 memavail=1720372 print_time=811.278 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71879.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000224 mcu_task_stddev=0.000247 bytes_write=1448630 bytes_read=836109 bytes_retransmit=0 bytes_invalid=0 send_seq=62470 receive_seq=62470 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8 freq=71998217  orange_pi: temp=47.1 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.13 cputime=2880.044 memavail=1720120 print_time=813.244 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 71880.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000224 mcu_task_stddev=0.000247 bytes_write=1451421 bytes_read=837493 bytes_retransmit=0 bytes_invalid=0 send_seq=62579 receive_seq=62578 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=44 freq=71998215  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.13 cputime=2880.159 memavail=1720060 print_time=816.141 buffer_time=2.224 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71881.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000224 mcu_task_stddev=0.000247 bytes_write=1453428 bytes_read=838599 bytes_retransmit=0 bytes_invalid=0 send_seq=62662 receive_seq=62662 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998215  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.13 cputime=2880.258 memavail=1719936 print_time=816.184 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71882.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000224 mcu_task_stddev=0.000247 bytes_write=1455413 bytes_read=839670 bytes_retransmit=0 bytes_invalid=0 send_seq=62741 receive_seq=62741 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8 freq=71998214  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.12 cputime=2880.354 memavail=1719956 print_time=816.184 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71883.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000219 mcu_task_stddev=0.000244 bytes_write=1457829 bytes_read=840985 bytes_retransmit=0 bytes_invalid=0 send_seq=62844 receive_seq=62844 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998213  orange_pi: temp=47.5 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.12 cputime=2880.458 memavail=1719956 print_time=817.134 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.2 pwm=0.000
Stats 71884.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000219 mcu_task_stddev=0.000244 bytes_write=1460167 bytes_read=842208 bytes_retransmit=0 bytes_invalid=0 send_seq=62942 receive_seq=62942 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998212  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.12 cputime=2880.565 memavail=1719464 print_time=818.699 buffer_time=0.780 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71885.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000219 mcu_task_stddev=0.000244 bytes_write=1462242 bytes_read=843357 bytes_retransmit=0 bytes_invalid=0 send_seq=63027 receive_seq=63027 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998212  orange_pi: temp=47.6 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.12 cputime=2880.662 memavail=1719220 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71886.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000219 mcu_task_stddev=0.000244 bytes_write=1464155 bytes_read=844226 bytes_retransmit=0 bytes_invalid=0 send_seq=63092 receive_seq=63092 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998214  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.12 cputime=2880.755 memavail=1719220 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71887.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000219 mcu_task_stddev=0.000244 bytes_write=1466096 bytes_read=845330 bytes_retransmit=0 bytes_invalid=0 send_seq=63174 receive_seq=63174 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998213  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=23.7 pwm=0.000 sysload=1.11 cputime=2880.847 memavail=1719224 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71888.9: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000217 mcu_task_stddev=0.000250 bytes_write=1468069 bytes_read=846455 bytes_retransmit=0 bytes_invalid=0 send_seq=63254 receive_seq=63254 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998212  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.11 cputime=2880.941 memavail=1719988 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71889.9: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000217 mcu_task_stddev=0.000250 bytes_write=1470074 bytes_read=847558 bytes_retransmit=0 bytes_invalid=0 send_seq=63336 receive_seq=63336 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998213  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.11 cputime=2881.037 memavail=1720000 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71890.9: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000217 mcu_task_stddev=0.000250 bytes_write=1472028 bytes_read=848604 bytes_retransmit=0 bytes_invalid=0 send_seq=63416 receive_seq=63416 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=44 upcoming_bytes=0 freq=71998212  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.11 cputime=2881.131 memavail=1719244 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71891.9: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000217 mcu_task_stddev=0.000250 bytes_write=1473928 bytes_read=849600 bytes_retransmit=0 bytes_invalid=0 send_seq=63488 receive_seq=63488 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998211  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.11 cputime=2881.220 memavail=1718992 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71892.9: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000217 mcu_task_stddev=0.000250 bytes_write=1475964 bytes_read=850781 bytes_retransmit=0 bytes_invalid=0 send_seq=63576 receive_seq=63576 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998211  orange_pi: temp=47.4 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.10 cputime=2881.318 memavail=1718488 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71893.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000255 bytes_write=1477903 bytes_read=851727 bytes_retransmit=0 bytes_invalid=0 send_seq=63647 receive_seq=63647 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998210  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.10 cputime=2881.409 memavail=1718508 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.2 pwm=0.000
Stats 71894.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000255 bytes_write=1479808 bytes_read=852801 bytes_retransmit=0 bytes_invalid=0 send_seq=63725 receive_seq=63725 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998209  orange_pi: temp=47.3 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.10 cputime=2881.502 memavail=1718508 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Neopixel update did not succeed
Stats 71895.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000255 bytes_write=1481854 bytes_read=854000 bytes_retransmit=0 bytes_invalid=0 send_seq=63815 receive_seq=63815 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.10 cputime=2881.601 memavail=1718764 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71896.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000255 bytes_write=1483819 bytes_read=854981 bytes_retransmit=0 bytes_invalid=0 send_seq=63891 receive_seq=63890 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.3 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.10 cputime=2881.694 memavail=1718764 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71897.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000255 bytes_write=1485798 bytes_read=856151 bytes_retransmit=0 bytes_invalid=0 send_seq=63976 receive_seq=63976 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.09 cputime=2881.790 memavail=1719540 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71898.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000252 bytes_write=1487853 bytes_read=857430 bytes_retransmit=0 bytes_invalid=0 send_seq=64069 receive_seq=64069 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998206  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.09 cputime=2881.889 memavail=1719800 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71899.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000252 bytes_write=1489764 bytes_read=858336 bytes_retransmit=0 bytes_invalid=0 send_seq=64138 receive_seq=64137 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998206  orange_pi: temp=47.3 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.09 cputime=2881.977 memavail=1719560 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71900.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000252 bytes_write=1491768 bytes_read=859532 bytes_retransmit=0 bytes_invalid=0 send_seq=64225 receive_seq=64225 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.09 cputime=2882.076 memavail=1718048 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71901.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000252 bytes_write=1493743 bytes_read=860614 bytes_retransmit=0 bytes_invalid=0 send_seq=64305 receive_seq=64305 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.09 cputime=2882.171 memavail=1717800 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71902.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000252 bytes_write=1495810 bytes_read=861848 bytes_retransmit=0 bytes_invalid=0 send_seq=64399 receive_seq=64399 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998209  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.24 cputime=2882.272 memavail=1717800 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71903.9: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000262 mcu_task_stddev=0.000250 bytes_write=1497809 bytes_read=862950 bytes_retransmit=0 bytes_invalid=0 send_seq=64480 receive_seq=64480 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.24 cputime=2882.366 memavail=1717820 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71904.9: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000262 mcu_task_stddev=0.000250 bytes_write=1499733 bytes_read=864014 bytes_retransmit=0 bytes_invalid=0 send_seq=64559 receive_seq=64559 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.24 cputime=2882.461 memavail=1718836 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71905.9: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000262 mcu_task_stddev=0.000250 bytes_write=1501666 bytes_read=865022 bytes_retransmit=0 bytes_invalid=0 send_seq=64633 receive_seq=64633 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.24 cputime=2882.552 memavail=1719120 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71906.9: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000262 mcu_task_stddev=0.000250 bytes_write=1503560 bytes_read=865924 bytes_retransmit=0 bytes_invalid=0 send_seq=64699 receive_seq=64699 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.24 cputime=2882.638 memavail=1718876 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71907.9: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000262 mcu_task_stddev=0.000250 bytes_write=1505670 bytes_read=867303 bytes_retransmit=0 bytes_invalid=0 send_seq=64802 receive_seq=64801 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998206  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.22 cputime=2882.741 memavail=1719160 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71908.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000250 mcu_task_stddev=0.000250 bytes_write=1507601 bytes_read=868346 bytes_retransmit=0 bytes_invalid=0 send_seq=64877 receive_seq=64877 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.22 cputime=2882.831 memavail=1718908 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71909.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000250 mcu_task_stddev=0.000250 bytes_write=1509607 bytes_read=869456 bytes_retransmit=0 bytes_invalid=0 send_seq=64959 receive_seq=64959 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.22 cputime=2882.928 memavail=1718908 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71910.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000250 mcu_task_stddev=0.000250 bytes_write=1511583 bytes_read=870543 bytes_retransmit=0 bytes_invalid=0 send_seq=65041 receive_seq=65041 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.22 cputime=2883.023 memavail=1719172 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71911.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000250 mcu_task_stddev=0.000250 bytes_write=1513463 bytes_read=871489 bytes_retransmit=0 bytes_invalid=0 send_seq=65109 receive_seq=65109 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.5 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.22 cputime=2883.112 memavail=1719184 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71912.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000250 mcu_task_stddev=0.000250 bytes_write=1515530 bytes_read=872763 bytes_retransmit=0 bytes_invalid=0 send_seq=65203 receive_seq=65203 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.29 cputime=2883.212 memavail=1719432 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71913.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000255 mcu_task_stddev=0.000251 bytes_write=1517645 bytes_read=874070 bytes_retransmit=0 bytes_invalid=0 send_seq=65301 receive_seq=65300 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.29 cputime=2883.314 memavail=1719456 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71914.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000255 mcu_task_stddev=0.000251 bytes_write=1519670 bytes_read=875301 bytes_retransmit=0 bytes_invalid=0 send_seq=65393 receive_seq=65393 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.29 cputime=2883.413 memavail=1718448 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71915.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000255 mcu_task_stddev=0.000251 bytes_write=1521604 bytes_read=876370 bytes_retransmit=0 bytes_invalid=0 send_seq=65470 receive_seq=65470 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.3 chamber_heater: target=0 temp=25.4 pwm=0.000 heater_bed: target=0 temp=23.8 pwm=0.000 sysload=1.29 cputime=2883.506 memavail=1717944 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71916.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000255 mcu_task_stddev=0.000251 bytes_write=1523530 bytes_read=877343 bytes_retransmit=0 bytes_invalid=0 send_seq=65542 receive_seq=65542 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998206  orange_pi: temp=47.8 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=24.7 pwm=0.000 sysload=1.29 cputime=2883.598 memavail=1717692 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71917.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000255 mcu_task_stddev=0.000251 bytes_write=1525504 bytes_read=878460 bytes_retransmit=0 bytes_invalid=0 send_seq=65625 receive_seq=65625 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=44 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.26 cputime=2883.697 memavail=1717592 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71918.9: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000253 mcu_task_stddev=0.000249 bytes_write=1527503 bytes_read=879674 bytes_retransmit=0 bytes_invalid=0 send_seq=65710 receive_seq=65710 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998206  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.26 cputime=2883.793 memavail=1717452 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71919.9: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000253 mcu_task_stddev=0.000249 bytes_write=1529380 bytes_read=880585 bytes_retransmit=0 bytes_invalid=0 send_seq=65776 receive_seq=65776 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998206  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.26 cputime=2883.882 memavail=1717712 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71920.9: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000253 mcu_task_stddev=0.000249 bytes_write=1531340 bytes_read=881561 bytes_retransmit=0 bytes_invalid=0 send_seq=65851 receive_seq=65850 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.26 cputime=2883.972 memavail=1716744 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71921.9: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000253 mcu_task_stddev=0.000249 bytes_write=1533284 bytes_read=882729 bytes_retransmit=0 bytes_invalid=0 send_seq=65934 receive_seq=65934 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.26 cputime=2884.069 memavail=1717256 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71922.9: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000253 mcu_task_stddev=0.000249 bytes_write=1535250 bytes_read=883809 bytes_retransmit=0 bytes_invalid=0 send_seq=66013 receive_seq=66013 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998206  orange_pi: temp=47.3 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.24 cputime=2884.162 memavail=1717288 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71923.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=1537180 bytes_read=884825 bytes_retransmit=0 bytes_invalid=0 send_seq=66090 receive_seq=66090 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998208  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.24 cputime=2884.253 memavail=1717560 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71924.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=1539246 bytes_read=886107 bytes_retransmit=0 bytes_invalid=0 send_seq=66184 receive_seq=66184 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998211  orange_pi: temp=46.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.24 cputime=2884.356 memavail=1717312 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71925.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=1541189 bytes_read=887140 bytes_retransmit=0 bytes_invalid=0 send_seq=66260 receive_seq=66260 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998211  orange_pi: temp=46.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.24 cputime=2884.449 memavail=1717312 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71926.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=1543166 bytes_read=888173 bytes_retransmit=0 bytes_invalid=0 send_seq=66339 receive_seq=66339 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998210  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.24 cputime=2884.541 memavail=1717312 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71927.9: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000253 mcu_task_stddev=0.000254 bytes_write=1545076 bytes_read=889190 bytes_retransmit=0 bytes_invalid=0 send_seq=66412 receive_seq=66412 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998210  orange_pi: temp=47.0 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.38 cputime=2884.634 memavail=1717312 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71928.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000251 bytes_write=1547126 bytes_read=890435 bytes_retransmit=0 bytes_invalid=0 send_seq=66503 receive_seq=66503 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998224  orange_pi: temp=47.2 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.38 cputime=2884.732 memavail=1717332 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71929.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000251 bytes_write=1549114 bytes_read=891507 bytes_retransmit=0 bytes_invalid=0 send_seq=66585 receive_seq=66585 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998223  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.38 cputime=2884.826 memavail=1717584 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 71930.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000251 bytes_write=1551045 bytes_read=892531 bytes_retransmit=0 bytes_invalid=0 send_seq=66661 receive_seq=66661 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998223  orange_pi: temp=47.4 chamber_heater: target=0 temp=25.2 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.38 cputime=2884.922 memavail=1716576 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71931.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000251 bytes_write=1552968 bytes_read=893565 bytes_retransmit=0 bytes_invalid=0 send_seq=66734 receive_seq=66734 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998222  orange_pi: temp=47.0 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.0 pwm=0.000 sysload=1.38 cputime=2885.016 memavail=1716576 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71932.9: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000246 mcu_task_stddev=0.000251 bytes_write=1554986 bytes_read=894697 bytes_retransmit=0 bytes_invalid=0 send_seq=66820 receive_seq=66820 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998220  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.35 cputime=2885.113 memavail=1716852 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71933.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000252 bytes_write=1556905 bytes_read=895762 bytes_retransmit=0 bytes_invalid=0 send_seq=66896 receive_seq=66896 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998218  orange_pi: temp=46.8 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.35 cputime=2885.207 memavail=1717104 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71934.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000252 bytes_write=1558901 bytes_read=896881 bytes_retransmit=0 bytes_invalid=0 send_seq=66978 receive_seq=66978 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998217  orange_pi: temp=47.6 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.35 cputime=2885.302 memavail=1717608 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71935.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000252 bytes_write=1560933 bytes_read=898060 bytes_retransmit=0 bytes_invalid=0 send_seq=67067 receive_seq=67067 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998216  orange_pi: temp=47.1 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.35 cputime=2885.400 memavail=1717376 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.2 pwm=0.000
Neopixel update did not succeed
Stats 71936.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000252 bytes_write=1562874 bytes_read=899087 bytes_retransmit=0 bytes_invalid=0 send_seq=67142 receive_seq=67142 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998216  orange_pi: temp=47.1 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=24.1 pwm=0.000 sysload=1.35 cputime=2885.495 memavail=1717648 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71937.9: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000257 mcu_task_stddev=0.000252 bytes_write=1564766 bytes_read=900089 bytes_retransmit=0 bytes_invalid=0 send_seq=67215 receive_seq=67215 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998215  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.32 cputime=2885.583 memavail=1717900 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.3 pwm=0.000
Stats 71938.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000248 mcu_task_stddev=0.000251 bytes_write=1566768 bytes_read=901199 bytes_retransmit=0 bytes_invalid=0 send_seq=67298 receive_seq=67298 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998215  orange_pi: temp=47.8 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.32 cputime=2885.678 memavail=1718172 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Stats 71939.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000248 mcu_task_stddev=0.000251 bytes_write=1568581 bytes_read=902166 bytes_retransmit=0 bytes_invalid=0 send_seq=67369 receive_seq=67369 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998214  orange_pi: temp=48.0 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=24.2 pwm=0.000 sysload=1.32 cputime=2885.838 memavail=1717924 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71940.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000248 mcu_task_stddev=0.000251 bytes_write=1570549 bytes_read=903246 bytes_retransmit=0 bytes_invalid=0 send_seq=67448 receive_seq=67448 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998214  orange_pi: temp=47.5 chamber_heater: target=0 temp=25.3 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.32 cputime=2885.932 memavail=1717212 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71941.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000248 mcu_task_stddev=0.000251 bytes_write=1572442 bytes_read=904139 bytes_retransmit=0 bytes_invalid=0 send_seq=67515 receive_seq=67515 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998214  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.32 cputime=2886.018 memavail=1717716 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.5 pwm=0.000
Stats 71942.9: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000248 mcu_task_stddev=0.000251 bytes_write=1574565 bytes_read=905504 bytes_retransmit=0 bytes_invalid=0 send_seq=67617 receive_seq=67616 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998215  orange_pi: temp=47.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=23.9 pwm=0.000 sysload=1.30 cputime=2886.124 memavail=1716980 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 71943.9: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000251 mcu_task_stddev=0.000253 bytes_write=1576480 bytes_read=906575 bytes_retransmit=0 bytes_invalid=0 send_seq=67693 receive_seq=67693 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998214  orange_pi: temp=47.4 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.30 cputime=2886.218 memavail=1716728 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 71944.9: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000251 mcu_task_stddev=0.000253 bytes_write=1578403 bytes_read=907507 bytes_retransmit=0 bytes_invalid=0 send_seq=67763 receive_seq=67763 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998212  orange_pi: temp=47.5 chamber_heater: target=0 temp=25.5 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.30 cputime=2886.308 memavail=1716224 print_time=818.699 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.4 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Unknown command:"STATUS_SB_NOZZLE_HEATING"
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 72486.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000208 mcu_task_stddev=0.000250 bytes_write=2260257 bytes_read=1422380 bytes_retransmit=0 bytes_invalid=0 send_seq=105448 receive_seq=105447 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998227  orange_pi: temp=47.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.04 cputime=2930.239 memavail=1715244 print_time=1419.635 buffer_time=0.247 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72487.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000208 mcu_task_stddev=0.000250 bytes_write=2260802 bytes_read=1423022 bytes_retransmit=0 bytes_invalid=0 send_seq=105501 receive_seq=105500 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998225  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.04 cputime=2930.305 memavail=1714996 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 72488.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000208 mcu_task_stddev=0.000250 bytes_write=2261310 bytes_read=1423669 bytes_retransmit=0 bytes_invalid=0 send_seq=105551 receive_seq=105551 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998222  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.04 cputime=2930.369 memavail=1714764 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72489.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000215 mcu_task_stddev=0.000252 bytes_write=2261858 bytes_read=1424347 bytes_retransmit=0 bytes_invalid=0 send_seq=105606 receive_seq=105606 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998220  orange_pi: temp=48.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.04 cputime=2930.436 memavail=1714508 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72490.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000215 mcu_task_stddev=0.000252 bytes_write=2262444 bytes_read=1425106 bytes_retransmit=0 bytes_invalid=0 send_seq=105666 receive_seq=105666 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998218  orange_pi: temp=48.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.04 cputime=2930.507 memavail=1714532 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72491.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000215 mcu_task_stddev=0.000252 bytes_write=2262992 bytes_read=1425782 bytes_retransmit=0 bytes_invalid=0 send_seq=105721 receive_seq=105721 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998216  orange_pi: temp=48.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.04 cputime=2930.575 memavail=1714056 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72492.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000215 mcu_task_stddev=0.000252 bytes_write=2263553 bytes_read=1426459 bytes_retransmit=0 bytes_invalid=0 send_seq=105777 receive_seq=105776 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=5 upcoming_bytes=0 freq=71998215  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.04 cputime=2930.641 memavail=1713804 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72493.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000232 mcu_task_stddev=0.000259 bytes_write=2264149 bytes_read=1427253 bytes_retransmit=0 bytes_invalid=0 send_seq=105837 receive_seq=105837 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998212  orange_pi: temp=48.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.03 cputime=2930.712 memavail=1713300 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72494.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000232 mcu_task_stddev=0.000259 bytes_write=2264697 bytes_read=1427929 bytes_retransmit=0 bytes_invalid=0 send_seq=105892 receive_seq=105892 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998211  orange_pi: temp=48.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.03 cputime=2930.777 memavail=1712944 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 72495.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000232 mcu_task_stddev=0.000259 bytes_write=2265268 bytes_read=1428637 bytes_retransmit=0 bytes_invalid=0 send_seq=105950 receive_seq=105950 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998209  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.03 cputime=2930.846 memavail=1712552 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 72496.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000232 mcu_task_stddev=0.000259 bytes_write=2265841 bytes_read=1429367 bytes_retransmit=0 bytes_invalid=0 send_seq=106008 receive_seq=106008 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.03 cputime=2930.914 memavail=1712704 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72497.4: gcodein=0  mcu: mcu_awake=0.089 mcu_task_avg=0.000232 mcu_task_stddev=0.000259 bytes_write=2266368 bytes_read=1430025 bytes_retransmit=0 bytes_invalid=0 send_seq=106061 receive_seq=106061 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.03 cputime=2930.980 memavail=1712580 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72498.4: gcodein=0  mcu: mcu_awake=0.086 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2266942 bytes_read=1430727 bytes_retransmit=0 bytes_invalid=0 send_seq=106119 receive_seq=106118 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=5 upcoming_bytes=0 freq=71998206  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.11 cputime=2931.050 memavail=1712580 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.0 pwm=0.000
Stats 72499.4: gcodein=0  mcu: mcu_awake=0.086 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2267526 bytes_read=1431463 bytes_retransmit=0 bytes_invalid=0 send_seq=106178 receive_seq=106178 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=9 upcoming_bytes=0 freq=71998205  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.11 cputime=2931.119 memavail=1713072 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72500.4: gcodein=0  mcu: mcu_awake=0.086 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2268111 bytes_read=1432180 bytes_retransmit=0 bytes_invalid=0 send_seq=106237 receive_seq=106237 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998204  orange_pi: temp=47.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.11 cputime=2931.187 memavail=1713104 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72501.4: gcodein=0  mcu: mcu_awake=0.086 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2268639 bytes_read=1432789 bytes_retransmit=0 bytes_invalid=0 send_seq=106289 receive_seq=106288 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998204  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.11 cputime=2931.253 memavail=1712504 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72502.4: gcodein=0  mcu: mcu_awake=0.086 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2269192 bytes_read=1433467 bytes_retransmit=0 bytes_invalid=0 send_seq=106343 receive_seq=106342 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998202  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.11 cputime=2931.318 memavail=1712904 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72503.4: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2269747 bytes_read=1434178 bytes_retransmit=0 bytes_invalid=0 send_seq=106399 receive_seq=106399 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998203  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.10 cputime=2931.386 memavail=1713668 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 72504.4: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2270358 bytes_read=1434901 bytes_retransmit=0 bytes_invalid=0 send_seq=106461 receive_seq=106460 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998202  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.10 cputime=2931.455 memavail=1714196 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72505.4: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2270880 bytes_read=1435545 bytes_retransmit=0 bytes_invalid=0 send_seq=106512 receive_seq=106512 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998201  orange_pi: temp=48.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.10 cputime=2931.520 memavail=1713964 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72506.4: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2271374 bytes_read=1436146 bytes_retransmit=0 bytes_invalid=0 send_seq=106560 receive_seq=106560 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998201  orange_pi: temp=47.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.10 cputime=2931.584 memavail=1713724 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72507.4: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000258 bytes_write=2271974 bytes_read=1436864 bytes_retransmit=0 bytes_invalid=0 send_seq=106620 receive_seq=106620 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998199  orange_pi: temp=48.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.10 cputime=2931.658 memavail=1714144 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72508.4: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000222 mcu_task_stddev=0.000259 bytes_write=2272602 bytes_read=1437585 bytes_retransmit=0 bytes_invalid=0 send_seq=106676 receive_seq=106676 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998199  orange_pi: temp=47.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.09 cputime=2931.724 memavail=1714020 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72509.4: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000222 mcu_task_stddev=0.000259 bytes_write=2273217 bytes_read=1438256 bytes_retransmit=0 bytes_invalid=0 send_seq=106730 receive_seq=106730 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998197  orange_pi: temp=47.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.09 cputime=2931.790 memavail=1714020 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 72510.4: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000222 mcu_task_stddev=0.000259 bytes_write=2273875 bytes_read=1438961 bytes_retransmit=0 bytes_invalid=0 send_seq=106789 receive_seq=106789 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=9 upcoming_bytes=0 freq=71998197  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.09 cputime=2931.859 memavail=1714780 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72511.4: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000222 mcu_task_stddev=0.000259 bytes_write=2274493 bytes_read=1439652 bytes_retransmit=0 bytes_invalid=0 send_seq=106844 receive_seq=106844 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=47.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.09 cputime=2931.927 memavail=1714528 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72512.4: gcodein=0  mcu: mcu_awake=0.083 mcu_task_avg=0.000222 mcu_task_stddev=0.000259 bytes_write=2275155 bytes_read=1440385 bytes_retransmit=0 bytes_invalid=0 send_seq=106904 receive_seq=106904 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.09 cputime=2931.994 memavail=1714276 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72513.4: gcodein=0  mcu: mcu_awake=0.088 mcu_task_avg=0.000227 mcu_task_stddev=0.000254 bytes_write=2275800 bytes_read=1441102 bytes_retransmit=0 bytes_invalid=0 send_seq=106962 receive_seq=106962 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.09 cputime=2932.061 memavail=1714276 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72514.4: gcodein=0  mcu: mcu_awake=0.088 mcu_task_avg=0.000227 mcu_task_stddev=0.000254 bytes_write=2276483 bytes_read=1441889 bytes_retransmit=0 bytes_invalid=0 send_seq=107025 receive_seq=107025 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=47.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.09 cputime=2932.131 memavail=1714800 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72515.4: gcodein=0  mcu: mcu_awake=0.088 mcu_task_avg=0.000227 mcu_task_stddev=0.000254 bytes_write=2277165 bytes_read=1442664 bytes_retransmit=0 bytes_invalid=0 send_seq=107088 receive_seq=107087 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=48.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.09 cputime=2932.201 memavail=1715052 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72516.4: gcodein=0  mcu: mcu_awake=0.088 mcu_task_avg=0.000227 mcu_task_stddev=0.000254 bytes_write=2277756 bytes_read=1443273 bytes_retransmit=0 bytes_invalid=0 send_seq=107138 receive_seq=107138 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998194  orange_pi: temp=47.7 chamber_heater: target=0 temp=25.6 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.09 cputime=2932.266 memavail=1714800 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72517.4: gcodein=0  mcu: mcu_awake=0.088 mcu_task_avg=0.000227 mcu_task_stddev=0.000254 bytes_write=2278418 bytes_read=1444042 bytes_retransmit=0 bytes_invalid=0 send_seq=107199 receive_seq=107199 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.09 cputime=2932.335 memavail=1714564 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72518.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000230 mcu_task_stddev=0.000254 bytes_write=2279043 bytes_read=1444719 bytes_retransmit=0 bytes_invalid=0 send_seq=107254 receive_seq=107254 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.08 cputime=2932.399 memavail=1714564 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72519.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000230 mcu_task_stddev=0.000254 bytes_write=2279744 bytes_read=1445517 bytes_retransmit=0 bytes_invalid=0 send_seq=107319 receive_seq=107319 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=9 upcoming_bytes=0 freq=71998195  orange_pi: temp=48.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.08 cputime=2932.470 memavail=1714564 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72520.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000230 mcu_task_stddev=0.000254 bytes_write=2280356 bytes_read=1446162 bytes_retransmit=0 bytes_invalid=0 send_seq=107372 receive_seq=107371 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998194  orange_pi: temp=48.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.08 cputime=2932.533 memavail=1715340 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72521.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000230 mcu_task_stddev=0.000254 bytes_write=2280978 bytes_read=1446851 bytes_retransmit=0 bytes_invalid=0 send_seq=107427 receive_seq=107427 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998194  orange_pi: temp=48.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.08 cputime=2932.601 memavail=1715872 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72522.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000230 mcu_task_stddev=0.000254 bytes_write=2281595 bytes_read=1447514 bytes_retransmit=0 bytes_invalid=0 send_seq=107481 receive_seq=107481 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998194  orange_pi: temp=47.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.08 cputime=2932.666 memavail=1715872 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 72523.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000233 mcu_task_stddev=0.000256 bytes_write=2282259 bytes_read=1448293 bytes_retransmit=0 bytes_invalid=0 send_seq=107542 receive_seq=107542 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998193  orange_pi: temp=48.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.23 cputime=2932.735 memavail=1715872 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72524.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000233 mcu_task_stddev=0.000256 bytes_write=2282827 bytes_read=1448873 bytes_retransmit=0 bytes_invalid=0 send_seq=107590 receive_seq=107589 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998193  orange_pi: temp=48.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.23 cputime=2932.796 memavail=1715872 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72525.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000233 mcu_task_stddev=0.000256 bytes_write=2283502 bytes_read=1449606 bytes_retransmit=0 bytes_invalid=0 send_seq=107650 receive_seq=107649 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=48.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.23 cputime=2932.864 memavail=1715876 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72526.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000233 mcu_task_stddev=0.000256 bytes_write=2284102 bytes_read=1450277 bytes_retransmit=0 bytes_invalid=0 send_seq=107704 receive_seq=107703 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=48.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.23 cputime=2933.000 memavail=1715876 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72527.4: gcodein=0  mcu: mcu_awake=0.091 mcu_task_avg=0.000233 mcu_task_stddev=0.000256 bytes_write=2284752 bytes_read=1450992 bytes_retransmit=0 bytes_invalid=0 send_seq=107762 receive_seq=107761 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.23 cputime=2933.068 memavail=1715876 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72528.4: gcodein=0  mcu: mcu_awake=0.084 mcu_task_avg=0.000224 mcu_task_stddev=0.000256 bytes_write=2285370 bytes_read=1451695 bytes_retransmit=0 bytes_invalid=0 send_seq=107818 receive_seq=107818 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.29 cputime=2933.137 memavail=1715876 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72529.4: gcodein=0  mcu: mcu_awake=0.084 mcu_task_avg=0.000224 mcu_task_stddev=0.000256 bytes_write=2285918 bytes_read=1452352 bytes_retransmit=0 bytes_invalid=0 send_seq=107872 receive_seq=107871 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.29 cputime=2933.204 memavail=1715632 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72530.4: gcodein=0  mcu: mcu_awake=0.084 mcu_task_avg=0.000224 mcu_task_stddev=0.000256 bytes_write=2286447 bytes_read=1452990 bytes_retransmit=0 bytes_invalid=0 send_seq=107924 receive_seq=107923 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998198  orange_pi: temp=48.8 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.29 cputime=2933.271 memavail=1715904 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72531.5: gcodein=0  mcu: mcu_awake=0.084 mcu_task_avg=0.000224 mcu_task_stddev=0.000256 bytes_write=2286987 bytes_read=1453674 bytes_retransmit=0 bytes_invalid=0 send_seq=107978 receive_seq=107978 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998198  orange_pi: temp=48.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.29 cputime=2933.339 memavail=1715672 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Stats 72532.5: gcodein=0  mcu: mcu_awake=0.084 mcu_task_avg=0.000224 mcu_task_stddev=0.000256 bytes_write=2287521 bytes_read=1454339 bytes_retransmit=0 bytes_invalid=0 send_seq=108031 receive_seq=108031 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998197  orange_pi: temp=48.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.29 cputime=2933.406 memavail=1716452 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72533.5: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000219 mcu_task_stddev=0.000258 bytes_write=2288085 bytes_read=1455051 bytes_retransmit=0 bytes_invalid=0 send_seq=108088 receive_seq=108088 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.27 cputime=2933.474 memavail=1716200 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72534.5: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000219 mcu_task_stddev=0.000258 bytes_write=2288672 bytes_read=1455792 bytes_retransmit=0 bytes_invalid=0 send_seq=108148 receive_seq=108148 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.27 cputime=2933.544 memavail=1715696 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72535.5: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000219 mcu_task_stddev=0.000258 bytes_write=2289199 bytes_read=1456444 bytes_retransmit=0 bytes_invalid=0 send_seq=108200 receive_seq=108200 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.5 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.27 cputime=2933.610 memavail=1715696 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72536.5: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000219 mcu_task_stddev=0.000258 bytes_write=2289733 bytes_read=1457100 bytes_retransmit=0 bytes_invalid=0 send_seq=108254 receive_seq=108254 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=48.0 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.27 cputime=2933.677 memavail=1715696 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.6 pwm=0.000
Stats 72537.5: gcodein=0  mcu: mcu_awake=0.080 mcu_task_avg=0.000219 mcu_task_stddev=0.000258 bytes_write=2290315 bytes_read=1457809 bytes_retransmit=0 bytes_invalid=0 send_seq=108312 receive_seq=108311 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=5 upcoming_bytes=0 freq=71998195  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.3 pwm=0.000 sysload=1.27 cputime=2933.746 memavail=1715444 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72538.5: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000257 bytes_write=2290903 bytes_read=1458546 bytes_retransmit=0 bytes_invalid=0 send_seq=108371 receive_seq=108370 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=48.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.25 cputime=2933.814 memavail=1715444 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72539.5: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000257 bytes_write=2291486 bytes_read=1459256 bytes_retransmit=0 bytes_invalid=0 send_seq=108430 receive_seq=108430 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=48.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.25 cputime=2933.884 memavail=1716204 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72540.5: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000257 bytes_write=2292038 bytes_read=1459947 bytes_retransmit=0 bytes_invalid=0 send_seq=108485 receive_seq=108485 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71998195  orange_pi: temp=48.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.25 cputime=2933.950 memavail=1715704 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72541.5: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000257 bytes_write=2292606 bytes_read=1460626 bytes_retransmit=0 bytes_invalid=0 send_seq=108540 receive_seq=108539 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998194  orange_pi: temp=48.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.7 pwm=0.000 sysload=1.25 cputime=2934.017 memavail=1715516 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72542.5: gcodein=0  mcu: mcu_awake=0.087 mcu_task_avg=0.000227 mcu_task_stddev=0.000257 bytes_write=2293133 bytes_read=1461253 bytes_retransmit=0 bytes_invalid=0 send_seq=108592 receive_seq=108592 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998195  orange_pi: temp=47.8 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.5 pwm=0.000 sysload=1.25 cputime=2934.082 memavail=1716272 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.8 pwm=0.000
Stats 72543.5: gcodein=0  mcu: mcu_awake=0.085 mcu_task_avg=0.000226 mcu_task_stddev=0.000259 bytes_write=2293671 bytes_read=1461935 bytes_retransmit=0 bytes_invalid=0 send_seq=108645 receive_seq=108645 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.23 cputime=2934.148 memavail=1717076 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.7 pwm=0.000
Stats 72544.5: gcodein=0  mcu: mcu_awake=0.085 mcu_task_avg=0.000226 mcu_task_stddev=0.000259 bytes_write=2294228 bytes_read=1462606 bytes_retransmit=0 bytes_invalid=0 send_seq=108700 receive_seq=108699 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71998196  orange_pi: temp=48.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=24.6 pwm=0.000 sysload=1.23 cputime=2934.217 memavail=1717096 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Stats 72545.5: gcodein=0  mcu: mcu_awake=0.085 mcu_task_avg=0.000226 mcu_task_stddev=0.000259 bytes_write=2294778 bytes_read=1463283 bytes_retransmit=0 bytes_invalid=0 send_seq=108755 receive_seq=108755 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998198  orange_pi: temp=48.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.23 cputime=2934.284 memavail=1718112 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Stats 72546.5: gcodein=0  mcu: mcu_awake=0.085 mcu_task_avg=0.000226 mcu_task_stddev=0.000259 bytes_write=2295387 bytes_read=1464065 bytes_retransmit=0 bytes_invalid=0 send_seq=108818 receive_seq=108817 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=5 upcoming_bytes=0 freq=71998198  orange_pi: temp=48.1 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=24.4 pwm=0.000 sysload=1.23 cputime=2934.355 memavail=1717380 print_time=1419.635 buffer_time=0.000 print_stall=0 extruder: target=0 temp=24.9 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 77425.2: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000266 mcu_task_stddev=0.000260 bytes_write=8501963 bytes_read=5707477 bytes_retransmit=0 bytes_invalid=0 send_seq=445289 receive_seq=445288 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998198  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.17 cputime=3306.315 memavail=1713404 print_time=6358.760 buffer_time=0.670 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
webhooks client 281473466147664: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:04:11 2024 (1735574651.4 77427.0)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel ring]
pin = PA8
chain_count = 16

[led_effect sb_logo_busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:sb_leds
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:sb_leds
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:sb_leds (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473445108352: New connection
webhooks client 281473445108352: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 19, 'next_clock': 2904746624, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77430.281346921, '#receive_time': 77430.286398337}
mcu 'mcu': got {'oid': 27, 'next_clock': 2910506624, 'value': 31239, '#name': 'analog_in_state', '#sent_time': 77430.333395629, '#receive_time': 77430.366392879}
mcu 'mcu': got {'oid': 15, 'next_clock': 2923466624, 'value': 31187, '#name': 'analog_in_state', '#sent_time': 77430.54072554599, '#receive_time': 77430.546391129}
mcu 'mcu': got {'oid': 19, 'next_clock': 2926346624, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77430.54072554599, '#receive_time': 77430.586401712}
mcu 'mcu': got {'oid': 27, 'next_clock': 2932106624, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77430.645810462, '#receive_time': 77430.666401212}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Unhandled exception during ready callback
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 164, in _connect
    cb()
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 390, in _handle_ready
    ledChain = self.printer.lookup_object(chainName)
  File "/home/klipper/klipper/klippy/klippy.py", line 79, in lookup_object
    raise self.config_error("Unknown config object '%s'" % (name,))
configparser.Error: Unknown config object 'neopixel sb_leds'
Transition to shutdown state: Internal error during ready callback: Unknown config object 'neopixel sb_leds'
Dumping gcode input 0 blocks
Dumping 10 requests for client 281473445108352
Received 77429.836786: b'{"id":281472834385136,"method":"info","params":{"client_info":{"program":"Moonraker","version":"v0.9.3-4-ga4604e3"}}}'
Received 77429.836786: b'{"id":281472836243648,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 77429.836786: b'{"id":281472833839760,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 77429.864970: b'{"id":281472834385136,"method":"list_endpoints","params":{}}'
Received 77429.939385: b'{"id":281472834386816,"method":"info","params":{}}'
Received 77430.117150: b'{"id":281472834387680,"method":"info","params":{}}'
Received 77430.369247: b'{"id":281472834387680,"method":"info","params":{}}'
Received 77430.621421: b'{"id":281472834387680,"method":"info","params":{}}'
Received 77430.873587: b'{"id":281472834387680,"method":"info","params":{}}'
Received 77431.125299: b'{"id":281472834385328,"method":"info","params":{}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (77430.281189504, 0.0, 0.0)
Internal error during ready callback: Unknown config object 'neopixel sb_leds'
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Printer is shutdown

MCU 'mcu' shutdown: Command request
clocksync state: mcu_freq=72000000 last_clock=458180038801 clock_est=(77430.351 458154880243 71995148.270) min_half_rtt=0.000224 min_rtt_time=77430.437 time_avg=77430.351(0.018) clock_avg=458154880243.255(1282590.234) pred_variance=3821288344.284
Dumping serial stats: bytes_write=2661 bytes_read=6240 bytes_retransmit=9 bytes_invalid=0 send_seq=206 receive_seq=206 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=8 upcoming_bytes=0
Dumping send queue 100 messages
Sent 0 77430.713410 77430.707055 61: seq: 1a, update_digital_out oid=29 value=1, query_analog_in oid=15 clock=3024266624 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=21589 max_value=31837 range_check_count=4, queue_digital_out oid=16 clock=2928051608 on_ticks=7200000, buttons_add oid=17 pos=0 pin=PC15 pull_up=0, buttons_add oid=17 pos=1 pin=PA10 pull_up=1, buttons_add oid=17 pos=2 pin=PA9 pull_up=1, buttons_add oid=17 pos=3 pin=PA15 pull_up=1
Sent 1 77430.715890 77430.709275 62: seq: 1b, buttons_query oid=17 clock=3025706624 rest_ticks=144000 retransmit_count=50 invert=9, queue_digital_out oid=18 clock=2928063744 on_ticks=0, query_analog_in oid=19 clock=3027146624 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=11782 max_value=32201 range_check_count=4, queue_digital_out oid=20 clock=2928088002 on_ticks=0, queue_digital_out oid=21 clock=2928092215 on_ticks=0
Sent 2 77430.718210 77430.711408 58: seq: 1c, queue_digital_out oid=22 clock=2928096311 on_ticks=0, queue_digital_out oid=23 clock=2928109628 on_ticks=0, queue_digital_out oid=5 clock=2928115811 on_ticks=0, query_analog_in oid=27 clock=3032906624 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=855 max_value=32201 range_check_count=4, queue_digital_out oid=28 clock=2928177412 on_ticks=0
Sent 3 77430.720010 77430.713750 45: seq: 1d, neopixel_update oid=0 pos=0 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_update oid=0 pos=16 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
Sent 4 77430.726611 77430.725531 27: seq: 1e, neopixel_update oid=0 pos=32 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_send oid=0
Sent 5 77430.734050 77430.733490 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 6 77430.740373 77430.739613 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03\x080\x80\x00\n\x08\xb8\x87' read=0
Sent 7 77430.744095 77430.743535 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 8 77430.750218 77430.749458 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03h0\x80\x00\x12\x08 \xda' read=0
Sent 9 77430.753896 77430.753336 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 10 77430.760009 77430.759249 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x03\x88=\x9a\x06\x02h*\xbf' read=0
Sent 11 77430.763709 77430.763149 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 12 77430.769819 77430.769059 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x03\x082\x80\x10\x92H\xa2\x83' read=0
Sent 13 77430.773506 77430.772946 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 14 77430.779616 77430.778856 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x03h2\x80\x00\x02\x08 \xfb' read=0
Sent 15 77430.783305 77430.782745 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 16 77430.789442 77430.788682 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x03\x882\x80\x00\x02\x08\xa0\xe6' read=0
Sent 17 77430.793131 77430.792571 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 18 77430.799241 77430.798481 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x03H8\x80\x00\x02\x08 \xde' read=0
Sent 19 77430.802936 77430.802376 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 20 77430.809047 77430.808287 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x03\x08>\xe4\x1ar\x88\xa4\x85' read=0
Sent 21 77430.812735 77430.812175 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 22 77430.818877 77430.818117 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03(2\x80\x00\x02\x88"\xf3' read=0
Sent 23 77430.822644 77430.822084 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 24 77430.828774 77430.828014 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03\x088\x80\x00\x02\x08 \xba' read=0
Sent 25 77430.832470 77430.831910 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 26 77430.838402 77430.837842 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 27 77430.844486 77430.843726 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x13\x080\x80\x00\n\x08\xb8\xbc' read=0
Sent 28 77430.848170 77430.847610 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 29 77430.854271 77430.853511 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x13h0\x80\x00\x12\x08 \xe1' read=0
Sent 30 77430.857954 77430.857394 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 31 77430.864056 77430.863296 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x13\x88=\x9a\x06\x02h*\x84' read=0
Sent 32 77430.867743 77430.867183 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 33 77430.873857 77430.873097 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x13\x082\x80\x10\x9ah"\xa7' read=0
Sent 34 77430.877765 77430.877205 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 35 77430.883905 77430.883145 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x13h2\x80\x00\x02\x08 \xc0' read=0
Sent 36 77430.887599 77430.887039 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 37 77430.893707 77430.892947 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x13\x882\x80\x00\x02\x08\xa0\xdd' read=0
Sent 38 77430.897386 77430.896826 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 39 77430.903490 77430.902730 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x13H8\x80\x00\x02\x08 \xe5' read=0
Sent 40 77430.907579 77430.906619 24: seq: 12, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10, queue_digital_out oid=18 clock=2937105629 on_ticks=157680
Sent 41 77430.913681 77430.912921 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x13\x08>\xe4\x1ar\x88\xa4\xbe' read=0
Sent 42 77430.917806 77430.917246 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 43 77430.924330 77430.923570 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x13(2\x80\x00\x02\x88"\xc8' read=0
Sent 44 77430.928078 77430.927518 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 45 77430.934207 77430.933447 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x13\x088\x80\x00\x02\x08 \x81' read=0
Sent 46 77430.937906 77430.937346 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 47 77430.943840 77430.943280 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 48 77430.949926 77430.949166 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0b\x080\x80\x00\n\x08\xb8\xf1' read=0
Sent 49 77430.953607 77430.953047 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 50 77430.959725 77430.958965 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x0bh0\x80\x00\x12\x08 \xac' read=0
Sent 51 77430.963410 77430.962850 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 52 77430.969672 77430.968912 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0b\x88=\x92\x06\x02h*\x91' read=0
Sent 53 77430.973375 77430.972815 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 54 77430.979511 77430.978751 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x0b\x082\x80\x10\x92H\xa2\xf5' read=0
Sent 55 77430.983212 77430.982652 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 56 77430.989319 77430.988559 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x0bh2\x80\x00\x02\x08 \x8d' read=0
Sent 57 77430.993016 77430.992456 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 58 77430.999154 77430.998394 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x0b\x882\x80\x00\x02\x08\xa0\x90' read=0
Sent 59 77431.002842 77431.002282 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 60 77431.008946 77431.008186 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x0bH8\x80\x00\x02\x08 \xa8' read=0
Sent 61 77431.012631 77431.012071 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 62 77431.018764 77431.018004 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x0b\x08>\xe4\x1ar\x88\xa4\xf3' read=0
Sent 63 77431.022473 77431.021913 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 64 77431.028578 77431.027818 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0b(2\x80\x00\x02\x88"\x85' read=0
Sent 65 77431.032267 77431.031707 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 66 77431.032787 77431.031707 13: seq: 1c, queue_digital_out oid=18 clock=2944305629 on_ticks=0
Sent 67 77431.038361 77431.037601 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0b\x088\x80\x00\x02\x08 \xcc' read=0
Sent 68 77431.042035 77431.041475 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 69 77431.047971 77431.047411 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 70 77431.054051 77431.053291 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x1b\x080\x80\x00\n\x08\xb8\xca' read=0
Sent 71 77431.057732 77431.057172 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 72 77431.063826 77431.063066 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x1bh0\x80\x00\x12\x08 \x97' read=0
Sent 73 77431.067518 77431.066958 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 74 77431.073611 77431.072851 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x1b\x88=\x9a\x06\x02h*\xf2' read=0
Sent 75 77431.077328 77431.076768 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 76 77431.083455 77431.082695 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x1b\x082\x80\x10\xb2\xc8\xa2\xe9' read=0
Sent 77 77431.087144 77431.086584 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 78 77431.093243 77431.092483 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x1bh2\x80\x00\x02\x08 \xb6' read=0
Sent 79 77431.096933 77431.096373 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 80 77431.103063 77431.102303 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x1b\x882\x80\x00\x02\x08\xa0\xab' read=0
Sent 81 77431.106793 77431.106233 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 82 77431.112899 77431.112139 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x1bH8\x80\x00\x02\x08 \x93' read=0
Sent 83 77431.116591 77431.116031 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 84 77431.122726 77431.121966 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x1b\x08>\xe4\x1ar\x88\xa4\xc8' read=0
Sent 85 77431.127303 77431.126743 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 86 77431.132672 77431.132072 15: seq: 10, queue_digital_out oid=18 clock=2951505629 on_ticks=106200
Sent 87 77431.133531 77431.132771 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x1b(2\x80\x00\x02\x88"\xbe' read=0
Sent 88 77431.137240 77431.136680 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 89 77431.143362 77431.142602 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x1b\x088\x80\x00\x02\x08 \xf7' read=0
Sent 90 77431.147218 77431.146658 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 91 77431.152750 77431.152470 7: seq: 15, stepper_get_position oid=6
Sent 92 77431.154637 77431.154077 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x03H-\xd5' read=10
Sent 93 77431.160419 77431.160139 7: seq: 17, stepper_get_position oid=9
Sent 94 77431.162313 77431.161753 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xad\xf8' read=10
Sent 95 77431.167911 77431.167631 7: seq: 19, stepper_get_position oid=12
Sent 96 77431.169791 77431.169231 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0bH-\x8e' read=10
Sent 97 77431.175774 77431.175494 7: seq: 1b, stepper_get_position oid=13
Sent 98 77431.177758 77431.177198 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x1bH\xad\xa3' read=10
Sent 99 77431.187565 77431.187325 6: seq: 1d, emergency_stop
Dumping receive queue 100 messages
Receive: 0 77430.593197 77430.592681 11: seq: 19, clock clock=2905735941
Receive: 1 77430.646300 77430.645810 11: seq: 1a, clock clock=2909560815
Receive: 2 77430.666401 77430.645810 15: seq: 1a, analog_in_state oid=27 next_clock=2932106624 value=31238
Receive: 3 77430.698187 77430.697719 11: seq: 1b, clock clock=2913297309
Receive: 4 77430.701511 77430.700365 15: seq: 1c, config is_config=1 crc=2417496047 is_shutdown=0 move_count=1024
Receive: 5 77430.701677 77430.700605 11: seq: 1d, clock clock=2913505425
Receive: 6 77430.727570 77430.726611 8: seq: 1f, neopixel_result oid=0 success=1
Receive: 7 77430.738131 77430.734050 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8!\xc9'
Receive: 8 77430.742832 77430.740373 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 9 77430.748128 77430.744095 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08"\xba'
Receive: 10 77430.752660 77430.750218 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 11 77430.757925 77430.753896 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa2\xfe'
Receive: 12 77430.762458 77430.760009 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 13 77430.767739 77430.763709 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa2\xd9'
Receive: 14 77430.772264 77430.769819 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 15 77430.777535 77430.773506 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h"\x9d'
Receive: 16 77430.782065 77430.779616 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 17 77430.787333 77430.783305 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88"\xca'
Receive: 18 77430.791889 77430.789442 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 19 77430.797161 77430.793131 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa2\x8e'
Receive: 20 77430.801691 77430.799241 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 21 77430.806966 77430.802936 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa2\xa9'
Receive: 22 77430.811495 77430.809047 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 23 77430.816766 77430.812735 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8"\xed'
Receive: 24 77430.821321 77430.818877 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 25 77430.826679 77430.822644 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08#\x82'
Receive: 26 77430.831224 77430.828774 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 27 77430.836504 77430.832470 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa3\xc6'
Receive: 28 77430.842440 77430.838402 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8!\xc9'
Receive: 29 77430.846936 77430.844486 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 30 77430.852203 77430.848170 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08"\xba'
Receive: 31 77430.856715 77430.854271 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 32 77430.861985 77430.857954 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa2\xfe'
Receive: 33 77430.866503 77430.864056 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 34 77430.871775 77430.867743 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa2\xd9'
Receive: 35 77430.876344 77430.873857 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 36 77430.881803 77430.877765 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h"\x9d'
Receive: 37 77430.886352 77430.883905 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 38 77430.891633 77430.887599 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88"\xca'
Receive: 39 77430.896152 77430.893707 8: seq: 10, tmcuart_response oid=3 read=b''
Receive: 40 77430.901415 77430.897386 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa2\x8e'
Receive: 41 77430.905940 77430.903490 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 42 77430.911611 77430.907579 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa2\xa9'
Receive: 43 77430.916206 77430.913681 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 44 77430.921910 77430.917806 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8"\xed'
Receive: 45 77430.926788 77430.924330 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 46 77430.932109 77430.928078 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08#\x82'
Receive: 47 77430.936653 77430.934207 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 48 77430.941937 77430.937906 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa3\xc6'
Receive: 49 77430.947879 77430.943840 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8!\xc9'
Receive: 50 77430.952370 77430.949926 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 51 77430.957637 77430.953607 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08"\xba'
Receive: 52 77430.962175 77430.959725 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 53 77430.967457 77430.963410 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa2\xfe'
Receive: 54 77430.972123 77430.969672 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 55 77430.977406 77430.973375 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa2\xd9'
Receive: 56 77430.981964 77430.979511 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 57 77430.987247 77430.983212 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h"\x9d'
Receive: 58 77430.991766 77430.989319 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 59 77430.997051 77430.993016 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88"\xca'
Receive: 60 77431.001604 77430.999154 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 61 77431.006875 77431.002842 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa2\x8e'
Receive: 62 77431.011397 77431.008946 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 63 77431.016663 77431.012631 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa2\xa9'
Receive: 64 77431.021206 77431.018764 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 65 77431.026507 77431.022473 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8"\xed'
Receive: 66 77431.031029 77431.028578 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 67 77431.036294 77431.032787 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08#\x82'
Receive: 68 77431.040802 77431.038361 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 69 77431.046061 77431.042035 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa3\xc6'
Receive: 70 77431.052005 77431.047971 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H?\xeb'
Receive: 71 77431.056495 77431.054051 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 72 77431.061756 77431.057732 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h\xbf\xaf'
Receive: 73 77431.066277 77431.063826 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 74 77431.071548 77431.067518 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88\xbf\xf8'
Receive: 75 77431.076057 77431.073611 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 76 77431.081359 77431.077328 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8?\xbc'
Receive: 77 77431.085906 77431.083455 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 78 77431.091176 77431.087144 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8?\x9b'
Receive: 79 77431.095686 77431.093243 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 80 77431.100965 77431.096933 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8\xbf\xdf'
Receive: 81 77431.105505 77431.103063 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 82 77431.110826 77431.106793 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08 \xa6'
Receive: 83 77431.115347 77431.112899 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 84 77431.120622 77431.116591 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa0\xe2'
Receive: 85 77431.125226 77431.122726 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 86 77431.131358 77431.127303 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa0\xc5'
Receive: 87 77431.135982 77431.133531 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 88 77431.141270 77431.137240 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h \x81'
Receive: 89 77431.145821 77431.143362 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 90 77431.151251 77431.147218 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88 \xd6'
Receive: 91 77431.153188 77431.152750 8: seq: 16, stepper_position oid=6 pos=5
Receive: 92 77431.158672 77431.154637 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x02\x08\xaf\xb7'
Receive: 93 77431.160875 77431.160419 8: seq: 18, stepper_position oid=9 pos=38
Receive: 94 77431.166345 77431.162313 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x12\x08\xbd\x85'
Receive: 95 77431.168360 77431.167911 9: seq: 1a, stepper_position oid=12 pos=2882
Receive: 96 77431.173821 77431.169791 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x1a\x08#\xc8'
Receive: 97 77431.176251 77431.175774 8: seq: 1c, stepper_position oid=13 pos=0
Receive: 98 77431.181793 77431.177758 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x1a\x08\xb3\xcb'
Receive: 99 77431.188096 77431.187565 12: seq: 1e, shutdown clock=2948565687 static_string_id=Command request
webhooks client 281473445108352: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:05:18 2024 (1735574718.8 77494.3)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect sb_logo_busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:sb_leds
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:sb_leds
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:sb_leds (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462191968: New connection
webhooks client 281473462191968: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 15, 'next_clock': 3459699328, 'value': 31242, '#name': 'analog_in_state', '#sent_time': 77497.615201369, '#receive_time': 77497.648119244}
mcu 'mcu': got {'oid': 19, 'next_clock': 3462579328, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77497.667284578, '#receive_time': 77497.688116369}
mcu 'mcu': got {'oid': 27, 'next_clock': 3468339328, 'value': 31251, '#name': 'analog_in_state', '#sent_time': 77497.71965574399, '#receive_time': 77497.768135119}
mcu 'mcu': got {'oid': 15, 'next_clock': 3481299328, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77497.927107703, '#receive_time': 77497.948116328}
mcu 'mcu': got {'oid': 19, 'next_clock': 3484179328, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77497.979534578, '#receive_time': 77497.988120578}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
MCU error during connect
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 135, in _connect
    cb()
  File "/home/klipper/klipper/klippy/mcu.py", line 742, in _connect
    config_params = self._send_get_config()
  File "/home/klipper/klipper/klippy/mcu.py", line 728, in _send_get_config
    raise error("Can not update MCU '%s' config as it is shutdown" % (
mcu.error: Can not update MCU 'mcu' config as it is shutdown
Can not update MCU 'mcu' config as it is shutdown
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Error configuring printer

No build file /home/klipper/klipper/klippy/../.config
No build file /home/klipper/klipper/klippy/../out/klipper.dict
No build file /home/klipper/klipper/klippy/../out/klipper.elf
mcu 'mcu': got {'oid': 27, 'next_clock': 3489939328, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.068150661}
mcu 'mcu': got {'oid': 15, 'next_clock': 3502899328, 'value': 31198, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.248179286}
mcu 'mcu': got {'oid': 19, 'next_clock': 3505779328, 'value': 31271, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.28814862}
mcu 'mcu': got {'oid': 27, 'next_clock': 3511539328, 'value': 31243, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.368193203}
mcu 'mcu': got {'oid': 15, 'next_clock': 3524499328, 'value': 31199, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.548159703}
mcu 'mcu': got {'oid': 19, 'next_clock': 3527379328, 'value': 31274, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.588149661}
mcu 'mcu': got {'oid': 27, 'next_clock': 3533139328, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.668148162}
mcu 'mcu': got {'oid': 15, 'next_clock': 3546099328, 'value': 31208, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.848190912}
mcu 'mcu': got {'oid': 19, 'next_clock': 3548979328, 'value': 31272, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.888199995}
mcu 'mcu': got {'oid': 27, 'next_clock': 3554739328, 'value': 31243, '#name': 'analog_in_state', '#sent_time': 77498.03441224499, '#receive_time': 77498.968243078}
mcu 'mcu': got {'oid': 15, 'next_clock': 3567699328, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77499.01939099499, '#receive_time': 77499.148157995}
mcu 'mcu': got {'oid': 19, 'next_clock': 3570579328, 'value': 31273, '#name': 'analog_in_state', '#sent_time': 77499.01939099499, '#receive_time': 77499.188168078}
mcu 'mcu': got {'oid': 27, 'next_clock': 3576339328, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77499.01939099499, '#receive_time': 77499.268190203}
mcu 'mcu': got {'oid': 15, 'next_clock': 3589299328, 'value': 31216, '#name': 'analog_in_state', '#sent_time': 77499.01939099499, '#receive_time': 77499.448202662}
mcu 'mcu': got {'oid': 19, 'next_clock': 3592179328, 'value': 31271, '#name': 'analog_in_state', '#sent_time': 77499.01939099499, '#receive_time': 77499.488186162}
mcu 'mcu': got {'oid': 27, 'next_clock': 3597939328, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77499.01939099499, '#receive_time': 77499.568180912}
mcu 'mcu': got {'oid': 15, 'next_clock': 3610899328, 'value': 31206, '#name': 'analog_in_state', '#sent_time': 77499.01939099499, '#receive_time': 77499.748194037}
mcu 'mcu': got {'oid': 19, 'next_clock': 3613779328, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77499.01939099499, '#receive_time': 77499.788185537}
mcu 'mcu': got {'oid': 27, 'next_clock': 3619539328, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 77499.01939099499, '#receive_time': 77499.868186412}
mcu 'mcu': got {'oid': 15, 'next_clock': 3632499328, 'value': 31214, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.048168954}
mcu 'mcu': got {'oid': 19, 'next_clock': 3635379328, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.088193871}
mcu 'mcu': got {'oid': 27, 'next_clock': 3641139328, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.168190787}
mcu 'mcu': got {'oid': 15, 'next_clock': 3654099328, 'value': 31210, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.348201746}
mcu 'mcu': got {'oid': 19, 'next_clock': 3656979328, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.388197121}
mcu 'mcu': got {'oid': 27, 'next_clock': 3662739328, 'value': 31241, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.468204121}
mcu 'mcu': got {'oid': 15, 'next_clock': 3675699328, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.648179454}
mcu 'mcu': got {'oid': 19, 'next_clock': 3678579328, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.688200412}
mcu 'mcu': got {'oid': 27, 'next_clock': 3684339328, 'value': 31241, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.768211746}
mcu 'mcu': got {'oid': 15, 'next_clock': 3697299328, 'value': 31199, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.948252413}
mcu 'mcu': got {'oid': 19, 'next_clock': 3700179328, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77500.00365336999, '#receive_time': 77500.988853413}
mcu 'mcu': got {'oid': 27, 'next_clock': 3705939328, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.068235663}
mcu 'mcu': got {'oid': 15, 'next_clock': 3718899328, 'value': 31209, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.248234871}
mcu 'mcu': got {'oid': 19, 'next_clock': 3721779328, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.288225663}
mcu 'mcu': got {'oid': 27, 'next_clock': 3727539328, 'value': 31243, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.368262163}
mcu 'mcu': got {'oid': 15, 'next_clock': 3740499328, 'value': 31215, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.548246246}
mcu 'mcu': got {'oid': 19, 'next_clock': 3743379328, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.58823008}
mcu 'mcu': got {'oid': 27, 'next_clock': 3749139328, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.668261746}
mcu 'mcu': got {'oid': 15, 'next_clock': 3762099328, 'value': 31198, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.84824612101}
mcu 'mcu': got {'oid': 19, 'next_clock': 3764979328, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.888242246}
mcu 'mcu': got {'oid': 27, 'next_clock': 3770739328, 'value': 31247, '#name': 'analog_in_state', '#sent_time': 77500.98803766299, '#receive_time': 77501.968319663}
mcu 'mcu': got {'oid': 15, 'next_clock': 3783699328, 'value': 31188, '#name': 'analog_in_state', '#sent_time': 77501.97273203799, '#receive_time': 77502.148243622}
mcu 'mcu': got {'oid': 19, 'next_clock': 3786579328, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77501.97273203799, '#receive_time': 77502.188245205}
mcu 'mcu': got {'oid': 27, 'next_clock': 3792339328, 'value': 31243, '#name': 'analog_in_state', '#sent_time': 77501.97273203799, '#receive_time': 77502.268253413}
mcu 'mcu': got {'oid': 15, 'next_clock': 3805299328, 'value': 31206, '#name': 'analog_in_state', '#sent_time': 77501.97273203799, '#receive_time': 77502.448253955}
mcu 'mcu': got {'oid': 19, 'next_clock': 3808179328, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77501.97273203799, '#receive_time': 77502.488251997}
mcu 'mcu': got {'oid': 27, 'next_clock': 3813939328, 'value': 31256, '#name': 'analog_in_state', '#sent_time': 77501.97273203799, '#receive_time': 77502.568259247}
mcu 'mcu': got {'oid': 15, 'next_clock': 3826899328, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77501.97273203799, '#receive_time': 77502.748258497}
mcu 'mcu': got {'oid': 19, 'next_clock': 3829779328, 'value': 31271, '#name': 'analog_in_state', '#sent_time': 77501.97273203799, '#receive_time': 77502.788254538}
mcu 'mcu': got {'oid': 27, 'next_clock': 3835539328, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 77501.97273203799, '#receive_time': 77502.86829808001}
mcu 'mcu': got {'oid': 15, 'next_clock': 3848499328, 'value': 31205, '#name': 'analog_in_state', '#sent_time': 77502.95775945499, '#receive_time': 77503.04829333}
mcu 'mcu': got {'oid': 19, 'next_clock': 3851379328, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77502.95775945499, '#receive_time': 77503.088274705}
mcu 'mcu': got {'oid': 27, 'next_clock': 3857139328, 'value': 31247, '#name': 'analog_in_state', '#sent_time': 77502.95775945499, '#receive_time': 77503.16826358}
mcu 'mcu': got {'oid': 15, 'next_clock': 3870099328, 'value': 31204, '#name': 'analog_in_state', '#sent_time': 77502.95775945499, '#receive_time': 77503.348304705}
mcu 'mcu': got {'oid': 19, 'next_clock': 3872979328, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77502.95775945499, '#receive_time': 77503.38827845501}
mcu 'mcu': got {'oid': 27, 'next_clock': 3878739328, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77502.95775945499, '#receive_time': 77503.46829587201}
mcu 'mcu': got {'oid': 15, 'next_clock': 3891699328, 'value': 31211, '#name': 'analog_in_state', '#sent_time': 77502.95775945499, '#receive_time': 77503.648284539}
mcu 'mcu': got {'oid': 19, 'next_clock': 3894579328, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77502.95775945499, '#receive_time': 77503.688294747}
mcu 'mcu': got {'oid': 27, 'next_clock': 3900339328, 'value': 31242, '#name': 'analog_in_state', '#sent_time': 77502.95775945499, '#receive_time': 77503.768293747}
mcu 'mcu': got {'oid': 15, 'next_clock': 3913299328, 'value': 31215, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77503.948365747}
mcu 'mcu': got {'oid': 19, 'next_clock': 3916179328, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77503.988317122}
mcu 'mcu': got {'oid': 27, 'next_clock': 3921939328, 'value': 31241, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77504.068312581}
mcu 'mcu': got {'oid': 15, 'next_clock': 3934899328, 'value': 31205, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77504.248304498}
mcu 'mcu': got {'oid': 19, 'next_clock': 3937779328, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77504.288293664}
mcu 'mcu': got {'oid': 27, 'next_clock': 3943539328, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77504.368296998}
mcu 'mcu': got {'oid': 15, 'next_clock': 3956499328, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77504.548301748}
mcu 'mcu': got {'oid': 19, 'next_clock': 3959379328, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77504.588306248}
mcu 'mcu': got {'oid': 27, 'next_clock': 3965139328, 'value': 31244, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77504.668306831}
mcu 'mcu': got {'oid': 15, 'next_clock': 3978099328, 'value': 31203, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77504.848385123}
mcu 'mcu': got {'oid': 19, 'next_clock': 3980979328, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77503.94276687199, '#receive_time': 77504.888339289}
mcu 'mcu': got {'oid': 27, 'next_clock': 3986739328, 'value': 31242, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77504.968399415}
mcu 'mcu': got {'oid': 15, 'next_clock': 3999699328, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77505.148343831}
mcu 'mcu': got {'oid': 19, 'next_clock': 4002579328, 'value': 31272, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77505.188328123}
mcu 'mcu': got {'oid': 27, 'next_clock': 4008339328, 'value': 31248, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77505.268328415}
mcu 'mcu': got {'oid': 15, 'next_clock': 4021299328, 'value': 31198, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77505.448363206}
mcu 'mcu': got {'oid': 19, 'next_clock': 4024179328, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77505.488328248}
mcu 'mcu': got {'oid': 27, 'next_clock': 4029939328, 'value': 31248, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77505.568331581}
mcu 'mcu': got {'oid': 15, 'next_clock': 4042899328, 'value': 31206, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77505.748314207}
mcu 'mcu': got {'oid': 19, 'next_clock': 4045779328, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77505.788333457}
mcu 'mcu': got {'oid': 27, 'next_clock': 4051539328, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77504.92767324799, '#receive_time': 77505.868337123}
mcu 'mcu': got {'oid': 15, 'next_clock': 4064499328, 'value': 31208, '#name': 'analog_in_state', '#sent_time': 77505.912513248, '#receive_time': 77506.048380165}
mcu 'mcu': got {'oid': 19, 'next_clock': 4067379328, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77505.912513248, '#receive_time': 77506.088357415}
mcu 'mcu': got {'oid': 27, 'next_clock': 4073139328, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77505.912513248, '#receive_time': 77506.168341748}
mcu 'mcu': got {'oid': 15, 'next_clock': 4086099328, 'value': 31203, '#name': 'analog_in_state', '#sent_time': 77505.912513248, '#receive_time': 77506.348361207}
mcu 'mcu': got {'oid': 19, 'next_clock': 4088979328, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77505.912513248, '#receive_time': 77506.38835141501}
mcu 'mcu': got {'oid': 27, 'next_clock': 4094739328, 'value': 31243, '#name': 'analog_in_state', '#sent_time': 77505.912513248, '#receive_time': 77506.468345665}
mcu 'mcu': got {'oid': 15, 'next_clock': 4107699328, 'value': 31205, '#name': 'analog_in_state', '#sent_time': 77505.912513248, '#receive_time': 77506.648357499}
mcu 'mcu': got {'oid': 19, 'next_clock': 4110579328, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77505.912513248, '#receive_time': 77506.688359999}
mcu 'mcu': got {'oid': 27, 'next_clock': 4116339328, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77505.912513248, '#receive_time': 77506.768370082}
mcu 'mcu': got {'oid': 15, 'next_clock': 4129299328, 'value': 31212, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77506.948336165}
mcu 'mcu': got {'oid': 19, 'next_clock': 4132179328, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77506.98840204}
mcu 'mcu': got {'oid': 27, 'next_clock': 4137939328, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77507.068406124}
mcu 'mcu': got {'oid': 15, 'next_clock': 4150899328, 'value': 31211, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77507.248388332}
mcu 'mcu': got {'oid': 19, 'next_clock': 4153779328, 'value': 31273, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77507.288378207}
mcu 'mcu': got {'oid': 27, 'next_clock': 4159539328, 'value': 31242, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77507.368415082}
mcu 'mcu': got {'oid': 15, 'next_clock': 4172499328, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77507.548396541}
mcu 'mcu': got {'oid': 19, 'next_clock': 4175379328, 'value': 31273, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77507.588388457}
mcu 'mcu': got {'oid': 27, 'next_clock': 4181139328, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77507.668406291}
mcu 'mcu': got {'oid': 15, 'next_clock': 4194099328, 'value': 31202, '#name': 'analog_in_state', '#sent_time': 77506.897564332, '#receive_time': 77507.848390541}
mcu 'mcu': got {'oid': 19, 'next_clock': 4196979328, 'value': 31275, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77507.888367291}
mcu 'mcu': got {'oid': 27, 'next_clock': 4202739328, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77507.968400624}
mcu 'mcu': got {'oid': 15, 'next_clock': 4215699328, 'value': 31206, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77508.148441124}
mcu 'mcu': got {'oid': 19, 'next_clock': 4218579328, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77508.188407166}
mcu 'mcu': got {'oid': 27, 'next_clock': 4224339328, 'value': 31242, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77508.268398791}
mcu 'mcu': got {'oid': 15, 'next_clock': 4237299328, 'value': 31212, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77508.448397916}
mcu 'mcu': got {'oid': 19, 'next_clock': 4240179328, 'value': 31274, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77508.488398708}
mcu 'mcu': got {'oid': 27, 'next_clock': 4245939328, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77508.568411625}
mcu 'mcu': got {'oid': 15, 'next_clock': 4258899328, 'value': 31191, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77508.748411333}
mcu 'mcu': got {'oid': 19, 'next_clock': 4261779328, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77507.881643416, '#receive_time': 77508.788408791}
mcu 'mcu': got {'oid': 27, 'next_clock': 4267539328, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77508.868388}
mcu 'mcu': got {'oid': 15, 'next_clock': 4280499328, 'value': 31201, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77509.048475625}
mcu 'mcu': got {'oid': 19, 'next_clock': 4283379328, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77509.088460375}
mcu 'mcu': got {'oid': 27, 'next_clock': 4289139328, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77509.168443875}
mcu 'mcu': got {'oid': 15, 'next_clock': 7132032, 'value': 31207, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77509.348461542}
mcu 'mcu': got {'oid': 19, 'next_clock': 10012032, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77509.388441417}
mcu 'mcu': got {'oid': 27, 'next_clock': 15772032, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77509.46843675}
mcu 'mcu': got {'oid': 15, 'next_clock': 28732032, 'value': 31201, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77509.648438625}
mcu 'mcu': got {'oid': 19, 'next_clock': 31612032, 'value': 31274, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77509.688458833}
mcu 'mcu': got {'oid': 27, 'next_clock': 37372032, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77508.86657354099, '#receive_time': 77509.768448417}
mcu 'mcu': got {'oid': 15, 'next_clock': 50332032, 'value': 31204, '#name': 'analog_in_state', '#sent_time': 77509.85065658399, '#receive_time': 77509.948420334}
mcu 'mcu': got {'oid': 19, 'next_clock': 53212032, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77509.85065658399, '#receive_time': 77509.988477375}
mcu 'mcu': got {'oid': 27, 'next_clock': 58972032, 'value': 31242, '#name': 'analog_in_state', '#sent_time': 77509.85065658399, '#receive_time': 77510.068515667}
mcu 'mcu': got {'oid': 15, 'next_clock': 71932032, 'value': 31204, '#name': 'analog_in_state', '#sent_time': 77509.85065658399, '#receive_time': 77510.248477542}
mcu 'mcu': got {'oid': 19, 'next_clock': 74812032, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77509.85065658399, '#receive_time': 77510.288459625}
mcu 'mcu': got {'oid': 27, 'next_clock': 80572032, 'value': 31247, '#name': 'analog_in_state', '#sent_time': 77509.85065658399, '#receive_time': 77510.368455375}
mcu 'mcu': got {'oid': 15, 'next_clock': 93532032, 'value': 31244, '#name': 'analog_in_state', '#sent_time': 77509.85065658399, '#receive_time': 77510.54845775099}
mcu 'mcu': got {'oid': 19, 'next_clock': 96412032, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 77509.85065658399, '#receive_time': 77510.588457876}
mcu 'mcu': got {'oid': 27, 'next_clock': 102172032, 'value': 31243, '#name': 'analog_in_state', '#sent_time': 77509.85065658399, '#receive_time': 77510.668470792}
mcu 'mcu': got {'oid': 15, 'next_clock': 115132032, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77510.83556475099, '#receive_time': 77510.848433792}
mcu 'mcu': got {'oid': 19, 'next_clock': 118012032, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77510.83556475099, '#receive_time': 77510.888456334}
mcu 'mcu': got {'oid': 27, 'next_clock': 123772032, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77510.83556475099, '#receive_time': 77510.968469209}
Attempting MCU 'mcu' reset command
webhooks client 281473462191968: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:05:36 2024 (1735574736.6 77512.2)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect sb_logo_busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:sb_leds
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:sb_leds
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:sb_leds (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473465820320: New connection
webhooks client 281473465820320: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Unhandled exception during ready callback
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 164, in _connect
    cb()
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 390, in _handle_ready
    ledChain = self.printer.lookup_object(chainName)
  File "/home/klipper/klipper/klippy/klippy.py", line 79, in lookup_object
    raise self.config_error("Unknown config object '%s'" % (name,))
configparser.Error: Unknown config object 'neopixel sb_leds'
Transition to shutdown state: Internal error during ready callback: Unknown config object 'neopixel sb_leds'
Dumping gcode input 0 blocks
Dumping 10 requests for client 281473465820320
Received 77514.985421: b'{"id":281472850291456,"method":"info","params":{"client_info":{"program":"Moonraker","version":"v0.9.3-4-ga4604e3"}}}'
Received 77514.985421: b'{"id":281472834386528,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 77514.985421: b'{"id":281472833835152,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 77515.014191: b'{"id":281472832490656,"method":"list_endpoints","params":{}}'
Received 77515.087928: b'{"id":281472834386144,"method":"info","params":{}}'
Received 77515.266621: b'{"id":281472834385520,"method":"info","params":{}}'
Received 77515.518713: b'{"id":281472834385520,"method":"info","params":{}}'
Received 77515.770021: b'{"id":281472834385520,"method":"info","params":{}}'
Received 77516.022087: b'{"id":281472850291456,"method":"info","params":{}}'
Received 77516.274263: b'{"id":281472850291456,"method":"info","params":{}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (77515.409774128, 0.0, 0.0)
Internal error during ready callback: Unknown config object 'neopixel sb_leds'
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Printer is shutdown

MCU 'mcu' shutdown: Command request
clocksync state: mcu_freq=72000000 last_clock=342297973 clock_est=(77515.480 317220176 71993701.683) min_half_rtt=0.000225 min_rtt_time=77515.825 time_avg=77515.480(0.018) clock_avg=317220176.924(1277608.537) pred_variance=3821157575.628
Dumping serial stats: bytes_write=2838 bytes_read=6173 bytes_retransmit=0 bytes_invalid=0 send_seq=222 receive_seq=222 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8
Dumping send queue 100 messages
Sent 0 77515.848782 77515.842216 56: seq: 1a, queue_digital_out oid=16 clock=356827359 on_ticks=7200000, buttons_add oid=17 pos=0 pin=PC15 pull_up=0, buttons_add oid=17 pos=1 pin=PA10 pull_up=1, buttons_add oid=17 pos=2 pin=PA9 pull_up=1, buttons_add oid=17 pos=3 pin=PA15 pull_up=1, buttons_query oid=17 clock=444240000 rest_ticks=144000 retransmit_count=50 invert=9, queue_digital_out oid=18 clock=356842580 on_ticks=0
Sent 1 77515.851102 77515.844684 58: seq: 1b, query_analog_in oid=19 clock=445680000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=11782 max_value=32201 range_check_count=4, queue_digital_out oid=20 clock=356867024 on_ticks=0, queue_digital_out oid=21 clock=356871248 on_ticks=0, queue_digital_out oid=22 clock=356875310 on_ticks=0, queue_digital_out oid=23 clock=356888686 on_ticks=0
Sent 2 77515.852822 77515.847603 43: seq: 1c, queue_digital_out oid=5 clock=356894874 on_ticks=0, query_analog_in oid=27 clock=451440000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=855 max_value=32201 range_check_count=4, queue_digital_out oid=28 clock=356956957 on_ticks=0, get_config
Sent 3 77515.858417 77515.856617 45: seq: 1d, neopixel_update oid=0 pos=0 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_update oid=0 pos=16 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
Sent 4 77515.865043 77515.863963 27: seq: 1e, neopixel_update oid=0 pos=32 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_send oid=0
Sent 5 77515.872459 77515.871899 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 6 77515.878788 77515.878028 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03\x080\x80\x00\n\x08\xb8\x87' read=0
Sent 7 77515.882542 77515.881982 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 8 77515.888651 77515.887891 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03h0\x80\x00\x12\x08 \xda' read=0
Sent 9 77515.892326 77515.891766 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 10 77515.898412 77515.897652 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x03\x88=\x9a\x06\x02h*\xbf' read=0
Sent 11 77515.902618 77515.902058 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 12 77515.909170 77515.908410 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x03\x082\x80\x10\x92H\xa2\x83' read=0
Sent 13 77515.912909 77515.912349 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 14 77515.919084 77515.918324 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x03h2\x80\x00\x02\x08 \xfb' read=0
Sent 15 77515.922825 77515.922265 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 16 77515.928948 77515.928188 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x03\x882\x80\x00\x02\x08\xa0\xe6' read=0
Sent 17 77515.932645 77515.932085 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 18 77515.938757 77515.937997 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x03H8\x80\x00\x02\x08 \xde' read=0
Sent 19 77515.942463 77515.941903 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 20 77515.948584 77515.947824 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x03\x08>\xe4\x1ar\x88\xa4\x85' read=0
Sent 21 77515.952275 77515.951715 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 22 77515.958380 77515.957620 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03(2\x80\x00\x02\x88"\xf3' read=0
Sent 23 77515.962068 77515.961508 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 24 77515.968173 77515.967413 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03\x088\x80\x00\x02\x08 \xba' read=0
Sent 25 77515.971882 77515.971322 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 26 77515.978413 77515.977853 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 27 77515.984939 77515.984179 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x13\x080\x80\x00\n\x08\xb8\xbc' read=0
Sent 28 77515.988687 77515.988127 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 29 77515.994849 77515.994089 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x13h0\x80\x00\x12\x08 \xe1' read=0
Sent 30 77515.998545 77515.997985 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 31 77516.004677 77516.003917 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x13\x88=\x9a\x06\x02h*\x84' read=0
Sent 32 77516.008375 77516.007815 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 33 77516.014478 77516.013718 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x13\x082\x80\x10\x9ah"\xa7' read=0
Sent 34 77516.018159 77516.017599 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 35 77516.024674 77516.023914 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x13h2\x80\x00\x02\x08 \xc0' read=0
Sent 36 77516.028421 77516.027861 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 37 77516.035093 77516.033933 29: seq: 1f, tmcuart_send oid=3 write=b'\xea\x13\x882\x80\x00\x02\x08\xa0\xdd' read=0, queue_digital_out oid=18 clock=366693979 on_ticks=157680
Sent 38 77516.038839 77516.038279 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 39 77516.044962 77516.044202 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x13H8\x80\x00\x02\x08 \xe5' read=0
Sent 40 77516.048652 77516.048092 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 41 77516.054756 77516.053996 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x13\x08>\xe4\x1ar\x88\xa4\xbe' read=0
Sent 42 77516.058447 77516.057887 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 43 77516.064546 77516.063786 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x13(2\x80\x00\x02\x88"\xc8' read=0
Sent 44 77516.068284 77516.067724 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 45 77516.074397 77516.073637 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x13\x088\x80\x00\x02\x08 \x81' read=0
Sent 46 77516.078072 77516.077512 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 47 77516.083993 77516.083433 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 48 77516.090081 77516.089321 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0b\x080\x80\x00\n\x08\xb8\xf1' read=0
Sent 49 77516.093758 77516.093198 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 50 77516.099856 77516.099096 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x0bh0\x80\x00\x12\x08 \xac' read=0
Sent 51 77516.103545 77516.102985 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 52 77516.109651 77516.108891 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0b\x88=\x92\x06\x02h*\x91' read=0
Sent 53 77516.113327 77516.112767 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 54 77516.119483 77516.118723 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x0b\x082\x80\x10\x92H\xa2\xf5' read=0
Sent 55 77516.123182 77516.122622 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 56 77516.129286 77516.128526 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x0bh2\x80\x00\x02\x08 \x8d' read=0
Sent 57 77516.132972 77516.132412 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 58 77516.139105 77516.138345 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x0b\x882\x80\x00\x02\x08\xa0\x90' read=0
Sent 59 77516.142822 77516.142262 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 60 77516.148925 77516.148165 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x0bH8\x80\x00\x02\x08 \xa8' read=0
Sent 61 77516.152619 77516.152059 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 62 77516.158724 77516.157964 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x0b\x08>\xe4\x1ar\x88\xa4\xf3' read=0
Sent 63 77516.162401 77516.161841 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 64 77516.168497 77516.167737 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0b(2\x80\x00\x02\x88"\x85' read=0
Sent 65 77516.171533 77516.171013 13: seq: 1b, queue_digital_out oid=18 clock=373893979 on_ticks=0
Sent 66 77516.172180 77516.171620 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 67 77516.178659 77516.177899 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0b\x088\x80\x00\x02\x08 \xcc' read=0
Sent 68 77516.183067 77516.182507 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 69 77516.189712 77516.189152 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 70 77516.196556 77516.195796 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x1b\x080\x80\x00\n\x08\xb8\xca' read=0
Sent 71 77516.200369 77516.199809 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 72 77516.206536 77516.205776 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x1bh0\x80\x00\x12\x08 \x97' read=0
Sent 73 77516.210239 77516.209679 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 74 77516.216411 77516.215651 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x1b\x88=\x9a\x06\x02h*\xf2' read=0
Sent 75 77516.220190 77516.219630 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 76 77516.226343 77516.225583 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x1b\x082\x80\x10\xb2\xc8\xa2\xe9' read=0
Sent 77 77516.230367 77516.229807 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 78 77516.236561 77516.235801 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x1bh2\x80\x00\x02\x08 \xb6' read=0
Sent 79 77516.240266 77516.239706 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 80 77516.246677 77516.245917 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x1b\x882\x80\x00\x02\x08\xa0\xab' read=0
Sent 81 77516.250397 77516.249837 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 82 77516.256530 77516.255770 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x1bH8\x80\x00\x02\x08 \x93' read=0
Sent 83 77516.260229 77516.259669 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 84 77516.266335 77516.265575 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x1b\x08>\xe4\x1ar\x88\xa4\xc8' read=0
Sent 85 77516.270014 77516.269454 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 86 77516.271051 77516.270451 15: seq: 10, queue_digital_out oid=18 clock=381093978 on_ticks=106200
Sent 87 77516.276651 77516.275891 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x1b(2\x80\x00\x02\x88"\xbe' read=0
Sent 88 77516.280415 77516.279855 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 89 77516.286533 77516.285773 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x1b\x088\x80\x00\x02\x08 \xf7' read=0
Sent 90 77516.290209 77516.289649 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 91 77516.295718 77516.295438 7: seq: 15, stepper_get_position oid=6
Sent 92 77516.297543 77516.296983 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x03H-\xd5' read=10
Sent 93 77516.303315 77516.303035 7: seq: 17, stepper_get_position oid=9
Sent 94 77516.305179 77516.304619 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xad\xf8' read=10
Sent 95 77516.310800 77516.310520 7: seq: 19, stepper_get_position oid=12
Sent 96 77516.312628 77516.312068 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0bH-\x8e' read=10
Sent 97 77516.318645 77516.318365 7: seq: 1b, stepper_get_position oid=13
Sent 98 77516.320615 77516.320055 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x1bH\xad\xa3' read=10
Sent 99 77516.329091 77516.328851 6: seq: 1d, emergency_stop
Dumping receive queue 100 messages
Receive: 0 77515.773840 77515.773344 11: seq: 16, clock clock=338364955
Receive: 1 77515.825632 77515.825182 11: seq: 17, clock clock=342095617
Receive: 2 77515.828830 77515.827694 10: seq: 18, config is_config=0 crc=0 is_shutdown=0 move_count=0
Receive: 3 77515.828798 77515.827993 11: seq: 19, clock clock=342297973
Receive: 4 77515.853324 77515.852822 15: seq: 1d, config is_config=1 crc=2417496047 is_shutdown=0 move_count=1024
Receive: 5 77515.866010 77515.865043 8: seq: 1f, neopixel_result oid=0 success=1
Receive: 6 77515.876537 77515.872459 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa3\xc6'
Receive: 7 77515.881272 77515.878788 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 8 77515.886566 77515.882542 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa3\xe1'
Receive: 9 77515.891092 77515.888651 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 10 77515.896351 77515.892326 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h#\xa5'
Receive: 11 77515.900898 77515.898412 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 12 77515.906721 77515.902618 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88#\xf2'
Receive: 13 77515.911625 77515.909170 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 14 77515.916939 77515.912909 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa3\xb6'
Receive: 15 77515.921531 77515.919084 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 16 77515.926860 77515.922825 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa3\x91'
Receive: 17 77515.931397 77515.928948 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 18 77515.936677 77515.932645 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8#\xd5'
Receive: 19 77515.941200 77515.938757 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 20 77515.946491 77515.942463 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08$\xa8'
Receive: 21 77515.951030 77515.948584 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 22 77515.956304 77515.952275 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa4\xec'
Receive: 23 77515.960825 77515.958380 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 24 77515.966097 77515.962068 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa4\xcb'
Receive: 25 77515.970618 77515.968173 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 26 77515.976021 77515.971882 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h$\x8f'
Receive: 27 77515.982530 77515.978413 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa3\xc6'
Receive: 28 77515.987397 77515.984939 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 29 77515.992722 77515.988687 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa3\xe1'
Receive: 30 77515.997295 77515.994849 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 31 77516.002573 77515.998545 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h#\xa5'
Receive: 32 77516.007130 77516.004677 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 33 77516.012409 77516.008375 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88#\xf2'
Receive: 34 77516.016920 77516.014478 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 35 77516.022240 77516.018159 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa3\xb6'
Receive: 36 77516.027142 77516.024674 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 37 77516.032459 77516.028421 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa3\x91'
Receive: 38 77516.037549 77516.035093 8: seq: 10, tmcuart_response oid=3 read=b''
Receive: 39 77516.042873 77516.038839 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8#\xd5'
Receive: 40 77516.047411 77516.044962 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 41 77516.052685 77516.048652 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08$\xa8'
Receive: 42 77516.057202 77516.054756 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 43 77516.062476 77516.058447 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa4\xec'
Receive: 44 77516.066997 77516.064546 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 45 77516.072319 77516.068284 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa4\xcb'
Receive: 46 77516.074299 77516.068284 15: seq: 17, stats count=251 sum=553615 sumsq=19847893
Receive: 47 77516.076843 77516.074397 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 48 77516.082099 77516.078072 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h$\x8f'
Receive: 49 77516.088032 77516.083993 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa3\xc6'
Receive: 50 77516.092522 77516.090081 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 51 77516.097789 77516.093758 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa3\xe1'
Receive: 52 77516.102307 77516.099856 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 53 77516.107580 77516.103545 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h#\xa5'
Receive: 54 77516.112092 77516.109651 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 55 77516.117373 77516.113327 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88#\xf2'
Receive: 56 77516.121938 77516.119483 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 57 77516.127217 77516.123182 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa3\xb6'
Receive: 58 77516.131732 77516.129286 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 59 77516.137004 77516.132972 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa3\x91'
Receive: 60 77516.141551 77516.139105 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 61 77516.146856 77516.142822 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8#\xd5'
Receive: 62 77516.151373 77516.148925 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 63 77516.156653 77516.152619 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08$\xa8'
Receive: 64 77516.161168 77516.158724 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 65 77516.166431 77516.162401 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa4\xec'
Receive: 66 77516.170930 77516.168497 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 67 77516.176230 77516.172180 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa4\xcb'
Receive: 68 77516.181239 77516.178659 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 69 77516.187205 77516.183067 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h$\x8f'
Receive: 70 77516.193888 77516.189712 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88 \xd6'
Receive: 71 77516.199023 77516.196556 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 72 77516.204402 77516.200369 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa0\x92'
Receive: 73 77516.208979 77516.206536 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 74 77516.214270 77516.210239 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa0\xb5'
Receive: 75 77516.218868 77516.216411 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 76 77516.224223 77516.220190 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8 \xf1'
Receive: 77 77516.228991 77516.226343 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 78 77516.234406 77516.230367 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08!\x9e'
Receive: 79 77516.239015 77516.236561 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 80 77516.244328 77516.240266 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa1\xda'
Receive: 81 77516.249131 77516.246677 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 82 77516.254430 77516.250397 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa1\xfd'
Receive: 83 77516.258975 77516.256530 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 84 77516.264262 77516.260229 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h!\xb9'
Receive: 85 77516.268779 77516.266335 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 86 77516.274108 77516.271051 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88!\xee'
Receive: 87 77516.279126 77516.276651 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 88 77516.284449 77516.280415 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa1\xaa'
Receive: 89 77516.288975 77516.286533 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 90 77516.294237 77516.290209 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa1\x8d'
Receive: 91 77516.296156 77516.295718 8: seq: 16, stepper_position oid=6 pos=0
Receive: 92 77516.301577 77516.297543 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x02\x081\xa1'
Receive: 93 77516.303764 77516.303315 8: seq: 18, stepper_position oid=9 pos=0
Receive: 94 77516.309215 77516.305179 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x1a\x08!\xd4'
Receive: 95 77516.311245 77516.310800 8: seq: 1a, stepper_position oid=12 pos=0
Receive: 96 77516.316663 77516.312628 18: seq: 1b, tmcuart_response oid=3 read=b"\n\xfaO-\x80\x00\x1a\x08'\xc6"
Receive: 97 77516.319111 77516.318645 8: seq: 1c, stepper_position oid=13 pos=0
Receive: 98 77516.324649 77516.320615 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x1a\x08/\xc1'
Receive: 99 77516.329650 77516.329091 12: seq: 1e, shutdown clock=378377449 static_string_id=Command request
webhooks client 281473465820320: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:07:06 2024 (1735574826.6 77602.2)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect sb_logo_busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:sb_leds
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:sb_leds
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:sb_leds (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473463900896: New connection
webhooks client 281473463900896: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
mcu 'mcu': got {'oid': 27, 'next_clock': 2528472704, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77605.55141196199, '#receive_time': 77605.553572462}
mcu 'mcu': got {'oid': 15, 'next_clock': 2541432704, 'value': 31189, '#name': 'analog_in_state', '#sent_time': 77605.706949421, '#receive_time': 77605.733576421}
mcu 'mcu': got {'oid': 19, 'next_clock': 2544312704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77605.75880625399, '#receive_time': 77605.773581379}
mcu 'mcu': got {'oid': 27, 'next_clock': 2550072704, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77605.81067246299, '#receive_time': 77605.853693504}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
MCU error during connect
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 135, in _connect
    cb()
  File "/home/klipper/klipper/klippy/mcu.py", line 742, in _connect
    config_params = self._send_get_config()
  File "/home/klipper/klipper/klippy/mcu.py", line 728, in _send_get_config
    raise error("Can not update MCU '%s' config as it is shutdown" % (
mcu.error: Can not update MCU 'mcu' config as it is shutdown
Can not update MCU 'mcu' config as it is shutdown
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Error configuring printer

No build file /home/klipper/klipper/klippy/../.config
No build file /home/klipper/klipper/klippy/../out/klipper.dict
No build file /home/klipper/klipper/klippy/../out/klipper.elf
mcu 'mcu': got {'oid': 15, 'next_clock': 2563032704, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77605.91859983798, '#receive_time': 77606.033616296}
mcu 'mcu': got {'oid': 19, 'next_clock': 2565912704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77605.91859983798, '#receive_time': 77606.073656796}
mcu 'mcu': got {'oid': 27, 'next_clock': 2571672704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77605.91859983798, '#receive_time': 77606.153666338}
mcu 'mcu': got {'oid': 15, 'next_clock': 2584632704, 'value': 31191, '#name': 'analog_in_state', '#sent_time': 77605.91859983798, '#receive_time': 77606.333625463}
mcu 'mcu': got {'oid': 19, 'next_clock': 2587512704, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77605.91859983798, '#receive_time': 77606.373633671}
mcu 'mcu': got {'oid': 27, 'next_clock': 2593272704, 'value': 31241, '#name': 'analog_in_state', '#sent_time': 77605.91859983798, '#receive_time': 77606.453622671}
mcu 'mcu': got {'oid': 15, 'next_clock': 2606232704, 'value': 31185, '#name': 'analog_in_state', '#sent_time': 77605.91859983798, '#receive_time': 77606.63362038}
mcu 'mcu': got {'oid': 19, 'next_clock': 2609112704, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77605.91859983798, '#receive_time': 77606.67361913}
mcu 'mcu': got {'oid': 27, 'next_clock': 2614872704, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77605.91859983798, '#receive_time': 77606.753619463}
mcu 'mcu': got {'oid': 15, 'next_clock': 2627832704, 'value': 31191, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77606.933601046}
mcu 'mcu': got {'oid': 19, 'next_clock': 2630712704, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77606.97362688}
mcu 'mcu': got {'oid': 27, 'next_clock': 2636472704, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77607.05368688}
mcu 'mcu': got {'oid': 15, 'next_clock': 2649432704, 'value': 31184, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77607.233679463}
mcu 'mcu': got {'oid': 19, 'next_clock': 2652312704, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77607.273659672}
mcu 'mcu': got {'oid': 27, 'next_clock': 2658072704, 'value': 31231, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77607.353637505}
mcu 'mcu': got {'oid': 15, 'next_clock': 2671032704, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77607.533651547}
mcu 'mcu': got {'oid': 19, 'next_clock': 2673912704, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77607.573638338}
mcu 'mcu': got {'oid': 27, 'next_clock': 2679672704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77607.653662713}
mcu 'mcu': got {'oid': 15, 'next_clock': 2692632704, 'value': 31176, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77607.833670505}
mcu 'mcu': got {'oid': 19, 'next_clock': 2695512704, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77606.903285713, '#receive_time': 77607.873700297}
mcu 'mcu': got {'oid': 27, 'next_clock': 2701272704, 'value': 31241, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77607.953695005}
mcu 'mcu': got {'oid': 15, 'next_clock': 2714232704, 'value': 31177, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77608.133689047}
mcu 'mcu': got {'oid': 19, 'next_clock': 2717112704, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77608.173679422}
mcu 'mcu': got {'oid': 27, 'next_clock': 2722872704, 'value': 31249, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77608.253672422}
mcu 'mcu': got {'oid': 15, 'next_clock': 2735832704, 'value': 31215, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77608.433675297}
mcu 'mcu': got {'oid': 19, 'next_clock': 2738712704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77608.473674006}
mcu 'mcu': got {'oid': 27, 'next_clock': 2744472704, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77608.553686339}
mcu 'mcu': got {'oid': 15, 'next_clock': 2757432704, 'value': 31176, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77608.733675922}
mcu 'mcu': got {'oid': 19, 'next_clock': 2760312704, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77608.773680089}
mcu 'mcu': got {'oid': 27, 'next_clock': 2766072704, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77607.88766904699, '#receive_time': 77608.853723881}
mcu 'mcu': got {'oid': 15, 'next_clock': 2779032704, 'value': 31172, '#name': 'analog_in_state', '#sent_time': 77608.872138797, '#receive_time': 77609.033723756}
mcu 'mcu': got {'oid': 19, 'next_clock': 2781912704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77608.872138797, '#receive_time': 77609.073720381}
mcu 'mcu': got {'oid': 27, 'next_clock': 2787672704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77608.872138797, '#receive_time': 77609.153697589}
mcu 'mcu': got {'oid': 15, 'next_clock': 2800632704, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 77608.872138797, '#receive_time': 77609.333724714}
mcu 'mcu': got {'oid': 19, 'next_clock': 2803512704, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77608.872138797, '#receive_time': 77609.373690589}
mcu 'mcu': got {'oid': 27, 'next_clock': 2809272704, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77608.872138797, '#receive_time': 77609.453692589}
mcu 'mcu': got {'oid': 15, 'next_clock': 2822232704, 'value': 31187, '#name': 'analog_in_state', '#sent_time': 77608.872138797, '#receive_time': 77609.633721506}
mcu 'mcu': got {'oid': 19, 'next_clock': 2825112704, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77608.872138797, '#receive_time': 77609.673686256}
mcu 'mcu': got {'oid': 27, 'next_clock': 2830872704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77608.872138797, '#receive_time': 77609.753721506}
mcu 'mcu': got {'oid': 15, 'next_clock': 2843832704, 'value': 31185, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77609.933763631}
mcu 'mcu': got {'oid': 19, 'next_clock': 2846712704, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77609.973736423}
mcu 'mcu': got {'oid': 27, 'next_clock': 2852472704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77610.053750423}
mcu 'mcu': got {'oid': 15, 'next_clock': 2865432704, 'value': 31182, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77610.233718173}
mcu 'mcu': got {'oid': 19, 'next_clock': 2868312704, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77610.273716798}
mcu 'mcu': got {'oid': 27, 'next_clock': 2874072704, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77610.35371067301}
mcu 'mcu': got {'oid': 15, 'next_clock': 2887032704, 'value': 31175, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77610.533716965}
mcu 'mcu': got {'oid': 19, 'next_clock': 2889912704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77610.573714132}
mcu 'mcu': got {'oid': 27, 'next_clock': 2895672704, 'value': 31244, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77610.653717715}
mcu 'mcu': got {'oid': 15, 'next_clock': 2908632704, 'value': 31177, '#name': 'analog_in_state', '#sent_time': 77609.856772756, '#receive_time': 77610.833813882}
mcu 'mcu': got {'oid': 19, 'next_clock': 2911512704, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77610.873697965}
mcu 'mcu': got {'oid': 27, 'next_clock': 2917272704, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77610.953769007}
mcu 'mcu': got {'oid': 15, 'next_clock': 2930232704, 'value': 31169, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77611.133756798}
mcu 'mcu': got {'oid': 19, 'next_clock': 2933112704, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77611.173732424}
mcu 'mcu': got {'oid': 27, 'next_clock': 2938872704, 'value': 31228, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77611.253761174}
mcu 'mcu': got {'oid': 15, 'next_clock': 2951832704, 'value': 31191, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77611.43373934}
mcu 'mcu': got {'oid': 19, 'next_clock': 2954712704, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77611.47374634}
mcu 'mcu': got {'oid': 27, 'next_clock': 2960472704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77611.553734049}
mcu 'mcu': got {'oid': 15, 'next_clock': 2973432704, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77611.733781215}
mcu 'mcu': got {'oid': 19, 'next_clock': 2976312704, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 77610.840911507, '#receive_time': 77611.773746674}
mcu 'mcu': got {'oid': 27, 'next_clock': 2982072704, 'value': 31227, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77611.853730507}
mcu 'mcu': got {'oid': 15, 'next_clock': 2995032704, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77612.033801216}
mcu 'mcu': got {'oid': 19, 'next_clock': 2997912704, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77612.073796257}
mcu 'mcu': got {'oid': 27, 'next_clock': 3003672704, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77612.153762591}
mcu 'mcu': got {'oid': 15, 'next_clock': 3016632704, 'value': 31188, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77612.333735257}
mcu 'mcu': got {'oid': 19, 'next_clock': 3019512704, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77612.373745466}
mcu 'mcu': got {'oid': 27, 'next_clock': 3025272704, 'value': 31232, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77612.453755966}
mcu 'mcu': got {'oid': 15, 'next_clock': 3038232704, 'value': 31202, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77612.633772633}
mcu 'mcu': got {'oid': 19, 'next_clock': 3041112704, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77612.673774591}
mcu 'mcu': got {'oid': 27, 'next_clock': 3046872704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77611.825254132, '#receive_time': 77612.753772799}
mcu 'mcu': got {'oid': 15, 'next_clock': 3059832704, 'value': 31181, '#name': 'analog_in_state', '#sent_time': 77612.80957892399, '#receive_time': 77612.933803299}
mcu 'mcu': got {'oid': 19, 'next_clock': 3062712704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77612.80957892399, '#receive_time': 77612.973826549}
mcu 'mcu': got {'oid': 27, 'next_clock': 3068472704, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77612.80957892399, '#receive_time': 77613.053887091}
mcu 'mcu': got {'oid': 15, 'next_clock': 3081432704, 'value': 31183, '#name': 'analog_in_state', '#sent_time': 77612.80957892399, '#receive_time': 77613.233826716}
mcu 'mcu': got {'oid': 19, 'next_clock': 3084312704, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77612.80957892399, '#receive_time': 77613.273795341}
mcu 'mcu': got {'oid': 27, 'next_clock': 3090072704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77612.80957892399, '#receive_time': 77613.353793425}
mcu 'mcu': got {'oid': 15, 'next_clock': 3103032704, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 77612.80957892399, '#receive_time': 77613.533793966}
mcu 'mcu': got {'oid': 19, 'next_clock': 3105912704, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77612.80957892399, '#receive_time': 77613.573792883}
mcu 'mcu': got {'oid': 27, 'next_clock': 3111672704, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77612.80957892399, '#receive_time': 77613.653791716}
mcu 'mcu': got {'oid': 15, 'next_clock': 3124632704, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77613.833772175}
mcu 'mcu': got {'oid': 19, 'next_clock': 3127512704, 'value': 31275, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77613.873791466}
mcu 'mcu': got {'oid': 27, 'next_clock': 3133272704, 'value': 31244, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77613.953799342}
mcu 'mcu': got {'oid': 15, 'next_clock': 3146232704, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77614.133843008}
mcu 'mcu': got {'oid': 19, 'next_clock': 3149112704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77614.173810633}
mcu 'mcu': got {'oid': 27, 'next_clock': 3154872704, 'value': 31250, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77614.253815258}
mcu 'mcu': got {'oid': 15, 'next_clock': 3167832704, 'value': 31189, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77614.433811633}
mcu 'mcu': got {'oid': 19, 'next_clock': 3170712704, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77614.473812508}
mcu 'mcu': got {'oid': 27, 'next_clock': 3176472704, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77614.553813633}
mcu 'mcu': got {'oid': 15, 'next_clock': 3189432704, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77614.73382942501}
mcu 'mcu': got {'oid': 19, 'next_clock': 3192312704, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77613.79378071599, '#receive_time': 77614.7738278}
mcu 'mcu': got {'oid': 27, 'next_clock': 3198072704, 'value': 31247, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77614.85380355}
mcu 'mcu': got {'oid': 15, 'next_clock': 3211032704, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77615.033875259}
mcu 'mcu': got {'oid': 19, 'next_clock': 3213912704, 'value': 31260, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77615.07387305}
mcu 'mcu': got {'oid': 27, 'next_clock': 3219672704, 'value': 31241, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77615.1538493}
mcu 'mcu': got {'oid': 15, 'next_clock': 3232632704, 'value': 31183, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77615.333872884}
mcu 'mcu': got {'oid': 19, 'next_clock': 3235512704, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77615.373844426}
mcu 'mcu': got {'oid': 27, 'next_clock': 3241272704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77615.453848634}
mcu 'mcu': got {'oid': 15, 'next_clock': 3254232704, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77615.633851801}
mcu 'mcu': got {'oid': 19, 'next_clock': 3257112704, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77615.673846384}
mcu 'mcu': got {'oid': 27, 'next_clock': 3262872704, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77614.77868875899, '#receive_time': 77615.753873384}
mcu 'mcu': got {'oid': 15, 'next_clock': 3275832704, 'value': 31204, '#name': 'analog_in_state', '#sent_time': 77615.762911717, '#receive_time': 77615.933902384}
mcu 'mcu': got {'oid': 19, 'next_clock': 3278712704, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77615.762911717, '#receive_time': 77615.973866342}
mcu 'mcu': got {'oid': 27, 'next_clock': 3284472704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77615.762911717, '#receive_time': 77616.053904551}
mcu 'mcu': got {'oid': 15, 'next_clock': 3297432704, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77615.762911717, '#receive_time': 77616.233871968}
mcu 'mcu': got {'oid': 19, 'next_clock': 3300312704, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77615.762911717, '#receive_time': 77616.273875509}
mcu 'mcu': got {'oid': 27, 'next_clock': 3306072704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77615.762911717, '#receive_time': 77616.353868051}
mcu 'mcu': got {'oid': 15, 'next_clock': 3319032704, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77615.762911717, '#receive_time': 77616.533868843}
mcu 'mcu': got {'oid': 19, 'next_clock': 3321912704, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77615.762911717, '#receive_time': 77616.573864134}
mcu 'mcu': got {'oid': 27, 'next_clock': 3327672704, 'value': 31245, '#name': 'analog_in_state', '#sent_time': 77615.762911717, '#receive_time': 77616.653870009}
mcu 'mcu': got {'oid': 15, 'next_clock': 3340632704, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 77616.74778909299, '#receive_time': 77616.833870301}
mcu 'mcu': got {'oid': 19, 'next_clock': 3343512704, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77616.74778909299, '#receive_time': 77616.873888593}
mcu 'mcu': got {'oid': 27, 'next_clock': 3349272704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77616.74778909299, '#receive_time': 77616.953877093}
mcu 'mcu': got {'oid': 15, 'next_clock': 3362232704, 'value': 31186, '#name': 'analog_in_state', '#sent_time': 77616.74778909299, '#receive_time': 77617.133926426}
mcu 'mcu': got {'oid': 19, 'next_clock': 3365112704, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77616.74778909299, '#receive_time': 77617.17389351}
mcu 'mcu': got {'oid': 27, 'next_clock': 3370872704, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77616.74778909299, '#receive_time': 77617.253930176}
mcu 'mcu': got {'oid': 15, 'next_clock': 3383832704, 'value': 31186, '#name': 'analog_in_state', '#sent_time': 77616.74778909299, '#receive_time': 77617.433876593}
mcu 'mcu': got {'oid': 19, 'next_clock': 3386712704, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77616.74778909299, '#receive_time': 77617.473887843}
mcu 'mcu': got {'oid': 27, 'next_clock': 3392472704, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77616.74778909299, '#receive_time': 77617.55390401}
mcu 'mcu': got {'oid': 15, 'next_clock': 3405432704, 'value': 31193, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77617.733874677}
mcu 'mcu': got {'oid': 19, 'next_clock': 3408312704, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77617.773891885}
mcu 'mcu': got {'oid': 27, 'next_clock': 3414072704, 'value': 31234, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77617.853897343}
mcu 'mcu': got {'oid': 15, 'next_clock': 3427032704, 'value': 31178, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77618.033903552}
mcu 'mcu': got {'oid': 19, 'next_clock': 3429912704, 'value': 31273, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77618.073954093}
mcu 'mcu': got {'oid': 27, 'next_clock': 3435672704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77618.153928927}
mcu 'mcu': got {'oid': 15, 'next_clock': 3448632704, 'value': 31227, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77618.33392401}
mcu 'mcu': got {'oid': 19, 'next_clock': 3451512704, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77618.37391326}
mcu 'mcu': got {'oid': 27, 'next_clock': 3457272704, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77618.453918219}
mcu 'mcu': got {'oid': 15, 'next_clock': 3470232704, 'value': 31186, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77618.633921302}
mcu 'mcu': got {'oid': 19, 'next_clock': 3473112704, 'value': 31272, '#name': 'analog_in_state', '#sent_time': 77617.73277063499, '#receive_time': 77618.673928219}
mcu 'mcu': got {'oid': 27, 'next_clock': 3478872704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77618.753905302}
mcu 'mcu': got {'oid': 15, 'next_clock': 3491832704, 'value': 31193, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77618.933926302}
mcu 'mcu': got {'oid': 19, 'next_clock': 3494712704, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77618.973925844}
mcu 'mcu': got {'oid': 27, 'next_clock': 3500472704, 'value': 31231, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77619.053977636}
mcu 'mcu': got {'oid': 15, 'next_clock': 3513432704, 'value': 31184, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77619.233981219}
mcu 'mcu': got {'oid': 19, 'next_clock': 3516312704, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77619.273958011}
mcu 'mcu': got {'oid': 27, 'next_clock': 3522072704, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77619.353946219}
mcu 'mcu': got {'oid': 15, 'next_clock': 3535032704, 'value': 31188, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77619.533946927}
mcu 'mcu': got {'oid': 19, 'next_clock': 3537912704, 'value': 31277, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77619.573942844}
mcu 'mcu': got {'oid': 27, 'next_clock': 3543672704, 'value': 31239, '#name': 'analog_in_state', '#sent_time': 77618.717713344, '#receive_time': 77619.653955261}
mcu 'mcu': got {'oid': 15, 'next_clock': 3556632704, 'value': 31203, '#name': 'analog_in_state', '#sent_time': 77619.70250784399, '#receive_time': 77619.833952969}
mcu 'mcu': got {'oid': 19, 'next_clock': 3559512704, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 77619.70250784399, '#receive_time': 77619.873951053}
mcu 'mcu': got {'oid': 27, 'next_clock': 3565272704, 'value': 31246, '#name': 'analog_in_state', '#sent_time': 77619.70250784399, '#receive_time': 77619.953954178}
mcu 'mcu': got {'oid': 15, 'next_clock': 3578232704, 'value': 31188, '#name': 'analog_in_state', '#sent_time': 77619.70250784399, '#receive_time': 77620.133997261}
mcu 'mcu': got {'oid': 19, 'next_clock': 3581112704, 'value': 31280, '#name': 'analog_in_state', '#sent_time': 77619.70250784399, '#receive_time': 77620.173972761}
mcu 'mcu': got {'oid': 27, 'next_clock': 3586872704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77619.70250784399, '#receive_time': 77620.253967095}
mcu 'mcu': got {'oid': 15, 'next_clock': 3599832704, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 77619.70250784399, '#receive_time': 77620.433971178}
mcu 'mcu': got {'oid': 19, 'next_clock': 3602712704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77619.70250784399, '#receive_time': 77620.473965428}
mcu 'mcu': got {'oid': 27, 'next_clock': 3608472704, 'value': 31249, '#name': 'analog_in_state', '#sent_time': 77619.70250784399, '#receive_time': 77620.553965178}
mcu 'mcu': got {'oid': 15, 'next_clock': 3621432704, 'value': 31193, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77620.733948845}
mcu 'mcu': got {'oid': 19, 'next_clock': 3624312704, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77620.773970845}
mcu 'mcu': got {'oid': 27, 'next_clock': 3630072704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77620.853971053}
mcu 'mcu': got {'oid': 15, 'next_clock': 3643032704, 'value': 31188, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77621.033976345}
mcu 'mcu': got {'oid': 19, 'next_clock': 3645912704, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77621.074026137}
mcu 'mcu': got {'oid': 27, 'next_clock': 3651672704, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77621.154017262}
mcu 'mcu': got {'oid': 15, 'next_clock': 3664632704, 'value': 31189, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77621.33402672}
mcu 'mcu': got {'oid': 19, 'next_clock': 3667512704, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77621.374002345}
mcu 'mcu': got {'oid': 27, 'next_clock': 3673272704, 'value': 31234, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77621.454000012}
mcu 'mcu': got {'oid': 15, 'next_clock': 3686232704, 'value': 31189, '#name': 'analog_in_state', '#sent_time': 77620.687405803, '#receive_time': 77621.633996095}
mcu 'mcu': got {'oid': 19, 'next_clock': 3689112704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77621.673974429}
mcu 'mcu': got {'oid': 27, 'next_clock': 3694872704, 'value': 31239, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77621.754025804}
mcu 'mcu': got {'oid': 15, 'next_clock': 3707832704, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77621.93400572}
mcu 'mcu': got {'oid': 19, 'next_clock': 3710712704, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77621.97400001201}
mcu 'mcu': got {'oid': 27, 'next_clock': 3716472704, 'value': 31239, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77622.054055845}
mcu 'mcu': got {'oid': 15, 'next_clock': 3729432704, 'value': 31198, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77622.234046929}
mcu 'mcu': got {'oid': 19, 'next_clock': 3732312704, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77622.274030595}
mcu 'mcu': got {'oid': 27, 'next_clock': 3738072704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77622.354019137}
mcu 'mcu': got {'oid': 15, 'next_clock': 3751032704, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77622.534011221}
mcu 'mcu': got {'oid': 19, 'next_clock': 3753912704, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77622.574022054}
mcu 'mcu': got {'oid': 27, 'next_clock': 3759672704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77621.671791637, '#receive_time': 77622.654019221}
mcu 'mcu': got {'oid': 15, 'next_clock': 3772632704, 'value': 31188, '#name': 'analog_in_state', '#sent_time': 77622.65569376199, '#receive_time': 77622.834014012}
mcu 'mcu': got {'oid': 19, 'next_clock': 3775512704, 'value': 31271, '#name': 'analog_in_state', '#sent_time': 77622.65569376199, '#receive_time': 77622.874027637}
mcu 'mcu': got {'oid': 27, 'next_clock': 3781272704, 'value': 31241, '#name': 'analog_in_state', '#sent_time': 77622.65569376199, '#receive_time': 77622.954034096}
mcu 'mcu': got {'oid': 15, 'next_clock': 3794232704, 'value': 31195, '#name': 'analog_in_state', '#sent_time': 77622.65569376199, '#receive_time': 77623.134079513}
mcu 'mcu': got {'oid': 19, 'next_clock': 3797112704, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 77622.65569376199, '#receive_time': 77623.174082554}
mcu 'mcu': got {'oid': 27, 'next_clock': 3802872704, 'value': 31248, '#name': 'analog_in_state', '#sent_time': 77622.65569376199, '#receive_time': 77623.254068429}
mcu 'mcu': got {'oid': 15, 'next_clock': 3815832704, 'value': 31198, '#name': 'analog_in_state', '#sent_time': 77622.65569376199, '#receive_time': 77623.434052804}
mcu 'mcu': got {'oid': 19, 'next_clock': 3818712704, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77622.65569376199, '#receive_time': 77623.474042263}
mcu 'mcu': got {'oid': 27, 'next_clock': 3824472704, 'value': 31233, '#name': 'analog_in_state', '#sent_time': 77622.65569376199, '#receive_time': 77623.554044513}
mcu 'mcu': got {'oid': 15, 'next_clock': 3837432704, 'value': 31202, '#name': 'analog_in_state', '#sent_time': 77623.640891388, '#receive_time': 77623.734059679}
mcu 'mcu': got {'oid': 19, 'next_clock': 3840312704, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77623.640891388, '#receive_time': 77623.774054221}
mcu 'mcu': got {'oid': 27, 'next_clock': 3846072704, 'value': 31242, '#name': 'analog_in_state', '#sent_time': 77623.640891388, '#receive_time': 77623.854052638}
mcu 'mcu': got {'oid': 15, 'next_clock': 3859032704, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 77623.640891388, '#receive_time': 77624.034055555}
mcu 'mcu': got {'oid': 19, 'next_clock': 3861912704, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77623.640891388, '#receive_time': 77624.074087096}
mcu 'mcu': got {'oid': 27, 'next_clock': 3867672704, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77623.640891388, '#receive_time': 77624.15408143}
mcu 'mcu': got {'oid': 15, 'next_clock': 3880632704, 'value': 31201, '#name': 'analog_in_state', '#sent_time': 77623.640891388, '#receive_time': 77624.334113263}
mcu 'mcu': got {'oid': 19, 'next_clock': 3883512704, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77623.640891388, '#receive_time': 77624.374079555}
mcu 'mcu': got {'oid': 27, 'next_clock': 3889272704, 'value': 31234, '#name': 'analog_in_state', '#sent_time': 77623.640891388, '#receive_time': 77624.454072013}
mcu 'mcu': got {'oid': 15, 'next_clock': 3902232704, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77624.634049055}
mcu 'mcu': got {'oid': 19, 'next_clock': 3905112704, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77624.674076513}
mcu 'mcu': got {'oid': 27, 'next_clock': 3910872704, 'value': 31248, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77624.754083972}
mcu 'mcu': got {'oid': 15, 'next_clock': 3923832704, 'value': 31188, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77624.934078013}
mcu 'mcu': got {'oid': 19, 'next_clock': 3926712704, 'value': 31260, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77624.974077513}
mcu 'mcu': got {'oid': 27, 'next_clock': 3932472704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77625.054118472}
mcu 'mcu': got {'oid': 15, 'next_clock': 3945432704, 'value': 31185, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77625.234115472}
mcu 'mcu': got {'oid': 19, 'next_clock': 3948312704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77625.274098264}
mcu 'mcu': got {'oid': 27, 'next_clock': 3954072704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77625.354102097}
mcu 'mcu': got {'oid': 15, 'next_clock': 3967032704, 'value': 31159, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77625.534097389}
mcu 'mcu': got {'oid': 19, 'next_clock': 3969912704, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77624.625747805, '#receive_time': 77625.574089389}
mcu 'mcu': got {'oid': 27, 'next_clock': 3975672704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77625.654080097}
mcu 'mcu': got {'oid': 15, 'next_clock': 3988632704, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77625.834117597}
mcu 'mcu': got {'oid': 19, 'next_clock': 3991512704, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77625.874102806}
mcu 'mcu': got {'oid': 27, 'next_clock': 3997272704, 'value': 31234, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77625.954135222}
mcu 'mcu': got {'oid': 15, 'next_clock': 4010232704, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77626.134138514}
mcu 'mcu': got {'oid': 19, 'next_clock': 4013112704, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77626.174117514}
mcu 'mcu': got {'oid': 27, 'next_clock': 4018872704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77626.254154889}
mcu 'mcu': got {'oid': 15, 'next_clock': 4031832704, 'value': 31185, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77626.434131181}
mcu 'mcu': got {'oid': 19, 'next_clock': 4034712704, 'value': 31267, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77626.474120639}
mcu 'mcu': got {'oid': 27, 'next_clock': 4040472704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77625.610134847, '#receive_time': 77626.554113598}
mcu 'mcu': got {'oid': 15, 'next_clock': 4053432704, 'value': 31202, '#name': 'analog_in_state', '#sent_time': 77626.59505576399, '#receive_time': 77626.734106848}
mcu 'mcu': got {'oid': 19, 'next_clock': 4056312704, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77626.59505576399, '#receive_time': 77626.774116931}
mcu 'mcu': got {'oid': 27, 'next_clock': 4062072704, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77626.59505576399, '#receive_time': 77626.854148306}
mcu 'mcu': got {'oid': 15, 'next_clock': 4075032704, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 77626.59505576399, '#receive_time': 77627.034133139}
mcu 'mcu': got {'oid': 19, 'next_clock': 4077912704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77626.59505576399, '#receive_time': 77627.074157973}
mcu 'mcu': got {'oid': 27, 'next_clock': 4083672704, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77626.59505576399, '#receive_time': 77627.154150973}
mcu 'mcu': got {'oid': 15, 'next_clock': 4096632704, 'value': 31201, '#name': 'analog_in_state', '#sent_time': 77626.59505576399, '#receive_time': 77627.334190181}
mcu 'mcu': got {'oid': 19, 'next_clock': 4099512704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77626.59505576399, '#receive_time': 77627.37414989}
mcu 'mcu': got {'oid': 27, 'next_clock': 4105272704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77626.59505576399, '#receive_time': 77627.454154848}
mcu 'mcu': got {'oid': 15, 'next_clock': 4118232704, 'value': 31187, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77627.63412464}
mcu 'mcu': got {'oid': 19, 'next_clock': 4121112704, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77627.674149848}
mcu 'mcu': got {'oid': 27, 'next_clock': 4126872704, 'value': 31232, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77627.75417739}
mcu 'mcu': got {'oid': 15, 'next_clock': 4139832704, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77627.934161098}
mcu 'mcu': got {'oid': 19, 'next_clock': 4142712704, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77627.974148515}
mcu 'mcu': got {'oid': 27, 'next_clock': 4148472704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77628.05422089}
mcu 'mcu': got {'oid': 15, 'next_clock': 4161432704, 'value': 31202, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77628.23419864}
mcu 'mcu': got {'oid': 19, 'next_clock': 4164312704, 'value': 31260, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77628.274216973}
mcu 'mcu': got {'oid': 27, 'next_clock': 4170072704, 'value': 31238, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77628.354186348}
mcu 'mcu': got {'oid': 15, 'next_clock': 4183032704, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77627.57950247299, '#receive_time': 77628.534178432}
mcu 'mcu': got {'oid': 19, 'next_clock': 4185912704, 'value': 31260, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77628.574149265}
mcu 'mcu': got {'oid': 27, 'next_clock': 4191672704, 'value': 31233, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77628.654175849}
mcu 'mcu': got {'oid': 15, 'next_clock': 4204632704, 'value': 31204, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77628.83418439}
mcu 'mcu': got {'oid': 19, 'next_clock': 4207512704, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77628.874185224}
mcu 'mcu': got {'oid': 27, 'next_clock': 4213272704, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77628.95418589}
mcu 'mcu': got {'oid': 15, 'next_clock': 4226232704, 'value': 31204, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77629.134230599}
mcu 'mcu': got {'oid': 19, 'next_clock': 4229112704, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77629.174197599}
mcu 'mcu': got {'oid': 27, 'next_clock': 4234872704, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77629.254233932}
mcu 'mcu': got {'oid': 15, 'next_clock': 4247832704, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77629.434222307}
mcu 'mcu': got {'oid': 19, 'next_clock': 4250712704, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77628.564387682, '#receive_time': 77629.474201891}
mcu 'mcu': got {'oid': 27, 'next_clock': 4256472704, 'value': 31231, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77629.554177807}
mcu 'mcu': got {'oid': 15, 'next_clock': 4269432704, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77629.734227391}
mcu 'mcu': got {'oid': 19, 'next_clock': 4272312704, 'value': 31271, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77629.774208307}
mcu 'mcu': got {'oid': 27, 'next_clock': 4278072704, 'value': 31234, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77629.854206224}
mcu 'mcu': got {'oid': 15, 'next_clock': 4291032704, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77630.034208516}
mcu 'mcu': got {'oid': 19, 'next_clock': 4293912704, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77630.074250308}
mcu 'mcu': got {'oid': 27, 'next_clock': 4705408, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77630.154232933}
mcu 'mcu': got {'oid': 15, 'next_clock': 17665408, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77630.334273849}
mcu 'mcu': got {'oid': 19, 'next_clock': 20545408, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77630.374230474}
mcu 'mcu': got {'oid': 27, 'next_clock': 26305408, 'value': 31233, '#name': 'analog_in_state', '#sent_time': 77629.54942722399, '#receive_time': 77630.454223933}
mcu 'mcu': got {'oid': 15, 'next_clock': 39265408, 'value': 31202, '#name': 'analog_in_state', '#sent_time': 77630.534312016, '#receive_time': 77630.634203599}
mcu 'mcu': got {'oid': 19, 'next_clock': 42145408, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77630.534312016, '#receive_time': 77630.674225599}
mcu 'mcu': got {'oid': 27, 'next_clock': 47905408, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77630.534312016, '#receive_time': 77630.7542336}
mcu 'mcu': got {'oid': 15, 'next_clock': 60865408, 'value': 31198, '#name': 'analog_in_state', '#sent_time': 77630.534312016, '#receive_time': 77630.934233225}
mcu 'mcu': got {'oid': 19, 'next_clock': 63745408, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 77630.534312016, '#receive_time': 77630.974227058}
mcu 'mcu': got {'oid': 27, 'next_clock': 69505408, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77630.534312016, '#receive_time': 77631.054233308}
mcu 'mcu': got {'oid': 15, 'next_clock': 82465408, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 77630.534312016, '#receive_time': 77631.234273433}
mcu 'mcu': got {'oid': 19, 'next_clock': 85345408, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77630.534312016, '#receive_time': 77631.274250433}
mcu 'mcu': got {'oid': 27, 'next_clock': 91105408, 'value': 31234, '#name': 'analog_in_state', '#sent_time': 77630.534312016, '#receive_time': 77631.3542966}
mcu 'mcu': got {'oid': 15, 'next_clock': 104065408, 'value': 31202, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77631.534224642}
mcu 'mcu': got {'oid': 19, 'next_clock': 106945408, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77631.5742406}
mcu 'mcu': got {'oid': 27, 'next_clock': 112705408, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77631.654244517}
mcu 'mcu': got {'oid': 15, 'next_clock': 125665408, 'value': 31193, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77631.834275808}
mcu 'mcu': got {'oid': 19, 'next_clock': 128545408, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77631.874258808}
mcu 'mcu': got {'oid': 27, 'next_clock': 134305408, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77631.95428085}
mcu 'mcu': got {'oid': 15, 'next_clock': 147265408, 'value': 31201, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77632.134292934}
mcu 'mcu': got {'oid': 19, 'next_clock': 150145408, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77632.174270059}
mcu 'mcu': got {'oid': 27, 'next_clock': 155905408, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77632.254266725}
mcu 'mcu': got {'oid': 15, 'next_clock': 168865408, 'value': 31201, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77632.434300184}
mcu 'mcu': got {'oid': 19, 'next_clock': 171745408, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77631.51893601699, '#receive_time': 77632.47428485}
mcu 'mcu': got {'oid': 27, 'next_clock': 177505408, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77632.554255892}
mcu 'mcu': got {'oid': 15, 'next_clock': 190465408, 'value': 31206, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77632.734257475}
mcu 'mcu': got {'oid': 19, 'next_clock': 193345408, 'value': 31281, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77632.774273059}
mcu 'mcu': got {'oid': 27, 'next_clock': 199105408, 'value': 31229, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77632.854279351}
mcu 'mcu': got {'oid': 15, 'next_clock': 212065408, 'value': 31200, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77633.03428814201}
mcu 'mcu': got {'oid': 19, 'next_clock': 214945408, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77633.074353726}
mcu 'mcu': got {'oid': 27, 'next_clock': 220705408, 'value': 31239, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77633.154339851}
mcu 'mcu': got {'oid': 15, 'next_clock': 233665408, 'value': 31194, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77633.334354767}
mcu 'mcu': got {'oid': 19, 'next_clock': 236545408, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77633.374343184}
mcu 'mcu': got {'oid': 27, 'next_clock': 242305408, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77632.50393226699, '#receive_time': 77633.454325934}
mcu 'mcu': got {'oid': 15, 'next_clock': 255265408, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77633.488130851, '#receive_time': 77633.634281768}
mcu 'mcu': got {'oid': 19, 'next_clock': 258145408, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77633.488130851, '#receive_time': 77633.674307768}
mcu 'mcu': got {'oid': 27, 'next_clock': 263905408, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77633.488130851, '#receive_time': 77633.754337268}
mcu 'mcu': got {'oid': 15, 'next_clock': 276865408, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 77633.488130851, '#receive_time': 77633.934328393}
mcu 'mcu': got {'oid': 19, 'next_clock': 279745408, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 77633.488130851, '#receive_time': 77633.974321309}
mcu 'mcu': got {'oid': 27, 'next_clock': 285505408, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77633.488130851, '#receive_time': 77634.054321434}
mcu 'mcu': got {'oid': 15, 'next_clock': 298465408, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 77633.488130851, '#receive_time': 77634.234349476}
mcu 'mcu': got {'oid': 19, 'next_clock': 301345408, 'value': 31247, '#name': 'analog_in_state', '#sent_time': 77633.488130851, '#receive_time': 77634.274338601}
mcu 'mcu': got {'oid': 27, 'next_clock': 307105408, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77633.488130851, '#receive_time': 77634.354382726}
mcu 'mcu': got {'oid': 15, 'next_clock': 320065408, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77634.534304185}
mcu 'mcu': got {'oid': 19, 'next_clock': 322945408, 'value': 31272, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77634.574328893}
mcu 'mcu': got {'oid': 27, 'next_clock': 328705408, 'value': 31234, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77634.654331018}
mcu 'mcu': got {'oid': 15, 'next_clock': 341665408, 'value': 31199, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77634.834346476}
mcu 'mcu': got {'oid': 19, 'next_clock': 344545408, 'value': 31265, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77634.874341685}
mcu 'mcu': got {'oid': 27, 'next_clock': 350305408, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77634.954343393}
mcu 'mcu': got {'oid': 15, 'next_clock': 363265408, 'value': 31185, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77635.134385352}
mcu 'mcu': got {'oid': 19, 'next_clock': 366145408, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77635.174359893}
mcu 'mcu': got {'oid': 27, 'next_clock': 371905408, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77635.254381643}
mcu 'mcu': got {'oid': 15, 'next_clock': 384865408, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77634.472191893, '#receive_time': 77635.434383393}
mcu 'mcu': got {'oid': 19, 'next_clock': 387745408, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77635.474330268}
mcu 'mcu': got {'oid': 27, 'next_clock': 393505408, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77635.554356102}
mcu 'mcu': got {'oid': 15, 'next_clock': 406465408, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77635.73439806}
mcu 'mcu': got {'oid': 19, 'next_clock': 409345408, 'value': 31260, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77635.774378477}
mcu 'mcu': got {'oid': 27, 'next_clock': 415105408, 'value': 31225, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77635.854367477}
mcu 'mcu': got {'oid': 15, 'next_clock': 428065408, 'value': 31186, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77636.034389352}
mcu 'mcu': got {'oid': 19, 'next_clock': 430945408, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77636.07440639401}
mcu 'mcu': got {'oid': 27, 'next_clock': 436705408, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77636.154392477}
mcu 'mcu': got {'oid': 15, 'next_clock': 449665408, 'value': 31193, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77636.334392811}
mcu 'mcu': got {'oid': 19, 'next_clock': 452545408, 'value': 31264, '#name': 'analog_in_state', '#sent_time': 77635.456398185, '#receive_time': 77636.374385977}
mcu 'mcu': got {'oid': 27, 'next_clock': 458305408, 'value': 31232, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77636.454356811}
mcu 'mcu': got {'oid': 15, 'next_clock': 471265408, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77636.634382519}
mcu 'mcu': got {'oid': 19, 'next_clock': 474145408, 'value': 31273, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77636.674376936}
mcu 'mcu': got {'oid': 27, 'next_clock': 479905408, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77636.754390686}
mcu 'mcu': got {'oid': 15, 'next_clock': 492865408, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77636.934401269}
mcu 'mcu': got {'oid': 19, 'next_clock': 495745408, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77636.974393602}
mcu 'mcu': got {'oid': 27, 'next_clock': 501505408, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77637.05439406101}
mcu 'mcu': got {'oid': 15, 'next_clock': 514465408, 'value': 31186, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77637.234421519}
mcu 'mcu': got {'oid': 19, 'next_clock': 517345408, 'value': 31266, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77637.274416478}
mcu 'mcu': got {'oid': 27, 'next_clock': 523105408, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77636.440572102, '#receive_time': 77637.354409144}
mcu 'mcu': got {'oid': 15, 'next_clock': 536065408, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77637.425593311, '#receive_time': 77637.534404769}
mcu 'mcu': got {'oid': 19, 'next_clock': 538945408, 'value': 31259, '#name': 'analog_in_state', '#sent_time': 77637.425593311, '#receive_time': 77637.574414936}
mcu 'mcu': got {'oid': 27, 'next_clock': 544705408, 'value': 31233, '#name': 'analog_in_state', '#sent_time': 77637.425593311, '#receive_time': 77637.654411853}
mcu 'mcu': got {'oid': 15, 'next_clock': 557665408, 'value': 31196, '#name': 'analog_in_state', '#sent_time': 77637.425593311, '#receive_time': 77637.83438877}
mcu 'mcu': got {'oid': 19, 'next_clock': 560545408, 'value': 31268, '#name': 'analog_in_state', '#sent_time': 77637.425593311, '#receive_time': 77637.874412103}
mcu 'mcu': got {'oid': 27, 'next_clock': 566305408, 'value': 31243, '#name': 'analog_in_state', '#sent_time': 77637.425593311, '#receive_time': 77637.954422395}
mcu 'mcu': got {'oid': 15, 'next_clock': 579265408, 'value': 31195, '#name': 'analog_in_state', '#sent_time': 77637.425593311, '#receive_time': 77638.13445652}
mcu 'mcu': got {'oid': 19, 'next_clock': 582145408, 'value': 31263, '#name': 'analog_in_state', '#sent_time': 77637.425593311, '#receive_time': 77638.174430436}
mcu 'mcu': got {'oid': 27, 'next_clock': 587905408, 'value': 31236, '#name': 'analog_in_state', '#sent_time': 77637.425593311, '#receive_time': 77638.254429395}
mcu 'mcu': got {'oid': 15, 'next_clock': 600865408, 'value': 31204, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77638.434464978}
mcu 'mcu': got {'oid': 19, 'next_clock': 603745408, 'value': 31269, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77638.474447603}
mcu 'mcu': got {'oid': 27, 'next_clock': 609505408, 'value': 31237, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77638.554441728}
mcu 'mcu': got {'oid': 15, 'next_clock': 622465408, 'value': 31190, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77638.734442978}
mcu 'mcu': got {'oid': 19, 'next_clock': 625345408, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77638.77444152}
mcu 'mcu': got {'oid': 27, 'next_clock': 631105408, 'value': 31234, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77638.854442687}
mcu 'mcu': got {'oid': 15, 'next_clock': 644065408, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77639.03448777}
mcu 'mcu': got {'oid': 19, 'next_clock': 646945408, 'value': 31257, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77639.074481187}
mcu 'mcu': got {'oid': 27, 'next_clock': 652705408, 'value': 31243, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77639.154477937}
mcu 'mcu': got {'oid': 15, 'next_clock': 665665408, 'value': 31186, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77639.334478729}
mcu 'mcu': got {'oid': 19, 'next_clock': 668545408, 'value': 31270, '#name': 'analog_in_state', '#sent_time': 77638.41048251999, '#receive_time': 77639.374464854}
mcu 'mcu': got {'oid': 27, 'next_clock': 674305408, 'value': 31240, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77639.454505812}
mcu 'mcu': got {'oid': 15, 'next_clock': 687265408, 'value': 31188, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77639.634491895}
mcu 'mcu': got {'oid': 19, 'next_clock': 690145408, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77639.674475479}
mcu 'mcu': got {'oid': 27, 'next_clock': 695905408, 'value': 31233, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77639.754489312}
mcu 'mcu': got {'oid': 15, 'next_clock': 708865408, 'value': 31197, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77639.934482312}
mcu 'mcu': got {'oid': 19, 'next_clock': 711745408, 'value': 31262, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77639.974484396}
mcu 'mcu': got {'oid': 27, 'next_clock': 717505408, 'value': 31235, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77640.054480062}
mcu 'mcu': got {'oid': 15, 'next_clock': 730465408, 'value': 31192, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77640.234501312}
mcu 'mcu': got {'oid': 19, 'next_clock': 733345408, 'value': 31261, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77640.274491646}
mcu 'mcu': got {'oid': 27, 'next_clock': 739105408, 'value': 31247, '#name': 'analog_in_state', '#sent_time': 77639.39508372899, '#receive_time': 77640.354488604}
mcu 'mcu': got {'oid': 15, 'next_clock': 752065408, 'value': 31184, '#name': 'analog_in_state', '#sent_time': 77640.38019497899, '#receive_time': 77640.534526771}
mcu 'mcu': got {'oid': 19, 'next_clock': 754945408, 'value': 31258, '#name': 'analog_in_state', '#sent_time': 77640.38019497899, '#receive_time': 77640.574502813}
Attempting MCU 'mcu' reset command
webhooks client 281473463900896: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:07:46 2024 (1735574866.1 77641.7)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect sb_logo_busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:sb_leds (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:sb_leds
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:sb_leds
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:sb_leds (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:sb_leds (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473463896672: New connection
webhooks client 281473463896672: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Unhandled exception during ready callback
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 164, in _connect
    cb()
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 390, in _handle_ready
    ledChain = self.printer.lookup_object(chainName)
  File "/home/klipper/klipper/klippy/klippy.py", line 79, in lookup_object
    raise self.config_error("Unknown config object '%s'" % (name,))
configparser.Error: Unknown config object 'neopixel sb_leds'
Transition to shutdown state: Internal error during ready callback: Unknown config object 'neopixel sb_leds'
Dumping gcode input 0 blocks
Dumping 11 requests for client 281473463896672
Received 77644.574439: b'{"id":281472833480800,"method":"info","params":{"client_info":{"program":"Moonraker","version":"v0.9.3-4-ga4604e3"}}}'
Received 77644.574439: b'{"id":281472833470624,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 77644.574439: b'{"id":281472833480560,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 77644.602901: b'{"id":281472833846864,"method":"list_endpoints","params":{}}'
Received 77644.668634: b'{"id":281472833484832,"method":"info","params":{}}'
Received 77644.855250: b'{"id":281472833832032,"method":"info","params":{}}'
Received 77645.107614: b'{"id":281472833832032,"method":"info","params":{}}'
Received 77645.359587: b'{"id":281472833832032,"method":"info","params":{}}'
Received 77645.611589: b'{"id":281472833832032,"method":"info","params":{}}'
Received 77645.777053: b'{"id":281472833485024,"method":"info","params":{}}'
Received 77645.863587: b'{"id":281472833831792,"method":"info","params":{}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (77644.991229565, 0.0, 0.0)
Internal error during ready callback: Unknown config object 'neopixel sb_leds'
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Printer is shutdown

Dumping stepper 'stepper_x' (mcu) 1 queue_step:
queue_step 0: t=376218709 p=0 i=0 c=0 a=0
Dumping stepper 'stepper_y' (mcu) 1 queue_step:
queue_step 0: t=376769073 p=0 i=0 c=0 a=0
Dumping stepper 'stepper_z' (mcu) 1 queue_step:
queue_step 0: t=377310416 p=0 i=0 c=0 a=0
Dumping stepper 'extruder' (mcu) 1 queue_step:
queue_step 0: t=377881222 p=0 i=0 c=0 a=0
MCU 'mcu' shutdown: Command request
clocksync state: mcu_freq=72000000 last_clock=342613513 clock_est=(77645.061 317522182 71995056.022) min_half_rtt=0.000222 min_rtt_time=77645.303 time_avg=77645.061(0.018) clock_avg=317522182.187(1278850.315) pred_variance=3821180294.667
Dumping serial stats: bytes_write=2838 bytes_read=6173 bytes_retransmit=0 bytes_invalid=0 send_seq=222 receive_seq=222 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8
Dumping send queue 100 messages
Sent 0 77645.430453 77645.424367 45: seq: 1a, buttons_add oid=17 pos=0 pin=PC15 pull_up=0, buttons_add oid=17 pos=1 pin=PA10 pull_up=1, buttons_add oid=17 pos=2 pin=PA9 pull_up=1, buttons_add oid=17 pos=3 pin=PA15 pull_up=1, buttons_query oid=17 clock=444240000 rest_ticks=144000 retransmit_count=50 invert=9, queue_digital_out oid=18 clock=357158569 on_ticks=0
Sent 1 77645.432773 77645.426745 58: seq: 1b, query_analog_in oid=19 clock=445680000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=11782 max_value=32201 range_check_count=4, queue_digital_out oid=20 clock=357182502 on_ticks=0, queue_digital_out oid=21 clock=357186683 on_ticks=0, queue_digital_out oid=22 clock=357190721 on_ticks=0, queue_digital_out oid=23 clock=357204175 on_ticks=0
Sent 2 77645.434493 77645.429643 43: seq: 1c, queue_digital_out oid=5 clock=357210349 on_ticks=0, query_analog_in oid=27 clock=451440000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=855 max_value=32201 range_check_count=4, queue_digital_out oid=28 clock=357271898 on_ticks=0, get_config
Sent 3 77645.440066 77645.438266 45: seq: 1d, neopixel_update oid=0 pos=0 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_update oid=0 pos=16 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
Sent 4 77645.446686 77645.445606 27: seq: 1e, neopixel_update oid=0 pos=32 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_send oid=0
Sent 5 77645.454109 77645.453549 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 6 77645.460414 77645.459654 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03\x080\x80\x00\n\x08\xb8\x87' read=0
Sent 7 77645.464134 77645.463574 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 8 77645.470240 77645.469480 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03h0\x80\x00\x12\x08 \xda' read=0
Sent 9 77645.473925 77645.473365 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 10 77645.480030 77645.479270 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x03\x88=\x9a\x06\x02h*\xbf' read=0
Sent 11 77645.483715 77645.483155 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 12 77645.489809 77645.489049 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x03\x082\x80\x10\x92H\xa2\x83' read=0
Sent 13 77645.493500 77645.492940 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 14 77645.499648 77645.498888 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x03h2\x80\x00\x02\x08 \xfb' read=0
Sent 15 77645.503344 77645.502784 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 16 77645.509447 77645.508687 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x03\x882\x80\x00\x02\x08\xa0\xe6' read=0
Sent 17 77645.513137 77645.512577 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 18 77645.519268 77645.518508 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x03H8\x80\x00\x02\x08 \xde' read=0
Sent 19 77645.522988 77645.522428 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 20 77645.529093 77645.528333 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x03\x08>\xe4\x1ar\x88\xa4\x85' read=0
Sent 21 77645.532781 77645.532221 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 22 77645.538880 77645.538120 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03(2\x80\x00\x02\x88"\xf3' read=0
Sent 23 77645.542557 77645.541997 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 24 77645.548651 77645.547891 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03\x088\x80\x00\x02\x08 \xba' read=0
Sent 25 77645.552347 77645.551787 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 26 77645.559133 77645.558573 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 27 77645.565879 77645.565119 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x13\x080\x80\x00\n\x08\xb8\xbc' read=0
Sent 28 77645.570548 77645.569988 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 29 77645.576858 77645.576098 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x13h0\x80\x00\x12\x08 \xe1' read=0
Sent 30 77645.580586 77645.580026 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 31 77645.586727 77645.585967 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x13\x88=\x9a\x06\x02h*\x84' read=0
Sent 32 77645.590427 77645.589867 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 33 77645.596625 77645.595865 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x13\x082\x80\x10\x9ah"\xa7' read=0
Sent 34 77645.600333 77645.599773 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 35 77645.606510 77645.605750 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x13h2\x80\x00\x02\x08 \xc0' read=0
Sent 36 77645.610211 77645.609651 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 37 77645.617101 77645.615941 29: seq: 1f, tmcuart_send oid=3 write=b'\xea\x13\x882\x80\x00\x02\x08\xa0\xdd' read=0, queue_digital_out oid=18 clock=367007165 on_ticks=157680
Sent 38 77645.620854 77645.620294 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 39 77645.627148 77645.626388 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x13H8\x80\x00\x02\x08 \xe5' read=0
Sent 40 77645.630861 77645.630301 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 41 77645.637023 77645.636263 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x13\x08>\xe4\x1ar\x88\xa4\xbe' read=0
Sent 42 77645.640716 77645.640156 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 43 77645.646817 77645.646057 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x13(2\x80\x00\x02\x88"\xc8' read=0
Sent 44 77645.650491 77645.649931 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 45 77645.656582 77645.655822 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x13\x088\x80\x00\x02\x08 \x81' read=0
Sent 46 77645.660260 77645.659700 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 47 77645.666174 77645.665614 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 48 77645.672245 77645.671485 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0b\x080\x80\x00\n\x08\xb8\xf1' read=0
Sent 49 77645.675920 77645.675360 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 50 77645.682002 77645.681242 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x0bh0\x80\x00\x12\x08 \xac' read=0
Sent 51 77645.685665 77645.685105 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 52 77645.691752 77645.690992 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0b\x88=\x92\x06\x02h*\x91' read=0
Sent 53 77645.695429 77645.694869 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 54 77645.701530 77645.700770 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x0b\x082\x80\x10\x92H\xa2\xf5' read=0
Sent 55 77645.705215 77645.704655 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 56 77645.711337 77645.710577 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x0bh2\x80\x00\x02\x08 \x8d' read=0
Sent 57 77645.715041 77645.714481 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 58 77645.721319 77645.720559 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x0b\x882\x80\x00\x02\x08\xa0\x90' read=0
Sent 59 77645.725020 77645.724460 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 60 77645.731148 77645.730388 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x0bH8\x80\x00\x02\x08 \xa8' read=0
Sent 61 77645.734820 77645.734260 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 62 77645.740904 77645.740144 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x0b\x08>\xe4\x1ar\x88\xa4\xf3' read=0
Sent 63 77645.744582 77645.744022 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 64 77645.750666 77645.749906 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0b(2\x80\x00\x02\x88"\x85' read=0
Sent 65 77645.752699 77645.752179 13: seq: 1b, queue_digital_out oid=18 clock=374207165 on_ticks=0
Sent 66 77645.754358 77645.753798 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 67 77645.760433 77645.759673 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0b\x088\x80\x00\x02\x08 \xcc' read=0
Sent 68 77645.764590 77645.764030 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 69 77645.770651 77645.770091 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 70 77645.777303 77645.776543 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x1b\x080\x80\x00\n\x08\xb8\xca' read=0
Sent 71 77645.781400 77645.780840 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 72 77645.787629 77645.786869 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x1bh0\x80\x00\x12\x08 \x97' read=0
Sent 73 77645.791359 77645.790799 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 74 77645.797510 77645.796750 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x1b\x88=\x9a\x06\x02h*\xf2' read=0
Sent 75 77645.801229 77645.800669 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 76 77645.807400 77645.806640 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x1b\x082\x80\x10\xb2\xc8\xa2\xe9' read=0
Sent 77 77645.811141 77645.810581 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 78 77645.817265 77645.816505 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x1bh2\x80\x00\x02\x08 \xb6' read=0
Sent 79 77645.820976 77645.820416 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 80 77645.827122 77645.826362 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x1b\x882\x80\x00\x02\x08\xa0\xab' read=0
Sent 81 77645.830845 77645.830285 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 82 77645.837104 77645.836344 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x1bH8\x80\x00\x02\x08 \x93' read=0
Sent 83 77645.840826 77645.840266 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 84 77645.846950 77645.846190 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x1b\x08>\xe4\x1ar\x88\xa4\xc8' read=0
Sent 85 77645.850650 77645.850090 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 86 77645.852764 77645.852164 15: seq: 10, queue_digital_out oid=18 clock=381407165 on_ticks=106200
Sent 87 77645.856771 77645.856011 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x1b(2\x80\x00\x02\x88"\xbe' read=0
Sent 88 77645.860475 77645.859915 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 89 77645.866931 77645.866171 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x1b\x088\x80\x00\x02\x08 \xf7' read=0
Sent 90 77645.870671 77645.870111 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 91 77645.876206 77645.875926 7: seq: 15, stepper_get_position oid=6
Sent 92 77645.878064 77645.877504 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x03H-\xd5' read=10
Sent 93 77645.883841 77645.883561 7: seq: 17, stepper_get_position oid=9
Sent 94 77645.885741 77645.885181 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xad\xf8' read=10
Sent 95 77645.891364 77645.891084 7: seq: 19, stepper_get_position oid=12
Sent 96 77645.893219 77645.892659 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0bH-\x8e' read=10
Sent 97 77645.899265 77645.898985 7: seq: 1b, stepper_get_position oid=13
Sent 98 77645.901253 77645.900693 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x1bH\xad\xa3' read=10
Sent 99 77645.911706 77645.911466 6: seq: 1d, emergency_stop
Dumping receive queue 100 messages
Receive: 0 77645.355027 77645.354560 11: seq: 16, clock clock=338647663
Receive: 1 77645.407284 77645.406810 11: seq: 17, clock clock=342409213
Receive: 2 77645.410544 77645.409403 10: seq: 18, config is_config=0 crc=0 is_shutdown=0 move_count=0
Receive: 3 77645.410512 77645.409651 11: seq: 19, clock clock=342613513
Receive: 4 77645.434995 77645.434493 15: seq: 1d, config is_config=1 crc=2417496047 is_shutdown=0 move_count=1024
Receive: 5 77645.447651 77645.446686 8: seq: 1f, neopixel_result oid=0 success=1
Receive: 6 77645.458186 77645.454109 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h$\x8f'
Receive: 7 77645.462873 77645.460414 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 8 77645.468167 77645.464134 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88$\xd8'
Receive: 9 77645.472686 77645.470240 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 10 77645.477957 77645.473925 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa4\x9c'
Receive: 11 77645.482479 77645.480030 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 12 77645.487747 77645.483715 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa4\xbb'
Receive: 13 77645.492257 77645.489809 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 14 77645.497533 77645.493500 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8$\xff'
Receive: 15 77645.502097 77645.499648 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 16 77645.507377 77645.503344 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08%\x90'
Receive: 17 77645.511896 77645.509447 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 18 77645.517168 77645.513137 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa5\xd4'
Receive: 19 77645.521715 77645.519268 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 20 77645.527020 77645.522988 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa5\xf3'
Receive: 21 77645.531541 77645.529093 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 22 77645.536811 77645.532781 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h%\xb7'
Receive: 23 77645.541323 77645.538880 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 24 77645.546585 77645.542557 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88%\xe0'
Receive: 25 77645.551101 77645.548651 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 26 77645.556476 77645.552347 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa5\xa4'
Receive: 27 77645.563263 77645.559133 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h$\x8f'
Receive: 28 77645.568405 77645.565879 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 29 77645.574617 77645.570548 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88$\xd8'
Receive: 30 77645.579307 77645.576858 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 31 77645.584619 77645.580586 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa4\x9c'
Receive: 32 77645.589172 77645.586727 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 33 77645.594469 77645.590427 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa4\xbb'
Receive: 34 77645.599073 77645.596625 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 35 77645.604366 77645.600333 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8$\xff'
Receive: 36 77645.608957 77645.606510 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 37 77645.614289 77645.610211 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08%\x90'
Receive: 38 77645.619563 77645.617101 8: seq: 10, tmcuart_response oid=3 read=b''
Receive: 39 77645.624895 77645.620854 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa5\xd4'
Receive: 40 77645.629600 77645.627148 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 41 77645.634896 77645.630861 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa5\xf3'
Receive: 42 77645.639475 77645.637023 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 43 77645.644745 77645.640716 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h%\xb7'
Receive: 44 77645.649261 77645.646817 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 45 77645.651394 77645.650491 15: seq: 17, stats count=251 sum=553512 sumsq=19645166
Receive: 46 77645.654518 77645.650491 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88%\xe0'
Receive: 47 77645.659029 77645.656582 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 48 77645.664288 77645.660260 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa5\xa4'
Receive: 49 77645.670205 77645.666174 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h$\x8f'
Receive: 50 77645.674689 77645.672245 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 51 77645.679948 77645.675920 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88$\xd8'
Receive: 52 77645.684441 77645.682002 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 53 77645.689694 77645.685665 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa4\x9c'
Receive: 54 77645.694198 77645.691752 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 55 77645.699458 77645.695429 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa4\xbb'
Receive: 56 77645.703971 77645.701530 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 57 77645.709247 77645.705215 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8$\xff'
Receive: 58 77645.713778 77645.711337 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 59 77645.719088 77645.715041 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08%\x90'
Receive: 60 77645.723772 77645.721319 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 61 77645.729051 77645.725020 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa5\xd4'
Receive: 62 77645.733587 77645.731148 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 63 77645.738846 77645.734820 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa5\xf3'
Receive: 64 77645.743351 77645.740904 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 65 77645.748610 77645.744582 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h%\xb7'
Receive: 66 77645.753123 77645.752699 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 67 77645.758378 77645.754358 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88%\xe0'
Receive: 68 77645.762964 77645.760433 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 69 77645.768643 77645.764590 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa5\xa4'
Receive: 70 77645.774755 77645.770651 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa1\x8d'
Receive: 71 77645.779824 77645.777303 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 72 77645.785442 77645.781400 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8!\xc9'
Receive: 73 77645.790082 77645.787629 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 74 77645.795396 77645.791359 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08"\xba'
Receive: 75 77645.799957 77645.797510 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 76 77645.805265 77645.801229 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xa2\xfe'
Receive: 77 77645.809850 77645.807400 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 78 77645.815176 77645.811141 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa2\xd9'
Receive: 79 77645.819711 77645.817265 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 80 77645.825007 77645.820976 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h"\x9d'
Receive: 81 77645.829573 77645.827122 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 82 77645.834885 77645.830845 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88"\xca'
Receive: 83 77645.839561 77645.837104 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 84 77645.844856 77645.840826 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa2\x8e'
Receive: 85 77645.849394 77645.846950 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 86 77645.854674 77645.852764 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa2\xa9'
Receive: 87 77645.859216 77645.856771 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 88 77645.864559 77645.860475 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8"\xed'
Receive: 89 77645.869389 77645.866931 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 90 77645.874705 77645.870671 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08#\x82'
Receive: 91 77645.876649 77645.876206 8: seq: 16, stepper_position oid=6 pos=0
Receive: 92 77645.882097 77645.878064 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x02\x085\xaf'
Receive: 93 77645.884293 77645.883841 8: seq: 18, stepper_position oid=9 pos=0
Receive: 94 77645.889776 77645.885741 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x1a\x08%\xda'
Receive: 95 77645.891812 77645.891364 8: seq: 1a, stepper_position oid=12 pos=0
Receive: 96 77645.897251 77645.893219 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x1a\x08+\xcf'
Receive: 97 77645.899741 77645.899265 8: seq: 1c, stepper_position oid=13 pos=0
Receive: 98 77645.905359 77645.901253 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x1a\x08+\xcf'
Receive: 99 77645.912251 77645.911706 12: seq: 1e, shutdown clock=378760993 static_string_id=Command request
Attempting MCU 'mcu' reset command
webhooks client 281473463896672: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:13:47 2024 (1735575227.9 78003.5)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect sb_logo_busy]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Config error
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 130, in _connect
    self._read_config()
  File "/home/klipper/klipper/klippy/klippy.py", line 123, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/klipper/klipper/klippy/klippy.py", line 112, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 1493, in load_config_prefix
    return ledEffect(config)
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 355, in __init__
    self.configLeds   = config.get('leds')
  File "/home/klipper/klipper/klippy/configfile.py", line 62, in get
    return self._get_wrapper(self.fileconfig.get, option, default,
  File "/home/klipper/klipper/klippy/configfile.py", line 37, in _get_wrapper
    raise error("Option '%s' in section '%s' must be specified"
configparser.Error: Option 'leds' in section 'led_effect sb_logo_busy' must be specified
webhooks client 281473473593888: New connection
webhooks client 281473473593888: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Unable to issue reset command on MCU 'mcu'
webhooks client 281473473593888: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:15:34 2024 (1735575334.5 78110.1)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Config error
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 130, in _connect
    self._read_config()
  File "/home/klipper/klipper/klippy/klippy.py", line 123, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/klipper/klipper/klippy/klippy.py", line 112, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 1493, in load_config_prefix
    return ledEffect(config)
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 355, in __init__
    self.configLeds   = config.get('leds')
  File "/home/klipper/klipper/klippy/configfile.py", line 62, in get
    return self._get_wrapper(self.fileconfig.get, option, default,
  File "/home/klipper/klipper/klippy/configfile.py", line 37, in _get_wrapper
    raise error("Option '%s' in section '%s' must be specified"
configparser.Error: Option 'leds' in section 'led_effect sb_logo_cleaning' must be specified
webhooks client 281473465779536: New connection
webhooks client 281473465779536: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Unable to issue reset command on MCU 'mcu'
webhooks client 281473465779536: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:19:18 2024 (1735575558.7 78334.3)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = true
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462414512: New connection
webhooks client 281473462414512: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 78338.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3279 bytes_read=6194 bytes_retransmit=0 bytes_invalid=0 send_seq=231 receive_seq=228 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1991 upcoming_bytes=182 freq=71995445  orange_pi: temp=43.5 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.10 cputime=3478.500 memavail=1717952 print_time=336.320 buffer_time=0.199 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462414512
webhooks: registering remote method 'reboot_machine' for connection id: 281473462414512
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462414512
webhooks: registering remote method 'start_job_queue' for connection id: 281473462414512
Stats 78339.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7325 bytes_read=6854 bytes_retransmit=0 bytes_invalid=0 send_seq=321 receive_seq=321 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996494  orange_pi: temp=42.8 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.10 cputime=3478.634 memavail=1717208 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
Stats 78340.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=9103 bytes_read=7518 bytes_retransmit=0 bytes_invalid=0 send_seq=375 receive_seq=375 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997937  orange_pi: temp=43.1 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3478.750 memavail=1716568 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78341.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=10864 bytes_read=8228 bytes_retransmit=0 bytes_invalid=0 send_seq=433 receive_seq=432 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=9 upcoming_bytes=0 freq=71997833  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.10 cputime=3478.842 memavail=1716840 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78342.5: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000174 mcu_task_stddev=0.000289 bytes_write=12550 bytes_read=8875 bytes_retransmit=0 bytes_invalid=0 send_seq=484 receive_seq=484 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997771  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3478.924 memavail=1716356 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78343.5: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000174 mcu_task_stddev=0.000289 bytes_write=14341 bytes_read=9605 bytes_retransmit=0 bytes_invalid=0 send_seq=542 receive_seq=542 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997833  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3479.013 memavail=1716632 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78344.5: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000174 mcu_task_stddev=0.000289 bytes_write=16116 bytes_read=10302 bytes_retransmit=0 bytes_invalid=0 send_seq=598 receive_seq=598 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997976  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.09 cputime=3479.104 memavail=1715652 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78345.5: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000174 mcu_task_stddev=0.000289 bytes_write=17899 bytes_read=11015 bytes_retransmit=0 bytes_invalid=0 send_seq=657 receive_seq=657 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71997941  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3479.196 memavail=1715652 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78346.5: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000174 mcu_task_stddev=0.000289 bytes_write=19716 bytes_read=11909 bytes_retransmit=0 bytes_invalid=0 send_seq=727 receive_seq=727 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997939  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.09 cputime=3479.289 memavail=1715652 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78347.5: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000270 bytes_write=21518 bytes_read=12625 bytes_retransmit=0 bytes_invalid=0 send_seq=785 receive_seq=785 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997945  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3479.378 memavail=1715652 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78348.5: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000270 bytes_write=23340 bytes_read=13345 bytes_retransmit=0 bytes_invalid=0 send_seq=847 receive_seq=847 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997953  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=3479.469 memavail=1715904 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78349.5: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000270 bytes_write=25102 bytes_read=14148 bytes_retransmit=0 bytes_invalid=0 send_seq=910 receive_seq=910 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997961  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3479.561 memavail=1715652 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78350.5: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000270 bytes_write=26881 bytes_read=14808 bytes_retransmit=0 bytes_invalid=0 send_seq=965 receive_seq=965 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997972  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3479.647 memavail=1715400 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78351.5: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000270 bytes_write=28677 bytes_read=15552 bytes_retransmit=0 bytes_invalid=0 send_seq=1027 receive_seq=1027 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997990  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3479.739 memavail=1715152 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78352.5: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000222 mcu_task_stddev=0.000269 bytes_write=30496 bytes_read=16351 bytes_retransmit=0 bytes_invalid=0 send_seq=1090 receive_seq=1089 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998021  orange_pi: temp=41.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3479.830 memavail=1715172 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78353.5: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000222 mcu_task_stddev=0.000269 bytes_write=32207 bytes_read=17048 bytes_retransmit=0 bytes_invalid=0 send_seq=1145 receive_seq=1145 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998025  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3479.943 memavail=1715948 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78354.5: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000222 mcu_task_stddev=0.000269 bytes_write=33995 bytes_read=17748 bytes_retransmit=0 bytes_invalid=0 send_seq=1203 receive_seq=1203 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998047  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3480.032 memavail=1716724 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78355.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000222 mcu_task_stddev=0.000269 bytes_write=35764 bytes_read=18434 bytes_retransmit=0 bytes_invalid=0 send_seq=1257 receive_seq=1257 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998066  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3480.119 memavail=1716480 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78356.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000222 mcu_task_stddev=0.000269 bytes_write=37517 bytes_read=19097 bytes_retransmit=0 bytes_invalid=0 send_seq=1312 receive_seq=1311 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998064  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3480.209 memavail=1717268 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78357.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=39289 bytes_read=19887 bytes_retransmit=0 bytes_invalid=0 send_seq=1374 receive_seq=1374 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998063  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3480.298 memavail=1716784 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78358.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=41129 bytes_read=20716 bytes_retransmit=0 bytes_invalid=0 send_seq=1439 receive_seq=1439 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998069  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3480.393 memavail=1716784 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78359.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=42923 bytes_read=21431 bytes_retransmit=0 bytes_invalid=0 send_seq=1498 receive_seq=1498 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998069  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3480.483 memavail=1716536 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78360.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=44723 bytes_read=22170 bytes_retransmit=0 bytes_invalid=0 send_seq=1562 receive_seq=1561 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998072  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3480.572 memavail=1716536 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Neopixel update did not succeed
Stats 78361.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=46592 bytes_read=23109 bytes_retransmit=0 bytes_invalid=0 send_seq=1636 receive_seq=1636 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998083  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3480.668 memavail=1716284 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78362.6: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000232 mcu_task_stddev=0.000269 bytes_write=48358 bytes_read=23786 bytes_retransmit=0 bytes_invalid=0 send_seq=1690 receive_seq=1690 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998083  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3480.755 memavail=1716032 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78363.6: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000232 mcu_task_stddev=0.000269 bytes_write=50159 bytes_read=24495 bytes_retransmit=0 bytes_invalid=0 send_seq=1750 receive_seq=1749 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998106  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=3480.845 memavail=1715780 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78364.6: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000232 mcu_task_stddev=0.000269 bytes_write=51922 bytes_read=25222 bytes_retransmit=0 bytes_invalid=0 send_seq=1808 receive_seq=1808 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998257  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3480.936 memavail=1715528 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78365.6: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000232 mcu_task_stddev=0.000269 bytes_write=53739 bytes_read=26002 bytes_retransmit=0 bytes_invalid=0 send_seq=1871 receive_seq=1871 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998243  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=3481.027 memavail=1715276 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78366.6: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000232 mcu_task_stddev=0.000269 bytes_write=55572 bytes_read=26767 bytes_retransmit=0 bytes_invalid=0 send_seq=1935 receive_seq=1935 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998211  orange_pi: temp=41.7 chamber_heater: target=0 temp=27.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3481.118 memavail=1715276 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78367.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000220 mcu_task_stddev=0.000268 bytes_write=57366 bytes_read=27498 bytes_retransmit=0 bytes_invalid=0 send_seq=1993 receive_seq=1993 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998205  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=3481.205 memavail=1715028 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78368.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000220 mcu_task_stddev=0.000268 bytes_write=59099 bytes_read=28138 bytes_retransmit=0 bytes_invalid=0 send_seq=2045 receive_seq=2044 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998194  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3481.293 memavail=1715028 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78369.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000220 mcu_task_stddev=0.000268 bytes_write=60809 bytes_read=28778 bytes_retransmit=0 bytes_invalid=0 send_seq=2098 receive_seq=2098 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998182  orange_pi: temp=43.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=3481.379 memavail=1715028 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78370.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000220 mcu_task_stddev=0.000268 bytes_write=62618 bytes_read=29534 bytes_retransmit=0 bytes_invalid=0 send_seq=2158 receive_seq=2158 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998172  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=3481.471 memavail=1715028 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78371.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000220 mcu_task_stddev=0.000268 bytes_write=64362 bytes_read=30244 bytes_retransmit=0 bytes_invalid=0 send_seq=2215 receive_seq=2215 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998167  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3481.561 memavail=1715276 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Neopixel update did not succeed
Stats 78372.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=66213 bytes_read=31164 bytes_retransmit=0 bytes_invalid=0 send_seq=2288 receive_seq=2288 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998161  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3481.657 memavail=1715028 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78373.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=67964 bytes_read=31829 bytes_retransmit=0 bytes_invalid=0 send_seq=2341 receive_seq=2341 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998161  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3481.745 memavail=1714524 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78374.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=69799 bytes_read=32635 bytes_retransmit=0 bytes_invalid=0 send_seq=2406 receive_seq=2406 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998254  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=3481.838 memavail=1713772 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78375.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=71552 bytes_read=33335 bytes_retransmit=0 bytes_invalid=0 send_seq=2464 receive_seq=2464 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998237  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=3481.928 memavail=1713780 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78376.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=73294 bytes_read=34034 bytes_retransmit=0 bytes_invalid=0 send_seq=2519 receive_seq=2519 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998222  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.05 cputime=3482.017 memavail=1713288 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.2 pwm=0.000
Stats 78377.6: gcodein=0  mcu: mcu_awake=0.096 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=75087 bytes_read=34779 bytes_retransmit=0 bytes_invalid=0 send_seq=2578 receive_seq=2578 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998306  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=3482.110 memavail=1713304 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78378.6: gcodein=0  mcu: mcu_awake=0.096 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=76882 bytes_read=35479 bytes_retransmit=0 bytes_invalid=0 send_seq=2636 receive_seq=2636 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998284  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=3482.199 memavail=1712812 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78379.6: gcodein=0  mcu: mcu_awake=0.096 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=78719 bytes_read=36313 bytes_retransmit=0 bytes_invalid=0 send_seq=2703 receive_seq=2702 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998266  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=3482.292 memavail=1712976 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78380.6: gcodein=0  mcu: mcu_awake=0.096 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=80442 bytes_read=37044 bytes_retransmit=0 bytes_invalid=0 send_seq=2760 receive_seq=2760 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998249  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3482.380 memavail=1712816 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.2 pwm=0.000
Stats 78381.6: gcodein=0  mcu: mcu_awake=0.096 mcu_task_avg=0.000223 mcu_task_stddev=0.000271 bytes_write=82287 bytes_read=37861 bytes_retransmit=0 bytes_invalid=0 send_seq=2827 receive_seq=2827 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=3482.473 memavail=1712816 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78382.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000271 bytes_write=84055 bytes_read=38540 bytes_retransmit=0 bytes_invalid=0 send_seq=2881 receive_seq=2881 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998304  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3482.562 memavail=1713592 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78383.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000271 bytes_write=85833 bytes_read=39221 bytes_retransmit=0 bytes_invalid=0 send_seq=2937 receive_seq=2937 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998284  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3482.652 memavail=1713868 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78384.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000271 bytes_write=87519 bytes_read=39851 bytes_retransmit=0 bytes_invalid=0 send_seq=2989 receive_seq=2989 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998265  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.12 cputime=3482.737 memavail=1713384 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78385.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000271 bytes_write=89374 bytes_read=40677 bytes_retransmit=0 bytes_invalid=0 send_seq=3055 receive_seq=3055 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998249  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=3482.828 memavail=1713908 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78386.6: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000227 mcu_task_stddev=0.000271 bytes_write=91168 bytes_read=41384 bytes_retransmit=0 bytes_invalid=0 send_seq=3113 receive_seq=3113 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3482.916 memavail=1713928 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78387.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000222 mcu_task_stddev=0.000272 bytes_write=92943 bytes_read=42096 bytes_retransmit=0 bytes_invalid=0 send_seq=3170 receive_seq=3170 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998223  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.12 cputime=3483.007 memavail=1714180 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.3 pwm=0.000
Neopixel update did not succeed
Stats 78388.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000222 mcu_task_stddev=0.000272 bytes_write=94732 bytes_read=42823 bytes_retransmit=0 bytes_invalid=0 send_seq=3229 receive_seq=3229 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998211  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3483.098 memavail=1714180 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78389.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000222 mcu_task_stddev=0.000272 bytes_write=96438 bytes_read=43494 bytes_retransmit=0 bytes_invalid=0 send_seq=3283 receive_seq=3283 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998200  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3483.184 memavail=1714184 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78390.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000222 mcu_task_stddev=0.000272 bytes_write=98257 bytes_read=44230 bytes_retransmit=0 bytes_invalid=0 send_seq=3345 receive_seq=3345 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998255  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.11 cputime=3483.273 memavail=1714184 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78391.6: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000222 mcu_task_stddev=0.000272 bytes_write=100069 bytes_read=45025 bytes_retransmit=0 bytes_invalid=0 send_seq=3408 receive_seq=3408 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3483.365 memavail=1713944 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78392.6: gcodein=0  mcu: mcu_awake=0.099 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=101834 bytes_read=45718 bytes_retransmit=0 bytes_invalid=0 send_seq=3464 receive_seq=3463 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998229  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3483.454 memavail=1713440 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78393.6: gcodein=0  mcu: mcu_awake=0.099 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=103525 bytes_read=46374 bytes_retransmit=0 bytes_invalid=0 send_seq=3517 receive_seq=3517 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998218  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3483.540 memavail=1713448 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78394.6: gcodein=0  mcu: mcu_awake=0.099 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=105340 bytes_read=47156 bytes_retransmit=0 bytes_invalid=0 send_seq=3579 receive_seq=3579 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998209  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3483.632 memavail=1712188 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78395.6: gcodein=0  mcu: mcu_awake=0.099 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=107119 bytes_read=47853 bytes_retransmit=0 bytes_invalid=0 send_seq=3635 receive_seq=3635 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998205  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3483.718 memavail=1711936 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78396.6: gcodein=0  mcu: mcu_awake=0.099 mcu_task_avg=0.000226 mcu_task_stddev=0.000271 bytes_write=108905 bytes_read=48542 bytes_retransmit=0 bytes_invalid=0 send_seq=3692 receive_seq=3691 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998199  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3483.808 memavail=1712208 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78397.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000221 mcu_task_stddev=0.000269 bytes_write=110675 bytes_read=49370 bytes_retransmit=0 bytes_invalid=0 send_seq=3757 receive_seq=3757 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998190  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3483.899 memavail=1712716 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78398.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000221 mcu_task_stddev=0.000269 bytes_write=112493 bytes_read=50124 bytes_retransmit=0 bytes_invalid=0 send_seq=3818 receive_seq=3818 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998182  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3483.990 memavail=1712716 print_time=336.320 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 78451.6: gcodein=0  mcu: mcu_awake=0.097 mcu_task_avg=0.000224 mcu_task_stddev=0.000270 bytes_write=207142 bytes_read=89296 bytes_retransmit=0 bytes_invalid=0 send_seq=6979 receive_seq=6979 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998149  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=3488.774 memavail=1716344 print_time=449.337 buffer_time=0.150 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 281473462414512: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:21:17 2024 (1735575677.3 78452.9)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462205264: New connection
webhooks client 281473462205264: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 78457.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=3274 bytes_read=6191 bytes_retransmit=0 bytes_invalid=0 send_seq=230 receive_seq=227 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2001 upcoming_bytes=172 freq=71995195  orange_pi: temp=44.6 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.29 cputime=3491.994 memavail=1716236 print_time=5.509 buffer_time=0.199 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462205264
webhooks: registering remote method 'reboot_machine' for connection id: 281473462205264
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462205264
webhooks: registering remote method 'start_job_queue' for connection id: 281473462205264
Stats 78458.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=7292 bytes_read=6950 bytes_retransmit=0 bytes_invalid=0 send_seq=324 receive_seq=324 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996589  orange_pi: temp=43.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.27 cputime=3492.101 memavail=1715272 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78459.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=9109 bytes_read=7681 bytes_retransmit=0 bytes_invalid=0 send_seq=385 receive_seq=385 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998077  orange_pi: temp=43.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.27 cputime=3492.226 memavail=1714552 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78460.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=10904 bytes_read=8601 bytes_retransmit=0 bytes_invalid=0 send_seq=457 receive_seq=457 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997832  orange_pi: temp=42.8 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.27 cputime=3492.308 memavail=1714048 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78461.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=12719 bytes_read=9475 bytes_retransmit=0 bytes_invalid=0 send_seq=526 receive_seq=526 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997864  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.27 cputime=3492.390 memavail=1713292 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78462.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000252 mcu_task_stddev=0.000307 bytes_write=14565 bytes_read=10374 bytes_retransmit=0 bytes_invalid=0 send_seq=598 receive_seq=598 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997910  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.27 cputime=3492.473 memavail=1713296 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78463.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000252 mcu_task_stddev=0.000307 bytes_write=16416 bytes_read=11312 bytes_retransmit=0 bytes_invalid=0 send_seq=672 receive_seq=672 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997908  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.24 cputime=3492.558 memavail=1712560 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78464.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000252 mcu_task_stddev=0.000307 bytes_write=18213 bytes_read=12186 bytes_retransmit=0 bytes_invalid=0 send_seq=741 receive_seq=741 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997948  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.24 cputime=3492.642 memavail=1713152 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78465.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000252 mcu_task_stddev=0.000307 bytes_write=19981 bytes_read=12964 bytes_retransmit=0 bytes_invalid=0 send_seq=805 receive_seq=805 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997949  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.24 cputime=3492.719 memavail=1712908 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78466.2: gcodein=0  mcu: mcu_awake=0.151 mcu_task_avg=0.000252 mcu_task_stddev=0.000307 bytes_write=21809 bytes_read=13837 bytes_retransmit=0 bytes_invalid=0 send_seq=874 receive_seq=874 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=44 upcoming_bytes=0 freq=71997961  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.24 cputime=3492.804 memavail=1713464 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78467.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=23665 bytes_read=14832 bytes_retransmit=0 bytes_invalid=0 send_seq=951 receive_seq=951 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997979  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.24 cputime=3492.889 memavail=1712988 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78468.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=25441 bytes_read=15610 bytes_retransmit=0 bytes_invalid=0 send_seq=1015 receive_seq=1015 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997987  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.22 cputime=3492.968 memavail=1712516 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78469.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=27305 bytes_read=16467 bytes_retransmit=0 bytes_invalid=0 send_seq=1085 receive_seq=1084 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997992  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.22 cputime=3493.049 memavail=1713020 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78470.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=29170 bytes_read=17473 bytes_retransmit=0 bytes_invalid=0 send_seq=1165 receive_seq=1165 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998015  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.22 cputime=3493.139 memavail=1712536 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78471.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=31032 bytes_read=18394 bytes_retransmit=0 bytes_invalid=0 send_seq=1240 receive_seq=1240 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998021  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.22 cputime=3493.224 memavail=1711780 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78472.2: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000266 mcu_task_stddev=0.000261 bytes_write=32785 bytes_read=19167 bytes_retransmit=0 bytes_invalid=0 send_seq=1300 receive_seq=1300 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998030  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.22 cputime=3493.302 memavail=1712100 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78473.2: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000266 mcu_task_stddev=0.000261 bytes_write=34678 bytes_read=20147 bytes_retransmit=0 bytes_invalid=0 send_seq=1379 receive_seq=1379 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998059  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=3493.413 memavail=1712120 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78474.2: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000266 mcu_task_stddev=0.000261 bytes_write=36523 bytes_read=21029 bytes_retransmit=0 bytes_invalid=0 send_seq=1451 receive_seq=1451 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998067  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=3493.499 memavail=1712208 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78475.2: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000266 mcu_task_stddev=0.000261 bytes_write=38303 bytes_read=21850 bytes_retransmit=0 bytes_invalid=0 send_seq=1516 receive_seq=1516 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998068  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=3493.578 memavail=1711980 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78476.2: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000266 mcu_task_stddev=0.000261 bytes_write=40136 bytes_read=22776 bytes_retransmit=0 bytes_invalid=0 send_seq=1589 receive_seq=1589 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998071  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=3493.660 memavail=1712000 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78477.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000267 mcu_task_stddev=0.000263 bytes_write=41870 bytes_read=23475 bytes_retransmit=0 bytes_invalid=0 send_seq=1645 receive_seq=1645 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998101  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.21 cputime=3493.737 memavail=1711768 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78478.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000267 mcu_task_stddev=0.000263 bytes_write=43835 bytes_read=24634 bytes_retransmit=0 bytes_invalid=0 send_seq=1736 receive_seq=1736 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998100  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.19 cputime=3493.830 memavail=1712312 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78479.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000267 mcu_task_stddev=0.000263 bytes_write=45620 bytes_read=25479 bytes_retransmit=0 bytes_invalid=0 send_seq=1804 receive_seq=1804 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=44 upcoming_bytes=0 freq=71998096  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.19 cputime=3493.910 memavail=1712832 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78480.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000267 mcu_task_stddev=0.000263 bytes_write=47379 bytes_read=26195 bytes_retransmit=0 bytes_invalid=0 send_seq=1862 receive_seq=1862 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998100  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.19 cputime=3493.985 memavail=1712600 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78481.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000267 mcu_task_stddev=0.000263 bytes_write=49322 bytes_read=27284 bytes_retransmit=0 bytes_invalid=0 send_seq=1947 receive_seq=1947 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998099  orange_pi: temp=42.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.19 cputime=3494.074 memavail=1712616 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78482.2: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000282 mcu_task_stddev=0.000263 bytes_write=51171 bytes_read=28237 bytes_retransmit=0 bytes_invalid=0 send_seq=2022 receive_seq=2022 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998100  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.19 cputime=3494.159 memavail=1713392 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78483.2: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000282 mcu_task_stddev=0.000263 bytes_write=53008 bytes_read=29135 bytes_retransmit=0 bytes_invalid=0 send_seq=2094 receive_seq=2094 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998104  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=3494.238 memavail=1713140 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78484.2: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000282 mcu_task_stddev=0.000263 bytes_write=54773 bytes_read=29930 bytes_retransmit=0 bytes_invalid=0 send_seq=2157 receive_seq=2157 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998111  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=3494.318 memavail=1711676 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78485.2: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000282 mcu_task_stddev=0.000263 bytes_write=56589 bytes_read=30773 bytes_retransmit=0 bytes_invalid=0 send_seq=2224 receive_seq=2224 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998117  orange_pi: temp=42.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.17 cputime=3494.400 memavail=1712200 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78486.2: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000282 mcu_task_stddev=0.000263 bytes_write=58362 bytes_read=31585 bytes_retransmit=0 bytes_invalid=0 send_seq=2290 receive_seq=2290 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998248  orange_pi: temp=41.9 chamber_heater: target=0 temp=25.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=3494.481 memavail=1711948 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78487.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000265 mcu_task_stddev=0.000264 bytes_write=60180 bytes_read=32449 bytes_retransmit=0 bytes_invalid=0 send_seq=2357 receive_seq=2357 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998230  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=3494.563 memavail=1711964 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78488.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000265 mcu_task_stddev=0.000264 bytes_write=61991 bytes_read=33294 bytes_retransmit=0 bytes_invalid=0 send_seq=2426 receive_seq=2425 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998216  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=3494.643 memavail=1712744 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78489.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000265 mcu_task_stddev=0.000264 bytes_write=63788 bytes_read=34218 bytes_retransmit=0 bytes_invalid=0 send_seq=2499 receive_seq=2499 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998206  orange_pi: temp=41.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=3494.729 memavail=1713272 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78490.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000265 mcu_task_stddev=0.000264 bytes_write=65768 bytes_read=35320 bytes_retransmit=0 bytes_invalid=0 send_seq=2585 receive_seq=2585 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998194  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=3494.819 memavail=1714040 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78491.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000265 mcu_task_stddev=0.000264 bytes_write=67515 bytes_read=36061 bytes_retransmit=0 bytes_invalid=0 send_seq=2645 receive_seq=2645 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998184  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=3494.895 memavail=1713284 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78492.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000275 mcu_task_stddev=0.000262 bytes_write=69237 bytes_read=36885 bytes_retransmit=0 bytes_invalid=0 send_seq=2710 receive_seq=2710 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998178  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=3494.975 memavail=1713032 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78493.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000275 mcu_task_stddev=0.000262 bytes_write=71239 bytes_read=37992 bytes_retransmit=0 bytes_invalid=0 send_seq=2797 receive_seq=2797 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998170  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=3495.064 memavail=1713032 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78494.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000275 mcu_task_stddev=0.000262 bytes_write=73090 bytes_read=38902 bytes_retransmit=0 bytes_invalid=0 send_seq=2870 receive_seq=2870 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998163  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=3495.149 memavail=1713304 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78495.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000275 mcu_task_stddev=0.000262 bytes_write=74748 bytes_read=39571 bytes_retransmit=0 bytes_invalid=0 send_seq=2925 receive_seq=2925 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998158  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=3495.222 memavail=1713304 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78496.2: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000275 mcu_task_stddev=0.000262 bytes_write=76702 bytes_read=40660 bytes_retransmit=0 bytes_invalid=0 send_seq=3010 receive_seq=3010 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998153  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.15 cputime=3495.312 memavail=1713080 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78497.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000284 mcu_task_stddev=0.000261 bytes_write=78559 bytes_read=41569 bytes_retransmit=0 bytes_invalid=0 send_seq=3081 receive_seq=3081 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998150  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=3495.397 memavail=1713084 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78498.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000284 mcu_task_stddev=0.000261 bytes_write=80385 bytes_read=42477 bytes_retransmit=0 bytes_invalid=0 send_seq=3155 receive_seq=3155 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998147  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.13 cputime=3495.481 memavail=1713084 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Neopixel update did not succeed
Stats 78499.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000284 mcu_task_stddev=0.000261 bytes_write=82256 bytes_read=43535 bytes_retransmit=0 bytes_invalid=0 send_seq=3237 receive_seq=3237 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998142  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3495.574 memavail=1713084 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78500.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000284 mcu_task_stddev=0.000261 bytes_write=84200 bytes_read=44536 bytes_retransmit=0 bytes_invalid=0 send_seq=3317 receive_seq=3317 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998142  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.13 cputime=3495.661 memavail=1712600 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78501.2: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000284 mcu_task_stddev=0.000261 bytes_write=86050 bytes_read=45452 bytes_retransmit=0 bytes_invalid=0 send_seq=3392 receive_seq=3391 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998140  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.13 cputime=3495.745 memavail=1712600 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78502.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000287 mcu_task_stddev=0.000258 bytes_write=87817 bytes_read=46389 bytes_retransmit=0 bytes_invalid=0 send_seq=3463 receive_seq=3463 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998191  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.13 cputime=3495.827 memavail=1712376 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 78503.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000287 mcu_task_stddev=0.000258 bytes_write=89696 bytes_read=47286 bytes_retransmit=0 bytes_invalid=0 send_seq=3535 receive_seq=3535 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998253  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=3495.912 memavail=1712900 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78504.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000287 mcu_task_stddev=0.000258 bytes_write=91589 bytes_read=48246 bytes_retransmit=0 bytes_invalid=0 send_seq=3614 receive_seq=3613 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.12 cputime=3495.999 memavail=1713208 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78505.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000287 mcu_task_stddev=0.000258 bytes_write=93485 bytes_read=49322 bytes_retransmit=0 bytes_invalid=0 send_seq=3698 receive_seq=3697 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998296  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=3496.085 memavail=1713212 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78506.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000287 mcu_task_stddev=0.000258 bytes_write=95302 bytes_read=50232 bytes_retransmit=0 bytes_invalid=0 send_seq=3770 receive_seq=3770 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998290  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=3496.170 memavail=1713216 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78507.2: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=97194 bytes_read=51170 bytes_retransmit=0 bytes_invalid=0 send_seq=3845 receive_seq=3845 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998274  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3496.251 memavail=1714012 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78508.2: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=99096 bytes_read=52199 bytes_retransmit=0 bytes_invalid=0 send_seq=3927 receive_seq=3926 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998317  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3496.337 memavail=1714328 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78509.2: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=100916 bytes_read=53208 bytes_retransmit=0 bytes_invalid=0 send_seq=4006 receive_seq=4006 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998298  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3496.424 memavail=1714096 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78510.2: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=102829 bytes_read=54129 bytes_retransmit=0 bytes_invalid=0 send_seq=4081 receive_seq=4081 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998281  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3496.507 memavail=1714620 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78511.2: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=104699 bytes_read=55067 bytes_retransmit=0 bytes_invalid=0 send_seq=4157 receive_seq=4157 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998265  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3496.593 memavail=1714892 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78512.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000288 mcu_task_stddev=0.000262 bytes_write=106505 bytes_read=55995 bytes_retransmit=0 bytes_invalid=0 send_seq=4231 receive_seq=4231 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998253  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3496.679 memavail=1714392 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78513.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000288 mcu_task_stddev=0.000262 bytes_write=108381 bytes_read=56914 bytes_retransmit=0 bytes_invalid=0 send_seq=4306 receive_seq=4306 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998242  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3496.762 memavail=1714412 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78514.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000288 mcu_task_stddev=0.000262 bytes_write=110213 bytes_read=57777 bytes_retransmit=0 bytes_invalid=0 send_seq=4375 receive_seq=4375 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998233  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.10 cputime=3496.844 memavail=1714480 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78515.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000288 mcu_task_stddev=0.000262 bytes_write=112003 bytes_read=58583 bytes_retransmit=0 bytes_invalid=0 send_seq=4441 receive_seq=4440 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998222  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3496.923 memavail=1714236 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78516.2: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000288 mcu_task_stddev=0.000262 bytes_write=113800 bytes_read=59507 bytes_retransmit=0 bytes_invalid=0 send_seq=4514 receive_seq=4514 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998216  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3497.007 memavail=1713732 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78517.2: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000279 mcu_task_stddev=0.000262 bytes_write=115750 bytes_read=60566 bytes_retransmit=0 bytes_invalid=0 send_seq=4596 receive_seq=4596 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3497.095 memavail=1713228 print_time=5.509 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Neopixel update did not succeed
Stats 78583.2: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000289 mcu_task_stddev=0.000258 bytes_write=238071 bytes_read=122391 bytes_retransmit=0 bytes_invalid=0 send_seq=9521 receive_seq=9521 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998182  orange_pi: temp=42.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3502.685 memavail=1713116 print_time=131.472 buffer_time=0.097 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 281473462205264: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:23:28 2024 (1735575808.9 78584.5)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (1-8,16-9)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473444406576: New connection
webhooks client 281473444406576: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 78588.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=3279 bytes_read=6196 bytes_retransmit=0 bytes_invalid=0 send_seq=231 receive_seq=228 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1909 upcoming_bytes=264 freq=71994975  orange_pi: temp=42.7 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.11 cputime=3505.900 memavail=1712008 print_time=5.507 buffer_time=0.198 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473444406576
webhooks: registering remote method 'reboot_machine' for connection id: 281473444406576
webhooks: registering remote method 'pause_job_queue' for connection id: 281473444406576
webhooks: registering remote method 'start_job_queue' for connection id: 281473444406576
Stats 78589.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=7362 bytes_read=6968 bytes_retransmit=0 bytes_invalid=0 send_seq=326 receive_seq=326 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71996291  orange_pi: temp=45.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3506.054 memavail=1711804 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 78590.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=9212 bytes_read=7785 bytes_retransmit=0 bytes_invalid=0 send_seq=393 receive_seq=393 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71997184  orange_pi: temp=45.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=3506.180 memavail=1711784 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78591.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=11075 bytes_read=8757 bytes_retransmit=0 bytes_invalid=0 send_seq=470 receive_seq=469 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997529  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3506.268 memavail=1711656 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78592.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=12966 bytes_read=9667 bytes_retransmit=0 bytes_invalid=0 send_seq=542 receive_seq=542 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997606  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=3506.352 memavail=1711692 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78593.7: gcodein=0  mcu: mcu_awake=0.156 mcu_task_avg=0.000249 mcu_task_stddev=0.000303 bytes_write=14855 bytes_read=10576 bytes_retransmit=0 bytes_invalid=0 send_seq=616 receive_seq=616 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71997738  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3506.437 memavail=1710956 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78594.7: gcodein=0  mcu: mcu_awake=0.156 mcu_task_avg=0.000249 mcu_task_stddev=0.000303 bytes_write=16732 bytes_read=11566 bytes_retransmit=0 bytes_invalid=0 send_seq=694 receive_seq=694 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997889  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.10 cputime=3506.526 memavail=1710960 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78595.7: gcodein=0  mcu: mcu_awake=0.156 mcu_task_avg=0.000249 mcu_task_stddev=0.000303 bytes_write=18688 bytes_read=12632 bytes_retransmit=0 bytes_invalid=0 send_seq=779 receive_seq=779 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997887  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3506.616 memavail=1710960 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78596.7: gcodein=0  mcu: mcu_awake=0.156 mcu_task_avg=0.000249 mcu_task_stddev=0.000303 bytes_write=20659 bytes_read=13644 bytes_retransmit=0 bytes_invalid=0 send_seq=862 receive_seq=861 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998150  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.10 cputime=3506.702 memavail=1710976 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78597.7: gcodein=0  mcu: mcu_awake=0.156 mcu_task_avg=0.000249 mcu_task_stddev=0.000303 bytes_write=22419 bytes_read=14447 bytes_retransmit=0 bytes_invalid=0 send_seq=924 receive_seq=924 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998091  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=3506.779 memavail=1711256 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78598.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000256 bytes_write=24351 bytes_read=15504 bytes_retransmit=0 bytes_invalid=0 send_seq=1007 receive_seq=1007 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998059  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3506.867 memavail=1711760 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78599.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000256 bytes_write=26383 bytes_read=16641 bytes_retransmit=0 bytes_invalid=0 send_seq=1098 receive_seq=1098 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998057  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=3506.960 memavail=1712276 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78600.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000256 bytes_write=28353 bytes_read=17748 bytes_retransmit=0 bytes_invalid=0 send_seq=1185 receive_seq=1185 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998046  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=3507.050 memavail=1712800 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78601.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000256 bytes_write=30137 bytes_read=18588 bytes_retransmit=0 bytes_invalid=0 send_seq=1252 receive_seq=1252 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998041  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.09 cputime=3507.129 memavail=1712560 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78602.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000256 bytes_write=31955 bytes_read=19361 bytes_retransmit=0 bytes_invalid=0 send_seq=1315 receive_seq=1315 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998048  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3507.234 memavail=1712568 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78603.7: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000281 mcu_task_stddev=0.000253 bytes_write=33965 bytes_read=20511 bytes_retransmit=0 bytes_invalid=0 send_seq=1404 receive_seq=1404 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998410  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3507.327 memavail=1711068 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78604.7: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000281 mcu_task_stddev=0.000253 bytes_write=35836 bytes_read=21486 bytes_retransmit=0 bytes_invalid=0 send_seq=1482 receive_seq=1482 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998344  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3507.413 memavail=1711580 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78605.7: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000281 mcu_task_stddev=0.000253 bytes_write=37677 bytes_read=22287 bytes_retransmit=0 bytes_invalid=0 send_seq=1549 receive_seq=1549 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998304  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3507.492 memavail=1712092 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78606.7: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000281 mcu_task_stddev=0.000253 bytes_write=39555 bytes_read=23173 bytes_retransmit=0 bytes_invalid=0 send_seq=1619 receive_seq=1619 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998258  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.08 cputime=3507.575 memavail=1711864 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78607.7: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000281 mcu_task_stddev=0.000253 bytes_write=41371 bytes_read=24065 bytes_retransmit=0 bytes_invalid=0 send_seq=1690 receive_seq=1690 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=42.1 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3507.658 memavail=1711872 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78608.7: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=43207 bytes_read=24933 bytes_retransmit=0 bytes_invalid=0 send_seq=1759 receive_seq=1759 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998214  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.08 cputime=3507.741 memavail=1711892 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78609.7: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=45148 bytes_read=25949 bytes_retransmit=0 bytes_invalid=0 send_seq=1839 receive_seq=1839 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998189  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3507.828 memavail=1712648 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78610.7: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=46945 bytes_read=26789 bytes_retransmit=0 bytes_invalid=0 send_seq=1906 receive_seq=1906 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998167  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3507.906 memavail=1712400 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78611.7: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=48840 bytes_read=27715 bytes_retransmit=0 bytes_invalid=0 send_seq=1982 receive_seq=1982 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998158  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3507.992 memavail=1712168 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78612.7: gcodein=0  mcu: mcu_awake=0.127 mcu_task_avg=0.000276 mcu_task_stddev=0.000260 bytes_write=50809 bytes_read=28788 bytes_retransmit=0 bytes_invalid=0 send_seq=2067 receive_seq=2067 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998147  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3508.081 memavail=1712420 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78613.7: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=52686 bytes_read=29673 bytes_retransmit=0 bytes_invalid=0 send_seq=2138 receive_seq=2138 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998149  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3508.164 memavail=1712156 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78614.7: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=54582 bytes_read=30633 bytes_retransmit=0 bytes_invalid=0 send_seq=2217 receive_seq=2216 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998142  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.07 cputime=3508.250 memavail=1713732 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78615.7: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=56562 bytes_read=31774 bytes_retransmit=0 bytes_invalid=0 send_seq=2305 receive_seq=2305 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998135  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3508.342 memavail=1712992 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78616.7: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=58487 bytes_read=32705 bytes_retransmit=0 bytes_invalid=0 send_seq=2381 receive_seq=2380 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998136  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3508.428 memavail=1712500 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78617.7: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000258 bytes_write=60269 bytes_read=33501 bytes_retransmit=0 bytes_invalid=0 send_seq=2446 receive_seq=2446 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998247  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3508.505 memavail=1713268 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78618.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000281 mcu_task_stddev=0.000258 bytes_write=62222 bytes_read=34599 bytes_retransmit=0 bytes_invalid=0 send_seq=2532 receive_seq=2531 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998227  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=3508.595 memavail=1713540 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78619.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000281 mcu_task_stddev=0.000258 bytes_write=64162 bytes_read=35579 bytes_retransmit=0 bytes_invalid=0 send_seq=2610 receive_seq=2610 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998210  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=3508.685 memavail=1713828 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78620.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000281 mcu_task_stddev=0.000258 bytes_write=65934 bytes_read=36360 bytes_retransmit=0 bytes_invalid=0 send_seq=2673 receive_seq=2673 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998197  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3508.763 memavail=1713084 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78621.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000281 mcu_task_stddev=0.000258 bytes_write=67794 bytes_read=37254 bytes_retransmit=0 bytes_invalid=0 send_seq=2744 receive_seq=2743 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998184  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3508.846 memavail=1712328 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78622.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000281 mcu_task_stddev=0.000258 bytes_write=69750 bytes_read=38291 bytes_retransmit=0 bytes_invalid=0 send_seq=2827 receive_seq=2827 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998172  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3508.933 memavail=1711824 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78623.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000274 mcu_task_stddev=0.000258 bytes_write=71597 bytes_read=39141 bytes_retransmit=0 bytes_invalid=0 send_seq=2895 receive_seq=2894 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998165  orange_pi: temp=42.3 chamber_heater: target=0 temp=25.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3509.016 memavail=1710820 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78624.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000274 mcu_task_stddev=0.000258 bytes_write=73420 bytes_read=40035 bytes_retransmit=0 bytes_invalid=0 send_seq=2964 receive_seq=2964 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998157  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3509.100 memavail=1710592 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78625.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000274 mcu_task_stddev=0.000258 bytes_write=75163 bytes_read=40703 bytes_retransmit=0 bytes_invalid=0 send_seq=3019 receive_seq=3019 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998151  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=3509.176 memavail=1710848 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78626.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000274 mcu_task_stddev=0.000258 bytes_write=77052 bytes_read=41642 bytes_retransmit=0 bytes_invalid=0 send_seq=3096 receive_seq=3096 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998147  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=3509.263 memavail=1711372 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78627.7: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000274 mcu_task_stddev=0.000258 bytes_write=78943 bytes_read=42601 bytes_retransmit=0 bytes_invalid=0 send_seq=3171 receive_seq=3171 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998224  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3509.346 memavail=1711372 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78628.7: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000264 mcu_task_stddev=0.000260 bytes_write=80756 bytes_read=43437 bytes_retransmit=0 bytes_invalid=0 send_seq=3237 receive_seq=3237 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998211  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.05 cputime=3509.428 memavail=1711644 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78629.7: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000264 mcu_task_stddev=0.000260 bytes_write=82670 bytes_read=44384 bytes_retransmit=0 bytes_invalid=0 send_seq=3314 receive_seq=3314 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998199  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3509.513 memavail=1711916 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78630.7: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000264 mcu_task_stddev=0.000260 bytes_write=84617 bytes_read=45499 bytes_retransmit=0 bytes_invalid=0 send_seq=3401 receive_seq=3401 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998188  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=3509.602 memavail=1711660 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78631.7: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000264 mcu_task_stddev=0.000260 bytes_write=86518 bytes_read=46435 bytes_retransmit=0 bytes_invalid=0 send_seq=3476 receive_seq=3476 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998180  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=3509.687 memavail=1711660 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Neopixel update did not succeed
Stats 78632.7: gcodein=0  mcu: mcu_awake=0.117 mcu_task_avg=0.000264 mcu_task_stddev=0.000260 bytes_write=88424 bytes_read=47382 bytes_retransmit=0 bytes_invalid=0 send_seq=3553 receive_seq=3553 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998173  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3509.773 memavail=1712696 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78633.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=90181 bytes_read=48176 bytes_retransmit=0 bytes_invalid=0 send_seq=3614 receive_seq=3614 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998240  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=3509.851 memavail=1711444 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78634.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=92062 bytes_read=49073 bytes_retransmit=0 bytes_invalid=0 send_seq=3686 receive_seq=3686 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998228  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3509.936 memavail=1711472 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78635.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=94031 bytes_read=50150 bytes_retransmit=0 bytes_invalid=0 send_seq=3773 receive_seq=3773 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998216  orange_pi: temp=42.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.05 cputime=3510.027 memavail=1711728 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78636.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=95874 bytes_read=51023 bytes_retransmit=0 bytes_invalid=0 send_seq=3842 receive_seq=3842 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998203  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3510.111 memavail=1711476 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78637.7: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=97678 bytes_read=51837 bytes_retransmit=0 bytes_invalid=0 send_seq=3907 receive_seq=3907 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998194  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.05 cputime=3510.189 memavail=1712232 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78638.8: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000271 mcu_task_stddev=0.000257 bytes_write=99587 bytes_read=52827 bytes_retransmit=0 bytes_invalid=0 send_seq=3986 receive_seq=3986 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998185  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.04 cputime=3510.278 memavail=1712740 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78639.8: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000271 mcu_task_stddev=0.000257 bytes_write=101570 bytes_read=53947 bytes_retransmit=0 bytes_invalid=0 send_seq=4074 receive_seq=4074 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998178  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.04 cputime=3510.371 memavail=1712572 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78640.8: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000271 mcu_task_stddev=0.000257 bytes_write=103397 bytes_read=54797 bytes_retransmit=0 bytes_invalid=0 send_seq=4143 receive_seq=4143 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998173  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.04 cputime=3510.455 memavail=1712588 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78641.8: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000271 mcu_task_stddev=0.000257 bytes_write=105313 bytes_read=55728 bytes_retransmit=0 bytes_invalid=0 send_seq=4220 receive_seq=4220 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998169  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.04 cputime=3510.539 memavail=1713120 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78642.8: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000271 mcu_task_stddev=0.000257 bytes_write=107226 bytes_read=56734 bytes_retransmit=0 bytes_invalid=0 send_seq=4300 receive_seq=4300 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998228  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.04 cputime=3510.629 memavail=1712376 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78643.8: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000277 mcu_task_stddev=0.000254 bytes_write=109124 bytes_read=57667 bytes_retransmit=0 bytes_invalid=0 send_seq=4375 receive_seq=4375 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998216  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.04 cputime=3510.715 memavail=1712148 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78644.8: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000277 mcu_task_stddev=0.000254 bytes_write=110929 bytes_read=58469 bytes_retransmit=0 bytes_invalid=0 send_seq=4441 receive_seq=4441 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998207  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.04 cputime=3510.795 memavail=1712160 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 78645.8: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000277 mcu_task_stddev=0.000254 bytes_write=112751 bytes_read=59314 bytes_retransmit=0 bytes_invalid=0 send_seq=4508 receive_seq=4508 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998199  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.04 cputime=3510.878 memavail=1711980 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78646.8: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000277 mcu_task_stddev=0.000254 bytes_write=114789 bytes_read=60492 bytes_retransmit=0 bytes_invalid=0 send_seq=4602 receive_seq=4601 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998190  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.04 cputime=3510.972 memavail=1711984 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78647.8: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000277 mcu_task_stddev=0.000254 bytes_write=116671 bytes_read=61486 bytes_retransmit=0 bytes_invalid=0 send_seq=4681 receive_seq=4681 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998184  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.04 cputime=3511.057 memavail=1711992 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.2 pwm=0.000
Neopixel update did not succeed
Stats 78648.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000279 mcu_task_stddev=0.000253 bytes_write=118583 bytes_read=62477 bytes_retransmit=0 bytes_invalid=0 send_seq=4759 receive_seq=4759 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998180  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.04 cputime=3511.143 memavail=1711744 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 78703.8: gcodein=0  mcu: mcu_awake=0.143 mcu_task_avg=0.000289 mcu_task_stddev=0.000257 bytes_write=222058 bytes_read=114006 bytes_retransmit=0 bytes_invalid=0 send_seq=8872 receive_seq=8872 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998146  orange_pi: temp=42.5 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.01 cputime=3515.765 memavail=1717732 print_time=121.142 buffer_time=0.758 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 281473444406576: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:25:30 2024 (1735575930.1 78705.7)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (8-1,16-9)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473445117136: New connection
webhooks client 281473445117136: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 78710.0: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=3279 bytes_read=6196 bytes_retransmit=0 bytes_invalid=0 send_seq=231 receive_seq=228 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2001 upcoming_bytes=172 freq=71994825  orange_pi: temp=44.3 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.09 cputime=3519.052 memavail=1717124 print_time=5.520 buffer_time=0.199 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473445117136
webhooks: registering remote method 'reboot_machine' for connection id: 281473445117136
webhooks: registering remote method 'pause_job_queue' for connection id: 281473445117136
webhooks: registering remote method 'start_job_queue' for connection id: 281473445117136
Stats 78711.0: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=7351 bytes_read=6937 bytes_retransmit=0 bytes_invalid=0 send_seq=324 receive_seq=323 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=18 upcoming_bytes=0 freq=71996355  orange_pi: temp=43.8 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.09 cputime=3519.158 memavail=1716932 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78712.0: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=9212 bytes_read=7777 bytes_retransmit=0 bytes_invalid=0 send_seq=393 receive_seq=393 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998252  orange_pi: temp=44.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.09 cputime=3519.268 memavail=1716864 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78713.0: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=11050 bytes_read=8702 bytes_retransmit=0 bytes_invalid=0 send_seq=466 receive_seq=466 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71997903  orange_pi: temp=43.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.09 cputime=3519.353 memavail=1717296 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78714.0: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=12908 bytes_read=9576 bytes_retransmit=0 bytes_invalid=0 send_seq=535 receive_seq=535 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997813  orange_pi: temp=42.8 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=3519.438 memavail=1718060 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78715.0: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000256 mcu_task_stddev=0.000306 bytes_write=14830 bytes_read=10537 bytes_retransmit=0 bytes_invalid=0 send_seq=613 receive_seq=613 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71999943  orange_pi: temp=43.3 chamber_heater: target=0 temp=27.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3519.522 memavail=1717820 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78716.0: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000256 mcu_task_stddev=0.000306 bytes_write=16720 bytes_read=11532 bytes_retransmit=0 bytes_invalid=0 send_seq=692 receive_seq=692 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71999112  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3519.610 memavail=1717564 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78717.0: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000256 mcu_task_stddev=0.000306 bytes_write=18696 bytes_read=12619 bytes_retransmit=0 bytes_invalid=0 send_seq=778 receive_seq=778 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998691  orange_pi: temp=42.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.08 cputime=3519.698 memavail=1717316 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78718.0: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000256 mcu_task_stddev=0.000306 bytes_write=20615 bytes_read=13545 bytes_retransmit=0 bytes_invalid=0 send_seq=854 receive_seq=854 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998432  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3519.781 memavail=1717324 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78719.0: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000256 mcu_task_stddev=0.000306 bytes_write=22523 bytes_read=14514 bytes_retransmit=0 bytes_invalid=0 send_seq=931 receive_seq=931 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998280  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.16 cputime=3519.866 memavail=1717336 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78720.0: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000287 mcu_task_stddev=0.000256 bytes_write=24419 bytes_read=15579 bytes_retransmit=0 bytes_invalid=0 send_seq=1014 receive_seq=1014 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998681  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=3519.955 memavail=1716836 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78721.0: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000287 mcu_task_stddev=0.000256 bytes_write=26403 bytes_read=16630 bytes_retransmit=0 bytes_invalid=0 send_seq=1099 receive_seq=1099 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998496  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=3520.042 memavail=1716856 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78722.0: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000287 mcu_task_stddev=0.000256 bytes_write=28332 bytes_read=17646 bytes_retransmit=0 bytes_invalid=0 send_seq=1180 receive_seq=1179 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998374  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.16 cputime=3520.129 memavail=1716352 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78723.0: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000287 mcu_task_stddev=0.000256 bytes_write=30160 bytes_read=18527 bytes_retransmit=0 bytes_invalid=0 send_seq=1251 receive_seq=1251 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998289  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=3520.210 memavail=1716100 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78724.0: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000287 mcu_task_stddev=0.000256 bytes_write=32077 bytes_read=19495 bytes_retransmit=0 bytes_invalid=0 send_seq=1329 receive_seq=1329 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998225  orange_pi: temp=42.4 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.15 cputime=3520.297 memavail=1715636 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78725.0: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=34018 bytes_read=20520 bytes_retransmit=0 bytes_invalid=0 send_seq=1409 receive_seq=1409 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998176  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=3520.384 memavail=1715884 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78726.0: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=35907 bytes_read=21464 bytes_retransmit=0 bytes_invalid=0 send_seq=1484 receive_seq=1484 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998150  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.15 cputime=3520.493 memavail=1715888 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78727.0: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=37676 bytes_read=22250 bytes_retransmit=0 bytes_invalid=0 send_seq=1548 receive_seq=1548 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998427  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=3520.572 memavail=1715888 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78728.0: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=39642 bytes_read=23292 bytes_retransmit=0 bytes_invalid=0 send_seq=1630 receive_seq=1630 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998355  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.15 cputime=3520.660 memavail=1715640 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78729.0: gcodein=0  mcu: mcu_awake=0.141 mcu_task_avg=0.000284 mcu_task_stddev=0.000257 bytes_write=41592 bytes_read=24324 bytes_retransmit=0 bytes_invalid=0 send_seq=1713 receive_seq=1713 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998393  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3520.748 memavail=1715392 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78730.0: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000290 mcu_task_stddev=0.000258 bytes_write=43573 bytes_read=25496 bytes_retransmit=0 bytes_invalid=0 send_seq=1806 receive_seq=1806 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998330  orange_pi: temp=42.2 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3520.842 memavail=1714900 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78731.0: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000290 mcu_task_stddev=0.000258 bytes_write=45429 bytes_read=26377 bytes_retransmit=0 bytes_invalid=0 send_seq=1875 receive_seq=1875 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998289  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3520.922 memavail=1714900 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78732.0: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000290 mcu_task_stddev=0.000258 bytes_write=47278 bytes_read=27193 bytes_retransmit=0 bytes_invalid=0 send_seq=1942 receive_seq=1942 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998458  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.13 cputime=3521.001 memavail=1714916 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78733.0: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000290 mcu_task_stddev=0.000258 bytes_write=49230 bytes_read=28231 bytes_retransmit=0 bytes_invalid=0 send_seq=2026 receive_seq=2026 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998394  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3521.088 memavail=1715172 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78734.0: gcodein=0  mcu: mcu_awake=0.144 mcu_task_avg=0.000290 mcu_task_stddev=0.000258 bytes_write=51089 bytes_read=29203 bytes_retransmit=0 bytes_invalid=0 send_seq=2102 receive_seq=2102 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998344  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.12 cputime=3521.175 memavail=1714668 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78735.0: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000273 mcu_task_stddev=0.000259 bytes_write=52956 bytes_read=30091 bytes_retransmit=0 bytes_invalid=0 send_seq=2172 receive_seq=2172 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998469  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.12 cputime=3521.257 memavail=1715192 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78736.0: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000273 mcu_task_stddev=0.000259 bytes_write=54831 bytes_read=30994 bytes_retransmit=0 bytes_invalid=0 send_seq=2245 receive_seq=2245 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998424  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=3521.343 memavail=1715216 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78737.0: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000273 mcu_task_stddev=0.000259 bytes_write=56723 bytes_read=32044 bytes_retransmit=0 bytes_invalid=0 send_seq=2327 receive_seq=2327 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998377  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=3521.431 memavail=1715216 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78738.0: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000273 mcu_task_stddev=0.000259 bytes_write=58649 bytes_read=33017 bytes_retransmit=0 bytes_invalid=0 send_seq=2404 receive_seq=2404 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998299  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=3521.517 memavail=1715992 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78739.0: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000273 mcu_task_stddev=0.000259 bytes_write=60501 bytes_read=33860 bytes_retransmit=0 bytes_invalid=0 send_seq=2474 receive_seq=2473 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998276  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3521.596 memavail=1716496 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78740.0: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=62286 bytes_read=34758 bytes_retransmit=0 bytes_invalid=0 send_seq=2542 receive_seq=2542 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998247  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.11 cputime=3521.678 memavail=1716756 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78741.0: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=64176 bytes_read=35650 bytes_retransmit=0 bytes_invalid=0 send_seq=2613 receive_seq=2613 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998222  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.11 cputime=3521.762 memavail=1716516 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78742.0: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=65988 bytes_read=36415 bytes_retransmit=0 bytes_invalid=0 send_seq=2676 receive_seq=2676 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998201  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3521.840 memavail=1716784 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78743.0: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=67706 bytes_read=37166 bytes_retransmit=0 bytes_invalid=0 send_seq=2735 receive_seq=2735 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998184  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=3521.918 memavail=1716540 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78744.0: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=69598 bytes_read=38034 bytes_retransmit=0 bytes_invalid=0 send_seq=2806 receive_seq=2806 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998171  orange_pi: temp=42.4 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3522.004 memavail=1716540 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78745.0: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000256 mcu_task_stddev=0.000263 bytes_write=71384 bytes_read=38751 bytes_retransmit=0 bytes_invalid=0 send_seq=2864 receive_seq=2864 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998158  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=3522.081 memavail=1716792 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78746.0: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000256 mcu_task_stddev=0.000263 bytes_write=73165 bytes_read=39598 bytes_retransmit=0 bytes_invalid=0 send_seq=2931 receive_seq=2931 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998148  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3522.162 memavail=1717572 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78747.0: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000256 mcu_task_stddev=0.000263 bytes_write=75125 bytes_read=40617 bytes_retransmit=0 bytes_invalid=0 send_seq=3014 receive_seq=3013 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998137  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3522.252 memavail=1717608 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78748.0: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000256 mcu_task_stddev=0.000263 bytes_write=77118 bytes_read=41689 bytes_retransmit=0 bytes_invalid=0 send_seq=3100 receive_seq=3099 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998130  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.10 cputime=3522.345 memavail=1717608 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78749.0: gcodein=0  mcu: mcu_awake=0.108 mcu_task_avg=0.000256 mcu_task_stddev=0.000263 bytes_write=79034 bytes_read=42783 bytes_retransmit=0 bytes_invalid=0 send_seq=3185 receive_seq=3185 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998125  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=3522.436 memavail=1717616 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78750.0: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000253 bytes_write=80934 bytes_read=43738 bytes_retransmit=0 bytes_invalid=0 send_seq=3262 receive_seq=3262 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998125  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=3522.520 memavail=1717900 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78751.0: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000253 bytes_write=82815 bytes_read=44576 bytes_retransmit=0 bytes_invalid=0 send_seq=3331 receive_seq=3330 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998118  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3522.602 memavail=1718168 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78752.0: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000253 bytes_write=84751 bytes_read=45592 bytes_retransmit=0 bytes_invalid=0 send_seq=3410 receive_seq=3410 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998118  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3522.691 memavail=1717672 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78753.0: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000253 bytes_write=86532 bytes_read=46445 bytes_retransmit=0 bytes_invalid=0 send_seq=3478 receive_seq=3478 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998117  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3522.774 memavail=1718416 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78754.0: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000283 mcu_task_stddev=0.000253 bytes_write=88386 bytes_read=47275 bytes_retransmit=0 bytes_invalid=0 send_seq=3546 receive_seq=3546 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998158  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3522.855 memavail=1717420 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78755.0: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=90385 bytes_read=48399 bytes_retransmit=0 bytes_invalid=0 send_seq=3634 receive_seq=3633 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998150  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3522.945 memavail=1718184 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78756.0: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=92385 bytes_read=49634 bytes_retransmit=0 bytes_invalid=0 send_seq=3731 receive_seq=3731 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998143  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3523.042 memavail=1718720 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78757.0: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=94321 bytes_read=50675 bytes_retransmit=0 bytes_invalid=0 send_seq=3814 receive_seq=3814 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998135  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3523.130 memavail=1718720 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78758.0: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=96118 bytes_read=51405 bytes_retransmit=0 bytes_invalid=0 send_seq=3872 receive_seq=3872 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998129  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.09 cputime=3523.207 memavail=1719244 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78759.0: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000276 mcu_task_stddev=0.000257 bytes_write=98023 bytes_read=52354 bytes_retransmit=0 bytes_invalid=0 send_seq=3949 receive_seq=3948 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998125  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3523.294 memavail=1720008 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78760.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000277 mcu_task_stddev=0.000253 bytes_write=99890 bytes_read=53336 bytes_retransmit=0 bytes_invalid=0 send_seq=4027 receive_seq=4027 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998186  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3523.380 memavail=1720296 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78761.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000277 mcu_task_stddev=0.000253 bytes_write=101848 bytes_read=54378 bytes_retransmit=0 bytes_invalid=0 send_seq=4109 receive_seq=4109 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998176  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=3523.468 memavail=1720044 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78762.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000277 mcu_task_stddev=0.000253 bytes_write=103792 bytes_read=55379 bytes_retransmit=0 bytes_invalid=0 send_seq=4190 receive_seq=4189 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998167  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3523.555 memavail=1719540 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.2 pwm=0.000
Stats 78763.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000277 mcu_task_stddev=0.000253 bytes_write=105659 bytes_read=56352 bytes_retransmit=0 bytes_invalid=0 send_seq=4268 receive_seq=4268 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998166  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3523.643 memavail=1718784 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78764.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000277 mcu_task_stddev=0.000253 bytes_write=107480 bytes_read=57184 bytes_retransmit=0 bytes_invalid=0 send_seq=4334 receive_seq=4334 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998160  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3523.727 memavail=1718280 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78765.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000254 bytes_write=109377 bytes_read=58099 bytes_retransmit=0 bytes_invalid=0 send_seq=4407 receive_seq=4407 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998159  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3523.812 memavail=1718028 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78766.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000254 bytes_write=111185 bytes_read=58927 bytes_retransmit=0 bytes_invalid=0 send_seq=4475 receive_seq=4475 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998154  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3523.894 memavail=1717776 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78767.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000254 bytes_write=113081 bytes_read=59894 bytes_retransmit=0 bytes_invalid=0 send_seq=4552 receive_seq=4552 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998148  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3523.980 memavail=1717792 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78768.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000254 bytes_write=115046 bytes_read=60900 bytes_retransmit=0 bytes_invalid=0 send_seq=4633 receive_seq=4633 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998143  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3524.066 memavail=1718324 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78769.0: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000254 bytes_write=116900 bytes_read=61722 bytes_retransmit=0 bytes_invalid=0 send_seq=4701 receive_seq=4701 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998139  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3524.149 memavail=1718072 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78770.0: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000279 mcu_task_stddev=0.000260 bytes_write=118732 bytes_read=62706 bytes_retransmit=0 bytes_invalid=0 send_seq=4776 receive_seq=4776 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998134  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3524.233 memavail=1718596 print_time=5.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 78815.0: gcodein=0  mcu: mcu_awake=0.152 mcu_task_avg=0.000290 mcu_task_stddev=0.000250 bytes_write=203545 bytes_read=105058 bytes_retransmit=0 bytes_invalid=0 send_seq=8144 receive_seq=8144 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998133  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.03 cputime=3528.041 memavail=1713736 print_time=110.700 buffer_time=0.322 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 281473445117136: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:27:20 2024 (1735576040.9 78816.5)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
neopixel = panel_ring (16-9)
	neopixel:panel_ring (1-8)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
Config error
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 130, in _connect
    self._read_config()
  File "/home/klipper/klipper/klippy/klippy.py", line 127, in _read_config
    pconfig.check_unused_options(config)
  File "/home/klipper/klipper/klippy/configfile.py", line 497, in check_unused_options
    self.validate.check_unused(config.fileconfig)
  File "/home/klipper/klipper/klippy/configfile.py", line 446, in check_unused
    raise error("Option '%s' is not valid in section '%s'"
configparser.Error: Option 'neopixel' is not valid in section 'led_effect rainbow'
webhooks client 281473465975760: New connection
webhooks client 281473465975760: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Unable to issue reset command on MCU 'mcu'
webhooks client 281473465975760: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:28:26 2024 (1735576107.0 78882.6)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (16-9)
	neopixel:panel_ring (1-8)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462750560: New connection
webhooks client 281473462750560: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 78886.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3274 bytes_read=6176 bytes_retransmit=9 bytes_invalid=0 send_seq=230 receive_seq=227 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1996 upcoming_bytes=177 freq=71985208  orange_pi: temp=43.5 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.12 cputime=3534.313 memavail=1717032 print_time=71.597 buffer_time=0.198 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462750560
webhooks: registering remote method 'reboot_machine' for connection id: 281473462750560
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462750560
webhooks: registering remote method 'start_job_queue' for connection id: 281473462750560
Stats 78887.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=7323 bytes_read=6909 bytes_retransmit=9 bytes_invalid=0 send_seq=323 receive_seq=322 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71992647  orange_pi: temp=43.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3534.421 memavail=1716368 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78888.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=9347 bytes_read=8060 bytes_retransmit=9 bytes_invalid=0 send_seq=414 receive_seq=413 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=5 upcoming_bytes=0 freq=71995210  orange_pi: temp=43.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3534.545 memavail=1716300 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78889.8: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=11277 bytes_read=9037 bytes_retransmit=9 bytes_invalid=0 send_seq=493 receive_seq=493 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71996539  orange_pi: temp=43.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3534.631 memavail=1716420 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78890.8: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000195 mcu_task_stddev=0.000280 bytes_write=13230 bytes_read=10152 bytes_retransmit=9 bytes_invalid=0 send_seq=581 receive_seq=581 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71996945  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3534.719 memavail=1716420 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78891.8: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000195 mcu_task_stddev=0.000280 bytes_write=15086 bytes_read=11043 bytes_retransmit=9 bytes_invalid=0 send_seq=652 receive_seq=652 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997136  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.11 cputime=3534.801 memavail=1716420 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78892.8: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000195 mcu_task_stddev=0.000280 bytes_write=16905 bytes_read=11859 bytes_retransmit=9 bytes_invalid=0 send_seq=719 receive_seq=719 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71997308  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=3534.884 memavail=1716420 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78893.8: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000195 mcu_task_stddev=0.000280 bytes_write=18852 bytes_read=12900 bytes_retransmit=9 bytes_invalid=0 send_seq=802 receive_seq=802 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997441  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=3534.971 memavail=1716420 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78894.8: gcodein=0  mcu: mcu_awake=0.149 mcu_task_avg=0.000195 mcu_task_stddev=0.000280 bytes_write=20854 bytes_read=14043 bytes_retransmit=9 bytes_invalid=0 send_seq=893 receive_seq=893 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998516  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.18 cputime=3535.060 memavail=1716424 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78895.8: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000255 bytes_write=22777 bytes_read=15035 bytes_retransmit=9 bytes_invalid=0 send_seq=971 receive_seq=971 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998285  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.18 cputime=3535.149 memavail=1716172 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78896.8: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000255 bytes_write=24591 bytes_read=15847 bytes_retransmit=9 bytes_invalid=0 send_seq=1038 receive_seq=1037 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=44 upcoming_bytes=0 freq=71998152  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=3535.229 memavail=1715164 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78897.8: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000255 bytes_write=26302 bytes_read=16512 bytes_retransmit=9 bytes_invalid=0 send_seq=1090 receive_seq=1090 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998052  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=3535.302 memavail=1715416 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78898.8: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000255 bytes_write=28334 bytes_read=17721 bytes_retransmit=9 bytes_invalid=0 send_seq=1186 receive_seq=1186 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71997993  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=3535.397 memavail=1715416 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78899.8: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000281 mcu_task_stddev=0.000255 bytes_write=30117 bytes_read=18473 bytes_retransmit=9 bytes_invalid=0 send_seq=1248 receive_seq=1248 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998445  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.16 cputime=3535.475 memavail=1715168 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78900.8: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000269 mcu_task_stddev=0.000258 bytes_write=31979 bytes_read=19410 bytes_retransmit=9 bytes_invalid=0 send_seq=1320 receive_seq=1320 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998315  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=3535.558 memavail=1714684 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78901.8: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000269 mcu_task_stddev=0.000258 bytes_write=33967 bytes_read=20554 bytes_retransmit=9 bytes_invalid=0 send_seq=1411 receive_seq=1411 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998241  orange_pi: temp=41.9 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=3535.650 memavail=1714456 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78902.8: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000269 mcu_task_stddev=0.000258 bytes_write=35940 bytes_read=21600 bytes_retransmit=9 bytes_invalid=0 send_seq=1495 receive_seq=1495 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998208  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=3535.764 memavail=1714204 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78903.8: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000269 mcu_task_stddev=0.000258 bytes_write=37756 bytes_read=22494 bytes_retransmit=9 bytes_invalid=0 send_seq=1565 receive_seq=1565 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998148  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.15 cputime=3535.846 memavail=1713700 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78904.8: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000269 mcu_task_stddev=0.000258 bytes_write=39564 bytes_read=23300 bytes_retransmit=9 bytes_invalid=0 send_seq=1630 receive_seq=1630 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998103  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.15 cputime=3535.928 memavail=1714524 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78905.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=41512 bytes_read=24282 bytes_retransmit=9 bytes_invalid=0 send_seq=1710 receive_seq=1709 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998078  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.15 cputime=3536.016 memavail=1714280 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78906.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=43396 bytes_read=25272 bytes_retransmit=9 bytes_invalid=0 send_seq=1787 receive_seq=1787 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=44 upcoming_bytes=0 freq=71998054  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=3536.102 memavail=1713788 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78907.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=45274 bytes_read=26216 bytes_retransmit=9 bytes_invalid=0 send_seq=1862 receive_seq=1862 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998038  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.15 cputime=3536.186 memavail=1713788 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78908.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=47099 bytes_read=27002 bytes_retransmit=9 bytes_invalid=0 send_seq=1926 receive_seq=1926 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998031  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.14 cputime=3536.267 memavail=1713788 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78909.8: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000280 mcu_task_stddev=0.000255 bytes_write=48963 bytes_read=27940 bytes_retransmit=9 bytes_invalid=0 send_seq=2000 receive_seq=2000 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998023  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.14 cputime=3536.352 memavail=1713540 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Neopixel update did not succeed
Stats 78910.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000274 mcu_task_stddev=0.000257 bytes_write=50849 bytes_read=28901 bytes_retransmit=9 bytes_invalid=0 send_seq=2075 receive_seq=2075 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998023  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.14 cputime=3536.440 memavail=1713812 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78911.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000274 mcu_task_stddev=0.000257 bytes_write=52736 bytes_read=29830 bytes_retransmit=9 bytes_invalid=0 send_seq=2150 receive_seq=2150 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998021  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.14 cputime=3536.525 memavail=1714324 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78912.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000274 mcu_task_stddev=0.000257 bytes_write=54676 bytes_read=30812 bytes_retransmit=9 bytes_invalid=0 send_seq=2229 receive_seq=2228 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998022  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.14 cputime=3536.612 memavail=1714084 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78913.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000274 mcu_task_stddev=0.000257 bytes_write=56551 bytes_read=31808 bytes_retransmit=9 bytes_invalid=0 send_seq=2307 receive_seq=2307 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998028  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3536.697 memavail=1713828 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78914.8: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000274 mcu_task_stddev=0.000257 bytes_write=58385 bytes_read=32649 bytes_retransmit=9 bytes_invalid=0 send_seq=2375 receive_seq=2375 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998029  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3536.781 memavail=1712856 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78915.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000282 mcu_task_stddev=0.000258 bytes_write=60359 bytes_read=33752 bytes_retransmit=9 bytes_invalid=0 send_seq=2461 receive_seq=2461 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998027  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.13 cputime=3536.870 memavail=1712500 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78916.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000282 mcu_task_stddev=0.000258 bytes_write=62220 bytes_read=34659 bytes_retransmit=9 bytes_invalid=0 send_seq=2535 receive_seq=2535 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998034  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.13 cputime=3536.951 memavail=1712900 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78917.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000282 mcu_task_stddev=0.000258 bytes_write=64169 bytes_read=35658 bytes_retransmit=9 bytes_invalid=0 send_seq=2616 receive_seq=2616 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998035  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3537.039 memavail=1712420 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78918.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000282 mcu_task_stddev=0.000258 bytes_write=66116 bytes_read=36726 bytes_retransmit=9 bytes_invalid=0 send_seq=2701 receive_seq=2700 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998034  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.12 cputime=3537.128 memavail=1712172 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78919.8: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000282 mcu_task_stddev=0.000258 bytes_write=68055 bytes_read=37672 bytes_retransmit=9 bytes_invalid=0 send_seq=2778 receive_seq=2777 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998035  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.12 cputime=3537.214 memavail=1712928 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78920.8: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000285 mcu_task_stddev=0.000258 bytes_write=69877 bytes_read=38587 bytes_retransmit=9 bytes_invalid=0 send_seq=2849 receive_seq=2849 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998035  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3537.298 memavail=1712684 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78921.8: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000285 mcu_task_stddev=0.000258 bytes_write=71711 bytes_read=39460 bytes_retransmit=9 bytes_invalid=0 send_seq=2918 receive_seq=2918 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998036  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3537.380 memavail=1713364 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78922.8: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000285 mcu_task_stddev=0.000258 bytes_write=73578 bytes_read=40331 bytes_retransmit=9 bytes_invalid=0 send_seq=2988 receive_seq=2988 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998036  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=3537.463 memavail=1713488 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78923.9: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000285 mcu_task_stddev=0.000258 bytes_write=75322 bytes_read=41060 bytes_retransmit=9 bytes_invalid=0 send_seq=3047 receive_seq=3047 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998040  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3537.539 memavail=1713488 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78924.9: gcodein=0  mcu: mcu_awake=0.142 mcu_task_avg=0.000285 mcu_task_stddev=0.000258 bytes_write=77219 bytes_read=42032 bytes_retransmit=9 bytes_invalid=0 send_seq=3123 receive_seq=3123 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998041  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3537.625 memavail=1713268 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78925.9: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000279 mcu_task_stddev=0.000260 bytes_write=79188 bytes_read=43141 bytes_retransmit=9 bytes_invalid=0 send_seq=3210 receive_seq=3210 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998043  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3537.717 memavail=1713268 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 78926.9: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000279 mcu_task_stddev=0.000260 bytes_write=80984 bytes_read=43961 bytes_retransmit=9 bytes_invalid=0 send_seq=3276 receive_seq=3276 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998047  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3537.797 memavail=1712776 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78927.9: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000279 mcu_task_stddev=0.000260 bytes_write=82856 bytes_read=44860 bytes_retransmit=9 bytes_invalid=0 send_seq=3347 receive_seq=3347 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998048  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3537.879 memavail=1712060 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78928.9: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000279 mcu_task_stddev=0.000260 bytes_write=84683 bytes_read=45705 bytes_retransmit=9 bytes_invalid=0 send_seq=3415 receive_seq=3415 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998049  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3537.962 memavail=1712320 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 78929.9: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000279 mcu_task_stddev=0.000260 bytes_write=86664 bytes_read=46842 bytes_retransmit=9 bytes_invalid=0 send_seq=3506 receive_seq=3506 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998055  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3538.056 memavail=1712068 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78930.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000278 mcu_task_stddev=0.000256 bytes_write=88591 bytes_read=47883 bytes_retransmit=9 bytes_invalid=0 send_seq=3586 receive_seq=3586 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998062  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3538.140 memavail=1711816 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78931.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000278 mcu_task_stddev=0.000256 bytes_write=90483 bytes_read=48845 bytes_retransmit=9 bytes_invalid=0 send_seq=3663 receive_seq=3663 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998066  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.10 cputime=3538.227 memavail=1711564 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78932.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000278 mcu_task_stddev=0.000256 bytes_write=92347 bytes_read=49709 bytes_retransmit=9 bytes_invalid=0 send_seq=3733 receive_seq=3733 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998069  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3538.309 memavail=1711564 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78933.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000278 mcu_task_stddev=0.000256 bytes_write=94138 bytes_read=50547 bytes_retransmit=9 bytes_invalid=0 send_seq=3799 receive_seq=3799 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998070  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.17 cputime=3538.391 memavail=1711824 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78934.9: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000278 mcu_task_stddev=0.000256 bytes_write=95997 bytes_read=51407 bytes_retransmit=9 bytes_invalid=0 send_seq=3869 receive_seq=3869 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998071  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.17 cputime=3538.477 memavail=1711844 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 78935.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000276 mcu_task_stddev=0.000263 bytes_write=97788 bytes_read=52166 bytes_retransmit=9 bytes_invalid=0 send_seq=3931 receive_seq=3931 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998073  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=3538.555 memavail=1712096 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78936.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000276 mcu_task_stddev=0.000263 bytes_write=99623 bytes_read=53082 bytes_retransmit=9 bytes_invalid=0 send_seq=4003 receive_seq=4003 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998075  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.17 cputime=3538.636 memavail=1711844 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78937.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000276 mcu_task_stddev=0.000263 bytes_write=101540 bytes_read=54039 bytes_retransmit=9 bytes_invalid=0 send_seq=4080 receive_seq=4080 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998076  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.17 cputime=3538.723 memavail=1711844 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78938.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000276 mcu_task_stddev=0.000263 bytes_write=103486 bytes_read=55090 bytes_retransmit=9 bytes_invalid=0 send_seq=4165 receive_seq=4165 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998077  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=3538.811 memavail=1712124 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78939.9: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000276 mcu_task_stddev=0.000263 bytes_write=105377 bytes_read=56033 bytes_retransmit=9 bytes_invalid=0 send_seq=4240 receive_seq=4240 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998078  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.16 cputime=3538.894 memavail=1711892 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78940.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000284 mcu_task_stddev=0.000260 bytes_write=107189 bytes_read=56856 bytes_retransmit=9 bytes_invalid=0 send_seq=4305 receive_seq=4305 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998079  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=3538.971 memavail=1712144 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78941.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000284 mcu_task_stddev=0.000260 bytes_write=109087 bytes_read=57790 bytes_retransmit=9 bytes_invalid=0 send_seq=4381 receive_seq=4381 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998080  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=3539.057 memavail=1713176 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78942.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000284 mcu_task_stddev=0.000260 bytes_write=110930 bytes_read=58624 bytes_retransmit=9 bytes_invalid=0 send_seq=4448 receive_seq=4447 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998083  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=3539.137 memavail=1713952 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78943.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000284 mcu_task_stddev=0.000260 bytes_write=112807 bytes_read=59620 bytes_retransmit=9 bytes_invalid=0 send_seq=4526 receive_seq=4526 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998084  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.14 cputime=3539.222 memavail=1714228 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78944.9: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000284 mcu_task_stddev=0.000260 bytes_write=114677 bytes_read=60489 bytes_retransmit=9 bytes_invalid=0 send_seq=4597 receive_seq=4597 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998088  orange_pi: temp=43.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.14 cputime=3539.308 memavail=1713228 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 78945.9: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000274 mcu_task_stddev=0.000263 bytes_write=116493 bytes_read=61348 bytes_retransmit=9 bytes_invalid=0 send_seq=4663 receive_seq=4663 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998091  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.14 cputime=3539.391 memavail=1713480 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 78946.9: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000274 mcu_task_stddev=0.000263 bytes_write=118409 bytes_read=62409 bytes_retransmit=9 bytes_invalid=0 send_seq=4747 receive_seq=4747 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998143  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.14 cputime=3539.477 memavail=1713484 print_time=71.597 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 79058.9: gcodein=0  mcu: mcu_awake=0.135 mcu_task_avg=0.000273 mcu_task_stddev=0.000254 bytes_write=329750 bytes_read=168791 bytes_retransmit=9 bytes_invalid=0 send_seq=13222 receive_seq=13222 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=44 upcoming_bytes=0 freq=71998178  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.14 cputime=3549.027 memavail=1718216 print_time=244.235 buffer_time=0.738 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 281473462750560: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:31:25 2024 (1735576285.2 79060.8)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (16-9)
	autostart:                          true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect rainbow-back]
leds = 
	neopixel:panel_ring (1-8)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473465792640: New connection
webhooks client 281473465792640: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Unhandled exception during ready callback
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 164, in _connect
    cb()
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 388, in _handle_ready
    chainName, ledIndices = self.handler.parse_chain(chain)
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 267, in parse_chain
    leds.append(int(i)-1)
ValueError: invalid literal for int() with base 10: 'true'
Transition to shutdown state: Internal error during ready callback: invalid literal for int() with base 10: 'true'
Dumping gcode input 0 blocks
Dumping 11 requests for client 281473465792640
Received 79063.668781: b'{"id":281472832316288,"method":"info","params":{"client_info":{"program":"Moonraker","version":"v0.9.3-4-ga4604e3"}}}'
Received 79063.668781: b'{"id":281472832314848,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 79063.668781: b'{"id":281472832317872,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 79063.697457: b'{"id":281472832320944,"method":"list_endpoints","params":{}}'
Received 79063.877448: b'{"id":281472832318352,"method":"info","params":{}}'
Received 79063.949901: b'{"id":281472832318544,"method":"info","params":{}}'
Received 79064.201704: b'{"id":281472836268528,"method":"info","params":{}}'
Received 79064.453875: b'{"id":281472836268528,"method":"info","params":{}}'
Received 79064.705918: b'{"id":281472836268528,"method":"info","params":{}}'
Received 79064.834879: b'{"id":281472832318352,"method":"info","params":{}}'
Received 79064.957671: b'{"id":281472832314800,"method":"info","params":{}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (79064.097674491, 0.0, 0.0)
Internal error during ready callback: invalid literal for int() with base 10: 'true'
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Printer is shutdown

Dumping stepper 'stepper_x' (mcu) 1 queue_step:
queue_step 0: t=376495946 p=0 i=0 c=0 a=0
Dumping stepper 'stepper_y' (mcu) 1 queue_step:
queue_step 0: t=377081279 p=0 i=0 c=0 a=0
Dumping stepper 'stepper_z' (mcu) 1 queue_step:
queue_step 0: t=377722650 p=0 i=0 c=0 a=0
Dumping stepper 'extruder' (mcu) 1 queue_step:
queue_step 0: t=378394234 p=0 i=0 c=0 a=0
MCU 'mcu' shutdown: Command request
clocksync state: mcu_freq=72000000 last_clock=342985213 clock_est=(79064.168 317911133 71993385.616) min_half_rtt=0.000222 min_rtt_time=79064.408 time_avg=79064.167(0.018) clock_avg=317911133.603(1275159.665) pred_variance=3821324223.965
Dumping serial stats: bytes_write=2843 bytes_read=6178 bytes_retransmit=0 bytes_invalid=0 send_seq=223 receive_seq=223 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8
Dumping send queue 100 messages
Sent 0 79064.538840 79064.532410 58: seq: 1b, query_analog_in oid=19 clock=445680000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=11782 max_value=32201 range_check_count=4, queue_digital_out oid=20 clock=357554405 on_ticks=0, queue_digital_out oid=21 clock=357558611 on_ticks=0, queue_digital_out oid=22 clock=357562633 on_ticks=0, queue_digital_out oid=23 clock=357576072 on_ticks=0
Sent 1 79064.540560 79064.535336 43: seq: 1c, queue_digital_out oid=5 clock=357582170 on_ticks=0, query_analog_in oid=27 clock=451440000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=855 max_value=32201 range_check_count=4, queue_digital_out oid=28 clock=357644493 on_ticks=0, get_config
Sent 2 79064.546140 79064.544340 45: seq: 1d, neopixel_update oid=0 pos=0 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_update oid=0 pos=16 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
Sent 3 79064.552765 79064.551685 27: seq: 1e, neopixel_update oid=0 pos=32 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_send oid=0
Sent 4 79064.560184 79064.559624 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 5 79064.566502 79064.565742 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03\x080\x80\x00\n\x08\xb8\x87' read=0
Sent 6 79064.570239 79064.569679 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 7 79064.576380 79064.575620 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03h0\x80\x00\x12\x08 \xda' read=0
Sent 8 79064.580079 79064.579519 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 9 79064.586463 79064.585703 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x03\x88=\x9a\x06\x02h*\xbf' read=0
Sent 10 79064.590234 79064.589674 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 11 79064.596383 79064.595623 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x03\x082\x80\x10\x92H\xa2\x83' read=0
Sent 12 79064.600095 79064.599535 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 13 79064.606227 79064.605467 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x03h2\x80\x00\x02\x08 \xfb' read=0
Sent 14 79064.609924 79064.609364 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 15 79064.616063 79064.615303 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x03\x882\x80\x00\x02\x08\xa0\xe6' read=0
Sent 16 79064.619765 79064.619205 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 17 79064.625886 79064.625126 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x03H8\x80\x00\x02\x08 \xde' read=0
Sent 18 79064.629578 79064.629018 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 19 79064.635704 79064.634944 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x03\x08>\xe4\x1ar\x88\xa4\x85' read=0
Sent 20 79064.639405 79064.638845 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 21 79064.645526 79064.644766 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03(2\x80\x00\x02\x88"\xf3' read=0
Sent 22 79064.649219 79064.648659 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 23 79064.655356 79064.654596 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03\x088\x80\x00\x02\x08 \xba' read=0
Sent 24 79064.659058 79064.658498 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 25 79064.665012 79064.664452 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 26 79064.671154 79064.670394 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x13\x080\x80\x00\n\x08\xb8\xbc' read=0
Sent 27 79064.674854 79064.674294 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 28 79064.680981 79064.680221 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x13h0\x80\x00\x12\x08 \xe1' read=0
Sent 29 79064.684680 79064.684120 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 30 79064.690856 79064.690096 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x13\x88=\x9a\x06\x02h*\x84' read=0
Sent 31 79064.694586 79064.694026 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 32 79064.700719 79064.699959 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x13\x082\x80\x10\x9ah"\xa7' read=0
Sent 33 79064.704421 79064.703861 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 34 79064.710976 79064.710216 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x13h2\x80\x00\x02\x08 \xc0' read=0
Sent 35 79064.714749 79064.714189 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 36 79064.720889 79064.720129 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x13\x882\x80\x00\x02\x08\xa0\xdd' read=0
Sent 37 79064.721920 79064.721320 15: seq: 10, queue_digital_out oid=18 clock=367378224 on_ticks=157680
Sent 38 79064.724585 79064.724025 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 39 79064.730746 79064.729986 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x13H8\x80\x00\x02\x08 \xe5' read=0
Sent 40 79064.734474 79064.733914 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 41 79064.740610 79064.739850 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x13\x08>\xe4\x1ar\x88\xa4\xbe' read=0
Sent 42 79064.744304 79064.743744 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 43 79064.750431 79064.749671 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x13(2\x80\x00\x02\x88"\xc8' read=0
Sent 44 79064.754270 79064.753710 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 45 79064.760402 79064.759642 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x13\x088\x80\x00\x02\x08 \x81' read=0
Sent 46 79064.764098 79064.763538 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 47 79064.770032 79064.769472 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 48 79064.776123 79064.775363 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0b\x080\x80\x00\n\x08\xb8\xf1' read=0
Sent 49 79064.779810 79064.779250 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 50 79064.785909 79064.785149 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0bh0\x80\x00\x12\x08 \xac' read=0
Sent 51 79064.789598 79064.789038 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 52 79064.795712 79064.794952 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x0b\x88=\x92\x06\x02h*\x91' read=0
Sent 53 79064.799406 79064.798846 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 54 79064.805512 79064.804752 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x0b\x082\x80\x10\x92H\xa2\xf5' read=0
Sent 55 79064.809201 79064.808641 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 56 79064.815323 79064.814563 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x0bh2\x80\x00\x02\x08 \x8d' read=0
Sent 57 79064.819042 79064.818482 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 58 79064.825158 79064.824398 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x0b\x882\x80\x00\x02\x08\xa0\x90' read=0
Sent 59 79064.828868 79064.828308 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 60 79064.835588 79064.834828 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x0bH8\x80\x00\x02\x08 \xa8' read=0
Sent 61 79064.839627 79064.839067 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 62 79064.845812 79064.845052 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x0b\x08>\xe4\x1ar\x88\xa4\xf3' read=0
Sent 63 79064.849523 79064.848963 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 64 79064.855662 79064.854902 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0b(2\x80\x00\x02\x88"\x85' read=0
Sent 65 79064.858946 79064.858426 13: seq: 1c, queue_digital_out oid=18 clock=374578224 on_ticks=0
Sent 66 79064.859506 79064.858822 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 67 79064.865612 79064.864852 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0b\x088\x80\x00\x02\x08 \xcc' read=0
Sent 68 79064.869303 79064.868743 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 69 79064.875286 79064.874726 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 70 79064.881397 79064.880637 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x1b\x080\x80\x00\n\x08\xb8\xca' read=0
Sent 71 79064.885093 79064.884533 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 72 79064.891327 79064.890567 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x1bh0\x80\x00\x12\x08 \x97' read=0
Sent 73 79064.895048 79064.894488 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 74 79064.901174 79064.900414 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x1b\x88=\x9a\x06\x02h*\xf2' read=0
Sent 75 79064.904899 79064.904339 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 76 79064.911051 79064.910291 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x1b\x082\x80\x10\xb2\xc8\xa2\xe9' read=0
Sent 77 79064.914751 79064.914191 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 78 79064.920852 79064.920092 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x1bh2\x80\x00\x02\x08 \xb6' read=0
Sent 79 79064.924547 79064.923987 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 80 79064.931246 79064.930486 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x1b\x882\x80\x00\x02\x08\xa0\xab' read=0
Sent 81 79064.935356 79064.934796 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 82 79064.941530 79064.940770 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x1bH8\x80\x00\x02\x08 \x93' read=0
Sent 83 79064.945227 79064.944667 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 84 79064.951377 79064.950617 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x1b\x08>\xe4\x1ar\x88\xa4\xc8' read=0
Sent 85 79064.955098 79064.954538 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 86 79064.959237 79064.958637 15: seq: 11, queue_digital_out oid=18 clock=381778223 on_ticks=106200
Sent 87 79064.961739 79064.960979 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x1b(2\x80\x00\x02\x88"\xbe' read=0
Sent 88 79064.965456 79064.964896 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 89 79064.971592 79064.970832 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x1b\x088\x80\x00\x02\x08 \xf7' read=0
Sent 90 79064.975292 79064.974732 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 91 79064.980982 79064.980702 7: seq: 16, stepper_get_position oid=6
Sent 92 79064.982931 79064.982371 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x03H-\xd5' read=10
Sent 93 79064.989030 79064.988750 7: seq: 18, stepper_get_position oid=9
Sent 94 79064.991486 79064.990926 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x13H\xad\xf8' read=10
Sent 95 79064.997935 79064.997655 7: seq: 1a, stepper_get_position oid=12
Sent 96 79065.000498 79064.999938 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0bH-\x8e' read=10
Sent 97 79065.007321 79065.007041 7: seq: 1c, stepper_get_position oid=13
Sent 98 79065.009362 79065.008802 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x1bH\xad\xa3' read=10
Sent 99 79065.034880 79065.034640 6: seq: 1e, emergency_stop
Dumping receive queue 100 messages
Receive: 0 79064.461564 79064.461091 11: seq: 16, clock clock=339051457
Receive: 1 79064.513288 79064.512844 11: seq: 17, clock clock=342776251
Receive: 2 79064.516617 79064.515490 10: seq: 18, config is_config=0 crc=0 is_shutdown=0 move_count=0
Receive: 3 79064.516583 79064.515730 11: seq: 19, clock clock=342985213
Receive: 4 79064.541054 79064.540560 15: seq: 1d, config is_config=1 crc=2417496047 is_shutdown=0 move_count=1024
Receive: 5 79064.553732 79064.552765 8: seq: 1f, neopixel_result oid=0 success=1
Receive: 6 79064.564254 79064.560184 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8+\xd2'
Receive: 7 79064.568954 79064.566502 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 8 79064.574271 79064.570239 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08,\xaf'
Receive: 9 79064.578827 79064.576380 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 10 79064.584116 79064.580079 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xac\xeb'
Receive: 11 79064.588923 79064.586463 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 12 79064.594264 79064.590234 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xac\xcc'
Receive: 13 79064.598832 79064.596383 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 14 79064.604127 79064.600095 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h,\x88'
Receive: 15 79064.608672 79064.606227 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 16 79064.613958 79064.609924 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88,\xdf'
Receive: 17 79064.618513 79064.616063 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 18 79064.623794 79064.619765 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xac\x9b'
Receive: 19 79064.628329 79064.625886 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 20 79064.633606 79064.629578 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xac\xbc'
Receive: 21 79064.638152 79064.635704 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 22 79064.643436 79064.639405 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8,\xf8'
Receive: 23 79064.647970 79064.645526 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 24 79064.653251 79064.649219 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08-\x97'
Receive: 25 79064.657805 79064.655356 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 26 79064.663089 79064.659058 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xad\xd3'
Receive: 27 79064.669077 79064.665012 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8+\xd2'
Receive: 28 79064.673603 79064.671154 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 29 79064.678886 79064.674854 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08,\xaf'
Receive: 30 79064.683429 79064.680981 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 31 79064.688709 79064.684680 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xac\xeb'
Receive: 32 79064.693299 79064.690856 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 33 79064.698619 79064.694586 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xac\xcc'
Receive: 34 79064.703165 79064.700719 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 35 79064.708513 79064.704421 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h,\x88'
Receive: 36 79064.713433 79064.710976 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 37 79064.718784 79064.714749 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88,\xdf'
Receive: 38 79064.723326 79064.721920 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 39 79064.728614 79064.724585 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xac\x9b'
Receive: 40 79064.733192 79064.730746 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 41 79064.738507 79064.734474 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xac\xbc'
Receive: 42 79064.743055 79064.740610 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 43 79064.748334 79064.744304 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8,\xf8'
Receive: 44 79064.752640 79064.750431 15: seq: 17, stats count=249 sum=550114 sumsq=19714484
Receive: 45 79064.752924 79064.750431 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 46 79064.758301 79064.754270 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08-\x97'
Receive: 47 79064.762852 79064.760402 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 48 79064.768127 79064.764098 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xad\xd3'
Receive: 49 79064.774058 79064.770032 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8+\xd2'
Receive: 50 79064.778567 79064.776123 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 51 79064.783838 79064.779810 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08,\xaf'
Receive: 52 79064.788354 79064.785909 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 53 79064.793627 79064.789598 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xac\xeb'
Receive: 54 79064.798160 79064.795712 8: seq: 10, tmcuart_response oid=3 read=b''
Receive: 55 79064.803437 79064.799406 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xac\xcc'
Receive: 56 79064.807953 79064.805512 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 57 79064.813236 79064.809201 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h,\x88'
Receive: 58 79064.817776 79064.815323 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 59 79064.823074 79064.819042 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88,\xdf'
Receive: 60 79064.827604 79064.825158 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 61 79064.832986 79064.828868 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xac\x9b'
Receive: 62 79064.838099 79064.835588 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 63 79064.843669 79064.839627 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xac\xbc'
Receive: 64 79064.848261 79064.845812 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 65 79064.853555 79064.849523 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8,\xf8'
Receive: 66 79064.858111 79064.855662 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 67 79064.863536 79064.859506 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08-\x97'
Receive: 68 79064.868055 79064.865612 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 69 79064.873342 79064.869303 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xad\xd3'
Receive: 70 79064.879323 79064.875286 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xa9\xfa'
Receive: 71 79064.883844 79064.881397 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 72 79064.889129 79064.885093 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h)\xbe'
Receive: 73 79064.893777 79064.891327 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 74 79064.899080 79064.895048 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88)\xe9'
Receive: 75 79064.903624 79064.901174 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 76 79064.908932 79064.904899 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xa9\xad'
Receive: 77 79064.913500 79064.911051 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 78 79064.918778 79064.914751 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xa9\x8a'
Receive: 79 79064.923299 79064.920852 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 80 79064.928676 79064.924547 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8)\xce'
Receive: 81 79064.933768 79064.931246 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 82 79064.939395 79064.935356 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08*\xbd'
Receive: 83 79064.943972 79064.941530 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 84 79064.949259 79064.945227 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xaa\xf9'
Receive: 85 79064.953823 79064.951377 8: seq: 10, tmcuart_response oid=3 read=b''
Receive: 86 79064.959364 79064.955098 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xaa\xde'
Receive: 87 79064.964190 79064.961739 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 88 79064.969488 79064.965456 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h*\x9a'
Receive: 89 79064.974041 79064.971592 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 90 79064.979334 79064.975292 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88*\xcd'
Receive: 91 79064.981435 79064.980982 8: seq: 17, stepper_position oid=6 pos=0
Receive: 92 79064.986969 79064.982931 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\n\x08\xad\xf0'
Receive: 93 79064.989565 79064.989030 8: seq: 19, stepper_position oid=9 pos=0
Receive: 94 79064.995608 79064.991486 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x1a\x08\xbd\xde'
Receive: 95 79064.998474 79064.997935 8: seq: 1b, stepper_position oid=12 pos=0
Receive: 96 79065.004616 79065.000498 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x02\x08\xa3\xbe'
Receive: 97 79065.007802 79065.007321 8: seq: 1d, stepper_position oid=13 pos=0
Receive: 98 79065.013395 79065.009362 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x12\x08\xb3\x90'
Receive: 99 79065.035413 79065.034880 12: seq: 1f, shutdown clock=380363371 static_string_id=Command request
Attempting MCU 'mcu' reset command
webhooks client 281473465792640: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:31:57 2024 (1735576317.5 79093.1)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (16-9)
	autostart:                          true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect rainbow-back]
leds = 
	neopixel:panel_ring (1-8)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473445076592: New connection
webhooks client 281473445076592: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Unhandled exception during ready callback
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 164, in _connect
    cb()
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 388, in _handle_ready
    chainName, ledIndices = self.handler.parse_chain(chain)
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 267, in parse_chain
    leds.append(int(i)-1)
ValueError: invalid literal for int() with base 10: 'true'
Transition to shutdown state: Internal error during ready callback: invalid literal for int() with base 10: 'true'
Dumping gcode input 0 blocks
Dumping 10 requests for client 281473445076592
Received 79095.920012: b'{"id":281472835865904,"method":"info","params":{"client_info":{"program":"Moonraker","version":"v0.9.3-4-ga4604e3"}}}'
Received 79095.920012: b'{"id":281472835868688,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 79095.920012: b'{"id":281472835864944,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 79095.948514: b'{"id":281472836264160,"method":"list_endpoints","params":{}}'
Received 79096.005835: b'{"id":281472836271360,"method":"info","params":{}}'
Received 79096.200704: b'{"id":281472836271360,"method":"info","params":{}}'
Received 79096.452962: b'{"id":281472836271360,"method":"info","params":{}}'
Received 79096.705064: b'{"id":281472836271360,"method":"info","params":{}}'
Received 79096.957058: b'{"id":281472835868688,"method":"info","params":{}}'
Received 79097.209395: b'{"id":281472832314992,"method":"info","params":{}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (79096.335695382, 0.0, 0.0)
Internal error during ready callback: invalid literal for int() with base 10: 'true'
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Printer is shutdown

Dumping stepper 'stepper_x' (mcu) 1 queue_step:
queue_step 0: t=375978117 p=0 i=0 c=0 a=0
Dumping stepper 'stepper_y' (mcu) 1 queue_step:
queue_step 0: t=376529464 p=0 i=0 c=0 a=0
Dumping stepper 'stepper_z' (mcu) 1 queue_step:
queue_step 0: t=377067719 p=0 i=0 c=0 a=0
Dumping stepper 'extruder' (mcu) 1 queue_step:
queue_step 0: t=377634650 p=0 i=0 c=0 a=0
MCU 'mcu' shutdown: Command request
clocksync state: mcu_freq=72000000 last_clock=342541207 clock_est=(79096.406 317496621 71995803.833) min_half_rtt=0.000220 min_rtt_time=79096.439 time_avg=79096.405(0.018) clock_avg=317496621.418(1272598.967) pred_variance=3821229798.949
Dumping serial stats: bytes_write=2843 bytes_read=6178 bytes_retransmit=0 bytes_invalid=0 send_seq=223 receive_seq=223 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8
Dumping send queue 100 messages
Sent 0 79096.776386 79096.770352 58: seq: 1b, query_analog_in oid=19 clock=445680000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=11782 max_value=32201 range_check_count=4, queue_digital_out oid=20 clock=357108685 on_ticks=0, queue_digital_out oid=21 clock=357112915 on_ticks=0, queue_digital_out oid=22 clock=357116920 on_ticks=0, queue_digital_out oid=23 clock=357130164 on_ticks=0
Sent 1 79096.778106 79096.773245 43: seq: 1c, queue_digital_out oid=5 clock=357136265 on_ticks=0, query_analog_in oid=27 clock=451440000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=855 max_value=32201 range_check_count=4, queue_digital_out oid=28 clock=357198434 on_ticks=0, get_config
Sent 2 79096.783704 79096.781904 45: seq: 1d, neopixel_update oid=0 pos=0 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_update oid=0 pos=16 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
Sent 3 79096.790311 79096.789231 27: seq: 1e, neopixel_update oid=0 pos=32 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_send oid=0
Sent 4 79096.797708 79096.797148 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 5 79096.804030 79096.803270 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03\x080\x80\x00\n\x08\xb8\x87' read=0
Sent 6 79096.807764 79096.807204 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 7 79096.813888 79096.813128 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03h0\x80\x00\x12\x08 \xda' read=0
Sent 8 79096.817568 79096.817008 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 9 79096.823674 79096.822914 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x03\x88=\x9a\x06\x02h*\xbf' read=0
Sent 10 79096.827364 79096.826804 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 11 79096.833474 79096.832714 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x03\x082\x80\x10\x92H\xa2\x83' read=0
Sent 12 79096.837154 79096.836594 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 13 79096.843270 79096.842510 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x03h2\x80\x00\x02\x08 \xfb' read=0
Sent 14 79096.846959 79096.846399 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 15 79096.853065 79096.852305 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x03\x882\x80\x00\x02\x08\xa0\xe6' read=0
Sent 16 79096.856755 79096.856195 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 17 79096.862964 79096.862204 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x03H8\x80\x00\x02\x08 \xde' read=0
Sent 18 79096.866676 79096.866116 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 19 79096.872804 79096.872044 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x03\x08>\xe4\x1ar\x88\xa4\x85' read=0
Sent 20 79096.876495 79096.875935 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 21 79096.882603 79096.881843 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03(2\x80\x00\x02\x88"\xf3' read=0
Sent 22 79096.886327 79096.885767 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 23 79096.892436 79096.891676 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03\x088\x80\x00\x02\x08 \xba' read=0
Sent 24 79096.896131 79096.895571 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 25 79096.902059 79096.901499 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 26 79096.908148 79096.907388 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x13\x080\x80\x00\n\x08\xb8\xbc' read=0
Sent 27 79096.911831 79096.911271 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 28 79096.917950 79096.917190 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x13h0\x80\x00\x12\x08 \xe1' read=0
Sent 29 79096.921624 79096.921064 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 30 79096.927723 79096.926963 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x13\x88=\x9a\x06\x02h*\x84' read=0
Sent 31 79096.931411 79096.930851 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 32 79096.937517 79096.936757 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x13\x082\x80\x10\x9ah"\xa7' read=0
Sent 33 79096.941197 79096.940637 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 34 79096.947306 79096.946546 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x13h2\x80\x00\x02\x08 \xc0' read=0
Sent 35 79096.950995 79096.950435 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 36 79096.957722 79096.956962 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x13\x882\x80\x00\x02\x08\xa0\xdd' read=0
Sent 37 79096.959937 79096.959337 15: seq: 10, queue_digital_out oid=18 clock=366935878 on_ticks=157680
Sent 38 79096.962353 79096.961793 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 39 79096.968607 79096.967847 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x13H8\x80\x00\x02\x08 \xe5' read=0
Sent 40 79096.972341 79096.971781 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 41 79096.978496 79096.977736 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x13\x08>\xe4\x1ar\x88\xa4\xbe' read=0
Sent 42 79096.982197 79096.981637 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 43 79096.988322 79096.987562 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x13(2\x80\x00\x02\x88"\xc8' read=0
Sent 44 79096.992027 79096.991467 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 45 79096.998874 79096.998114 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x13\x088\x80\x00\x02\x08 \x81' read=0
Sent 46 79097.002605 79097.002045 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 47 79097.008677 79097.008117 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 48 79097.014855 79097.014095 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0b\x080\x80\x00\n\x08\xb8\xf1' read=0
Sent 49 79097.018579 79097.018019 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 50 79097.024692 79097.023932 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0bh0\x80\x00\x12\x08 \xac' read=0
Sent 51 79097.028377 79097.027817 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 52 79097.034996 79097.034236 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x0b\x88=\x92\x06\x02h*\x91' read=0
Sent 53 79097.038873 79097.038313 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 54 79097.045008 79097.044248 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x0b\x082\x80\x10\x92H\xa2\xf5' read=0
Sent 55 79097.048700 79097.048140 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 56 79097.054833 79097.054073 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x0bh2\x80\x00\x02\x08 \x8d' read=0
Sent 57 79097.058552 79097.057992 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 58 79097.064711 79097.063951 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x0b\x882\x80\x00\x02\x08\xa0\x90' read=0
Sent 59 79097.068416 79097.067856 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 60 79097.074517 79097.073757 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x0bH8\x80\x00\x02\x08 \xa8' read=0
Sent 61 79097.078192 79097.077632 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 62 79097.084291 79097.083531 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x0b\x08>\xe4\x1ar\x88\xa4\xf3' read=0
Sent 63 79097.087984 79097.087424 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 64 79097.094090 79097.093330 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0b(2\x80\x00\x02\x88"\x85' read=0
Sent 65 79097.097123 79097.096603 13: seq: 1c, queue_digital_out oid=18 clock=374135878 on_ticks=0
Sent 66 79097.097769 79097.097209 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 67 79097.103872 79097.103112 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0b\x088\x80\x00\x02\x08 \xcc' read=0
Sent 68 79097.107558 79097.106998 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 69 79097.113483 79097.112923 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 70 79097.119573 79097.118813 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x1b\x080\x80\x00\n\x08\xb8\xca' read=0
Sent 71 79097.123261 79097.122701 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 72 79097.129393 79097.128633 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x1bh0\x80\x00\x12\x08 \x97' read=0
Sent 73 79097.133087 79097.132527 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 74 79097.139230 79097.138470 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x1b\x88=\x9a\x06\x02h*\xf2' read=0
Sent 75 79097.142927 79097.142367 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 76 79097.149029 79097.148269 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x1b\x082\x80\x10\xb2\xc8\xa2\xe9' read=0
Sent 77 79097.152726 79097.152166 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 78 79097.158867 79097.158107 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x1bh2\x80\x00\x02\x08 \xb6' read=0
Sent 79 79097.162581 79097.162021 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 80 79097.168700 79097.167940 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x1b\x882\x80\x00\x02\x08\xa0\xab' read=0
Sent 81 79097.172394 79097.171834 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 82 79097.178498 79097.177738 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x1bH8\x80\x00\x02\x08 \x93' read=0
Sent 83 79097.182172 79097.181612 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 84 79097.188275 79097.187515 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x1b\x08>\xe4\x1ar\x88\xa4\xc8' read=0
Sent 85 79097.191969 79097.191409 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 86 79097.197080 79097.196480 15: seq: 11, queue_digital_out oid=18 clock=381335878 on_ticks=106200
Sent 87 79097.198115 79097.197355 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x1b(2\x80\x00\x02\x88"\xbe' read=0
Sent 88 79097.201815 79097.201255 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 89 79097.207924 79097.207164 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x1b\x088\x80\x00\x02\x08 \xf7' read=0
Sent 90 79097.211924 79097.211364 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 91 79097.217481 79097.217201 7: seq: 16, stepper_get_position oid=6
Sent 92 79097.219330 79097.218770 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x03H-\xd5' read=10
Sent 93 79097.225097 79097.224817 7: seq: 18, stepper_get_position oid=9
Sent 94 79097.227029 79097.226469 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x13H\xad\xf8' read=10
Sent 95 79097.232615 79097.232335 7: seq: 1a, stepper_get_position oid=12
Sent 96 79097.234470 79097.233910 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0bH-\x8e' read=10
Sent 97 79097.240469 79097.240189 7: seq: 1c, stepper_get_position oid=13
Sent 98 79097.242477 79097.241917 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x1bH\xad\xa3' read=10
Sent 99 79097.267834 79097.267594 6: seq: 1e, emergency_stop
Dumping receive queue 100 messages
Receive: 0 79096.698854 79096.698413 11: seq: 16, clock clock=338590495
Receive: 1 79096.750762 79096.750292 11: seq: 17, clock clock=342327097
Receive: 2 79096.754157 79096.753032 10: seq: 18, config is_config=0 crc=0 is_shutdown=0 move_count=0
Receive: 3 79096.754123 79096.753272 11: seq: 19, clock clock=342541207
Receive: 4 79096.778601 79096.778106 15: seq: 1d, config is_config=1 crc=2417496047 is_shutdown=0 move_count=1024
Receive: 5 79096.791277 79096.790311 8: seq: 1f, neopixel_result oid=0 success=1
Receive: 6 79096.801784 79096.797708 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xad\xd3'
Receive: 7 79096.806490 79096.804030 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 8 79096.811799 79096.807764 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xad\xf4'
Receive: 9 79096.816330 79096.813888 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 10 79096.821597 79096.817568 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h-\xb0'
Receive: 11 79096.826125 79096.823674 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 12 79096.831396 79096.827364 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88-\xe7'
Receive: 13 79096.835919 79096.833474 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 14 79096.841190 79096.837154 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xad\xa3'
Receive: 15 79096.845722 79096.843270 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 16 79096.850992 79096.846959 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xad\x84'
Receive: 17 79096.855516 79096.853065 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 18 79096.860788 79096.856755 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8-\xc0'
Receive: 19 79096.865408 79096.862964 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 20 79096.870705 79096.866676 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08.\xb3'
Receive: 21 79096.875254 79096.872804 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 22 79096.880527 79096.876495 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xae\xf7'
Receive: 23 79096.885080 79096.882603 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 24 79096.890357 79096.886327 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xae\xd0'
Receive: 25 79096.894886 79096.892436 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 26 79096.900164 79096.896131 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h.\x94'
Receive: 27 79096.906093 79096.902059 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xad\xd3'
Receive: 28 79096.910596 79096.908148 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 29 79096.915866 79096.911831 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xad\xf4'
Receive: 30 79096.920392 79096.917950 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 31 79096.925651 79096.921624 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h-\xb0'
Receive: 32 79096.930173 79096.927723 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 33 79096.935440 79096.931411 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88-\xe7'
Receive: 34 79096.939962 79096.937517 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 35 79096.945227 79096.941197 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xad\xa3'
Receive: 36 79096.949756 79096.947306 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 37 79096.955108 79096.950995 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xad\x84'
Receive: 38 79096.960485 79096.959937 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 39 79096.966411 79096.962353 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8-\xc0'
Receive: 40 79096.971057 79096.968607 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 41 79096.976371 79096.972341 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08.\xb3'
Receive: 42 79096.980945 79096.978496 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 43 79096.986229 79096.982197 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xae\xf7'
Receive: 44 79096.990773 79096.988322 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 45 79096.996764 79096.992027 15: seq: 18, stats count=251 sum=553711 sumsq=19670880
Receive: 46 79096.996648 79096.992027 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xae\xd0'
Receive: 47 79097.001324 79096.998874 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 48 79097.006641 79097.002605 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h.\x94'
Receive: 49 79097.012733 79097.008677 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xad\xd3'
Receive: 50 79097.017299 79097.014855 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 51 79097.022612 79097.018579 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xad\xf4'
Receive: 52 79097.027140 79097.024692 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 53 79097.032480 79097.028377 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h-\xb0'
Receive: 54 79097.037459 79097.034996 8: seq: 10, tmcuart_response oid=3 read=b''
Receive: 55 79097.042914 79097.038873 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88-\xe7'
Receive: 56 79097.047457 79097.045008 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 57 79097.052731 79097.048700 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xad\xa3'
Receive: 58 79097.057277 79097.054833 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 59 79097.062583 79097.058552 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xad\x84'
Receive: 60 79097.067167 79097.064711 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 61 79097.072449 79097.068416 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8-\xc0'
Receive: 62 79097.076961 79097.074517 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 63 79097.082223 79097.078192 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08.\xb3'
Receive: 64 79097.086739 79097.084291 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 65 79097.092017 79097.087984 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xae\xf7'
Receive: 66 79097.096527 79097.094090 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 67 79097.101803 79097.097769 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xae\xd0'
Receive: 68 79097.106317 79097.103872 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 69 79097.111591 79097.107558 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h.\x94'
Receive: 70 79097.117519 79097.113483 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88*\xcd'
Receive: 71 79097.122020 79097.119573 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 72 79097.127292 79097.123261 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xaa\x89'
Receive: 73 79097.131840 79097.129393 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 74 79097.137118 79097.133087 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xaa\xae'
Receive: 75 79097.141680 79097.139230 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 76 79097.146960 79097.142927 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8*\xea'
Receive: 77 79097.151480 79097.149029 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 78 79097.156758 79097.152726 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08+\x85'
Receive: 79 79097.161311 79097.158867 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 80 79097.166609 79097.162581 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xab\xc1'
Receive: 81 79097.171153 79097.168700 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 82 79097.176427 79097.172394 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xab\xe6'
Receive: 83 79097.180939 79097.178498 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 84 79097.186201 79097.182172 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h+\xa2'
Receive: 85 79097.190725 79097.188275 8: seq: 10, tmcuart_response oid=3 read=b''
Receive: 86 79097.195979 79097.191969 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88+\xf5'
Receive: 87 79097.200567 79097.198115 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 88 79097.205841 79097.201815 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xab\xb1'
Receive: 89 79097.210415 79097.207924 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 90 79097.215970 79097.211924 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xab\x96'
Receive: 91 79097.217925 79097.217481 8: seq: 17, stepper_position oid=6 pos=0
Receive: 92 79097.223369 79097.219330 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\n\x081\xfa'
Receive: 93 79097.225583 79097.225097 8: seq: 19, stepper_position oid=9 pos=0
Receive: 94 79097.231069 79097.227029 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x02\x08\xa1\xa2'
Receive: 95 79097.233059 79097.232615 8: seq: 1b, stepper_position oid=12 pos=0
Receive: 96 79097.238500 79097.234470 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x02\x08\xa7\xb0'
Receive: 97 79097.240933 79097.240469 8: seq: 1d, stepper_position oid=13 pos=0
Receive: 98 79097.246516 79097.242477 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x12\x08/\x9a'
Receive: 99 79097.268370 79097.267834 12: seq: 1f, shutdown clock=379589119 static_string_id=Command request
Attempting MCU 'mcu' reset command
webhooks client 281473445076592: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:33:49 2024 (1735576429.0 79204.6)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (16-9)
	autostart:                          true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect rainbow-back]
leds = 
	neopixel:panel_ring (1-8)
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473465818640: New connection
webhooks client 281473465818640: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Unhandled exception during ready callback
Traceback (most recent call last):
  File "/home/klipper/klipper/klippy/klippy.py", line 164, in _connect
    cb()
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 388, in _handle_ready
    chainName, ledIndices = self.handler.parse_chain(chain)
  File "/home/klipper/klipper/klippy/extras/led_effect.py", line 267, in parse_chain
    leds.append(int(i)-1)
ValueError: invalid literal for int() with base 10: 'true'
Transition to shutdown state: Internal error during ready callback: invalid literal for int() with base 10: 'true'
Dumping gcode input 0 blocks
Dumping 11 requests for client 281473465818640
Received 79207.460168: b'{"id":281472832321808,"method":"info","params":{"client_info":{"program":"Moonraker","version":"v0.9.3-4-ga4604e3"}}}'
Received 79207.460168: b'{"id":281472836479648,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 79207.460168: b'{"id":281472836480800,"method":"objects/query","params":{"objects":{"gcode":["commands"]}}}'
Received 79207.488707: b'{"id":281472832321808,"method":"list_endpoints","params":{}}'
Received 79207.558244: b'{"id":281472836480896,"method":"info","params":{}}'
Received 79207.741745: b'{"id":281472836264160,"method":"info","params":{}}'
Received 79207.993777: b'{"id":281472836264160,"method":"info","params":{}}'
Received 79208.245261: b'{"id":281472832315280,"method":"info","params":{}}'
Received 79208.497311: b'{"id":281472832315280,"method":"info","params":{}}'
Received 79208.749400: b'{"id":281472832315280,"method":"info","params":{}}'
Received 79208.782449: b'{"id":281472836479648,"method":"info","params":{}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (79207.878741768, 0.0, 0.0)
Internal error during ready callback: invalid literal for int() with base 10: 'true'
Once the underlying issue is corrected, use the
"FIRMWARE_RESTART" command to reset the firmware, reload the
config, and restart the host software.
Printer is shutdown

Dumping stepper 'stepper_x' (mcu) 1 queue_step:
queue_step 0: t=375946526 p=0 i=0 c=0 a=0
Dumping stepper 'stepper_y' (mcu) 1 queue_step:
queue_step 0: t=376495556 p=0 i=0 c=0 a=0
Dumping stepper 'stepper_z' (mcu) 1 queue_step:
queue_step 0: t=377031120 p=0 i=0 c=0 a=0
Dumping stepper 'extruder' (mcu) 1 queue_step:
queue_step 0: t=377624185 p=0 i=0 c=0 a=0
MCU 'mcu' shutdown: Command request
clocksync state: mcu_freq=72000000 last_clock=342408205 clock_est=(79207.949 317301195 71995301.738) min_half_rtt=0.000223 min_rtt_time=79208.191 time_avg=79207.949(0.018) clock_avg=317301195.471(1279728.102) pred_variance=3821058250.219
Dumping serial stats: bytes_write=2843 bytes_read=6178 bytes_retransmit=0 bytes_invalid=0 send_seq=223 receive_seq=223 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8
Dumping send queue 100 messages
Sent 0 79208.320556 79208.314527 58: seq: 1b, query_analog_in oid=19 clock=445680000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=11782 max_value=32201 range_check_count=4, queue_digital_out oid=20 clock=356977466 on_ticks=0, queue_digital_out oid=21 clock=356981627 on_ticks=0, queue_digital_out oid=22 clock=356985673 on_ticks=0, queue_digital_out oid=23 clock=356999022 on_ticks=0
Sent 1 79208.322276 79208.317420 43: seq: 1c, queue_digital_out oid=5 clock=357005139 on_ticks=0, query_analog_in oid=27 clock=451440000 sample_ticks=72000 sample_count=8 rest_ticks=21600000 min_value=855 max_value=32201 range_check_count=4, queue_digital_out oid=28 clock=357067187 on_ticks=0, get_config
Sent 2 79208.327849 79208.326049 45: seq: 1d, neopixel_update oid=0 pos=0 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_update oid=0 pos=16 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
Sent 3 79208.334462 79208.333382 27: seq: 1e, neopixel_update oid=0 pos=32 data=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', neopixel_send oid=0
Sent 4 79208.341922 79208.341362 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 5 79208.348248 79208.347488 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03\x080\x80\x00\n\x08\xb8\x87' read=0
Sent 6 79208.351985 79208.351425 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 7 79208.358126 79208.357366 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03h0\x80\x00\x12\x08 \xda' read=0
Sent 8 79208.361820 79208.361260 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 9 79208.367948 79208.367188 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x03\x88=\x9a\x06\x02h*\xbf' read=0
Sent 10 79208.371651 79208.371091 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 11 79208.377781 79208.377021 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x03\x082\x80\x10\x92H\xa2\x83' read=0
Sent 12 79208.381478 79208.380918 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 13 79208.387607 79208.386847 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x03h2\x80\x00\x02\x08 \xfb' read=0
Sent 14 79208.391311 79208.390751 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 15 79208.397432 79208.396672 19: seq: 1a, tmcuart_send oid=3 write=b'\xea\x03\x882\x80\x00\x02\x08\xa0\xe6' read=0
Sent 16 79208.401135 79208.400575 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 17 79208.407312 79208.406552 19: seq: 1c, tmcuart_send oid=3 write=b'\xea\x03H8\x80\x00\x02\x08 \xde' read=0
Sent 18 79208.411053 79208.410493 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 19 79208.417186 79208.416426 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x03\x08>\xe4\x1ar\x88\xa4\x85' read=0
Sent 20 79208.420888 79208.420328 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 21 79208.427047 79208.426287 19: seq: 10, tmcuart_send oid=3 write=b'\xea\x03(2\x80\x00\x02\x88"\xf3' read=0
Sent 22 79208.430772 79208.430212 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 23 79208.436911 79208.436151 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x03\x088\x80\x00\x02\x08 \xba' read=0
Sent 24 79208.440619 79208.440059 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x03H \xe4' read=10
Sent 25 79208.446566 79208.446006 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 26 79208.452673 79208.451913 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x13\x080\x80\x00\n\x08\xb8\xbc' read=0
Sent 27 79208.456380 79208.455820 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 28 79208.462510 79208.461750 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x13h0\x80\x00\x12\x08 \xe1' read=0
Sent 29 79208.466203 79208.465643 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 30 79208.472334 79208.471574 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x13\x88=\x9a\x06\x02h*\x84' read=0
Sent 31 79208.476034 79208.475474 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 32 79208.482159 79208.481399 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x13\x082\x80\x10\x9ah"\xa7' read=0
Sent 33 79208.485852 79208.485292 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 34 79208.491982 79208.491222 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x13h2\x80\x00\x02\x08 \xc0' read=0
Sent 35 79208.495682 79208.495122 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 36 79208.502193 79208.501433 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x13\x882\x80\x00\x02\x08\xa0\xdd' read=0
Sent 37 79208.504333 79208.503733 15: seq: 10, queue_digital_out oid=18 clock=366804667 on_ticks=157680
Sent 38 79208.506061 79208.505501 14: seq: 11, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 39 79208.512199 79208.511439 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x13H8\x80\x00\x02\x08 \xe5' read=0
Sent 40 79208.515902 79208.515342 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 41 79208.522039 79208.521279 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x13\x08>\xe4\x1ar\x88\xa4\xbe' read=0
Sent 42 79208.525734 79208.525174 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 43 79208.531874 79208.531114 19: seq: 16, tmcuart_send oid=3 write=b'\xea\x13(2\x80\x00\x02\x88"\xc8' read=0
Sent 44 79208.535589 79208.535029 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 45 79208.541722 79208.540962 19: seq: 18, tmcuart_send oid=3 write=b'\xea\x13\x088\x80\x00\x02\x08 \x81' read=0
Sent 46 79208.545417 79208.544857 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x13H\xa0\xc9' read=10
Sent 47 79208.552076 79208.551516 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 48 79208.559143 79208.558383 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0b\x080\x80\x00\n\x08\xb8\xf1' read=0
Sent 49 79208.563746 79208.563186 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 50 79208.570380 79208.569620 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0bh0\x80\x00\x12\x08 \xac' read=0
Sent 51 79208.574114 79208.573554 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 52 79208.580304 79208.579544 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x0b\x88=\x92\x06\x02h*\x91' read=0
Sent 53 79208.584018 79208.583458 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 54 79208.590159 79208.589399 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x0b\x082\x80\x10\x92H\xa2\xf5' read=0
Sent 55 79208.593876 79208.593316 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 56 79208.600013 79208.599253 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x0bh2\x80\x00\x02\x08 \x8d' read=0
Sent 57 79208.603712 79208.603152 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 58 79208.609841 79208.609081 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x0b\x882\x80\x00\x02\x08\xa0\x90' read=0
Sent 59 79208.613545 79208.612985 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 60 79208.619699 79208.618939 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x0bH8\x80\x00\x02\x08 \xa8' read=0
Sent 61 79208.623421 79208.622861 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 62 79208.629552 79208.628792 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x0b\x08>\xe4\x1ar\x88\xa4\xf3' read=0
Sent 63 79208.633280 79208.632720 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 64 79208.639438 79208.638678 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0b(2\x80\x00\x02\x88"\x85' read=0
Sent 65 79208.640396 79208.639876 13: seq: 1c, queue_digital_out oid=18 clock=374004667 on_ticks=0
Sent 66 79208.643135 79208.642575 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 67 79208.649719 79208.648959 19: seq: 1e, tmcuart_send oid=3 write=b'\xea\x0b\x088\x80\x00\x02\x08 \xcc' read=0
Sent 68 79208.653440 79208.652880 14: seq: 1f, tmcuart_send oid=3 write=b'\xea\x0bH \xbf' read=10
Sent 69 79208.659371 79208.658811 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 70 79208.665455 79208.664695 19: seq: 11, tmcuart_send oid=3 write=b'\xea\x1b\x080\x80\x00\n\x08\xb8\xca' read=0
Sent 71 79208.669133 79208.668573 14: seq: 12, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 72 79208.675258 79208.674498 19: seq: 13, tmcuart_send oid=3 write=b'\xea\x1bh0\x80\x00\x12\x08 \x97' read=0
Sent 73 79208.678972 79208.678412 14: seq: 14, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 74 79208.685065 79208.684305 19: seq: 15, tmcuart_send oid=3 write=b'\xea\x1b\x88=\x9a\x06\x02h*\xf2' read=0
Sent 75 79208.688746 79208.688186 14: seq: 16, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 76 79208.694838 79208.694078 19: seq: 17, tmcuart_send oid=3 write=b'\xea\x1b\x082\x80\x10\xb2\xc8\xa2\xe9' read=0
Sent 77 79208.698507 79208.697947 14: seq: 18, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 78 79208.704597 79208.703837 19: seq: 19, tmcuart_send oid=3 write=b'\xea\x1bh2\x80\x00\x02\x08 \xb6' read=0
Sent 79 79208.708267 79208.707707 14: seq: 1a, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 80 79208.714347 79208.713587 19: seq: 1b, tmcuart_send oid=3 write=b'\xea\x1b\x882\x80\x00\x02\x08\xa0\xab' read=0
Sent 81 79208.718013 79208.717453 14: seq: 1c, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 82 79208.724099 79208.723339 19: seq: 1d, tmcuart_send oid=3 write=b'\xea\x1bH8\x80\x00\x02\x08 \x93' read=0
Sent 83 79208.727786 79208.727226 14: seq: 1e, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 84 79208.733875 79208.733115 19: seq: 1f, tmcuart_send oid=3 write=b'\xea\x1b\x08>\xe4\x1ar\x88\xa4\xc8' read=0
Sent 85 79208.737562 79208.737002 14: seq: 10, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 86 79208.740663 79208.740063 15: seq: 11, queue_digital_out oid=18 clock=381204666 on_ticks=106200
Sent 87 79208.743710 79208.742950 19: seq: 12, tmcuart_send oid=3 write=b'\xea\x1b(2\x80\x00\x02\x88"\xbe' read=0
Sent 88 79208.747394 79208.746834 14: seq: 13, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 89 79208.753819 79208.753059 19: seq: 14, tmcuart_send oid=3 write=b'\xea\x1b\x088\x80\x00\x02\x08 \xf7' read=0
Sent 90 79208.757522 79208.756962 14: seq: 15, tmcuart_send oid=3 write=b'\xea\x1bH\xa0\x92' read=10
Sent 91 79208.763031 79208.762751 7: seq: 16, stepper_get_position oid=6
Sent 92 79208.764855 79208.764295 14: seq: 17, tmcuart_send oid=3 write=b'\xea\x03H-\xd5' read=10
Sent 93 79208.770648 79208.770368 7: seq: 18, stepper_get_position oid=9
Sent 94 79208.772524 79208.771964 14: seq: 19, tmcuart_send oid=3 write=b'\xea\x13H\xad\xf8' read=10
Sent 95 79208.778095 79208.777815 7: seq: 1a, stepper_get_position oid=12
Sent 96 79208.779904 79208.779344 14: seq: 1b, tmcuart_send oid=3 write=b'\xea\x0bH-\x8e' read=10
Sent 97 79208.786284 79208.786004 7: seq: 1c, stepper_get_position oid=13
Sent 98 79208.788313 79208.787753 14: seq: 1d, tmcuart_send oid=3 write=b'\xea\x1bH\xad\xa3' read=10
Sent 99 79208.813596 79208.813356 6: seq: 1e, emergency_stop
Dumping receive queue 100 messages
Receive: 0 79208.242826 79208.242356 11: seq: 16, clock clock=338445487
Receive: 1 79208.294972 79208.294494 11: seq: 17, clock clock=342199405
Receive: 2 79208.298255 79208.297119 10: seq: 18, config is_config=0 crc=0 is_shutdown=0 move_count=0
Receive: 3 79208.298221 79208.297414 11: seq: 19, clock clock=342408205
Receive: 4 79208.322777 79208.322276 15: seq: 1d, config is_config=1 crc=2417496047 is_shutdown=0 move_count=1024
Receive: 5 79208.335428 79208.334462 8: seq: 1f, neopixel_result oid=0 success=1
Receive: 6 79208.345999 79208.341922 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h.\x94'
Receive: 7 79208.350705 79208.348248 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 8 79208.356017 79208.351985 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88.\xc3'
Receive: 9 79208.360570 79208.358126 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 10 79208.365852 79208.361820 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xae\x87'
Receive: 11 79208.370399 79208.367948 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 12 79208.375683 79208.371651 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xae\xa0'
Receive: 13 79208.380226 79208.377781 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 14 79208.385512 79208.381478 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8.\xe4'
Receive: 15 79208.390051 79208.387607 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 16 79208.395342 79208.391311 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08/\x8b'
Receive: 17 79208.399884 79208.397432 8: seq: 1b, tmcuart_response oid=3 read=b''
Receive: 18 79208.405166 79208.401135 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xaf\xcf'
Receive: 19 79208.409759 79208.407312 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 20 79208.415088 79208.411053 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xaf\xe8'
Receive: 21 79208.419636 79208.417186 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 22 79208.424923 79208.420888 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h/\xac'
Receive: 23 79208.429491 79208.427047 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 24 79208.434808 79208.430772 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88/\xfb'
Receive: 25 79208.439361 79208.436911 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 26 79208.444653 79208.440619 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xaf\xbf'
Receive: 27 79208.450600 79208.446566 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h.\x94'
Receive: 28 79208.455121 79208.452673 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 29 79208.460412 79208.456380 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88.\xc3'
Receive: 30 79208.464956 79208.462510 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 31 79208.470234 79208.466203 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xae\x87'
Receive: 32 79208.474783 79208.472334 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 33 79208.480068 79208.476034 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xae\xa0'
Receive: 34 79208.484604 79208.482159 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 35 79208.489879 79208.485852 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8.\xe4'
Receive: 36 79208.494429 79208.491982 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 37 79208.499762 79208.495682 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08/\x8b'
Receive: 38 79208.504768 79208.504333 8: seq: 11, tmcuart_response oid=3 read=b''
Receive: 39 79208.510091 79208.506061 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xaf\xcf'
Receive: 40 79208.514650 79208.512199 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 41 79208.519933 79208.515902 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xaf\xe8'
Receive: 42 79208.524485 79208.522039 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 43 79208.529766 79208.525734 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h/\xac'
Receive: 44 79208.534327 79208.531874 8: seq: 17, tmcuart_response oid=3 read=b''
Receive: 45 79208.539623 79208.535589 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88/\xfb'
Receive: 46 79208.542187 79208.541722 15: seq: 19, stats count=253 sum=557276 sumsq=19668605
Receive: 47 79208.544173 79208.541722 8: seq: 19, tmcuart_response oid=3 read=b''
Receive: 48 79208.549536 79208.545417 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xaf\xbf'
Receive: 49 79208.556201 79208.552076 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h.\x94'
Receive: 50 79208.561684 79208.559143 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 51 79208.567868 79208.563746 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88.\xc3'
Receive: 52 79208.572835 79208.570380 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 53 79208.578150 79208.574114 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xae\x87'
Receive: 54 79208.582752 79208.580304 8: seq: 10, tmcuart_response oid=3 read=b''
Receive: 55 79208.588046 79208.584018 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xae\xa0'
Receive: 56 79208.592603 79208.590159 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 57 79208.597905 79208.593876 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8.\xe4'
Receive: 58 79208.602458 79208.600013 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 59 79208.607742 79208.603712 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08/\x8b'
Receive: 60 79208.612286 79208.609841 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 61 79208.617576 79208.613545 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xaf\xcf'
Receive: 62 79208.622149 79208.619699 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 63 79208.627452 79208.623421 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xaf\xe8'
Receive: 64 79208.632005 79208.629552 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 65 79208.637318 79208.633280 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h/\xac'
Receive: 66 79208.641883 79208.640396 8: seq: 1d, tmcuart_response oid=3 read=b''
Receive: 67 79208.647236 79208.643135 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88/\xfb'
Receive: 68 79208.652176 79208.649719 8: seq: 1f, tmcuart_response oid=3 read=b''
Receive: 69 79208.657471 79208.653440 18: seq: 10, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xaf\xbf'
Receive: 70 79208.663407 79208.659371 18: seq: 11, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xab\x96'
Receive: 71 79208.667904 79208.665455 8: seq: 12, tmcuart_response oid=3 read=b''
Receive: 72 79208.673164 79208.669133 18: seq: 13, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8+\xd2'
Receive: 73 79208.677702 79208.675258 8: seq: 14, tmcuart_response oid=3 read=b''
Receive: 74 79208.683003 79208.678972 18: seq: 15, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08,\xaf'
Receive: 75 79208.687510 79208.685065 8: seq: 16, tmcuart_response oid=3 read=b''
Receive: 76 79208.692775 79208.688746 18: seq: 17, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02(\xac\xeb'
Receive: 77 79208.697279 79208.694838 8: seq: 18, tmcuart_response oid=3 read=b''
Receive: 78 79208.702534 79208.698507 18: seq: 19, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02H\xac\xcc'
Receive: 79 79208.707039 79208.704597 8: seq: 1a, tmcuart_response oid=3 read=b''
Receive: 80 79208.712296 79208.708267 18: seq: 1b, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02h,\x88'
Receive: 81 79208.716787 79208.714347 8: seq: 1c, tmcuart_response oid=3 read=b''
Receive: 82 79208.722043 79208.718013 18: seq: 1d, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x88,\xdf'
Receive: 83 79208.726545 79208.724099 8: seq: 1e, tmcuart_response oid=3 read=b''
Receive: 84 79208.731816 79208.727786 18: seq: 1f, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xa8\xac\x9b'
Receive: 85 79208.736317 79208.733875 8: seq: 10, tmcuart_response oid=3 read=b''
Receive: 86 79208.741585 79208.740663 18: seq: 12, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xc8\xac\xbc'
Receive: 87 79208.746156 79208.743710 8: seq: 13, tmcuart_response oid=3 read=b''
Receive: 88 79208.751469 79208.747394 18: seq: 14, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\xe8,\xf8'
Receive: 89 79208.756269 79208.753819 8: seq: 15, tmcuart_response oid=3 read=b''
Receive: 90 79208.761553 79208.757522 18: seq: 16, tmcuart_response oid=3 read=b'\n\xfaO \x80\x00\x02\x08-\x97'
Receive: 91 79208.763469 79208.763031 8: seq: 17, stepper_position oid=6 pos=0
Receive: 92 79208.768888 79208.764855 18: seq: 18, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\n\x085\xf4'
Receive: 93 79208.771095 79208.770648 8: seq: 19, stepper_position oid=9 pos=0
Receive: 94 79208.776561 79208.772524 18: seq: 1a, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x02\x08\xa5\xac'
Receive: 95 79208.778533 79208.778095 8: seq: 1b, stepper_position oid=12 pos=0
Receive: 96 79208.783992 79208.779904 18: seq: 1c, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x02\x08\xab\xb9'
Receive: 97 79208.786771 79208.786284 8: seq: 1d, stepper_position oid=13 pos=0
Receive: 98 79208.792353 79208.788313 18: seq: 1e, tmcuart_response oid=3 read=b'\n\xfaO-\x80\x00\x12\x08+\x94'
Receive: 99 79208.814148 79208.813596 12: seq: 1f, shutdown clock=379574071 static_string_id=Command request
Attempting MCU 'mcu' reset command
webhooks client 281473465818640: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:35:50 2024 (1735576550.9 79326.5)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring (1)
layers = 
	breathing  3 1 top (1,0,0)

[led_effect sb_logo_cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect sb_logo_calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect sb_logo_heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect sb_logo_cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect sb_logo_homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect sb_logo_leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect sb_logo_meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect sb_logo_printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect sb_logo_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect sb_logo_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect sb_nozzle_heating]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (1.0, 0.18, 0.0, 0.0)

[led_effect sb_nozzle_cooling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.0, 0.0, 1.0, 0.1)

[led_effect sb_nozzle_standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 0.0, 0.0, 0.0)

[led_effect sb_nozzle_part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (2,3)
layers = 
	breathing  3 1 top (0.6, 1.0, 0.0, 0.1)

[led_effect sb_critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (16-9)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect rainbow-back]
leds = 
	neopixel:panel_ring (1-8)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473462194608: New connection
webhooks client 281473462194608: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 79330.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=3279 bytes_read=6196 bytes_retransmit=0 bytes_invalid=0 send_seq=231 receive_seq=228 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1924 upcoming_bytes=249 freq=71994229  orange_pi: temp=43.1 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.10 cputime=3567.982 memavail=1717276 print_time=5.507 buffer_time=0.193 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473462194608
webhooks: registering remote method 'reboot_machine' for connection id: 281473462194608
webhooks: registering remote method 'pause_job_queue' for connection id: 281473462194608
webhooks: registering remote method 'start_job_queue' for connection id: 281473462194608
Stats 79331.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=7292 bytes_read=6916 bytes_retransmit=0 bytes_invalid=0 send_seq=323 receive_seq=322 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71996139  orange_pi: temp=43.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3568.131 memavail=1716132 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79332.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=9190 bytes_read=7808 bytes_retransmit=0 bytes_invalid=0 send_seq=397 receive_seq=396 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997083  orange_pi: temp=43.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3568.259 memavail=1717196 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79333.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=10995 bytes_read=8775 bytes_retransmit=0 bytes_invalid=0 send_seq=471 receive_seq=471 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997369  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.09 cputime=3568.341 memavail=1716964 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79334.7: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000055 bytes_write=12899 bytes_read=9797 bytes_retransmit=0 bytes_invalid=0 send_seq=552 receive_seq=552 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997710  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=3568.429 memavail=1717536 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79335.7: gcodein=0  mcu: mcu_awake=0.164 mcu_task_avg=0.000261 mcu_task_stddev=0.000305 bytes_write=14707 bytes_read=10605 bytes_retransmit=0 bytes_invalid=0 send_seq=617 receive_seq=617 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997728  orange_pi: temp=43.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=3568.511 memavail=1717284 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79336.7: gcodein=0  mcu: mcu_awake=0.164 mcu_task_avg=0.000261 mcu_task_stddev=0.000305 bytes_write=16454 bytes_read=11421 bytes_retransmit=0 bytes_invalid=0 send_seq=681 receive_seq=681 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997761  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=3568.591 memavail=1717284 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79337.7: gcodein=0  mcu: mcu_awake=0.164 mcu_task_avg=0.000261 mcu_task_stddev=0.000305 bytes_write=18366 bytes_read=12427 bytes_retransmit=0 bytes_invalid=0 send_seq=762 receive_seq=762 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997796  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3568.678 memavail=1716780 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79338.7: gcodein=0  mcu: mcu_awake=0.164 mcu_task_avg=0.000261 mcu_task_stddev=0.000305 bytes_write=20184 bytes_read=13249 bytes_retransmit=0 bytes_invalid=0 send_seq=831 receive_seq=830 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998441  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3568.759 memavail=1716780 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79339.7: gcodein=0  mcu: mcu_awake=0.164 mcu_task_avg=0.000261 mcu_task_stddev=0.000305 bytes_write=21924 bytes_read=14026 bytes_retransmit=0 bytes_invalid=0 send_seq=891 receive_seq=891 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998306  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.08 cputime=3568.838 memavail=1716532 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79340.7: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000260 mcu_task_stddev=0.000263 bytes_write=23694 bytes_read=14810 bytes_retransmit=0 bytes_invalid=0 send_seq=953 receive_seq=953 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998203  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3568.916 memavail=1715776 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79341.7: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000260 mcu_task_stddev=0.000263 bytes_write=25610 bytes_read=15830 bytes_retransmit=0 bytes_invalid=0 send_seq=1036 receive_seq=1035 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998157  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.08 cputime=3569.004 memavail=1715032 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79342.7: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000260 mcu_task_stddev=0.000263 bytes_write=27470 bytes_read=16820 bytes_retransmit=0 bytes_invalid=0 send_seq=1113 receive_seq=1113 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998143  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3569.090 memavail=1715040 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79343.7: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000260 mcu_task_stddev=0.000263 bytes_write=29368 bytes_read=17829 bytes_retransmit=0 bytes_invalid=0 send_seq=1193 receive_seq=1193 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998146  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3569.176 memavail=1714304 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.2 pwm=0.000
Stats 79344.7: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000260 mcu_task_stddev=0.000263 bytes_write=31126 bytes_read=18542 bytes_retransmit=0 bytes_invalid=0 send_seq=1252 receive_seq=1252 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998123  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3569.280 memavail=1714352 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.2 pwm=0.000
Stats 79345.7: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000259 bytes_write=32942 bytes_read=19484 bytes_retransmit=0 bytes_invalid=0 send_seq=1325 receive_seq=1325 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998101  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3569.364 memavail=1713848 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79346.7: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000259 bytes_write=34834 bytes_read=20428 bytes_retransmit=0 bytes_invalid=0 send_seq=1400 receive_seq=1400 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998085  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3569.450 memavail=1714132 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79347.7: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000259 bytes_write=36653 bytes_read=21250 bytes_retransmit=0 bytes_invalid=0 send_seq=1468 receive_seq=1468 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998074  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3569.533 memavail=1713896 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79348.7: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000259 bytes_write=38427 bytes_read=22136 bytes_retransmit=0 bytes_invalid=0 send_seq=1538 receive_seq=1538 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998073  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3569.617 memavail=1713916 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79349.7: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000276 mcu_task_stddev=0.000259 bytes_write=40419 bytes_read=23283 bytes_retransmit=0 bytes_invalid=0 send_seq=1628 receive_seq=1628 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998070  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3569.709 memavail=1713936 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79350.7: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000274 mcu_task_stddev=0.000256 bytes_write=42283 bytes_read=24179 bytes_retransmit=0 bytes_invalid=0 send_seq=1701 receive_seq=1701 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998065  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3569.792 memavail=1714460 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79351.7: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000274 mcu_task_stddev=0.000256 bytes_write=44171 bytes_read=25169 bytes_retransmit=0 bytes_invalid=0 send_seq=1780 receive_seq=1779 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998067  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3569.880 memavail=1714460 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 79352.7: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000274 mcu_task_stddev=0.000256 bytes_write=46052 bytes_read=26230 bytes_retransmit=0 bytes_invalid=0 send_seq=1863 receive_seq=1863 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998062  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3569.968 memavail=1714460 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79353.7: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000274 mcu_task_stddev=0.000256 bytes_write=47961 bytes_read=27195 bytes_retransmit=0 bytes_invalid=0 send_seq=1942 receive_seq=1942 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998062  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.14 cputime=3570.053 memavail=1714460 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79354.7: gcodein=0  mcu: mcu_awake=0.133 mcu_task_avg=0.000274 mcu_task_stddev=0.000256 bytes_write=49791 bytes_read=28089 bytes_retransmit=0 bytes_invalid=0 send_seq=2012 receive_seq=2012 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998065  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.14 cputime=3570.137 memavail=1713956 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79355.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=51560 bytes_read=28943 bytes_retransmit=0 bytes_invalid=0 send_seq=2080 receive_seq=2080 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998063  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.14 cputime=3570.216 memavail=1713960 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79356.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=53465 bytes_read=29877 bytes_retransmit=0 bytes_invalid=0 send_seq=2156 receive_seq=2156 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998064  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.14 cputime=3570.302 memavail=1713960 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79357.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=55376 bytes_read=30893 bytes_retransmit=0 bytes_invalid=0 send_seq=2237 receive_seq=2236 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998066  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.14 cputime=3570.390 memavail=1713708 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79358.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=57348 bytes_read=32053 bytes_retransmit=0 bytes_invalid=0 send_seq=2328 receive_seq=2328 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998088  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3570.484 memavail=1713708 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79359.7: gcodein=0  mcu: mcu_awake=0.137 mcu_task_avg=0.000283 mcu_task_stddev=0.000260 bytes_write=59173 bytes_read=32956 bytes_retransmit=0 bytes_invalid=0 send_seq=2401 receive_seq=2401 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998086  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3570.564 memavail=1713960 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79360.7: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000293 mcu_task_stddev=0.000259 bytes_write=61026 bytes_read=33898 bytes_retransmit=0 bytes_invalid=0 send_seq=2474 receive_seq=2474 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998084  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.13 cputime=3570.648 memavail=1714976 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79361.7: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000293 mcu_task_stddev=0.000259 bytes_write=62921 bytes_read=34899 bytes_retransmit=0 bytes_invalid=0 send_seq=2554 receive_seq=2554 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998084  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.13 cputime=3570.737 memavail=1714736 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79362.7: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000293 mcu_task_stddev=0.000259 bytes_write=64751 bytes_read=35807 bytes_retransmit=0 bytes_invalid=0 send_seq=2628 receive_seq=2628 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998146  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.13 cputime=3570.821 memavail=1714488 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79363.7: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000293 mcu_task_stddev=0.000259 bytes_write=66653 bytes_read=36818 bytes_retransmit=0 bytes_invalid=0 send_seq=2707 receive_seq=2707 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998138  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.20 cputime=3570.905 memavail=1714236 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79364.7: gcodein=0  mcu: mcu_awake=0.146 mcu_task_avg=0.000293 mcu_task_stddev=0.000259 bytes_write=68453 bytes_read=37616 bytes_retransmit=0 bytes_invalid=0 send_seq=2772 receive_seq=2772 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998133  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.20 cputime=3570.985 memavail=1712724 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79365.7: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=70380 bytes_read=38666 bytes_retransmit=0 bytes_invalid=0 send_seq=2856 receive_seq=2855 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998130  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.20 cputime=3571.074 memavail=1712472 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79366.7: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=72302 bytes_read=39760 bytes_retransmit=0 bytes_invalid=0 send_seq=2941 receive_seq=2941 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998125  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.20 cputime=3571.163 memavail=1712736 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79367.7: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=74128 bytes_read=40631 bytes_retransmit=0 bytes_invalid=0 send_seq=3011 receive_seq=3011 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998123  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.20 cputime=3571.246 memavail=1712492 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79368.7: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=75918 bytes_read=41409 bytes_retransmit=0 bytes_invalid=0 send_seq=3075 receive_seq=3075 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998122  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.26 cputime=3571.325 memavail=1712756 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79369.7: gcodein=0  mcu: mcu_awake=0.139 mcu_task_avg=0.000287 mcu_task_stddev=0.000261 bytes_write=77692 bytes_read=42264 bytes_retransmit=0 bytes_invalid=0 send_seq=3142 receive_seq=3142 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998118  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.26 cputime=3571.407 memavail=1712532 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79370.7: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=79469 bytes_read=43019 bytes_retransmit=0 bytes_invalid=0 send_seq=3203 receive_seq=3203 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998116  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.26 cputime=3571.487 memavail=1712784 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.2 pwm=0.000
Stats 79371.7: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=81234 bytes_read=43766 bytes_retransmit=0 bytes_invalid=0 send_seq=3264 receive_seq=3264 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998118  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.26 cputime=3571.565 memavail=1712548 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79372.7: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=82942 bytes_read=44530 bytes_retransmit=0 bytes_invalid=0 send_seq=3324 receive_seq=3324 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998120  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.26 cputime=3571.641 memavail=1712548 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79373.7: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=84749 bytes_read=45310 bytes_retransmit=0 bytes_invalid=0 send_seq=3387 receive_seq=3387 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998120  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.32 cputime=3571.721 memavail=1712044 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79374.7: gcodein=0  mcu: mcu_awake=0.122 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=86561 bytes_read=46140 bytes_retransmit=0 bytes_invalid=0 send_seq=3455 receive_seq=3455 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998118  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.32 cputime=3571.802 memavail=1712092 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79375.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000267 mcu_task_stddev=0.000269 bytes_write=88299 bytes_read=47020 bytes_retransmit=0 bytes_invalid=0 send_seq=3522 receive_seq=3522 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998117  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.32 cputime=3571.883 memavail=1711360 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79376.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000267 mcu_task_stddev=0.000269 bytes_write=90215 bytes_read=47969 bytes_retransmit=0 bytes_invalid=0 send_seq=3599 receive_seq=3598 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998121  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.32 cputime=3571.971 memavail=1711888 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79377.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000267 mcu_task_stddev=0.000269 bytes_write=92142 bytes_read=49020 bytes_retransmit=0 bytes_invalid=0 send_seq=3683 receive_seq=3683 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998119  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.32 cputime=3572.060 memavail=1712416 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79378.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000267 mcu_task_stddev=0.000269 bytes_write=93950 bytes_read=49911 bytes_retransmit=0 bytes_invalid=0 send_seq=3754 receive_seq=3754 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998121  orange_pi: temp=41.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.30 cputime=3572.143 memavail=1712680 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79379.7: gcodein=0  mcu: mcu_awake=0.112 mcu_task_avg=0.000267 mcu_task_stddev=0.000269 bytes_write=95731 bytes_read=50699 bytes_retransmit=0 bytes_invalid=0 send_seq=3817 receive_seq=3817 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998119  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.30 cputime=3572.221 memavail=1712964 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79380.7: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000269 mcu_task_stddev=0.000261 bytes_write=97549 bytes_read=51512 bytes_retransmit=0 bytes_invalid=0 send_seq=3883 receive_seq=3883 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998118  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.30 cputime=3572.303 memavail=1713724 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79381.7: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000269 mcu_task_stddev=0.000261 bytes_write=99341 bytes_read=52393 bytes_retransmit=0 bytes_invalid=0 send_seq=3952 receive_seq=3952 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998119  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.30 cputime=3572.386 memavail=1712996 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79382.7: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000269 mcu_task_stddev=0.000261 bytes_write=101143 bytes_read=53259 bytes_retransmit=0 bytes_invalid=0 send_seq=4021 receive_seq=4021 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998118  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.30 cputime=3572.467 memavail=1713004 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79383.7: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000269 mcu_task_stddev=0.000261 bytes_write=102964 bytes_read=54037 bytes_retransmit=0 bytes_invalid=0 send_seq=4085 receive_seq=4085 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998117  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.35 cputime=3572.549 memavail=1712500 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79384.7: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000269 mcu_task_stddev=0.000261 bytes_write=104763 bytes_read=54939 bytes_retransmit=0 bytes_invalid=0 send_seq=4157 receive_seq=4157 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998117  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.35 cputime=3572.633 memavail=1713048 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79385.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000263 bytes_write=106580 bytes_read=55849 bytes_retransmit=0 bytes_invalid=0 send_seq=4229 receive_seq=4229 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998118  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.35 cputime=3572.714 memavail=1713324 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 79386.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000263 bytes_write=108424 bytes_read=56669 bytes_retransmit=0 bytes_invalid=0 send_seq=4297 receive_seq=4297 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998124  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.35 cputime=3572.796 memavail=1713580 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 79387.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000263 bytes_write=110242 bytes_read=57506 bytes_retransmit=0 bytes_invalid=0 send_seq=4365 receive_seq=4364 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998124  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.35 cputime=3572.879 memavail=1713580 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 79388.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000263 bytes_write=112153 bytes_read=58645 bytes_retransmit=0 bytes_invalid=0 send_seq=4454 receive_seq=4454 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998124  orange_pi: temp=41.9 chamber_heater: target=0 temp=25.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.33 cputime=3572.971 memavail=1712572 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79389.7: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000263 bytes_write=113945 bytes_read=59410 bytes_retransmit=0 bytes_invalid=0 send_seq=4517 receive_seq=4517 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998124  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.33 cputime=3573.050 memavail=1712572 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 79390.7: gcodein=0  mcu: mcu_awake=0.126 mcu_task_avg=0.000274 mcu_task_stddev=0.000263 bytes_write=115813 bytes_read=60331 bytes_retransmit=0 bytes_invalid=0 send_seq=4589 receive_seq=4589 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998127  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.33 cputime=3573.133 memavail=1712844 print_time=5.507 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Unknown command:"STATUS_PANEL_IDLE"
The value 'critical_error' is not valid for EFFECT
Stats 80244.5: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000013 bytes_write=868122 bytes_read=630046 bytes_retransmit=0 bytes_invalid=0 send_seq=47118 receive_seq=47118 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998158  orange_pi: temp=41.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=3628.736 memavail=1714040 print_time=919.380 buffer_time=0.327 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 281473462194608: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:51:10 2024 (1735577470.4 80246.0)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  3 1 top (1,0,0)

[led_effect cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (16-9)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect rainbow-back]
leds = 
	neopixel:panel_ring (1-8)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logcritical_erroro_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473465495136: New connection
webhooks client 281473465495136: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 80250.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=3279 bytes_read=6196 bytes_retransmit=0 bytes_invalid=0 send_seq=231 receive_seq=228 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2019 upcoming_bytes=154 freq=71995893  orange_pi: temp=42.6 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.02 cputime=3631.933 memavail=1713920 print_time=5.490 buffer_time=0.196 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473465495136
webhooks: registering remote method 'reboot_machine' for connection id: 281473465495136
webhooks: registering remote method 'pause_job_queue' for connection id: 281473465495136
webhooks: registering remote method 'start_job_queue' for connection id: 281473465495136
Stats 80251.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=7306 bytes_read=6942 bytes_retransmit=0 bytes_invalid=0 send_seq=325 receive_seq=324 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71996592  orange_pi: temp=42.8 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.02 cputime=3632.056 memavail=1714160 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80252.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=9267 bytes_read=7964 bytes_retransmit=0 bytes_invalid=0 send_seq=408 receive_seq=408 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998220  orange_pi: temp=42.7 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.02 cputime=3632.176 memavail=1714880 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80253.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=11053 bytes_read=8830 bytes_retransmit=0 bytes_invalid=0 send_seq=477 receive_seq=477 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998004  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=3632.258 memavail=1714396 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80254.2: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=12864 bytes_read=9690 bytes_retransmit=0 bytes_invalid=0 send_seq=545 receive_seq=545 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997866  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.02 cputime=3632.338 memavail=1714396 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80255.2: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000257 mcu_task_stddev=0.000305 bytes_write=14728 bytes_read=10602 bytes_retransmit=0 bytes_invalid=0 send_seq=618 receive_seq=618 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=72000040  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.01 cputime=3632.421 memavail=1714184 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80256.2: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000257 mcu_task_stddev=0.000305 bytes_write=16623 bytes_read=11657 bytes_retransmit=0 bytes_invalid=0 send_seq=701 receive_seq=701 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71999232  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.01 cputime=3632.513 memavail=1714188 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80257.2: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000257 mcu_task_stddev=0.000305 bytes_write=18457 bytes_read=12575 bytes_retransmit=0 bytes_invalid=0 send_seq=774 receive_seq=774 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72000063  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.01 cputime=3632.595 memavail=1713936 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80258.2: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000257 mcu_task_stddev=0.000305 bytes_write=20212 bytes_read=13314 bytes_retransmit=0 bytes_invalid=0 send_seq=835 receive_seq=835 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71999438  orange_pi: temp=41.8 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.01 cputime=3632.674 memavail=1714712 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80259.2: gcodein=0  mcu: mcu_awake=0.158 mcu_task_avg=0.000257 mcu_task_stddev=0.000305 bytes_write=22115 bytes_read=14343 bytes_retransmit=0 bytes_invalid=0 send_seq=916 receive_seq=916 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71999018  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.01 cputime=3632.763 memavail=1714712 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Neopixel update did not succeed
Stats 80260.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000259 bytes_write=24065 bytes_read=15343 bytes_retransmit=0 bytes_invalid=0 send_seq=994 receive_seq=994 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998786  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.01 cputime=3632.867 memavail=1714460 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80261.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000259 bytes_write=25843 bytes_read=16082 bytes_retransmit=0 bytes_invalid=0 send_seq=1055 receive_seq=1055 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998566  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.01 cputime=3632.962 memavail=1714488 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80262.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000259 bytes_write=27638 bytes_read=16877 bytes_retransmit=0 bytes_invalid=0 send_seq=1118 receive_seq=1118 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998418  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.01 cputime=3633.057 memavail=1714256 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80263.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000259 bytes_write=29390 bytes_read=17621 bytes_retransmit=0 bytes_invalid=0 send_seq=1178 receive_seq=1177 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998330  orange_pi: temp=41.5 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.01 cputime=3633.152 memavail=1714256 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 80264.2: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000259 bytes_write=31151 bytes_read=18360 bytes_retransmit=0 bytes_invalid=0 send_seq=1238 receive_seq=1238 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998252  orange_pi: temp=41.8 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.01 cputime=3633.245 memavail=1714280 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80265.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000259 mcu_task_stddev=0.000276 bytes_write=32911 bytes_read=19094 bytes_retransmit=0 bytes_invalid=0 send_seq=1296 receive_seq=1295 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998219  orange_pi: temp=42.7 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.01 cputime=3633.363 memavail=1713524 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80266.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000259 mcu_task_stddev=0.000276 bytes_write=34731 bytes_read=19866 bytes_retransmit=0 bytes_invalid=0 send_seq=1359 receive_seq=1358 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998541  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.01 cputime=3633.460 memavail=1713272 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 80267.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000259 mcu_task_stddev=0.000276 bytes_write=36483 bytes_read=20652 bytes_retransmit=0 bytes_invalid=0 send_seq=1422 receive_seq=1422 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998440  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.01 cputime=3633.558 memavail=1713272 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 80268.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000259 mcu_task_stddev=0.000276 bytes_write=38277 bytes_read=21486 bytes_retransmit=0 bytes_invalid=0 send_seq=1488 receive_seq=1488 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998360  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.01 cputime=3633.656 memavail=1713524 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 80269.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000259 mcu_task_stddev=0.000276 bytes_write=40057 bytes_read=22227 bytes_retransmit=0 bytes_invalid=0 send_seq=1549 receive_seq=1548 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998533  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.01 cputime=3633.751 memavail=1713776 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Neopixel update did not succeed
Stats 80270.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000274 bytes_write=41932 bytes_read=23144 bytes_retransmit=0 bytes_invalid=0 send_seq=1622 receive_seq=1622 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998448  orange_pi: temp=41.9 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.01 cputime=3633.854 memavail=1714300 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80271.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000274 bytes_write=43657 bytes_read=23882 bytes_retransmit=0 bytes_invalid=0 send_seq=1680 receive_seq=1680 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998377  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.01 cputime=3633.945 memavail=1714304 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80272.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000274 bytes_write=45370 bytes_read=24519 bytes_retransmit=0 bytes_invalid=0 send_seq=1732 receive_seq=1732 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998317  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.01 cputime=3634.037 memavail=1714304 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80273.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000274 bytes_write=47132 bytes_read=25193 bytes_retransmit=0 bytes_invalid=0 send_seq=1788 receive_seq=1788 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998271  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.01 cputime=3634.129 memavail=1713800 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80274.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000266 mcu_task_stddev=0.000274 bytes_write=48872 bytes_read=25970 bytes_retransmit=0 bytes_invalid=0 send_seq=1849 receive_seq=1849 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998234  orange_pi: temp=41.5 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.01 cputime=3634.222 memavail=1713548 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80275.2: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000250 mcu_task_stddev=0.000279 bytes_write=50651 bytes_read=26736 bytes_retransmit=0 bytes_invalid=0 send_seq=1909 receive_seq=1909 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998202  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.01 cputime=3634.318 memavail=1713296 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80276.2: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000250 mcu_task_stddev=0.000279 bytes_write=52451 bytes_read=27488 bytes_retransmit=0 bytes_invalid=0 send_seq=1971 receive_seq=1971 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998182  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.01 cputime=3634.413 memavail=1713064 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80277.2: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000250 mcu_task_stddev=0.000279 bytes_write=54281 bytes_read=28309 bytes_retransmit=0 bytes_invalid=0 send_seq=2037 receive_seq=2036 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998172  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.01 cputime=3634.510 memavail=1713820 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80278.2: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000250 mcu_task_stddev=0.000279 bytes_write=55960 bytes_read=29035 bytes_retransmit=0 bytes_invalid=0 send_seq=2094 receive_seq=2094 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998151  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.01 cputime=3634.601 memavail=1714344 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80279.2: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000250 mcu_task_stddev=0.000279 bytes_write=57701 bytes_read=29675 bytes_retransmit=0 bytes_invalid=0 send_seq=2148 receive_seq=2148 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998139  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.01 cputime=3634.692 memavail=1714368 print_time=5.490 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 80280.2: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000253 mcu_task_stddev=0.000278 bytes_write=60205 bytes_read=30964 bytes_retransmit=0 bytes_invalid=0 send_seq=2228 receive_seq=2228 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998126  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.01 cputime=3634.821 memavail=1715144 print_time=36.078 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Neopixel update did not succeed
Stats 80281.2: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000253 mcu_task_stddev=0.000278 bytes_write=62692 bytes_read=32443 bytes_retransmit=0 bytes_invalid=0 send_seq=2327 receive_seq=2326 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998115  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.8 pwm=0.000 sysload=1.01 cputime=3634.958 memavail=1715144 print_time=36.528 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80282.2: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000253 mcu_task_stddev=0.000278 bytes_write=64828 bytes_read=33585 bytes_retransmit=0 bytes_invalid=0 send_seq=2412 receive_seq=2412 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998110  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.9 pwm=0.000 sysload=1.01 cputime=3635.069 memavail=1715144 print_time=37.528 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80283.2: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000253 mcu_task_stddev=0.000278 bytes_write=67135 bytes_read=34927 bytes_retransmit=0 bytes_invalid=0 send_seq=2510 receive_seq=2510 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998103  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.01 cputime=3635.187 memavail=1715144 print_time=38.528 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Neopixel update did not succeed
Stats 80284.2: gcodein=0  mcu: mcu_awake=0.100 mcu_task_avg=0.000253 mcu_task_stddev=0.000278 bytes_write=69721 bytes_read=36410 bytes_retransmit=0 bytes_invalid=0 send_seq=2621 receive_seq=2620 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998098  orange_pi: temp=41.9 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.01 cputime=3635.319 memavail=1715144 print_time=39.860 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80285.2: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000183 mcu_task_stddev=0.000236 bytes_write=71822 bytes_read=37571 bytes_retransmit=0 bytes_invalid=0 send_seq=2708 receive_seq=2708 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998094  orange_pi: temp=41.9 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3635.431 memavail=1714892 print_time=40.555 buffer_time=0.242 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Stats 80286.2: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000183 mcu_task_stddev=0.000236 bytes_write=74665 bytes_read=39548 bytes_retransmit=0 bytes_invalid=0 send_seq=2837 receive_seq=2837 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998090  orange_pi: temp=42.2 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=24.9 pwm=0.000 sysload=1.09 cputime=3635.587 memavail=1715652 print_time=41.498 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80287.2: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000183 mcu_task_stddev=0.000236 bytes_write=76976 bytes_read=40869 bytes_retransmit=0 bytes_invalid=0 send_seq=2933 receive_seq=2933 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998086  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3635.704 memavail=1716180 print_time=42.498 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80288.2: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000183 mcu_task_stddev=0.000236 bytes_write=79248 bytes_read=41983 bytes_retransmit=0 bytes_invalid=0 send_seq=3018 receive_seq=3018 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998090  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=3635.817 memavail=1716944 print_time=43.531 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Neopixel update did not succeed
Stats 80289.2: gcodein=0  mcu: mcu_awake=0.131 mcu_task_avg=0.000183 mcu_task_stddev=0.000236 bytes_write=81919 bytes_read=43233 bytes_retransmit=0 bytes_invalid=0 send_seq=3111 receive_seq=3111 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998094  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.09 cputime=3635.945 memavail=1716956 print_time=48.254 buffer_time=3.938 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 80290.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000187 mcu_task_stddev=0.000241 bytes_write=83876 bytes_read=44236 bytes_retransmit=0 bytes_invalid=0 send_seq=3184 receive_seq=3184 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998092  orange_pi: temp=42.9 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3636.052 memavail=1716724 print_time=48.254 buffer_time=2.938 print_stall=0 extruder: target=0 temp=26.2 pwm=0.000
Stats 80291.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000187 mcu_task_stddev=0.000241 bytes_write=85636 bytes_read=45017 bytes_retransmit=0 bytes_invalid=0 send_seq=3243 receive_seq=3243 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998096  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=3636.150 memavail=1716724 print_time=48.254 buffer_time=1.937 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 80292.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000187 mcu_task_stddev=0.000241 bytes_write=87503 bytes_read=45956 bytes_retransmit=0 bytes_invalid=0 send_seq=3310 receive_seq=3310 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=71998099  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3636.254 memavail=1717468 print_time=48.254 buffer_time=0.937 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80293.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000187 mcu_task_stddev=0.000241 bytes_write=89377 bytes_read=46817 bytes_retransmit=0 bytes_invalid=0 send_seq=3374 receive_seq=3374 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=18 freq=71998096  orange_pi: temp=42.2 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.08 cputime=3636.357 memavail=1716988 print_time=48.254 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 80294.2: gcodein=0  mcu: mcu_awake=0.132 mcu_task_avg=0.000187 mcu_task_stddev=0.000241 bytes_write=91344 bytes_read=47797 bytes_retransmit=0 bytes_invalid=0 send_seq=3447 receive_seq=3447 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=18 freq=71998099  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3636.464 memavail=1717264 print_time=50.220 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80295.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000224 mcu_task_stddev=0.000270 bytes_write=93389 bytes_read=48766 bytes_retransmit=0 bytes_invalid=0 send_seq=3519 receive_seq=3519 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998188  orange_pi: temp=42.3 chamber_heater: target=0 temp=27.4 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.07 cputime=3636.571 memavail=1717332 print_time=50.520 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 80296.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000224 mcu_task_stddev=0.000270 bytes_write=96095 bytes_read=50206 bytes_retransmit=0 bytes_invalid=0 send_seq=3630 receive_seq=3630 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=36 freq=71998180  orange_pi: temp=42.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.8 pwm=0.000 sysload=1.07 cputime=3636.705 memavail=1717352 print_time=53.212 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80297.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000224 mcu_task_stddev=0.000270 bytes_write=98021 bytes_read=51120 bytes_retransmit=0 bytes_invalid=0 send_seq=3699 receive_seq=3698 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=18 freq=71998171  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3636.811 memavail=1716860 print_time=53.212 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80298.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000224 mcu_task_stddev=0.000270 bytes_write=100014 bytes_read=52119 bytes_retransmit=0 bytes_invalid=0 send_seq=3773 receive_seq=3773 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998164  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.1 pwm=0.000 sysload=1.07 cputime=3636.917 memavail=1717628 print_time=53.512 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 80299.2: gcodein=0  mcu: mcu_awake=0.106 mcu_task_avg=0.000224 mcu_task_stddev=0.000270 bytes_write=102622 bytes_read=53655 bytes_retransmit=0 bytes_invalid=0 send_seq=3888 receive_seq=3888 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=18 freq=71998157  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3637.048 memavail=1717392 print_time=55.728 buffer_time=1.407 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80300.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000194 mcu_task_stddev=0.000247 bytes_write=104558 bytes_read=54580 bytes_retransmit=0 bytes_invalid=0 send_seq=3958 receive_seq=3958 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998151  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3637.154 memavail=1717392 print_time=55.728 buffer_time=0.406 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80301.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000194 mcu_task_stddev=0.000247 bytes_write=106430 bytes_read=55466 bytes_retransmit=0 bytes_invalid=0 send_seq=4024 receive_seq=4024 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998145  orange_pi: temp=41.9 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.07 cputime=3637.254 memavail=1717392 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80302.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000194 mcu_task_stddev=0.000247 bytes_write=108296 bytes_read=56361 bytes_retransmit=0 bytes_invalid=0 send_seq=4090 receive_seq=4090 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998141  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3637.358 memavail=1717396 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Stats 80303.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000194 mcu_task_stddev=0.000247 bytes_write=110149 bytes_read=57181 bytes_retransmit=0 bytes_invalid=0 send_seq=4152 receive_seq=4152 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998138  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3637.462 memavail=1717396 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80304.2: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000194 mcu_task_stddev=0.000247 bytes_write=112038 bytes_read=58177 bytes_retransmit=0 bytes_invalid=0 send_seq=4226 receive_seq=4226 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998134  orange_pi: temp=41.7 chamber_heater: target=0 temp=27.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3637.567 memavail=1717396 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80305.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000225 mcu_task_stddev=0.000265 bytes_write=113842 bytes_read=59020 bytes_retransmit=0 bytes_invalid=0 send_seq=4287 receive_seq=4287 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998131  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.06 cputime=3637.668 memavail=1716892 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 80306.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000225 mcu_task_stddev=0.000265 bytes_write=115733 bytes_read=59887 bytes_retransmit=0 bytes_invalid=0 send_seq=4354 receive_seq=4354 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998132  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.06 cputime=3637.773 memavail=1716892 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.5 pwm=0.000
Neopixel update did not succeed
Stats 80307.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000225 mcu_task_stddev=0.000265 bytes_write=117620 bytes_read=60862 bytes_retransmit=0 bytes_invalid=0 send_seq=4427 receive_seq=4427 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998130  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.06 cputime=3637.882 memavail=1716892 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 80308.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000225 mcu_task_stddev=0.000265 bytes_write=119476 bytes_read=61762 bytes_retransmit=0 bytes_invalid=0 send_seq=4494 receive_seq=4494 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998128  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.06 cputime=3637.983 memavail=1716892 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Neopixel update did not succeed
Stats 80309.2: gcodein=0  mcu: mcu_awake=0.105 mcu_task_avg=0.000225 mcu_task_stddev=0.000265 bytes_write=121404 bytes_read=62777 bytes_retransmit=0 bytes_invalid=0 send_seq=4571 receive_seq=4571 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998125  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3638.091 memavail=1717648 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80310.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000232 mcu_task_stddev=0.000265 bytes_write=123336 bytes_read=63792 bytes_retransmit=0 bytes_invalid=0 send_seq=4645 receive_seq=4645 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998123  orange_pi: temp=42.1 chamber_heater: target=0 temp=27.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3638.197 memavail=1717148 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Neopixel update did not succeed
Stats 80311.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000232 mcu_task_stddev=0.000265 bytes_write=125241 bytes_read=64825 bytes_retransmit=0 bytes_invalid=0 send_seq=4721 receive_seq=4721 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998122  orange_pi: temp=42.1 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3638.306 memavail=1716896 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80312.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000232 mcu_task_stddev=0.000265 bytes_write=127046 bytes_read=65658 bytes_retransmit=0 bytes_invalid=0 send_seq=4784 receive_seq=4784 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998121  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.06 cputime=3638.407 memavail=1716896 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 80313.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000232 mcu_task_stddev=0.000265 bytes_write=128910 bytes_read=66542 bytes_retransmit=0 bytes_invalid=0 send_seq=4848 receive_seq=4848 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998119  orange_pi: temp=41.9 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=3638.510 memavail=1716404 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80314.2: gcodein=0  mcu: mcu_awake=0.113 mcu_task_avg=0.000232 mcu_task_stddev=0.000265 bytes_write=130794 bytes_read=67403 bytes_retransmit=0 bytes_invalid=0 send_seq=4913 receive_seq=4912 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998168  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.06 cputime=3638.614 memavail=1716664 print_time=55.728 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 80315.2: gcodein=0  mcu: mcu_awake=0.116 mcu_task_avg=0.000242 mcu_task_stddev=0.000271 bytes_write=132595 bytes_read=68293 bytes_retransmit=0 bytes_invalid=0 send_seq=4979 receive_seq=4979 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998162  orange_pi: temp=42.3 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.05 cputime=3638.718 memavail=1716440 print_time=71.050 buffer_time=0.720 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 281473465495136: Disconnected
Restarting printer
Start printer at Mon Dec 30 19:52:21 2024 (1735577541.5 80317.1)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  3 1 top (1,0,0)

[led_effect cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (16-9)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect rainbow-back]
leds = 
	neopixel:panel_ring (1-8)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logcritical_erroro_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473445108400: New connection
webhooks client 281473445108400: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 80321.3: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=3279 bytes_read=6196 bytes_retransmit=0 bytes_invalid=0 send_seq=231 receive_seq=228 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2001 upcoming_bytes=172 freq=71996917  orange_pi: temp=42.9 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.13 cputime=3641.969 memavail=1716244 print_time=5.487 buffer_time=0.196 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473445108400
webhooks: registering remote method 'reboot_machine' for connection id: 281473445108400
webhooks: registering remote method 'pause_job_queue' for connection id: 281473445108400
webhooks: registering remote method 'start_job_queue' for connection id: 281473445108400
Stats 80322.3: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=7313 bytes_read=6955 bytes_retransmit=0 bytes_invalid=0 send_seq=326 receive_seq=325 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71996999  orange_pi: temp=42.5 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3642.092 memavail=1715528 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80323.3: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=9183 bytes_read=7808 bytes_retransmit=0 bytes_invalid=0 send_seq=396 receive_seq=396 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997913  orange_pi: temp=42.5 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.13 cputime=3642.207 memavail=1715052 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80324.3: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=10862 bytes_read=8492 bytes_retransmit=0 bytes_invalid=0 send_seq=451 receive_seq=451 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997798  orange_pi: temp=42.8 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.13 cputime=3642.281 memavail=1714800 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80325.3: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000031 mcu_task_stddev=0.000054 bytes_write=12610 bytes_read=9235 bytes_retransmit=0 bytes_invalid=0 send_seq=510 receive_seq=510 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=72000935  orange_pi: temp=42.1 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3642.356 memavail=1715576 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80326.3: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000245 mcu_task_stddev=0.000311 bytes_write=14425 bytes_read=10043 bytes_retransmit=0 bytes_invalid=0 send_seq=576 receive_seq=575 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71999697  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3642.435 memavail=1715344 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80327.3: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000245 mcu_task_stddev=0.000311 bytes_write=16354 bytes_read=11195 bytes_retransmit=0 bytes_invalid=0 send_seq=666 receive_seq=666 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998948  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3642.529 memavail=1714592 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80328.3: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000245 mcu_task_stddev=0.000311 bytes_write=18219 bytes_read=12094 bytes_retransmit=0 bytes_invalid=0 send_seq=737 receive_seq=737 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998573  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.12 cputime=3642.629 memavail=1714600 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 80329.3: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000245 mcu_task_stddev=0.000311 bytes_write=20021 bytes_read=12911 bytes_retransmit=0 bytes_invalid=0 send_seq=804 receive_seq=804 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998366  orange_pi: temp=42.9 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.12 cputime=3642.730 memavail=1714872 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80330.3: gcodein=0  mcu: mcu_awake=0.140 mcu_task_avg=0.000245 mcu_task_stddev=0.000311 bytes_write=21803 bytes_read=13623 bytes_retransmit=0 bytes_invalid=0 send_seq=864 receive_seq=863 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998222  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.11 cputime=3642.822 memavail=1714872 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Neopixel update did not succeed
Stats 80331.3: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000260 mcu_task_stddev=0.000262 bytes_write=23505 bytes_read=14365 bytes_retransmit=0 bytes_invalid=0 send_seq=920 receive_seq=920 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998140  orange_pi: temp=42.2 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=3642.916 memavail=1714872 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 80332.3: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000260 mcu_task_stddev=0.000262 bytes_write=25338 bytes_read=15208 bytes_retransmit=0 bytes_invalid=0 send_seq=989 receive_seq=989 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998094  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.11 cputime=3643.015 memavail=1714872 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Neopixel update did not succeed
Stats 80333.3: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000260 mcu_task_stddev=0.000262 bytes_write=27109 bytes_read=15939 bytes_retransmit=0 bytes_invalid=0 send_seq=1047 receive_seq=1047 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998113  orange_pi: temp=42.4 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.11 cputime=3643.114 memavail=1714872 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80334.3: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000260 mcu_task_stddev=0.000262 bytes_write=28851 bytes_read=16591 bytes_retransmit=0 bytes_invalid=0 send_seq=1100 receive_seq=1099 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998081  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.11 cputime=3643.205 memavail=1714872 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80335.3: gcodein=0  mcu: mcu_awake=0.120 mcu_task_avg=0.000260 mcu_task_stddev=0.000262 bytes_write=30628 bytes_read=17421 bytes_retransmit=0 bytes_invalid=0 send_seq=1167 receive_seq=1167 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998102  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.10 cputime=3643.302 memavail=1714876 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80336.3: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000252 mcu_task_stddev=0.000274 bytes_write=32415 bytes_read=18215 bytes_retransmit=0 bytes_invalid=0 send_seq=1228 receive_seq=1228 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998108  orange_pi: temp=42.1 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.10 cputime=3643.424 memavail=1714624 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80337.3: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000252 mcu_task_stddev=0.000274 bytes_write=34181 bytes_read=18909 bytes_retransmit=0 bytes_invalid=0 send_seq=1285 receive_seq=1285 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998100  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=3643.516 memavail=1714624 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80338.3: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000252 mcu_task_stddev=0.000274 bytes_write=35905 bytes_read=19609 bytes_retransmit=0 bytes_invalid=0 send_seq=1343 receive_seq=1343 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998085  orange_pi: temp=41.4 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.10 cputime=3643.606 memavail=1714624 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80339.3: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000252 mcu_task_stddev=0.000274 bytes_write=37619 bytes_read=20295 bytes_retransmit=0 bytes_invalid=0 send_seq=1397 receive_seq=1397 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998074  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.10 cputime=3643.698 memavail=1714624 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80340.3: gcodein=0  mcu: mcu_awake=0.104 mcu_task_avg=0.000252 mcu_task_stddev=0.000274 bytes_write=39381 bytes_read=21018 bytes_retransmit=0 bytes_invalid=0 send_seq=1455 receive_seq=1455 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998065  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=3643.791 memavail=1714120 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80341.3: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000239 mcu_task_stddev=0.000274 bytes_write=41166 bytes_read=21719 bytes_retransmit=0 bytes_invalid=0 send_seq=1514 receive_seq=1513 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998062  orange_pi: temp=40.8 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=3643.885 memavail=1714120 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80342.3: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000239 mcu_task_stddev=0.000274 bytes_write=42856 bytes_read=22402 bytes_retransmit=0 bytes_invalid=0 send_seq=1568 receive_seq=1568 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998070  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.09 cputime=3643.977 memavail=1714624 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80343.3: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000239 mcu_task_stddev=0.000274 bytes_write=44641 bytes_read=23143 bytes_retransmit=0 bytes_invalid=0 send_seq=1628 receive_seq=1628 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998066  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3644.070 memavail=1714396 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80344.3: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000239 mcu_task_stddev=0.000274 bytes_write=46397 bytes_read=23791 bytes_retransmit=0 bytes_invalid=0 send_seq=1683 receive_seq=1682 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998063  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.09 cputime=3644.161 memavail=1714648 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80345.3: gcodein=0  mcu: mcu_awake=0.095 mcu_task_avg=0.000239 mcu_task_stddev=0.000274 bytes_write=48165 bytes_read=24529 bytes_retransmit=0 bytes_invalid=0 send_seq=1741 receive_seq=1740 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998066  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=3644.253 memavail=1714920 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80346.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000234 mcu_task_stddev=0.000275 bytes_write=49816 bytes_read=25204 bytes_retransmit=0 bytes_invalid=0 send_seq=1793 receive_seq=1793 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998066  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3644.342 memavail=1714920 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80347.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000234 mcu_task_stddev=0.000275 bytes_write=51606 bytes_read=25943 bytes_retransmit=0 bytes_invalid=0 send_seq=1854 receive_seq=1854 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998066  orange_pi: temp=42.3 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3644.436 memavail=1714676 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80348.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000234 mcu_task_stddev=0.000275 bytes_write=53361 bytes_read=26642 bytes_retransmit=0 bytes_invalid=0 send_seq=1909 receive_seq=1909 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998069  orange_pi: temp=42.2 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=3644.529 memavail=1714940 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80349.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000234 mcu_task_stddev=0.000275 bytes_write=55140 bytes_read=27503 bytes_retransmit=0 bytes_invalid=0 send_seq=1978 receive_seq=1978 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998085  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3644.629 memavail=1714960 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80350.3: gcodein=0  mcu: mcu_awake=0.092 mcu_task_avg=0.000234 mcu_task_stddev=0.000275 bytes_write=56831 bytes_read=28120 bytes_retransmit=0 bytes_invalid=0 send_seq=2029 receive_seq=2029 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998088  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3644.718 memavail=1714728 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80351.3: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000243 mcu_task_stddev=0.000275 bytes_write=58618 bytes_read=28893 bytes_retransmit=0 bytes_invalid=0 send_seq=2089 receive_seq=2089 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998087  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.08 cputime=3644.812 memavail=1714744 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80352.3: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000243 mcu_task_stddev=0.000275 bytes_write=60346 bytes_read=29543 bytes_retransmit=0 bytes_invalid=0 send_seq=2142 receive_seq=2142 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998087  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.08 cputime=3644.901 memavail=1715016 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80353.3: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000243 mcu_task_stddev=0.000275 bytes_write=61985 bytes_read=30134 bytes_retransmit=0 bytes_invalid=0 send_seq=2191 receive_seq=2191 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998091  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.08 cputime=3644.989 memavail=1715008 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80354.3: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000243 mcu_task_stddev=0.000275 bytes_write=63756 bytes_read=30851 bytes_retransmit=0 bytes_invalid=0 send_seq=2248 receive_seq=2248 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998094  orange_pi: temp=42.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.08 cputime=3645.080 memavail=1715016 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80355.3: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000243 mcu_task_stddev=0.000275 bytes_write=65532 bytes_read=31579 bytes_retransmit=0 bytes_invalid=0 send_seq=2307 receive_seq=2307 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998102  orange_pi: temp=42.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.8 pwm=0.000 sysload=1.07 cputime=3645.178 memavail=1715312 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80356.3: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000239 mcu_task_stddev=0.000277 bytes_write=67271 bytes_read=32361 bytes_retransmit=0 bytes_invalid=0 send_seq=2370 receive_seq=2370 retransmit_seq=0 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998104  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3645.274 memavail=1715072 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80357.3: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000239 mcu_task_stddev=0.000277 bytes_write=69007 bytes_read=33060 bytes_retransmit=0 bytes_invalid=0 send_seq=2425 receive_seq=2425 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998103  orange_pi: temp=42.3 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.07 cputime=3645.365 memavail=1716076 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80358.3: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000239 mcu_task_stddev=0.000277 bytes_write=70716 bytes_read=33658 bytes_retransmit=0 bytes_invalid=0 send_seq=2474 receive_seq=2474 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998104  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.07 cputime=3645.455 memavail=1715848 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Neopixel update did not succeed
Stats 80359.3: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000239 mcu_task_stddev=0.000277 bytes_write=72496 bytes_read=34410 bytes_retransmit=0 bytes_invalid=0 send_seq=2536 receive_seq=2536 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998103  orange_pi: temp=41.7 chamber_heater: target=0 temp=27.0 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.07 cputime=3645.550 memavail=1715352 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80360.3: gcodein=0  mcu: mcu_awake=0.094 mcu_task_avg=0.000239 mcu_task_stddev=0.000277 bytes_write=74195 bytes_read=35088 bytes_retransmit=0 bytes_invalid=0 send_seq=2590 receive_seq=2590 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=23 upcoming_bytes=0 freq=71998105  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=3645.643 memavail=1715376 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80361.3: gcodein=0  mcu: mcu_awake=0.093 mcu_task_avg=0.000240 mcu_task_stddev=0.000279 bytes_write=75890 bytes_read=35750 bytes_retransmit=0 bytes_invalid=0 send_seq=2642 receive_seq=2642 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998107  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=3645.730 memavail=1715628 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80362.3: gcodein=0  mcu: mcu_awake=0.093 mcu_task_avg=0.000240 mcu_task_stddev=0.000279 bytes_write=77621 bytes_read=36385 bytes_retransmit=0 bytes_invalid=0 send_seq=2695 receive_seq=2695 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998105  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.06 cputime=3645.820 memavail=1716152 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80363.3: gcodein=0  mcu: mcu_awake=0.093 mcu_task_avg=0.000240 mcu_task_stddev=0.000279 bytes_write=79391 bytes_read=37136 bytes_retransmit=0 bytes_invalid=0 send_seq=2755 receive_seq=2754 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998111  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=3645.917 memavail=1715900 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80364.3: gcodein=0  mcu: mcu_awake=0.093 mcu_task_avg=0.000240 mcu_task_stddev=0.000279 bytes_write=81160 bytes_read=37880 bytes_retransmit=0 bytes_invalid=0 send_seq=2814 receive_seq=2813 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998112  orange_pi: temp=42.0 chamber_heater: target=0 temp=27.1 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3646.011 memavail=1716656 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80365.3: gcodein=0  mcu: mcu_awake=0.093 mcu_task_avg=0.000240 mcu_task_stddev=0.000279 bytes_write=82888 bytes_read=38580 bytes_retransmit=0 bytes_invalid=0 send_seq=2871 receive_seq=2871 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998112  orange_pi: temp=42.9 chamber_heater: target=0 temp=27.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=3646.102 memavail=1716720 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80366.3: gcodein=0  mcu: mcu_awake=0.101 mcu_task_avg=0.000248 mcu_task_stddev=0.000277 bytes_write=84671 bytes_read=39405 bytes_retransmit=0 bytes_invalid=0 send_seq=2935 receive_seq=2935 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998111  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3646.199 memavail=1717248 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80367.3: gcodein=0  mcu: mcu_awake=0.101 mcu_task_avg=0.000248 mcu_task_stddev=0.000277 bytes_write=86477 bytes_read=40167 bytes_retransmit=0 bytes_invalid=0 send_seq=2996 receive_seq=2996 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998112  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.06 cputime=3646.295 memavail=1717268 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80368.3: gcodein=0  mcu: mcu_awake=0.101 mcu_task_avg=0.000248 mcu_task_stddev=0.000277 bytes_write=88271 bytes_read=40919 bytes_retransmit=0 bytes_invalid=0 send_seq=3059 receive_seq=3058 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=22 upcoming_bytes=0 freq=71998112  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3646.389 memavail=1717288 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80369.4: gcodein=0  mcu: mcu_awake=0.101 mcu_task_avg=0.000248 mcu_task_stddev=0.000277 bytes_write=89958 bytes_read=41597 bytes_retransmit=0 bytes_invalid=0 send_seq=3112 receive_seq=3112 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998117  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.06 cputime=3646.479 memavail=1717560 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80370.4: gcodein=0  mcu: mcu_awake=0.101 mcu_task_avg=0.000248 mcu_task_stddev=0.000277 bytes_write=91685 bytes_read=42286 bytes_retransmit=0 bytes_invalid=0 send_seq=3168 receive_seq=3168 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998200  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.05 cputime=3646.568 memavail=1717832 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Neopixel update did not succeed
Stats 80371.4: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000252 mcu_task_stddev=0.000279 bytes_write=93493 bytes_read=43068 bytes_retransmit=0 bytes_invalid=0 send_seq=3231 receive_seq=3231 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998193  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3646.665 memavail=1718104 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80372.4: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000252 mcu_task_stddev=0.000279 bytes_write=95170 bytes_read=43741 bytes_retransmit=0 bytes_invalid=0 send_seq=3284 receive_seq=3284 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998185  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.7 pwm=0.000 sysload=1.05 cputime=3646.755 memavail=1717600 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80373.4: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000252 mcu_task_stddev=0.000279 bytes_write=96974 bytes_read=44560 bytes_retransmit=0 bytes_invalid=0 send_seq=3350 receive_seq=3350 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998179  orange_pi: temp=42.1 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3646.852 memavail=1717100 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80374.4: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000252 mcu_task_stddev=0.000279 bytes_write=98757 bytes_read=45260 bytes_retransmit=0 bytes_invalid=0 send_seq=3408 receive_seq=3408 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998174  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3646.945 memavail=1717100 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80375.4: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000252 mcu_task_stddev=0.000279 bytes_write=100517 bytes_read=45962 bytes_retransmit=0 bytes_invalid=0 send_seq=3464 receive_seq=3464 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998173  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3647.038 memavail=1716876 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80376.4: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000246 mcu_task_stddev=0.000276 bytes_write=102178 bytes_read=46646 bytes_retransmit=0 bytes_invalid=0 send_seq=3518 receive_seq=3518 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998167  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3647.129 memavail=1716624 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80377.4: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000246 mcu_task_stddev=0.000276 bytes_write=103956 bytes_read=47349 bytes_retransmit=0 bytes_invalid=0 send_seq=3577 receive_seq=3577 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998166  orange_pi: temp=42.0 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3647.222 memavail=1716132 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.1 pwm=0.000
Stats 80378.4: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000246 mcu_task_stddev=0.000276 bytes_write=105793 bytes_read=48194 bytes_retransmit=0 bytes_invalid=0 send_seq=3644 receive_seq=3644 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998163  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3647.321 memavail=1716404 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 80379.4: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000246 mcu_task_stddev=0.000276 bytes_write=107598 bytes_read=48940 bytes_retransmit=0 bytes_invalid=0 send_seq=3706 receive_seq=3705 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998158  orange_pi: temp=41.8 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.05 cputime=3647.418 memavail=1716176 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Stats 80380.4: gcodein=0  mcu: mcu_awake=0.098 mcu_task_avg=0.000246 mcu_task_stddev=0.000276 bytes_write=109253 bytes_read=49609 bytes_retransmit=0 bytes_invalid=0 send_seq=3760 receive_seq=3760 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998155  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.8 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.04 cputime=3647.508 memavail=1715924 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 80381.4: gcodein=0  mcu: mcu_awake=0.102 mcu_task_avg=0.000248 mcu_task_stddev=0.000274 bytes_write=111032 bytes_read=50369 bytes_retransmit=0 bytes_invalid=0 send_seq=3819 receive_seq=3819 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998208  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.0 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.04 cputime=3647.605 memavail=1715676 print_time=5.487 buffer_time=0.000 print_stall=0 extruder: target=0 temp=26.0 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Stats 93501.8: gcodein=0  mcu: mcu_awake=0.002 mcu_task_avg=0.000018 mcu_task_stddev=0.000013 bytes_write=1125860 bytes_read=2560666 bytes_retransmit=0 bytes_invalid=0 send_seq=48780 receive_seq=48780 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998156  orange_pi: temp=40.8 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.16 cputime=3989.149 memavail=1719500 print_time=13185.339 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 281473445108400: Disconnected
Restarting printer
Start printer at Mon Dec 30 23:32:07 2024 (1735590727.2 93502.9)
===== Config file =====
[virtual_sdcard]
path = /home/klipper/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = BASE_CANCEL_PRINT
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	TURN_OFF_HEATERS
	M107
	G91
	G1 E-{E} F1500
	G90
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT
	PARK

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	SAVE_GCODE_STATE NAME=PAUSE_STATE
	BASE_PAUSE
	G91
	G1 E-{E} F1500
	G90
	PARK

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	G91
	G1 E{E} F1500
	G90
	RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[gcode_macro _CLIENT_LINEAR_MOVE]
description = Linear move with save and restore of the gcode state
gcode = 
	{% set x_move = "X" ~ params.X if params.X is defined else "" %}
	{% set y_move = "Y" ~ params.Y if params.Y is defined else "" %}
	{% set z_move = "Z" ~ params.Z if params.Z is defined else "" %}
	{% set e_move = "E" ~ params.E if params.E is defined else "" %}
	{% set rate = "F" ~ params.F if params.F is defined else "" %}
	{% set ABSOLUTE = params.ABSOLUTE | default(0) | int != 0 %}
	{% set ABSOLUTE_E = params.ABSOLUTE_E | default(0) | int != 0 %}
	SAVE_GCODE_STATE NAME=_client_movement
	{% if x_move or y_move or z_move %}
	G9{ 0 if ABSOLUTE else 1 }
	{% endif %}
	{% if e_move %}
	M8{ 2 if ABSOLUTE_E else 3 }
	{% endif %}
	G1 { x_move } { y_move } { z_move } { e_move } { rate }
	RESTORE_GCODE_STATE NAME=_client_movement

[gcode_macro Backup_on_GitHub]
gcode = 
	{% set message = params.MESSAGE|default() %}
	{% if message %}
	RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
	{% else %}
	RUN_SHELL_COMMAND CMD=update_git_script
	{% endif %}

[gcode_macro list_sensors]
gcode = 
	{ action_respond_info(printer.heaters.available_heaters | join(', ')) }
	{ action_respond_info(printer.heaters.available_sensors | join(', ')) }

[gcode_macro Power_OFF]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = SET_PIN PIN=Power VALUE=0

[gcode_macro ACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60

[gcode_macro DEACTIVATE_POWER_OFF]
gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=0

[delayed_gcode POWER_OFF_PRINTER_CHECK_ACT]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK_ACT DURATION=60
	{% endif %}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro M141]
gcode = SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S|default(0)}

[gcode_macro M80]
gcode = SET_PIN PIN=Power  VALUE=1

[gcode_macro M81]
gcode = 
	
	SET_PIN PIN=Power VALUE=0

[gcode_macro M486]
gcode = 
	
	
	
	
	
	
	
	
	
	
	
	{% if 'exclude_object' not in printer %}
	{action_raise_error("[exclude_object] is not enabled")}
	{% endif %}
	
	{% if 'T' in params %}
	EXCLUDE_OBJECT RESET=1
	
	{% for i in range(params.T | int) %}
	EXCLUDE_OBJECT_DEFINE NAME={i}
	{% endfor %}
	{% endif %}
	
	{% if 'C' in params %}
	EXCLUDE_OBJECT CURRENT=1
	{% endif %}
	
	{% if 'P' in params %}
	EXCLUDE_OBJECT NAME={params.P}
	{% endif %}
	
	{% if 'S' in params %}
	{% if params.S == '-1' %}
	{% if printer.exclude_object.current_object %}
	EXCLUDE_OBJECT_END NAME={printer.exclude_object.current_object}
	{% endif %}
	{% else %}
	EXCLUDE_OBJECT_START NAME={params.S}
	{% endif %}
	{% endif %}
	
	{% if 'U' in params %}
	EXCLUDE_OBJECT RESET=1 NAME={params.U}
	{% endif %}

[gcode_macro M190]
rename_existing = M190.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M190.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _CHOME]
gcode = 
	{% if printer["gcode_macro status_homing"] != null %}
	status_homing
	{% endif %}
	{% if printer.toolhead.homed_axes != "xyz" %}
	G28
	{% endif %}
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro M109]
rename_existing = M109.1
gcode = 
	{% if printer["gcode_macro status_heating"] != null %}
	status_heating
	{% endif %}
	M109.1 { rawparams }
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro _MOVE_AWAY]
gcode = 
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	{% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
	
	G90
	G0 X{x_safe} Y{y_safe} Z{z_safe} F20000

[gcode_macro PARK_CENTER_REAR]
gcode = 
	{% if printer["gcode_macro status_busy"] != null %}
	status_busy
	{% endif %}
	{% set th = printer.toolhead %}
	{% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
	{% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
	
	G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600
	{% if printer["gcode_macro status_ready"] != null %}
	status_ready
	{% endif %}

[gcode_macro START_PRINT]
variable_retract = 15
gcode = 
	{% set chamber_temp = params.CHAMBER_TEMP|default(0)|float %}
	{% set extruder_temp = params.EXTRUDER_TEMP|default(210)|float %}
	{% set bed_temp = params.BED_TEMP|default(60)|float %}
	{% set E = printer["gcode_macro START_PRINT"].retract|float %}
	CLEAR_PAUSE
	G28
	Smart_Park
	M220 S100
	M221 S100
	SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={chamber_temp}
	SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp * 0.75}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	G90
	M82
	TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bed_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	G92 E0
	
	G1 E-15 F2000
	
	G92 E0
	G28
	BED_MESH_CALIBRATE
	PRIME_LINE

[gcode_macro pid_soplo]
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro pid_bed]
gcode = 
	PID_CALIBRATE HEATER=heater_bed TARGET=105

[gcode_macro BED]
gcode = 
	PROBE_CALIBRATE

[gcode_macro END_PRINT]
gcode = 
	
	{% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
	{% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
	{% set max_z = printer.configfile.config["stepper_z"]["position_max"]|float %}
	
	
	{% if printer.toolhead.position.x < (max_x - 20) %}
	{% set x_safe = 20.0 %}
	{% else %}
	{% set x_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.y < (max_y - 20) %}
	{% set y_safe = 20.0 %}
	{% else %}
	{% set y_safe = -20.0 %}
	{% endif %}
	
	{% if printer.toolhead.position.z < (max_z - 2) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - printer.toolhead.position.z %}
	{% endif %}
	
	
	M400
	G92 E0
	G1 E-15 F3600
	G91
	G0 Z{z_safe} F3600
	G0 X{x_safe} Y{y_safe} F20000
	
	
	M104 S0
	M104 S0
	M140 S0
	M106 S0
	G90
	G0 X{max_x / 2} Y{max_y} F3600
	
	SONG_CRAB_RAVE
	
	
	
	M117 Finished!
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro M300]
gcode = 
	
	{% set S = params.S|default(1000)|int %}
	
	{% set P = params.P|default(100)|int %}
	
	
	{% set V = params.V|default(99)|int %}
	SET_PIN PIN=beeper VALUE={0.1 * (V / 100) if S > 0 else 1} CYCLE_TIME={ 1.0 / S if S > 0 else 1 }
	G4 P{P}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
description = 
	"Plays a beep sound.
	@param {int} [S=1000] - Frequency in Hz
	@param {int} [P=100] - Duration in ms
	@param {int} [V=99] - Volume in percent"

[gcode_macro PRIME_LINE]
gcode = 
	{% set feedrate = params.F|default(10)|float * 60 %}
	{% set length = 100.0 %}
	{% set width = printer.configfile.settings.extruder.nozzle_diameter|float %}
	{% set height = ( (width / 0.04)|int - (width / 0.04 / 4)|int )|float * 0.04 %}
	
	{% set extrude = length * width * height * 1.5 %}
	SAVE_GCODE_STATE NAME=PRIME_LINE_STATE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	{% if 'Y' in params %}
	{% set x_start = 1.0 %}
	{% set y_start = (printer.toolhead.axis_maximum.y|float - 100) / 2 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 Y100 E{extrude} F{feedrate}
	G0 X{width} F5000
	G1 Y-100 E{extrude} F{feedrate}
	{% else %}
	{% set x_start = (printer.toolhead.axis_maximum.x|float - 100) / 2 %}
	{% set y_start = 1.0 %}
	G0 X{x_start} Y{y_start} F5000
	G0 Z{height} F1500
	G91
	
	G1 E8 F300
	
	
	G1 X100 E{extrude} F{feedrate}
	G0 Y{width} F5000
	G1 X-100 E{extrude} F{feedrate}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRIME_LINE_STATE

[gcode_macro VINT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% set extruder_temp = params.T|default(240)|float %}
	{% if printer.extruder.target > extruder_temp %}
	{% set extruder_temp = printer.extruder.target %}
	{% endif %}
	{% if printer.extruder.temperature < extruder_temp %}
	M118 Heating to {extruder_temp}
	SET_HEATER_TEMPERATURE HEATER=extruder TARGET={extruder_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
	{% endif %}

[gcode_macro M76]
gcode = 
	PAUSE

[gcode_macro M601]
gcode = 
	PAUSE

[gcode_macro G27]
gcode = 
	PARK

[gcode_macro M125]
gcode = 
	PARK

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro M701]
gcode = 
	FILAMENT_LOAD

[gcode_macro M702]
gcode = 
	FILAMENT_UNLOAD

[gcode_macro M500]
gcode = 
	SAVE_CONFIG

[gcode_macro PARK]
gcode = 
	{% set x_park = params.X|default(0)|float %}
	{% set y_park = params.Y|default(0)|float %}
	{% set z_park = params.Z|default(10)|float + printer.toolhead.position.z|float %}
	{% set x_max = printer.toolhead.axis_maximum.x|float %}
	{% set y_max = printer.toolhead.axis_maximum.y|float %}
	{% set z_max = printer.toolhead.axis_maximum.z|float %}
	{% if x_park > x_max %}
	{% set x_park = x_max %}
	{% endif %}
	{% if y_park > y_max %}
	{% set y_park = y_max %}
	{% endif %}
	{% if z_park > z_max %}
	{% set z_park = z_max %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PARK_STATE
	G90
	G1 Z{z_park} F1500
	G1 X{x_park} Y{y_park} F5000
	RESTORE_GCODE_STATE name=PARK_STATE

[gcode_macro START_DRYER]
description = Start the heated bed filament dryer.
gcode = 
	{% set ChamberTemperature = params.CHAMBER | default(65.0) | float %}
	{% set BedTemperature = params.TEMPERATURE | default(0.0) | float %}
	{% set DryTime = params.TIME | default(14400) | int %}
	M140 S{BedTemperature}
	M141 S{ChamberTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={DryTime}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=bed_temperature VALUE={BedTemperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=chamber_temperature VALUE={ChamberTemperature}
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1

[gcode_macro STOP_DRYER]
gcode = 
	M140 S0
	M141 S0
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE=0
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=0
	M117 Drying Stopped

[gcode_macro DRYER_STATUS]
variable_time_remaining = 0
variable_bed_temperature = 0
variable_chamber_temperature = 0
gcode = 
	{% if time_remaining > 0 %}
	M140 S{bed_temperature}
	SET_GCODE_VARIABLE MACRO=DRYER_STATUS VARIABLE=time_remaining VALUE={time_remaining - 1}
	M117 Drying {time_remaining}
	{% else %}
	STOP_DRYER
	{% endif %}

[delayed_gcode DRYER_TIMER]
gcode = 
	UPDATE_DELAYED_GCODE ID=DRYER_TIMER DURATION=1
	DRYER_STATUS

[gcode_macro DRY_tpu]
gcode = 
	START_DRYER TEMPERATURE=0 CHAMBER=50 TIME=18000

[gcode_macro DRY_PETG]
gcode = 
	START_DRYER TEMPERATURE=0  CHAMBER=65 TIME=18000

[gcode_macro DRY_ABS]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M4]
gcode = 
	{% set S = params.S|default(0.0)|float %}
	SET_PIN PIN=Laser VALUE={S / 255.0}

[gcode_macro M5]
gcode = 
	SET_PIN PIN=Laser VALUE=0

[menu __main __control __toolonoff]
type = input
enable = {'pwm_tool Laser' in printer}
name = Fan: {'ON ' if menu.input else 'OFF'}
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 1
gcode = 
	M3 S{255 if menu.input else 0}

[menu __main __control __toolspeed]
type = input
enable = {'pwm_tool Laser' in printer}
name = Laser speed: {'%3d' % (menu.input*100)}%
input = {printer['pwm_tool Laser'].value}
input_min = 0
input_max = 1
input_step = 0.01
gcode = 
	M3 S{'%d' % (menu.input*255)}

[gcode_macro NOTE]
description = 
	"Plays a specified note for a specified duration
	@param {string} [N=C5] - Note to play
	@param {int} [D=500] - Duration of note. There are currently some Klipper limitations to how short a note can be.
	@param {int} [V=99] - Volume in percent
	@param {bool} [S=true] - Whether or not to stop the note after duration"
gcode = 
	{% set notes = {
	'C0': 16.35,   'CS0': 17.32,   'D0': 18.35,   'DS0': 19.45,   'E0': 20.60,   'F0': 21.83,   'FS0': 23.12,   'G0': 24.50,   'GS0': 25.96,   'A0': 27.50,   'AS0': 29.14,   'B0': 30.87,
	'C1': 32.70,   'CS1': 34.65,   'D1': 36.71,   'DS1': 38.89,   'E1': 41.20,   'F1': 43.65,   'FS1': 46.25,   'G1': 49.00,   'GS1': 51.91,   'A1': 55.00,   'AS1': 58.27,   'B1': 61.74,
	'C2': 65.41,   'CS2': 69.30,   'D2': 73.42,   'DS2': 77.78,   'E2': 82.41,   'F2': 87.31,   'FS2': 92.50,   'G2': 98.00,   'GS2': 103.83,  'A2': 110.00,  'AS2': 116.54,  'B2': 123.47,
	'C3': 130.81,  'CS3': 138.59,  'D3': 146.83,  'DS3': 155.56,  'E3': 164.81,  'F3': 174.61,  'FS3': 185.00,  'G3': 196.00,  'GS3': 207.65,  'A3': 220.00,  'AS3': 233.08,  'B3': 246.94,
	'C4': 261.63,  'CS4': 277.18,  'D4': 293.66,  'DS4': 311.13,  'E4': 329.63,  'F4': 349.23,  'FS4': 369.99,  'G4': 392.00,  'GS4': 415.30,  'A4': 440.00,  'AS4': 466.16,  'B4': 493.88,
	'C5': 523.25,  'CS5': 554.37,  'D5': 587.33,  'DS5': 622.25,  'E5': 659.26,  'F5': 698.46,  'FS5': 739.99,  'G5': 783.99,  'GS5': 830.61,  'A5': 880.00,  'AS5': 932.33,  'B5': 987.77,
	'C6': 1046.50, 'CS6': 1108.73, 'D6': 1174.66, 'DS6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'FS6': 1479.98, 'G6': 1567.98, 'GS6': 1661.22, 'A6': 1760.00, 'AS6': 1864.66, 'B6': 1975.53,
	'C7': 2093.00, 'CS7': 2217.46, 'D7': 2349.32, 'DS7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'FS7': 2959.96, 'G7': 3135.96, 'GS7': 3322.44, 'A7': 3520.00, 'AS7': 3729.31, 'B7': 3951.07,
	'C8': 4186.01, 'CS8': 4434.92, 'D8': 4698.64, 'DS8': 4978.03, 'E8': 5274.04, 'F8': 5587.65, 'FS8': 5919.91, 'G8': 6271.93, 'GS8': 6644.88, 'A8': 7040.00, 'AS8': 7458.62, 'B8': 7902.13,
	} %}
	
	{% set note = params.N|default('C5')|string %}
	
	{% set dur = params.D|default(500)|int %}
	
	
	{% set volume = params.V|default(99)|int %}
	
	{% set stop = params.S|default('true')|string %}
	
	{% set freq = notes[note] %}
	
	SET_PIN PIN=beeper VALUE={0.1 * (volume / 100) if volume > 0 else 1} CYCLE_TIME={ 1.0 / freq }
	G4 P{dur}
	{% if stop|lower == 'true' %}
	SET_PIN PIN=beeper VALUE=0 CYCLE_TIME={ 0.001 }
	{% endif %}

[gcode_macro TONE_GEN]
description = "Used for the tone generator menu"
variable_tone_freq = 0.001093
gcode = 
	M117 {printer["gcode_macro TONE_GEN"].tone_freq}nothz

[gcode_macro SONG_STAR_WARS_MAIN_THEME]
description = "Plays the Star Wars main theme"
gcode = 
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=D4 D=133
	NOTE N=G4 D=1000
	NOTE N=D5 D=1000
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=A4 D=133
	NOTE N=G5 D=1000
	NOTE N=D5 D=500
	
	NOTE N=C5 D=133
	NOTE N=B4 D=133
	NOTE N=C5 D=133
	NOTE N=A4 D=1000

[gcode_macro SONG_CRAB_RAVE]
description = "Plays Crab Rave"
gcode = 
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=AS6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=1
	NOTE N=G6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=D6 D=150 V=30 S=1
	NOTE N=D6 D=150 V=30 S=0
	NOTE N=A6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=1
	NOTE N=F6 D=150 V=30 S=0
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=C6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=1
	NOTE N=E6 D=150 V=30 S=0
	NOTE N=F6 D=150 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro one]
description = "one"
gcode = 
	NOTE N=C6 D=600 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=E6 D=400 V=30 S=1
	G4 P150
	NOTE N=G6 D=180 V=30 S=0
	NOTE N=F6 D=180 V=30 S=0
	NOTE N=E6 D=180 V=30 S=0
	NOTE N=D6 D=180 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=G5 D=400 V=30 S=1
	NOTE N=D6 D=600 V=30 S=1
	NOTE N=C6 D=600 V=30 S=1
	SET_PIN PIN=beeper VALUE=0

[gcode_macro SONG_BOOMER]
description = "BOOMER"
gcode = 
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S659
	M300 P207 S784
	M300 P207 S494
	M300 P207 S494
	M300 P207 S392
	M300 P207 S494
	M300 P207 S494
	M300 P207 S330
	M300 P207 S784
	M300 P207 S659
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S784
	M300 P207 S880
	M300 P207 S988
	M300 P207 S523
	M300 P207 S523
	M300 P207 S392
	M300 P207 S523
	M300 P207 S523
	M300 P207 S330

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
gcode = 
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set probe_dock_enable = kamp_settings.probe_dock_enable | abs %}
	{% set attach_macro = kamp_settings.attach_macro | string %}
	{% set detach_macro = kamp_settings.detach_macro | string %}
	{% set mesh_margin = kamp_settings.mesh_margin | float %}
	{% set fuzz_amount = kamp_settings.fuzz_amount | float %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% set fuzz_range = range((0) | int, (fuzz_amount * 100) | int + 1) %}
	{% set adapted_x_min = x_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_y_min = y_min - mesh_margin - (fuzz_range | random / 100.0) %}
	{% set adapted_x_max = x_max + mesh_margin + (fuzz_range | random / 100.0) %}
	{% set adapted_y_max = y_max + mesh_margin + (fuzz_range | random / 100.0) %}
	
	{% set adapted_x_min = [adapted_x_min , bed_mesh_min[0]] | max %}
	{% set adapted_y_min = [adapted_y_min , bed_mesh_min[1]] | max %}
	{% set adapted_x_max = [adapted_x_max , bed_mesh_max[0]] | min %}
	{% set adapted_y_max = [adapted_y_max , bed_mesh_max[1]] | min %}
	
	{% set points_x = (((adapted_x_max - adapted_x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((adapted_y_max - adapted_y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	
	{% set points_x = [points_x , min_points]|max %}
	{% set points_y = [points_y , min_points]|max %}
	{% set points_x = [points_x , probe_count[0]]|min %}
	{% set points_y = [points_y , probe_count[1]]|min %}
	
	{% if verbose_enable == True %}
	{% if printer.exclude_object.objects != [] %}
	
	{ action_respond_info( "Algorithm: {}.".format(
	(algorithm),
	)) }
	
	{ action_respond_info("Default probe count: {},{}.".format(
	(probe_count[0]),
	(probe_count[1]),
	)) }
	
	{ action_respond_info("Adapted probe count: {},{}.".format(
	(points_x),
	(points_y),
	)) }
	
	{action_respond_info("Default mesh bounds: {}, {}.".format(
	(bed_mesh_min[0],bed_mesh_min[1]),
	(bed_mesh_max[0],bed_mesh_max[1]),
	)) }
	
	{% if mesh_margin > 0 %}
	{action_respond_info("Mesh margin is {}, mesh bounds extended by {}mm.".format(
	(mesh_margin),
	(mesh_margin),
	)) }
	{% else %}
	{action_respond_info("Mesh margin is 0, margin not increased.")}
	{% endif %}
	
	{% if fuzz_amount > 0 %}
	{action_respond_info("Mesh point fuzzing enabled, points fuzzed up to {}mm.".format(
	(fuzz_amount),
	)) }
	{% else %}
	{action_respond_info("Fuzz amount is 0, mesh points not fuzzed.")}
	{% endif %}
	
	{ action_respond_info("Adapted mesh bounds: {}, {}.".format(
	(adapted_x_min, adapted_y_min),
	(adapted_x_max, adapted_y_max),
	)) }
	
	{action_respond_info("KAMP adjustments successful. Happy KAMPing!")}
	
	{% else %}
	
	{action_respond_info("No objects detected! Check your gcode and make sure that EXCLUDE_OBJECT_DEFINE is happening before BED_MESH_CALIBRATE is called. Defaulting to regular meshing.")}
	G4 P5000
	{% endif %}
	
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={adapted_x_min},{adapted_y_min} mesh_max={adapted_x_max},{adapted_y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SMART_PARK]
description = Parks your printhead near the print area for pre-print hotend heating.
gcode = 
	
	{% set kamp_settings = printer["gcode_macro _KAMP_Settings"] %}
	{% set z_height = kamp_settings.smart_park_height | float %}
	{% set purge_margin = kamp_settings.purge_margin | float %}
	{% set verbose_enable = kamp_settings.verbose_enable | abs %}
	{% set center_x = printer.toolhead.axis_maximum.x / 2 | float %}
	{% set center_y = printer.toolhead.axis_maximum.y / 2 | float %}
	{% set axis_minimum_x = printer.toolhead.axis_minimum.x | float %}
	{% set axis_minimum_y = printer.toolhead.axis_minimum.y | float %}
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set x_min = all_points | map(attribute=0) | min | default(center_x) %}
	{% set y_min = all_points | map(attribute=1) | min | default(center_y) %}
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	
	{% if purge_margin > 0 and x_min != center_x and y_min != center_y %}
	{% set x_min = [ x_min - purge_margin , x_min ] | min %}
	{% set y_min = [ y_min - purge_margin , y_min ] | min %}
	{% set x_min = [ x_min , axis_minimum_x ] | max %}
	{% set y_min = [ y_min , axis_minimum_y ] | max %}
	{% endif %}
	
	
	{% if verbose_enable == True %}
	
	{ action_respond_info("Smart Park location: {},{}.".format(
	(x_min),
	(y_min),
	)) }
	
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Presmartpark_State
	
	G90
	{% if printer.toolhead.position.z < z_height %}
	G0 Z{z_height}
	{% endif %}
	G0 X{x_min} Y{y_min} F{travel_speed}
	G0 Z{z_height}
	
	RESTORE_GCODE_STATE NAME=Presmartpark_State

[gcode_macro _KAMP_Settings]
description = This macro contains all adjustable settings for KAMP
variable_verbose_enable = True
variable_mesh_margin = 0
variable_fuzz_amount = 0
variable_probe_dock_enable = False
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_purge_height = 0.8
variable_tip_distance = 0
variable_purge_margin = 10
variable_purge_amount = 30
variable_flow_rate = 12
variable_smart_park_height = 0.0
gcode = 
	
	{action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}

[exclude_object]

[neopixel panel_ring]
pin = PA8
chain_count = 16

[led_effect panel_idle]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  10 1 top (.5,.5,1)

[led_effect busy]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring
layers = 
	breathing  3 1 top (1,0,0)

[led_effect cleaning]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.02, 0.5)

[led_effect calibrating_z]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.0, 0.35)

[led_effect heating]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (1, 0.18, 0)

[led_effect cooling]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	breathing  3 1 top (0, 0, 1)

[led_effect homing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 0.6, 0.2)

[led_effect leveling]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.5, 0.1, 0.4)

[led_effect meshing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.2, 1.0, 0.0)

[led_effect printing]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.3, 0.3, 0.0),(0.3, 0.1, 0.0)

[led_effect standby]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.01, 0.01, 0.01)

[led_effect part_ready]
autostart = false
frame_rate = 24
leds = 
	neopixel:panel_ring  (1)
layers = 
	breathing  3 1 top (0.0, 1.0, 0.0)

[led_effect critical_error]
leds = 
	neopixel:panel_ring
layers = 
	strobe         1  1.5   add        (1.0,  1.0, 1.0)
	breathing      2  0     difference (0.95, 0.0, 0.0)
	static         1  0     top        (1.0,  0.0, 0.0)
autostart = false
frame_rate = 24
run_on_error = true

[led_effect rainbow]
leds = 
	neopixel:panel_ring (16-9)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect rainbow-back]
leds = 
	neopixel:panel_ring (1-8)
autostart = true
frame_rate = 24
layers = 
	gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)

[led_effect set_nozzle_leds]
leds = 
	neopixel:panel_ring  (2,3)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (0.0,  0.0, 0.0, 1.0)

[led_effect set_logo_leds]
leds = 
	neopixel:panel_ring  (1)
autostart = false
frame_rate = 24
layers = 
	static         0  0     top        (1.0,  1.0, 1.0)

[gcode_macro set_logo_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_logo_leds STOP=1

[gcode_macro set_logo_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_logcritical_erroro_leds

[gcode_macro set_nozzle_leds_on]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds

[gcode_macro set_nozzle_leds_off]
gcode = 
	SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1

[gcode_macro status_off]
gcode = 
	STOP_LED_EFFECTS

[gcode_macro status_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=rainbow

[gcode_macro status_part_ready]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_nozzle_part_ready
	SET_LED_EFFECT EFFECT=sb_logo_part_ready

[gcode_macro status_busy]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_busy
	set_nozzle_leds_on

[gcode_macro status_heating]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_heating
	SET_LED_EFFECT EFFECT=sb_nozzle_heating

[gcode_macro status_cooling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cooling
	SET_LED_EFFECT EFFECT=sb_nozzle_cooling

[gcode_macro status_leveling]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_leveling
	set_nozzle_leds_on

[gcode_macro status_homing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_homing
	set_nozzle_leds_on

[gcode_macro status_cleaning]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_cleaning
	set_nozzle_leds_on

[gcode_macro status_meshing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_meshing
	set_nozzle_leds_on

[gcode_macro status_calibrating_z]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_calibrating_z
	set_nozzle_leds_on

[gcode_macro status_printing]
gcode = 
	STOP_LED_EFFECTS
	SET_LED_EFFECT EFFECT=sb_logo_printing
	set_nozzle_leds_on

[gcode_shell_command update_git_script]
command = bash -c "bash $HOME/klipper-backup/script.sh"
timeout = 90.0
verbose = True

[gcode_shell_command update_git_script_message]
command = bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout = 90.0
verbose = True

[mcu]
serial = /dev/ttyS3
restart_method = command

[output_pin Power]
pin = PC12
value = 1
shutdown_value = 1

[temperature_sensor orange_pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[heater_generic chamber_heater]
heater_pin = !PA7
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA5
control = watermark
max_power = 1
min_temp = 15
max_temp = 85

[verify_heater chamber_heater]
max_error = 9999
check_gain_time = 9999
hysteresis = 5
heating_gain = 2

[filament_motion_sensor motion_sensor]
detection_length = 50
extruder = extruder
switch_pin = !PC15
pause_on_runout = True
runout_gcode = 
	SONG_CRAB_RAVE

[bltouch]
sensor_pin = ^PC14
control_pin = PA1
x_offset = -40
y_offset = 0.000
z_offset = 1.70
pin_up_reports_not_triggered = False
probe_with_touch_mode = True

[heater_bed]
heater_pin = PC9
sensor_type = ATC Semitec 104GT-2
sensor_pin = PC3
control = pid
pid_kp = 72.553
pid_ki = 1.154
pid_kd = 1139.994
min_temp = 5
max_temp = 125

[heater_fan radiator]
pin = PC7
max_power = 1.0
kick_start_time = 0.600
heater = extruder
heater_temp = 50.0
shutdown_speed = 1

[fan]
pin = PC6

[input_shaper]
shaper_type_x = 2hump_ei
shaper_freq_x = 43.0
shaper_type_y = mzv
shaper_freq_y = 32.6

[printer]
kinematics = cartesian
max_velocity = 300
max_accel = 1900
max_z_velocity = 30
max_z_accel = 100
square_corner_velocity = 4

[bed_mesh]
speed = 150
horizontal_move_z = 9
mesh_min = 10, 20
mesh_max = 195, 210
probe_count = 5
mesh_pps = 2, 3
algorithm = bicubic
bicubic_tension = 0.2
move_check_distance = 9
split_delta_z = .025
fade_start = 1
fade_end = 10
fade_target = 0

[screws_tilt_adjust]
screw1 = 79, 27
screw1_name = Peredniy Leviy
screw2 = 235, 27
screw2_name = Peredniy Praviy
screw3 = 235,197
screw3_name = Zadniy Praviy
screw4 = 79,197
screw4_name = Zadniy Leviy
speed = 120
horizontal_move_z = 9

[safe_z_home]
home_xy_position = 157,115
speed = 50
z_hop = 9.0
z_hop_speed = 20.0

[stepper_x]
step_pin = PB13
dir_pin = !PB12
enable_pin = !PB14
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC0
position_endstop = 0
position_max = 240
position_min = -2
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10

[tmc2209 stepper_x]
uart_pin = PC11
tx_pin = PC10
uart_address = 0
run_current = 0.580
stealthchop_threshold = 999999

[stepper_y]
step_pin = PB10
dir_pin = !PB2
enable_pin = !PB11
microsteps = 16
rotation_distance = 40
endstop_pin = ^PC1
position_endstop = 0
homing_retract_dist = 5
homing_speed = 50
second_homing_speed = 10
position_max = 231
position_min = 0

[tmc2209 stepper_y]
uart_pin = PC11
tx_pin = PC10
uart_address = 2
run_current = 0.6
stealthchop_threshold = 999999

[stepper_z]
step_pin = PB0
dir_pin = PC5
enable_pin = !PB1
microsteps = 16
rotation_distance = 40
gear_ratio = 80:16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
homing_retract_dist = 9
second_homing_speed = 10
position_min = -5
position_max = 245
homing_speed = 50

[tmc2209 stepper_z]
uart_pin = PC11
tx_pin = PC10
uart_address = 1
run_current = 0.580
stealthchop_threshold = 999999
interpolate = false

[extruder]
step_pin = PB3
dir_pin = PB4
enable_pin = !PD2
microsteps = 16
rotation_distance = 4.637
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = PC8
sensor_type = ATC Semitec 104GT-2
sensor_pin = PA0
min_temp = 5
max_temp = 270
max_extrude_only_velocity = 120
max_extrude_only_accel = 3000
pressure_advance = 0.031
full_steps_per_rotation = 200
control = pid
pid_kp = 29.662
pid_ki = 2.382
pid_kd = 92.322

[tmc2209 extruder]
uart_pin = PC11
tx_pin = PC10
uart_address = 3
run_current = 0.7
stealthchop_threshold = 999999

[static_digital_output usb_pullup_enable]
pins = !PA14

[board_pins]
aliases = 
	
	EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
	EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

[display]
lcd_type = st7920
cs_pin = EXP1_7
sclk_pin = EXP1_6
sid_pin = EXP1_8
encoder_pins = ^EXP1_5, ^EXP1_3
click_pin = ^!EXP1_2

[pwm_cycle_time beeper]
pin = EXP1_1
shutdown_value = 0
cycle_time = 0.001

[firmware_retraction]
retract_length = 1.0
retract_speed = 80
unretract_extra_length = 0
unretract_speed = 80

[pwm_tool Laser]
pin = PA6
cycle_time = 0.0001
shutdown_value = 0
maximum_mcu_duration = 5

[bed_mesh 70]
version = 1
points = 
	-0.045000, 0.027500, 0.015000
	-0.055000, -0.005000, -0.035000
	-0.007500, 0.040000, -0.002500
x_count = 3
y_count = 3
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0

[bed_mesh default]
version = 1
points = 
	0.020000, 0.025000, 0.030000, -0.007500, -0.052500
	0.015000, 0.017500, 0.022500, -0.007500, -0.057500
	0.030000, 0.030000, 0.037500, 0.002500, -0.035000
	0.012500, 0.030000, 0.050000, 0.035000, -0.010000
	0.080000, 0.087500, 0.115000, 0.097500, 0.067500
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 195.0
min_y = 20.0
max_y = 210.0
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 281473445079904: New connection
webhooks client 281473445079904: Client info {'program': 'Moonraker', 'version': 'v0.9.3-4-ga4604e3'}
Loaded MCU 'mcu' 118 commands (v0.12.0-404-g80d185c94 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=72000000 INITIAL_PINS=!PA14 MCU=stm32f103xe PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_serial=PA3,PA2 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for chamber_heater
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (50.0, 20.0)    | (10.0, 20.0)
  1   | (96.2, 20.0)    | (56.2, 20.0)
  2   | (142.5, 20.0)   | (102.5, 20.0)
  3   | (188.8, 20.0)   | (148.8, 20.0)
  4   | (235.0, 20.0)   | (195.0, 20.0)
  5   | (235.0, 67.5)   | (195.0, 67.5)
  6   | (188.8, 67.5)   | (148.8, 67.5)
  7   | (142.5, 67.5)   | (102.5, 67.5)
  8   | (96.2, 67.5)    | (56.2, 67.5)
  9   | (50.0, 67.5)    | (10.0, 67.5)
  10  | (50.0, 115.0)   | (10.0, 115.0)
  11  | (96.2, 115.0)   | (56.2, 115.0)
  12  | (142.5, 115.0)  | (102.5, 115.0)
  13  | (188.8, 115.0)  | (148.8, 115.0)
  14  | (235.0, 115.0)  | (195.0, 115.0)
  15  | (235.0, 162.5)  | (195.0, 162.5)
  16  | (188.8, 162.5)  | (148.8, 162.5)
  17  | (142.5, 162.5)  | (102.5, 162.5)
  18  | (96.2, 162.5)   | (56.2, 162.5)
  19  | (50.0, 162.5)   | (10.0, 162.5)
  20  | (50.0, 210.0)   | (10.0, 210.0)
  21  | (96.2, 210.0)   | (56.2, 210.0)
  22  | (142.5, 210.0)  | (102.5, 210.0)
  23  | (188.8, 210.0)  | (148.8, 210.0)
  24  | (235.0, 210.0)  | (195.0, 210.0)
Starting heater checks for extruder
Stats 93507.1: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000030 mcu_task_stddev=0.000053 bytes_write=3274 bytes_read=6191 bytes_retransmit=9 bytes_invalid=0 send_seq=230 receive_seq=227 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=1986 upcoming_bytes=187 freq=71994937  orange_pi: temp=42.5 chamber_heater: target=0 temp=0.0 pwm=0.000 heater_bed: target=0 temp=0.0 pwm=0.000 sysload=1.23 cputime=3992.311 memavail=1719612 print_time=5.495 buffer_time=0.196 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 281473445079904
webhooks: registering remote method 'reboot_machine' for connection id: 281473445079904
webhooks: registering remote method 'pause_job_queue' for connection id: 281473445079904
webhooks: registering remote method 'start_job_queue' for connection id: 281473445079904
Stats 93508.1: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000030 mcu_task_stddev=0.000053 bytes_write=7294 bytes_read=6924 bytes_retransmit=9 bytes_invalid=0 send_seq=323 receive_seq=322 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=11 upcoming_bytes=0 freq=71996526  orange_pi: temp=42.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=3992.415 memavail=1719196 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93509.1: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000030 mcu_task_stddev=0.000053 bytes_write=9046 bytes_read=7634 bytes_retransmit=9 bytes_invalid=0 send_seq=382 receive_seq=382 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=52 upcoming_bytes=0 freq=71997331  orange_pi: temp=42.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.23 cputime=3992.520 memavail=1718972 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93510.1: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000030 mcu_task_stddev=0.000053 bytes_write=10976 bytes_read=8723 bytes_retransmit=9 bytes_invalid=0 send_seq=467 receive_seq=467 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997561  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.29 cputime=3992.608 memavail=1718972 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 93511.1: gcodein=0  mcu: mcu_awake=0.008 mcu_task_avg=0.000030 mcu_task_stddev=0.000053 bytes_write=12985 bytes_read=9927 bytes_retransmit=9 bytes_invalid=0 send_seq=563 receive_seq=562 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997760  orange_pi: temp=41.9 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.29 cputime=3992.697 memavail=1718972 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93512.1: gcodein=0  mcu: mcu_awake=0.170 mcu_task_avg=0.000268 mcu_task_stddev=0.000306 bytes_write=14821 bytes_read=10800 bytes_retransmit=9 bytes_invalid=0 send_seq=632 receive_seq=632 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997854  orange_pi: temp=42.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.29 cputime=3992.779 memavail=1719000 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 93513.1: gcodein=0  mcu: mcu_awake=0.170 mcu_task_avg=0.000268 mcu_task_stddev=0.000306 bytes_write=16526 bytes_read=11538 bytes_retransmit=9 bytes_invalid=0 send_seq=690 receive_seq=690 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71997952  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.29 cputime=3992.854 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93514.1: gcodein=0  mcu: mcu_awake=0.170 mcu_task_avg=0.000268 mcu_task_stddev=0.000306 bytes_write=18461 bytes_read=12612 bytes_retransmit=9 bytes_invalid=0 send_seq=775 receive_seq=775 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998023  orange_pi: temp=41.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.2 pwm=0.000 sysload=1.29 cputime=3992.942 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93515.1: gcodein=0  mcu: mcu_awake=0.170 mcu_task_avg=0.000268 mcu_task_stddev=0.000306 bytes_write=20349 bytes_read=13598 bytes_retransmit=9 bytes_invalid=0 send_seq=855 receive_seq=855 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998041  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.27 cputime=3993.028 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93516.1: gcodein=0  mcu: mcu_awake=0.170 mcu_task_avg=0.000268 mcu_task_stddev=0.000306 bytes_write=22126 bytes_read=14393 bytes_retransmit=9 bytes_invalid=0 send_seq=918 receive_seq=918 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998096  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.27 cputime=3993.106 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93517.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000277 mcu_task_stddev=0.000261 bytes_write=24008 bytes_read=15427 bytes_retransmit=9 bytes_invalid=0 send_seq=998 receive_seq=998 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998084  orange_pi: temp=41.2 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.27 cputime=3993.190 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93518.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000277 mcu_task_stddev=0.000261 bytes_write=25994 bytes_read=16577 bytes_retransmit=9 bytes_invalid=0 send_seq=1091 receive_seq=1090 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998071  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.27 cputime=3993.280 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93519.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000277 mcu_task_stddev=0.000261 bytes_write=27874 bytes_read=17515 bytes_retransmit=9 bytes_invalid=0 send_seq=1165 receive_seq=1164 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998061  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.27 cputime=3993.363 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 93520.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000277 mcu_task_stddev=0.000261 bytes_write=29584 bytes_read=18285 bytes_retransmit=9 bytes_invalid=0 send_seq=1225 receive_seq=1225 retransmit_seq=2 srtt=0.001 rttvar=0.001 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998079  orange_pi: temp=41.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.25 cputime=3993.439 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93521.1: gcodein=0  mcu: mcu_awake=0.130 mcu_task_avg=0.000277 mcu_task_stddev=0.000261 bytes_write=31403 bytes_read=19128 bytes_retransmit=9 bytes_invalid=0 send_seq=1294 receive_seq=1294 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998070  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.25 cputime=3993.519 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93522.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000284 mcu_task_stddev=0.000263 bytes_write=33260 bytes_read=20057 bytes_retransmit=9 bytes_invalid=0 send_seq=1367 receive_seq=1366 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998067  orange_pi: temp=41.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.25 cputime=3993.601 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93523.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000284 mcu_task_stddev=0.000263 bytes_write=35065 bytes_read=20962 bytes_retransmit=9 bytes_invalid=0 send_seq=1438 receive_seq=1438 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998065  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.25 cputime=3993.682 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 93524.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000284 mcu_task_stddev=0.000263 bytes_write=36954 bytes_read=21935 bytes_retransmit=9 bytes_invalid=0 send_seq=1517 receive_seq=1517 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998372  orange_pi: temp=41.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.9 pwm=0.000 sysload=1.25 cputime=3993.791 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93525.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000284 mcu_task_stddev=0.000263 bytes_write=38831 bytes_read=22917 bytes_retransmit=9 bytes_invalid=0 send_seq=1595 receive_seq=1595 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998320  orange_pi: temp=41.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.23 cputime=3993.876 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93526.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000284 mcu_task_stddev=0.000263 bytes_write=40750 bytes_read=23939 bytes_retransmit=9 bytes_invalid=0 send_seq=1677 receive_seq=1676 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998277  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.23 cputime=3993.963 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93527.1: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=42591 bytes_read=24877 bytes_retransmit=9 bytes_invalid=0 send_seq=1751 receive_seq=1751 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998366  orange_pi: temp=41.2 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=3994.044 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93528.1: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=44395 bytes_read=25724 bytes_retransmit=9 bytes_invalid=0 send_seq=1818 receive_seq=1818 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998320  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.23 cputime=3994.123 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93529.1: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=46320 bytes_read=26816 bytes_retransmit=9 bytes_invalid=0 send_seq=1905 receive_seq=1905 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998283  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.23 cputime=3994.211 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 93530.1: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=48229 bytes_read=27844 bytes_retransmit=9 bytes_invalid=0 send_seq=1987 receive_seq=1987 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998256  orange_pi: temp=41.7 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=3994.296 memavail=1719004 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93531.1: gcodein=0  mcu: mcu_awake=0.138 mcu_task_avg=0.000282 mcu_task_stddev=0.000259 bytes_write=50057 bytes_read=28730 bytes_retransmit=9 bytes_invalid=0 send_seq=2057 receive_seq=2057 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998229  orange_pi: temp=41.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.21 cputime=3994.377 memavail=1719008 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 93532.1: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=51724 bytes_read=29397 bytes_retransmit=9 bytes_invalid=0 send_seq=2110 receive_seq=2110 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998215  orange_pi: temp=41.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.21 cputime=3994.450 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93533.1: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=53633 bytes_read=30378 bytes_retransmit=9 bytes_invalid=0 send_seq=2189 receive_seq=2189 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998204  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.21 cputime=3994.533 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93534.1: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=55486 bytes_read=31316 bytes_retransmit=9 bytes_invalid=0 send_seq=2263 receive_seq=2263 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998188  orange_pi: temp=41.1 chamber_heater: target=0 temp=26.3 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.21 cputime=3994.615 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93535.1: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=57318 bytes_read=32224 bytes_retransmit=9 bytes_invalid=0 send_seq=2335 receive_seq=2335 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998173  orange_pi: temp=41.0 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.27 cputime=3994.697 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93536.1: gcodein=0  mcu: mcu_awake=0.129 mcu_task_avg=0.000278 mcu_task_stddev=0.000262 bytes_write=59108 bytes_read=33062 bytes_retransmit=9 bytes_invalid=0 send_seq=2403 receive_seq=2403 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998163  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.27 cputime=3994.774 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93537.1: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000280 mcu_task_stddev=0.000262 bytes_write=60919 bytes_read=33926 bytes_retransmit=9 bytes_invalid=0 send_seq=2470 receive_seq=2470 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998155  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.27 cputime=3994.856 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93538.1: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000280 mcu_task_stddev=0.000262 bytes_write=62837 bytes_read=34974 bytes_retransmit=9 bytes_invalid=0 send_seq=2553 receive_seq=2553 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998158  orange_pi: temp=41.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.27 cputime=3994.944 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93539.1: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000280 mcu_task_stddev=0.000262 bytes_write=64585 bytes_read=35734 bytes_retransmit=9 bytes_invalid=0 send_seq=2615 receive_seq=2615 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998150  orange_pi: temp=41.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.27 cputime=3995.020 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93540.1: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000280 mcu_task_stddev=0.000262 bytes_write=66422 bytes_read=36641 bytes_retransmit=9 bytes_invalid=0 send_seq=2686 receive_seq=2686 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998144  orange_pi: temp=40.9 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.25 cputime=3995.100 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93541.1: gcodein=0  mcu: mcu_awake=0.128 mcu_task_avg=0.000280 mcu_task_stddev=0.000262 bytes_write=68229 bytes_read=37473 bytes_retransmit=9 bytes_invalid=0 send_seq=2753 receive_seq=2753 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998139  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.25 cputime=3995.180 memavail=1719016 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93542.1: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000272 mcu_task_stddev=0.000263 bytes_write=70002 bytes_read=38341 bytes_retransmit=9 bytes_invalid=0 send_seq=2822 receive_seq=2822 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=42 upcoming_bytes=0 freq=71998135  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.25 cputime=3995.261 memavail=1719224 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93543.1: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000272 mcu_task_stddev=0.000263 bytes_write=71824 bytes_read=39183 bytes_retransmit=9 bytes_invalid=0 send_seq=2888 receive_seq=2888 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998131  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.25 cputime=3995.339 memavail=1719328 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93544.1: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000272 mcu_task_stddev=0.000263 bytes_write=73622 bytes_read=40002 bytes_retransmit=9 bytes_invalid=0 send_seq=2954 receive_seq=2954 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998128  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.25 cputime=3995.417 memavail=1719328 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93545.1: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000272 mcu_task_stddev=0.000263 bytes_write=75587 bytes_read=41126 bytes_retransmit=9 bytes_invalid=0 send_seq=3044 receive_seq=3044 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998125  orange_pi: temp=41.4 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.23 cputime=3995.508 memavail=1719328 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93546.1: gcodein=0  mcu: mcu_awake=0.125 mcu_task_avg=0.000272 mcu_task_stddev=0.000263 bytes_write=77454 bytes_read=42116 bytes_retransmit=9 bytes_invalid=0 send_seq=3122 receive_seq=3122 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998123  orange_pi: temp=41.4 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.23 cputime=3995.591 memavail=1719328 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93547.1: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000279 mcu_task_stddev=0.000255 bytes_write=79296 bytes_read=43059 bytes_retransmit=9 bytes_invalid=0 send_seq=3195 receive_seq=3195 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998121  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.23 cputime=3995.674 memavail=1719328 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93548.1: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000279 mcu_task_stddev=0.000255 bytes_write=81115 bytes_read=43902 bytes_retransmit=9 bytes_invalid=0 send_seq=3264 receive_seq=3264 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998120  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.23 cputime=3995.753 memavail=1719328 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93549.1: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000279 mcu_task_stddev=0.000255 bytes_write=82940 bytes_read=44848 bytes_retransmit=9 bytes_invalid=0 send_seq=3338 receive_seq=3338 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998119  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.23 cputime=3995.836 memavail=1719332 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93550.1: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000279 mcu_task_stddev=0.000255 bytes_write=84814 bytes_read=45792 bytes_retransmit=9 bytes_invalid=0 send_seq=3413 receive_seq=3413 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998118  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.9 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=3995.920 memavail=1719332 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93551.1: gcodein=0  mcu: mcu_awake=0.134 mcu_task_avg=0.000279 mcu_task_stddev=0.000255 bytes_write=86633 bytes_read=46635 bytes_retransmit=9 bytes_invalid=0 send_seq=3482 receive_seq=3482 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998117  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.21 cputime=3995.999 memavail=1719332 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93552.1: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=88454 bytes_read=47551 bytes_retransmit=9 bytes_invalid=0 send_seq=3553 receive_seq=3553 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998116  orange_pi: temp=41.2 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.21 cputime=3996.083 memavail=1719332 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93553.1: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=90404 bytes_read=48690 bytes_retransmit=9 bytes_invalid=0 send_seq=3643 receive_seq=3643 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998116  orange_pi: temp=41.6 chamber_heater: target=0 temp=26.7 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.21 cputime=3996.173 memavail=1719332 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93554.1: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=92191 bytes_read=49468 bytes_retransmit=9 bytes_invalid=0 send_seq=3707 receive_seq=3707 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998182  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.21 cputime=3996.250 memavail=1719332 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 93555.1: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=94037 bytes_read=50393 bytes_retransmit=9 bytes_invalid=0 send_seq=3780 receive_seq=3780 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=2 upcoming_bytes=0 freq=71998175  orange_pi: temp=40.1 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.19 cputime=3996.332 memavail=1719336 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93556.1: gcodein=0  mcu: mcu_awake=0.121 mcu_task_avg=0.000268 mcu_task_stddev=0.000260 bytes_write=95862 bytes_read=51337 bytes_retransmit=9 bytes_invalid=0 send_seq=3855 receive_seq=3855 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998169  orange_pi: temp=41.4 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.19 cputime=3996.413 memavail=1719336 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.9 pwm=0.000
Stats 93557.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=97738 bytes_read=52283 bytes_retransmit=9 bytes_invalid=0 send_seq=3930 receive_seq=3930 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998166  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.19 cputime=3996.497 memavail=1719336 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93558.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=99566 bytes_read=53169 bytes_retransmit=9 bytes_invalid=0 send_seq=4000 receive_seq=4000 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998161  orange_pi: temp=41.2 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.19 cputime=3996.577 memavail=1719336 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.6 pwm=0.000
Stats 93559.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=101352 bytes_read=54040 bytes_retransmit=9 bytes_invalid=0 send_seq=4070 receive_seq=4070 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=43 upcoming_bytes=0 freq=71998157  orange_pi: temp=41.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.19 cputime=3996.656 memavail=1719336 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93560.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=103214 bytes_read=54938 bytes_retransmit=9 bytes_invalid=0 send_seq=4142 receive_seq=4142 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998155  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.18 cputime=3996.736 memavail=1719336 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93561.1: gcodein=0  mcu: mcu_awake=0.136 mcu_task_avg=0.000280 mcu_task_stddev=0.000257 bytes_write=104990 bytes_read=55723 bytes_retransmit=9 bytes_invalid=0 send_seq=4205 receive_seq=4205 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998152  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.18 cputime=3996.814 memavail=1719340 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93562.1: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000271 mcu_task_stddev=0.000264 bytes_write=106821 bytes_read=56625 bytes_retransmit=9 bytes_invalid=0 send_seq=4277 receive_seq=4277 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998151  orange_pi: temp=41.4 chamber_heater: target=0 temp=26.6 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.18 cputime=3996.896 memavail=1719088 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93563.1: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000271 mcu_task_stddev=0.000264 bytes_write=108627 bytes_read=57487 bytes_retransmit=9 bytes_invalid=0 send_seq=4347 receive_seq=4347 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998150  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.4 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.18 cputime=3996.975 memavail=1719088 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93564.1: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000271 mcu_task_stddev=0.000264 bytes_write=110622 bytes_read=58670 bytes_retransmit=9 bytes_invalid=0 send_seq=4440 receive_seq=4440 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998147  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.4 pwm=0.000 sysload=1.18 cputime=3997.065 memavail=1719088 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Stats 93565.1: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000271 mcu_task_stddev=0.000264 bytes_write=112454 bytes_read=59554 bytes_retransmit=9 bytes_invalid=0 send_seq=4511 receive_seq=4511 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998148  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.2 pwm=0.000 heater_bed: target=0 temp=25.3 pwm=0.000 sysload=1.16 cputime=3997.145 memavail=1719088 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93566.1: gcodein=0  mcu: mcu_awake=0.119 mcu_task_avg=0.000271 mcu_task_stddev=0.000264 bytes_write=114348 bytes_read=60509 bytes_retransmit=9 bytes_invalid=0 send_seq=4588 receive_seq=4588 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998147  orange_pi: temp=41.5 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.6 pwm=0.000 sysload=1.16 cputime=3997.228 memavail=1719088 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.7 pwm=0.000
Stats 93567.1: gcodein=0  mcu: mcu_awake=0.147 mcu_task_avg=0.000297 mcu_task_stddev=0.000259 bytes_write=116200 bytes_read=61537 bytes_retransmit=9 bytes_invalid=0 send_seq=4667 receive_seq=4667 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=71998196  orange_pi: temp=41.3 chamber_heater: target=0 temp=26.5 pwm=0.000 heater_bed: target=0 temp=25.5 pwm=0.000 sysload=1.16 cputime=3997.312 memavail=1719088 print_time=5.495 buffer_time=0.000 print_stall=0 extruder: target=0 temp=25.8 pwm=0.000
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
Neopixel update did not succeed
